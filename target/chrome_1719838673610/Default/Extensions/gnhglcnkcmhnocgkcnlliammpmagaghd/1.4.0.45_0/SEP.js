'use strict';self.window=self;/*
 CryptoJS v3.1.2 core-fix.js
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 THIS IS FIX of 'core.js' to fix Hmac issue.
 https://code.google.com/p/crypto-js/issues/detail?id=84
 https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
 (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
 Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
*/
var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},f=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;b&&c.mixIn(b);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},
clone:function(){return this.init.prototype.extend(this)}}}(),k=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||m).stringify(this)},concat:function(a){var b=this.words,c=a.words,e=this.sigBytes;a=a.sigBytes;this.clamp();if(e%4)for(var d=0;d<a;d++)b[e+d>>>2]|=(c[d>>>2]>>>24-d%4*8&255)<<24-(e+d)%4*8;else for(d=0;d<a;d+=4)b[e+d>>>2]=c[d>>>2];this.sigBytes+=a;return this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>
2]&=4294967295<<32-c%4*8;b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],e=0;e<b;e+=4)c.push(4294967296*a.random()|0);return new k.init(c,b)}}),l=c.enc={},m=l.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],e=0;e<a;e++){var d=b[e>>>2]>>>24-e%4*8&255;c.push((d>>>4).toString(16));c.push((d&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],e=0;e<b;e+=2)c[e>>>3]|=parseInt(a.substr(e,
2),16)<<24-e%8*4;return new k.init(c,b/2)}},e=l.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],e=0;e<a;e++)c.push(String.fromCharCode(b[e>>>2]>>>24-e%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],e=0;e<b;e++)c[e>>>2]|=(a.charCodeAt(e)&255)<<24-e%4*8;return new k.init(c,b)}},h=l.Utf8={stringify:function(a){try{return decodeURIComponent(escape(e.stringify(a)))}catch(q){throw Error("Malformed UTF-8 data");}},parse:function(a){return e.parse(unescape(encodeURIComponent(a)))}},
n=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new k.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=h.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,e=c.words,d=c.sigBytes,g=this.blockSize,h=d/(4*g);h=b?a.ceil(h):a.max((h|0)-this._minBufferSize,0);b=h*g;d=a.min(4*b,d);if(b){for(var p=0;p<b;p+=g)this._doProcessBlock(e,p);p=e.splice(0,b);c.sigBytes-=d}return new k.init(p,d)},clone:function(){var a=f.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=n.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){n.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new g.HMAC.init(a,
c)).finalize(b)}}});var g=c.algo={};return c}(Math);
(function(a){var b=CryptoJS,c=b.lib,d=c.Base,f=c.WordArray;b=b.x64={};b.Word=d.extend({init:function(a,b){this.high=a;this.low=b}});b.WordArray=d.extend({init:function(b,c){b=this.words=b||[];this.sigBytes=c!=a?c:8*b.length},toX32:function(){for(var a=this.words,b=a.length,c=[],e=0;e<b;e++){var d=a[e];c.push(d.high);c.push(d.low)}return f.create(c,this.sigBytes)},clone:function(){for(var a=d.clone.call(this),b=a.words=this.words.slice(0),c=b.length,e=0;e<c;e++)b[e]=b[e].clone();return a}})})();
CryptoJS.lib.Cipher||function(a){var b=CryptoJS,c=b.lib,d=c.Base,f=c.WordArray,k=c.BufferedBlockAlgorithm,l=b.enc.Base64,m=b.algo.EvpKDF,e=c.Cipher=k.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){k.reset.call(this);this._doReset()},process:function(a){this._append(a);
return this._process()},finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,e){return("string"==typeof c?r:q).encrypt(a,b,c,e)},decrypt:function(b,c,e){return("string"==typeof c?r:q).decrypt(a,b,c,e)}}}});c.StreamCipher=e.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=b.mode={},n=function(b,c,e){var d=this._iv;d?this._iv=a:d=this._prevBlock;for(var g=
0;g<e;g++)b[c+g]^=d[g]},g=(c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}})).extend();g.Encryptor=g.extend({processBlock:function(a,b){var c=this._cipher,e=c.blockSize;n.call(this,a,b,e);c.encryptBlock(a,b);this._prevBlock=a.slice(b,b+e)}});g.Decryptor=g.extend({processBlock:function(a,b){var c=this._cipher,e=c.blockSize,d=a.slice(b,b+e);c.decryptBlock(a,
b);n.call(this,a,b,e);this._prevBlock=d}});h=h.CBC=g;g=(b.pad={}).Pkcs7={pad:function(a,b){b*=4;b-=a.sigBytes%b;for(var c=b<<24|b<<16|b<<8|b,e=[],d=0;d<b;d+=4)e.push(c);b=f.create(e,b);a.concat(b)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};c.BlockCipher=e.extend({cfg:e.cfg.extend({mode:h,padding:g}),reset:function(){e.reset.call(this);var a=this.cfg,b=a.iv;a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=
c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var p=c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}});h=(b.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;a=a.salt;return(a?
f.create([1398893684,1701076831]).concat(a).concat(b):b).toString(l)},parse:function(a){a=l.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=f.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return p.create({ciphertext:a,salt:c})}};var q=c.SerializableCipher=d.extend({cfg:d.extend({format:h}),encrypt:function(a,b,c,e){e=this.cfg.extend(e);var d=a.createEncryptor(c,e);b=d.finalize(b);d=d.cfg;return p.create({ciphertext:b,key:c,iv:d.iv,algorithm:a,mode:d.mode,padding:d.padding,
blockSize:a.blockSize,formatter:e.format})},decrypt:function(a,b,c,e){e=this.cfg.extend(e);b=this._parse(b,e.format);return a.createDecryptor(c,e).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}});b=(b.kdf={}).OpenSSL={execute:function(a,b,c,e){e||(e=f.random(8));a=m.create({keySize:b+c}).compute(a,e);c=f.create(a.words.slice(b),4*c);a.sigBytes=4*b;return p.create({key:a,iv:c,salt:e})}};var r=c.PasswordBasedCipher=q.extend({cfg:q.cfg.extend({kdf:b}),encrypt:function(a,
b,c,e){e=this.cfg.extend(e);c=e.kdf.execute(c,a.keySize,a.ivSize);e.iv=c.iv;a=q.encrypt.call(this,a,b,c.key,e);a.mixIn(c);return a},decrypt:function(a,b,c,e){e=this.cfg.extend(e);b=this._parse(b,e.format);c=e.kdf.execute(c,a.keySize,a.ivSize,b.salt);e.iv=c.iv;return q.decrypt.call(this,a,b,c.key,e)}})}();
(function(){for(var a=CryptoJS,b=a.lib.BlockCipher,c=a.algo,d=[],f=[],k=[],l=[],m=[],e=[],h=[],n=[],g=[],p=[],q=[],r=0;256>r;r++)q[r]=128>r?r<<1:r<<1^283;var v=0,u=0;for(r=0;256>r;r++){var A=u^u<<1^u<<2^u<<3^u<<4;A=A>>>8^A&255^99;d[v]=A;f[A]=v;var x=q[v],B=q[x],I=q[B],D=257*q[A]^16843008*A;k[v]=D<<24|D>>>8;l[v]=D<<16|D>>>16;m[v]=D<<8|D>>>24;e[v]=D;D=16843009*I^65537*B^257*x^16843008*v;h[A]=D<<24|D>>>8;n[A]=D<<16|D>>>16;g[A]=D<<8|D>>>24;p[A]=D;v?(v=x^q[q[q[I^x]]],u^=q[q[u]]):v=u=1}var E=[0,1,2,4,8,
16,32,64,128,27,54];c=c.AES=b.extend({_doReset:function(){var a=this._key,b=a.words,c=a.sigBytes/4;a=4*((this._nRounds=c+6)+1);for(var e=this._keySchedule=[],m=0;m<a;m++)if(m<c)e[m]=b[m];else{var f=e[m-1];m%c?6<c&&4==m%c&&(f=d[f>>>24]<<24|d[f>>>16&255]<<16|d[f>>>8&255]<<8|d[f&255]):(f=f<<8|f>>>24,f=d[f>>>24]<<24|d[f>>>16&255]<<16|d[f>>>8&255]<<8|d[f&255],f^=E[m/c|0]<<24);e[m]=e[m-c]^f}b=this._invKeySchedule=[];for(c=0;c<a;c++)m=a-c,f=c%4?e[m]:e[m-4],b[c]=4>c||4>=m?f:h[d[f>>>24]]^n[d[f>>>16&255]]^
g[d[f>>>8&255]]^p[d[f&255]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,k,l,m,e,d)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3];a[b+3]=c;this._doCryptBlock(a,b,this._invKeySchedule,h,n,g,p,f);c=a[b+1];a[b+1]=a[b+3];a[b+3]=c},_doCryptBlock:function(a,b,c,e,d,g,h,p){for(var m=this._nRounds,f=a[b]^c[0],n=a[b+1]^c[1],k=a[b+2]^c[2],q=a[b+3]^c[3],C=4,l=1;l<m;l++){var r=e[f>>>24]^d[n>>>16&255]^g[k>>>8&255]^h[q&255]^c[C++],v=e[n>>>24]^d[k>>>16&255]^g[q>>>8&255]^h[f&255]^
c[C++],G=e[k>>>24]^d[q>>>16&255]^g[f>>>8&255]^h[n&255]^c[C++];q=e[q>>>24]^d[f>>>16&255]^g[n>>>8&255]^h[k&255]^c[C++];f=r;n=v;k=G}r=(p[f>>>24]<<24|p[n>>>16&255]<<16|p[k>>>8&255]<<8|p[q&255])^c[C++];v=(p[n>>>24]<<24|p[k>>>16&255]<<16|p[q>>>8&255]<<8|p[f&255])^c[C++];G=(p[k>>>24]<<24|p[q>>>16&255]<<16|p[f>>>8&255]<<8|p[n&255])^c[C++];q=(p[q>>>24]<<24|p[f>>>16&255]<<16|p[n>>>8&255]<<8|p[k&255])^c[C++];a[b]=r;a[b+1]=v;a[b+2]=G;a[b+3]=q},keySize:8});a.AES=b._createHelper(c)})();
(function(){function a(a,b){b&=this._lBlock>>>a^this._rBlock;this._rBlock^=b;this._lBlock^=b<<a}function b(a,b){b&=this._rBlock>>>a^this._lBlock;this._lBlock^=b;this._rBlock^=b<<a}var c=CryptoJS,d=c.lib,f=d.WordArray;d=d.BlockCipher;var k=c.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],m=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,
51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],e=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,
2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,
2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,
75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,
276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,
14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,
17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,
98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,
1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,
10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,
83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,
2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,
16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,
496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,
2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,
2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],n=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],g=k.DES=d.extend({_doReset:function(){for(var a=this._key.words,b=[],c=0;56>c;c++){var d=l[c]-1;b[c]=a[d>>>5]>>>31-d%32&1}a=this._subKeys=[];for(d=0;16>d;d++){var g=a[d]=[],h=e[d];for(c=0;24>c;c++)g[c/6|0]|=b[(m[c]-1+h)%28]<<31-c%6,g[4+(c/6|0)]|=b[28+(m[c+24]-1+h)%28]<<31-c%6;g[0]=g[0]<<1|g[0]>>>31;for(c=1;7>c;c++)g[c]>>>=
4*(c-1)+3;g[7]=g[7]<<5|g[7]>>>27}b=this._invSubKeys=[];for(c=0;16>c;c++)b[c]=a[15-c]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._subKeys)},decryptBlock:function(a,b){this._doCryptBlock(a,b,this._invSubKeys)},_doCryptBlock:function(c,e,d){this._lBlock=c[e];this._rBlock=c[e+1];a.call(this,4,252645135);a.call(this,16,65535);b.call(this,2,858993459);b.call(this,8,16711935);a.call(this,1,1431655765);for(var g=0;16>g;g++){for(var p=d[g],m=this._lBlock,f=this._rBlock,k=0,q=0;8>q;q++)k|=h[q][((f^
p[q])&n[q])>>>0];this._lBlock=f;this._rBlock=m^k}d=this._lBlock;this._lBlock=this._rBlock;this._rBlock=d;a.call(this,1,1431655765);b.call(this,8,16711935);b.call(this,2,858993459);a.call(this,16,65535);a.call(this,4,252645135);c[e]=this._lBlock;c[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});c.DES=d._createHelper(g);k=k.TripleDES=d.extend({_doReset:function(){var a=this._key.words;this._des1=g.createEncryptor(f.create(a.slice(0,2)));this._des2=g.createEncryptor(f.create(a.slice(2,4)));this._des3=
g.createEncryptor(f.create(a.slice(4,6)))},encryptBlock:function(a,b){this._des1.encryptBlock(a,b);this._des2.decryptBlock(a,b);this._des3.encryptBlock(a,b)},decryptBlock:function(a,b){this._des3.decryptBlock(a,b);this._des2.encryptBlock(a,b);this._des1.decryptBlock(a,b)},keySize:6,ivSize:2,blockSize:2});c.TripleDES=d._createHelper(k)})();
(function(){var a=CryptoJS,b=a.lib.WordArray;a.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,k=this._map;a.clamp();a=[];for(var l=0;l<c;l+=3)for(var m=(b[l>>>2]>>>24-l%4*8&255)<<16|(b[l+1>>>2]>>>24-(l+1)%4*8&255)<<8|b[l+2>>>2]>>>24-(l+2)%4*8&255,e=0;4>e&&l+.75*e<c;e++)a.push(k.charAt(m>>>6*(3-e)&63));if(b=k.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var c=a.length,f=this._map,k=f.charAt(64);k&&(k=a.indexOf(k),-1!=k&&(c=k));k=[];for(var l=0,m=0;m<c;m++)if(m%
4){var e=f.indexOf(a.charAt(m-1))<<m%4*2,h=f.indexOf(a.charAt(m))>>>6-m%4*2;k[l>>>2]|=(e|h)<<24-l%4*8;l++}return b.create(k,l)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(a){function b(a,b,c,e,d,h,m){a=a+(b&c|~b&e)+d+m;return(a<<h|a>>>32-h)+b}function c(a,b,c,e,d,h,m){a=a+(b&e|c&~e)+d+m;return(a<<h|a>>>32-h)+b}function d(a,b,c,e,d,h,m){a=a+(b^c^e)+d+m;return(a<<h|a>>>32-h)+b}function f(a,b,c,e,d,h,m){a=a+(c^(b|~e))+d+m;return(a<<h|a>>>32-h)+b}var k=CryptoJS,l=k.lib,m=l.WordArray,e=l.Hasher;l=k.algo;for(var h=[],n=0;64>n;n++)h[n]=4294967296*a.abs(a.sin(n+1))|0;l=l.MD5=e.extend({_doReset:function(){this._hash=new m.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(a,e){for(var g=0;16>g;g++){var m=e+g,n=a[m];a[m]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}g=this._hash.words;m=a[e+0];n=a[e+1];var p=a[e+2],k=a[e+3],l=a[e+4],B=a[e+5],I=a[e+6],D=a[e+7],E=a[e+8],C=a[e+9],G=a[e+10],L=a[e+11],K=a[e+12],J=a[e+13],M=a[e+14];a=a[e+15];e=g[0];var w=g[1],y=g[2],F=g[3];e=b(e,w,y,F,m,7,h[0]);F=b(F,e,w,y,n,12,h[1]);y=b(y,F,e,w,p,17,h[2]);w=b(w,y,F,e,k,22,h[3]);e=b(e,w,y,F,l,7,h[4]);F=b(F,e,w,y,B,12,h[5]);y=b(y,F,e,w,I,17,h[6]);w=b(w,y,F,e,D,22,
h[7]);e=b(e,w,y,F,E,7,h[8]);F=b(F,e,w,y,C,12,h[9]);y=b(y,F,e,w,G,17,h[10]);w=b(w,y,F,e,L,22,h[11]);e=b(e,w,y,F,K,7,h[12]);F=b(F,e,w,y,J,12,h[13]);y=b(y,F,e,w,M,17,h[14]);w=b(w,y,F,e,a,22,h[15]);e=c(e,w,y,F,n,5,h[16]);F=c(F,e,w,y,I,9,h[17]);y=c(y,F,e,w,L,14,h[18]);w=c(w,y,F,e,m,20,h[19]);e=c(e,w,y,F,B,5,h[20]);F=c(F,e,w,y,G,9,h[21]);y=c(y,F,e,w,a,14,h[22]);w=c(w,y,F,e,l,20,h[23]);e=c(e,w,y,F,C,5,h[24]);F=c(F,e,w,y,M,9,h[25]);y=c(y,F,e,w,k,14,h[26]);w=c(w,y,F,e,E,20,h[27]);e=c(e,w,y,F,J,5,h[28]);F=
c(F,e,w,y,p,9,h[29]);y=c(y,F,e,w,D,14,h[30]);w=c(w,y,F,e,K,20,h[31]);e=d(e,w,y,F,B,4,h[32]);F=d(F,e,w,y,E,11,h[33]);y=d(y,F,e,w,L,16,h[34]);w=d(w,y,F,e,M,23,h[35]);e=d(e,w,y,F,n,4,h[36]);F=d(F,e,w,y,l,11,h[37]);y=d(y,F,e,w,D,16,h[38]);w=d(w,y,F,e,G,23,h[39]);e=d(e,w,y,F,J,4,h[40]);F=d(F,e,w,y,m,11,h[41]);y=d(y,F,e,w,k,16,h[42]);w=d(w,y,F,e,I,23,h[43]);e=d(e,w,y,F,C,4,h[44]);F=d(F,e,w,y,K,11,h[45]);y=d(y,F,e,w,a,16,h[46]);w=d(w,y,F,e,p,23,h[47]);e=f(e,w,y,F,m,6,h[48]);F=f(F,e,w,y,D,10,h[49]);y=f(y,
F,e,w,M,15,h[50]);w=f(w,y,F,e,B,21,h[51]);e=f(e,w,y,F,K,6,h[52]);F=f(F,e,w,y,k,10,h[53]);y=f(y,F,e,w,G,15,h[54]);w=f(w,y,F,e,n,21,h[55]);e=f(e,w,y,F,E,6,h[56]);F=f(F,e,w,y,a,10,h[57]);y=f(y,F,e,w,I,15,h[58]);w=f(w,y,F,e,J,21,h[59]);e=f(e,w,y,F,l,6,h[60]);F=f(F,e,w,y,L,10,h[61]);y=f(y,F,e,w,p,15,h[62]);w=f(w,y,F,e,C,21,h[63]);g[0]=g[0]+e|0;g[1]=g[1]+w|0;g[2]=g[2]+y|0;g[3]=g[3]+F|0},_doFinalize:function(){var b=this._data,c=b.words,e=8*this._nDataBytes,d=8*b.sigBytes;c[d>>>5]|=128<<24-d%32;var h=a.floor(e/
4294967296);c[(d+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;c[(d+64>>>9<<4)+14]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;b.sigBytes=4*(c.length+1);this._process();b=this._hash;c=b.words;for(e=0;4>e;e++)d=c[e],c[e]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;return b},clone:function(){var a=e.clone.call(this);a._hash=this._hash.clone();return a}});k.MD5=e._createHelper(l);k.HmacMD5=e._createHmacHelper(l)})(Math);
(function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,f=[];b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,e=c[0],d=c[1],n=c[2],g=c[3],p=c[4],k=0;80>k;k++){if(16>k)f[k]=a[b+k]|0;else{var l=f[k-3]^f[k-8]^f[k-14]^f[k-16];f[k]=l<<1|l>>>31}l=(e<<5|e>>>27)+p+f[k];l=20>k?l+((d&n|~d&g)+1518500249):40>k?l+((d^n^g)+1859775393):60>k?l+((d&n|d&g|n&g)-1894007588):l+((d^n^
g)-899497514);p=g;g=n;n=d<<30|d>>>2;d=e;e=l}c[0]=c[0]+e|0;c[1]=c[1]+d|0;c[2]=c[2]+n|0;c[3]=c[3]+g|0;c[4]=c[4]+p|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,e=8*a.sigBytes;b[e>>>5]|=128<<24-e%32;b[(e+64>>>9<<4)+14]=Math.floor(c/4294967296);b[(e+64>>>9<<4)+15]=c;a.sigBytes=4*b.length;this._process();return this._hash},clone:function(){var a=d.clone.call(this);a._hash=this._hash.clone();return a}});a.SHA1=d._createHelper(b);a.HmacSHA1=d._createHmacHelper(b)})();
(function(a){var b=CryptoJS,c=b.lib,d=c.WordArray,f=c.Hasher;c=b.algo;for(var k=[],l=[],m=function(a){return 4294967296*(a-(a|0))|0},e=2,h=0;64>h;){a:{var n=e;for(var g=a.sqrt(n),p=2;p<=g;p++)if(!(n%p)){n=!1;break a}n=!0}n&&(8>h&&(k[h]=m(a.pow(e,.5))),l[h]=m(a.pow(e,1/3)),h++);e++}var q=[];c=c.SHA256=f.extend({_doReset:function(){this._hash=new d.init(k.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,e=c[0],d=c[1],g=c[2],h=c[3],m=c[4],f=c[5],n=c[6],p=c[7],k=0;64>k;k++){if(16>k)q[k]=
a[b+k]|0;else{var v=q[k-15],r=q[k-2];q[k]=((v<<25|v>>>7)^(v<<14|v>>>18)^v>>>3)+q[k-7]+((r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10)+q[k-16]}v=p+((m<<26|m>>>6)^(m<<21|m>>>11)^(m<<7|m>>>25))+(m&f^~m&n)+l[k]+q[k];r=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&d^e&g^d&g);p=n;n=f;f=m;m=h+v|0;h=g;g=d;d=e;e=v+r|0}c[0]=c[0]+e|0;c[1]=c[1]+d|0;c[2]=c[2]+g|0;c[3]=c[3]+h|0;c[4]=c[4]+m|0;c[5]=c[5]+f|0;c[6]=c[6]+n|0;c[7]=c[7]+p|0},_doFinalize:function(){var b=this._data,c=b.words,e=8*this._nDataBytes,d=8*b.sigBytes;
c[d>>>5]|=128<<24-d%32;c[(d+64>>>9<<4)+14]=a.floor(e/4294967296);c[(d+64>>>9<<4)+15]=e;b.sigBytes=4*c.length;this._process();return this._hash},clone:function(){var a=f.clone.call(this);a._hash=this._hash.clone();return a}});b.SHA256=f._createHelper(c);b.HmacSHA256=f._createHmacHelper(c)})(Math);
(function(){var a=CryptoJS,b=a.lib.WordArray,c=a.algo,d=c.SHA256;c=c.SHA224=d.extend({_doReset:function(){this._hash=new b.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var a=d._doFinalize.call(this);a.sigBytes-=4;return a}});a.SHA224=d._createHelper(c);a.HmacSHA224=d._createHmacHelper(c)})();
(function(){function a(){return f.create.apply(f,arguments)}var b=CryptoJS,c=b.lib.Hasher,d=b.x64,f=d.Word,k=d.WordArray;d=b.algo;for(var l=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),
a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,
2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),
a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,
3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],m=[],e=0;80>e;e++)m[e]=a();d=d.SHA512=c.extend({_doReset:function(){this._hash=new k.init([new f.init(1779033703,4089235720),new f.init(3144134277,2227873595),new f.init(1013904242,4271175723),new f.init(2773480762,1595750129),new f.init(1359893119,2917565137),new f.init(2600822924,725511199),new f.init(528734635,4215389547),new f.init(1541459225,327033209)])},_doProcessBlock:function(a,b){var c=this._hash.words,
e=c[0],d=c[1],h=c[2],f=c[3],n=c[4],k=c[5],x=c[6];c=c[7];for(var B=e.high,I=e.low,D=d.high,E=d.low,C=h.high,G=h.low,L=f.high,K=f.low,J=n.high,M=n.low,w=k.high,y=k.low,F=x.high,P=x.low,Q=c.high,U=c.low,O=B,N=I,H=D,R=E,V=C,S=G,sa=L,ka=K,X=J,Y=M,pa=w,la=y,qa=F,ma=P,ta=Q,na=U,aa=0;80>aa;aa++){var da=m[aa];if(16>aa)var Z=da.high=a[b+2*aa]|0,T=da.low=a[b+2*aa+1]|0;else{Z=m[aa-15];T=Z.high;var ba=Z.low;Z=(T>>>1|ba<<31)^(T>>>8|ba<<24)^T>>>7;ba=(ba>>>1|T<<31)^(ba>>>8|T<<24)^(ba>>>7|T<<25);var ha=m[aa-2];T=
ha.high;var W=ha.low;ha=(T>>>19|W<<13)^(T<<3|W>>>29)^T>>>6;W=(W>>>19|T<<13)^(W<<3|T>>>29)^(W>>>6|T<<26);T=m[aa-7];var va=T.high,ea=m[aa-16],ca=ea.high;ea=ea.low;T=ba+T.low;Z=Z+va+(T>>>0<ba>>>0?1:0);T+=W;Z=Z+ha+(T>>>0<W>>>0?1:0);T+=ea;Z=Z+ca+(T>>>0<ea>>>0?1:0);da.high=Z;da.low=T}va=X&pa^~X&qa;ea=Y&la^~Y&ma;da=O&H^O&V^H&V;var za=N&R^N&S^R&S;ba=(O>>>28|N<<4)^(O<<30|N>>>2)^(O<<25|N>>>7);ha=(N>>>28|O<<4)^(N<<30|O>>>2)^(N<<25|O>>>7);W=l[aa];var Aa=W.high,xa=W.low;W=na+((Y>>>14|X<<18)^(Y>>>18|X<<14)^(Y<<
23|X>>>9));ca=ta+((X>>>14|Y<<18)^(X>>>18|Y<<14)^(X<<23|Y>>>9))+(W>>>0<na>>>0?1:0);W+=ea;ca=ca+va+(W>>>0<ea>>>0?1:0);W+=xa;ca=ca+Aa+(W>>>0<xa>>>0?1:0);W+=T;ca=ca+Z+(W>>>0<T>>>0?1:0);T=ha+za;da=ba+da+(T>>>0<ha>>>0?1:0);ta=qa;na=ma;qa=pa;ma=la;pa=X;la=Y;Y=ka+W|0;X=sa+ca+(Y>>>0<ka>>>0?1:0)|0;sa=V;ka=S;V=H;S=R;H=O;R=N;N=W+T|0;O=ca+da+(N>>>0<W>>>0?1:0)|0}I=e.low=I+N;e.high=B+O+(I>>>0<N>>>0?1:0);E=d.low=E+R;d.high=D+H+(E>>>0<R>>>0?1:0);G=h.low=G+S;h.high=C+V+(G>>>0<S>>>0?1:0);K=f.low=K+ka;f.high=L+sa+(K>>>
0<ka>>>0?1:0);M=n.low=M+Y;n.high=J+X+(M>>>0<Y>>>0?1:0);y=k.low=y+la;k.high=w+pa+(y>>>0<la>>>0?1:0);P=x.low=P+ma;x.high=F+qa+(P>>>0<ma>>>0?1:0);U=c.low=U+na;c.high=Q+ta+(U>>>0<na>>>0?1:0)},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,e=8*a.sigBytes;b[e>>>5]|=128<<24-e%32;b[(e+128>>>10<<5)+30]=Math.floor(c/4294967296);b[(e+128>>>10<<5)+31]=c;a.sigBytes=4*b.length;this._process();return this._hash.toX32()},clone:function(){var a=c.clone.call(this);a._hash=this._hash.clone();
return a},blockSize:32});b.SHA512=c._createHelper(d);b.HmacSHA512=c._createHmacHelper(d)})();
(function(){var a=CryptoJS,b=a.x64,c=b.Word,d=b.WordArray;b=a.algo;var f=b.SHA512;b=b.SHA384=f.extend({_doReset:function(){this._hash=new d.init([new c.init(3418070365,3238371032),new c.init(1654270250,914150663),new c.init(2438529370,812702999),new c.init(355462360,4144912697),new c.init(1731405415,4290775857),new c.init(2394180231,1750603025),new c.init(3675008525,1694076839),new c.init(1203062813,3204075428)])},_doFinalize:function(){var a=f._doFinalize.call(this);a.sigBytes-=16;return a}});a.SHA384=
f._createHelper(b);a.HmacSHA384=f._createHmacHelper(b)})();
(function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher;b=a.algo;var f=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),k=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=c.create([11,14,15,
12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),m=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),e=c.create([0,1518500249,1859775393,2400959708,2840853838]),h=c.create([1352829926,1548603684,
1836072691,2053994217,0]);b=b.RIPEMD160=d.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=0;16>c;c++){var d=b+c,g=a[d];a[d]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}d=this._hash.words;g=e.words;var n=h.words,u=f.words,A=k.words,x=l.words,B=m.words,I,D,E,C,G;var L=I=d[0];var K=D=d[1];var J=E=d[2];var M=C=d[3];var w=G=d[4];for(c=0;80>c;c+=1){var y=I+a[b+u[c]]|0;y=16>c?y+((D^E^C)+g[0]):32>c?y+((D&
E|~D&C)+g[1]):48>c?y+(((D|~E)^C)+g[2]):64>c?y+((D&C|E&~C)+g[3]):y+((D^(E|~C))+g[4]);y|=0;y=y<<x[c]|y>>>32-x[c];y=y+G|0;I=G;G=C;C=E<<10|E>>>22;E=D;D=y;y=L+a[b+A[c]]|0;y=16>c?y+((K^(J|~M))+n[0]):32>c?y+((K&M|J&~M)+n[1]):48>c?y+(((K|~J)^M)+n[2]):64>c?y+((K&J|~K&M)+n[3]):y+((K^J^M)+n[4]);y|=0;y=y<<B[c]|y>>>32-B[c];y=y+w|0;L=w;w=M;M=J<<10|J>>>22;J=K;K=y}y=d[1]+E+M|0;d[1]=d[2]+C+w|0;d[2]=d[3]+G+L|0;d[3]=d[4]+I+K|0;d[4]=d[0]+D+J|0;d[0]=y},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,
e=8*a.sigBytes;b[e>>>5]|=128<<24-e%32;b[(e+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(c=0;5>c;c++)e=b[c],b[c]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;return a},clone:function(){var a=d.clone.call(this);a._hash=this._hash.clone();return a}});a.RIPEMD160=d._createHelper(b);a.HmacRIPEMD160=d._createHmacHelper(b)})(Math);
(function(){var a=CryptoJS,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,d){a=this._hasher=new a.init;"string"==typeof d&&(d=b.parse(d));var c=a.blockSize,k=4*c;d.sigBytes>k&&(d=a.finalize(d));d.clamp();a=this._oKey=d.clone();d=this._iKey=d.clone();for(var l=a.words,m=d.words,e=0;e<c;e++)l[e]^=1549556828,m[e]^=909522486;a.sigBytes=d.sigBytes=k;this.reset()},reset:function(){var a=this._hasher;a.reset();a.update(this._iKey)},update:function(a){this._hasher.update(a);return this},finalize:function(a){var b=
this._hasher;a=b.finalize(a);b.reset();return b.finalize(this._oKey.clone().concat(a))}})})();
(function(){var a=CryptoJS,b=a.lib,c=b.Base,d=b.WordArray;b=a.algo;var f=b.HMAC,k=b.PBKDF2=c.extend({cfg:c.extend({keySize:4,hasher:b.SHA1,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){var c=this.cfg;a=f.create(c.hasher,a);var h=d.create(),m=d.create([1]),g=h.words,p=m.words,k=c.keySize;for(c=c.iterations;g.length<k;){var l=a.update(b).finalize(m);a.reset();for(var v=l.words,u=v.length,A=l,x=1;x<c;x++){A=a.finalize(A);a.reset();for(var B=A.words,I=0;I<u;I++)v[I]^=
B[I]}h.concat(l);p[0]++}h.sigBytes=4*k;return h}});a.PBKDF2=function(a,b,c){return k.create(c).compute(a,b)}})();
function hex2b64(a){var b,c="";for(b=0;b+3<=a.length;b+=3){var d=parseInt(a.substring(b,b+3),16);c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d&63)}b+1==a.length?(d=parseInt(a.substring(b,b+1),16),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<2)):b+2==a.length&&(d=parseInt(a.substring(b,b+2),16),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>
2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((d&3)<<4));for(;0<(c.length&3);)c+="=";return c}
function b64tohex(a){var b="",c,d=0;for(c=0;c<a.length&&"="!=a.charAt(c);++c){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));if(!(0>f))if(0==d){b+=int2char(f>>2);var k=f&3;d=1}else 1==d?(b+=int2char(k<<2|f>>4),k=f&15,d=2):2==d?(b+=int2char(k),b+=int2char(f>>2),k=f&3,d=3):(b+=int2char(k<<2|f>>4),b+=int2char(f&15),d=0)}1==d&&(b+=int2char(k<<2));return b}
function b64toBA(a){a=b64tohex(a);var b,c=[];for(b=0;2*b<a.length;++b)c[b]=parseInt(a.substring(2*b,2*b+2),16);return c}var dbits;function BigInteger(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}function am1(a,b,c,d,f,k){for(;0<=--k;){var l=b*this[a++]+c[d]+f;f=Math.floor(l/67108864);c[d++]=l&67108863}return f}
function am2(a,b,c,d,f,k){var l=b&32767;for(b>>=15;0<=--k;){var m=this[a]&32767,e=this[a++]>>15,h=b*m+e*l;m=l*m+((h&32767)<<15)+c[d]+(f&1073741823);f=(m>>>30)+(h>>>15)+b*e+(f>>>30);c[d++]=m&1073741823}return f}function am3(a,b,c,d,f,k){var l=b&16383;for(b>>=14;0<=--k;){var m=this[a]&16383,e=this[a++]>>14,h=b*m+e*l;m=l*m+((h&16383)<<14)+c[d]+f;f=(m>>28)+(h>>14)+b*e;c[d++]=m&268435455}return f}
"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=am2,dbits=30):"Netscape"!=navigator.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28);BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;BigInteger.prototype.FV=Math.pow(2,52);BigInteger.prototype.F1=52-dbits;BigInteger.prototype.F2=2*dbits-52;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=[],rr,vv;rr=48;
for(vv=0;9>=vv;++vv)BI_RC[rr++]=vv;rr=97;for(vv=10;36>vv;++vv)BI_RC[rr++]=vv;rr=65;for(vv=10;36>vv;++vv)BI_RC[rr++]=vv;function int2char(a){return BI_RM.charAt(a)}function intAt(a,b){a=BI_RC[a.charCodeAt(b)];return null==a?-1:a}function nbv(a){var b=nbi();b.fromInt(a);return b}function nbits(a){var b=1,c;0!=(c=a>>>16)&&(a=c,b+=16);0!=(c=a>>8)&&(a=c,b+=8);0!=(c=a>>4)&&(a=c,b+=4);0!=(c=a>>2)&&(a=c,b+=2);0!=a>>1&&(b+=1);return b}function Classic(a){this.m=a}
Classic.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):a};Classic.prototype.revert=function(a){return a};Classic.prototype.reduce=function(a){a.divRemTo(this.m,null,a)};Classic.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};Classic.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};function Montgomery(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<a.DB-15)-1;this.mt2=2*a.t}
Montgomery.prototype.convert=function(a){var b=nbi();a.abs().dlShiftTo(this.m.t,b);b.divRemTo(this.m,null,b);0>a.s&&0<b.compareTo(BigInteger.ZERO)&&this.m.subTo(b,b);return b};Montgomery.prototype.revert=function(a){var b=nbi();a.copyTo(b);this.reduce(b);return b};
Montgomery.prototype.reduce=function(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=a[b]&32767,d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;c=b+this.m.t;for(a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};Montgomery.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};Montgomery.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};
BigInteger.prototype.copyTo=function(a){for(var b=this.t-1;0<=b;--b)a[b]=this[b];a.t=this.t;a.s=this.s};BigInteger.prototype.fromInt=function(a){this.t=1;this.s=0>a?-1:0;0<a?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0};
BigInteger.prototype.fromString=function(a,b){if(16==b)b=4;else if(8==b)b=3;else if(256==b)b=8;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else{this.fromRadix(a,b);return}this.s=this.t=0;for(var c=a.length,d=!1,f=0;0<=--c;){var k=8==b?a[c]&255:intAt(a,c);0>k?"-"==a.charAt(c)&&(d=!0):(d=!1,0==f?this[this.t++]=k:f+b>this.DB?(this[this.t-1]|=(k&(1<<this.DB-f)-1)<<f,this[this.t++]=k>>this.DB-f):this[this.t-1]|=k<<f,f+=b,f>=this.DB&&(f-=this.DB))}8==b&&0!=(a[0]&128)&&(this.s=-1,0<f&&(this[this.t-
1]|=(1<<this.DB-f)-1<<f));this.clamp();d&&BigInteger.ZERO.subTo(this,this)};BigInteger.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t};BigInteger.prototype.dlShiftTo=function(a,b){var c;for(c=this.t-1;0<=c;--c)b[c+a]=this[c];for(c=a-1;0<=c;--c)b[c]=0;b.t=this.t+a;b.s=this.s};BigInteger.prototype.drShiftTo=function(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0);b.s=this.s};
BigInteger.prototype.lShiftTo=function(a,b){var c=a%this.DB,d=this.DB-c,f=(1<<d)-1;a=Math.floor(a/this.DB);var k=this.s<<c&this.DM,l;for(l=this.t-1;0<=l;--l)b[l+a+1]=this[l]>>d|k,k=(this[l]&f)<<c;for(l=a-1;0<=l;--l)b[l]=0;b[a]=k;b.t=this.t+a+1;b.s=this.s;b.clamp()};
BigInteger.prototype.rShiftTo=function(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)b.t=0;else{a%=this.DB;var d=this.DB-a,f=(1<<a)-1;b[0]=this[c]>>a;for(var k=c+1;k<this.t;++k)b[k-c-1]|=(this[k]&f)<<d,b[k-c]=this[k]>>a;0<a&&(b[this.t-c-1]|=(this.s&f)<<d);b.t=this.t-c;b.clamp()}};
BigInteger.prototype.subTo=function(a,b){for(var c=0,d=0,f=Math.min(a.t,this.t);c<f;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0;-1>d?b[c++]=this.DV+d:0<d&&(b[c++]=d);b.t=c;b.clamp()};
BigInteger.prototype.multiplyTo=function(a,b){var c=this.abs(),d=a.abs(),f=c.t;for(b.t=f+d.t;0<=--f;)b[f]=0;for(f=0;f<d.t;++f)b[f+c.t]=c.am(0,d[f],b,f,0,c.t);b.s=0;b.clamp();this.s!=a.s&&BigInteger.ZERO.subTo(b,b)};BigInteger.prototype.squareTo=function(a){for(var b=this.abs(),c=a.t=2*b.t;0<=--c;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}0<a.t&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1));a.s=0;a.clamp()};
BigInteger.prototype.divRemTo=function(a,b,c){var d=a.abs();if(!(0>=d.t)){var f=this.abs();if(f.t<d.t)null!=b&&b.fromInt(0),null!=c&&this.copyTo(c);else{null==c&&(c=nbi());var k=nbi(),l=this.s;a=a.s;var m=this.DB-nbits(d[d.t-1]);0<m?(d.lShiftTo(m,k),f.lShiftTo(m,c)):(d.copyTo(k),f.copyTo(c));d=k.t;f=k[d-1];if(0!=f){var e=f*(1<<this.F1)+(1<d?k[d-2]>>this.F2:0),h=this.FV/e;e=(1<<this.F1)/e;var n=1<<this.F2,g=c.t,p=g-d,q=null==b?nbi():b;k.dlShiftTo(p,q);0<=c.compareTo(q)&&(c[c.t++]=1,c.subTo(q,c));BigInteger.ONE.dlShiftTo(d,
q);for(q.subTo(k,k);k.t<d;)k[k.t++]=0;for(;0<=--p;){var r=c[--g]==f?this.DM:Math.floor(c[g]*h+(c[g-1]+n)*e);if((c[g]+=k.am(0,r,c,p,0,d))<r)for(k.dlShiftTo(p,q),c.subTo(q,c);c[g]<--r;)c.subTo(q,c)}null!=b&&(c.drShiftTo(d,b),l!=a&&BigInteger.ZERO.subTo(b,b));c.t=d;c.clamp();0<m&&c.rShiftTo(m,c);0>l&&BigInteger.ZERO.subTo(c,c)}}}};
BigInteger.prototype.invDigit=function(){if(1>this.t)return 0;var a=this[0];if(0==(a&1))return 0;var b=a&3;b=b*(2-(a&15)*b)&15;b=b*(2-(a&255)*b)&255;b=b*(2-((a&65535)*b&65535))&65535;b=b*(2-a*b%this.DV)%this.DV;return 0<b?this.DV-b:-b};BigInteger.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};
BigInteger.prototype.exp=function(a,b){if(4294967295<a||1>a)return BigInteger.ONE;var c=nbi(),d=nbi(),f=b.convert(this),k=nbits(a)-1;for(f.copyTo(c);0<=--k;)if(b.sqrTo(c,d),0<(a&1<<k))b.mulTo(d,f,c);else{var l=c;c=d;d=l}return b.revert(c)};
BigInteger.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else return this.toRadix(a);var b=(1<<a)-1,c,d=!1,f="",k=this.t,l=this.DB-k*this.DB%a;if(0<k--)for(l<this.DB&&0<(c=this[k]>>l)&&(d=!0,f=int2char(c));0<=k;)l<a?(c=(this[k]&(1<<l)-1)<<a-l,c|=this[--k]>>(l+=this.DB-a)):(c=this[k]>>(l-=a)&b,0>=l&&(l+=this.DB,--k)),0<c&&(d=!0),d&&(f+=int2char(c));return d?f:"0"};
BigInteger.prototype.negate=function(){var a=nbi();BigInteger.ZERO.subTo(this,a);return a};BigInteger.prototype.abs=function(){return 0>this.s?this.negate():this};BigInteger.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;b=c-a.t;if(0!=b)return 0>this.s?-b:b;for(;0<=--c;)if(0!=(b=this[c]-a[c]))return b;return 0};BigInteger.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)};
BigInteger.prototype.mod=function(a){var b=nbi();this.abs().divRemTo(a,null,b);0>this.s&&0<b.compareTo(BigInteger.ZERO)&&a.subTo(b,b);return b};BigInteger.prototype.modPowInt=function(a,b){b=256>a||b.isEven()?new Classic(b):new Montgomery(b);return this.exp(a,b)};BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function op_and(a,b){return a&b}function op_or(a,b){return a|b}function op_xor(a,b){return a^b}function op_andnot(a,b){return a&~b}
function lbit(a){if(0==a)return-1;var b=0;0==(a&65535)&&(a>>=16,b+=16);0==(a&255)&&(a>>=8,b+=8);0==(a&15)&&(a>>=4,b+=4);0==(a&3)&&(a>>=2,b+=2);0==(a&1)&&++b;return b}function cbit(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function NullExp(){}function nNop(a){return a}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c)};NullExp.prototype.sqrTo=function(a,b){a.squareTo(b)};
function Barrett(a){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*a.t,this.r2);this.mu=this.r2.divide(a);this.m=a}Barrett.prototype.convert=function(a){if(0>a.s||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var b=nbi();a.copyTo(b);this.reduce(b);return b};Barrett.prototype.revert=function(a){return a};
Barrett.prototype.reduce=function(a){a.drShiftTo(this.m.t-1,this.r2);a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)};Barrett.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};Barrett.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};
var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,
733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=67108864/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=function(a){return Math.floor(Math.LN2*this.DB/Math.log(a))};
BigInteger.prototype.toRadix=function(a){null==a&&(a=10);if(0==this.signum()||2>a||36<a)return"0";var b=this.chunkSize(a);b=Math.pow(a,b);var c=nbv(b),d=nbi(),f=nbi(),k="";for(this.divRemTo(c,d,f);0<d.signum();)k=(b+f.intValue()).toString(a).substr(1)+k,d.divRemTo(c,d,f);return f.intValue().toString(a)+k};
BigInteger.prototype.fromRadix=function(a,b){this.fromInt(0);null==b&&(b=10);for(var c=this.chunkSize(b),d=Math.pow(b,c),f=!1,k=0,l=0,m=0;m<a.length;++m){var e=intAt(a,m);0>e?"-"==a.charAt(m)&&0==this.signum()&&(f=!0):(l=b*l+e,++k>=c&&(this.dMultiply(d),this.dAddOffset(l,0),l=k=0))}0<k&&(this.dMultiply(Math.pow(b,k)),this.dAddOffset(l,0));f&&BigInteger.ZERO.subTo(this,this)};
BigInteger.prototype.fromNumber=function(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this);else{c=[];var d=a&7;c.length=(a>>3)+1;b.nextBytes(c);c[0]=0<d?c[0]&(1<<d)-1:0;this.fromString(c,256)}};
BigInteger.prototype.bitwiseTo=function(a,b,c){var d,f=Math.min(a.t,this.t);for(d=0;d<f;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){var k=a.s&this.DM;for(d=f;d<this.t;++d)c[d]=b(this[d],k);c.t=this.t}else{k=this.s&this.DM;for(d=f;d<a.t;++d)c[d]=b(k,a[d]);c.t=a.t}c.s=b(this.s,a.s);c.clamp()};BigInteger.prototype.changeBit=function(a,b){a=BigInteger.ONE.shiftLeft(a);this.bitwiseTo(a,b,a);return a};
BigInteger.prototype.addTo=function(a,b){for(var c=0,d=0,f=Math.min(a.t,this.t);c<f;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0;0<d?b[c++]=d:-1>d&&(b[c++]=this.DV+d);b.t=c;b.clamp()};BigInteger.prototype.dMultiply=function(a){this[this.t]=this.am(0,a-1,this,0,0,this.t);++this.t;this.clamp()};
BigInteger.prototype.dAddOffset=function(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}};BigInteger.prototype.multiplyLowerTo=function(a,b,c){var d=Math.min(this.t+a.t,b);c.s=0;for(c.t=d;0<d;)c[--d]=0;var f;for(f=c.t-this.t;d<f;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(f=Math.min(a.t,b);d<f;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()};
BigInteger.prototype.multiplyUpperTo=function(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;0<=--d;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp();c.drShiftTo(1,c)};BigInteger.prototype.modInt=function(a){if(0>=a)return 0;var b=this.DV%a,c=0>this.s?a-1:0;if(0<this.t)if(0==b)c=this[0]%a;else for(var d=this.t-1;0<=d;--d)c=(b*c+this[d])%a;return c};
BigInteger.prototype.millerRabin=function(a){var b=this.subtract(BigInteger.ONE),c=b.getLowestSetBit();if(0>=c)return!1;var d=b.shiftRight(c);a=a+1>>1;a>lowprimes.length&&(a=lowprimes.length);for(var f=nbi(),k=0;k<a;++k){f.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var l=f.modPow(d,this);if(0!=l.compareTo(BigInteger.ONE)&&0!=l.compareTo(b)){for(var m=1;m++<c&&0!=l.compareTo(b);)if(l=l.modPowInt(2,this),0==l.compareTo(BigInteger.ONE))return!1;if(0!=l.compareTo(b))return!1}}return!0};
BigInteger.prototype.clone=function(){var a=nbi();this.copyTo(a);return a};BigInteger.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};BigInteger.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};BigInteger.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};
BigInteger.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};BigInteger.prototype.toByteArray=function(){var a=this.t,b=[];b[0]=this.s;var c=this.DB-a*this.DB%8,d,f=0;if(0<a--)for(c<this.DB&&(d=this[a]>>c)!=(this.s&this.DM)>>c&&(b[f++]=d|this.s<<this.DB-c);0<=a;)if(8>c?(d=(this[a]&(1<<c)-1)<<8-c,d|=this[--a]>>(c+=this.DB-8)):(d=this[a]>>(c-=8)&255,0>=c&&(c+=this.DB,--a)),0!=(d&128)&&(d|=-256),0==f&&(this.s&128)!=(d&128)&&++f,0<f||d!=this.s)b[f++]=d;return b};
BigInteger.prototype.equals=function(a){return 0==this.compareTo(a)};BigInteger.prototype.min=function(a){return 0>this.compareTo(a)?this:a};BigInteger.prototype.max=function(a){return 0<this.compareTo(a)?this:a};BigInteger.prototype.and=function(a){var b=nbi();this.bitwiseTo(a,op_and,b);return b};BigInteger.prototype.or=function(a){var b=nbi();this.bitwiseTo(a,op_or,b);return b};BigInteger.prototype.xor=function(a){var b=nbi();this.bitwiseTo(a,op_xor,b);return b};
BigInteger.prototype.andNot=function(a){var b=nbi();this.bitwiseTo(a,op_andnot,b);return b};BigInteger.prototype.not=function(){for(var a=nbi(),b=0;b<this.t;++b)a[b]=this.DM&~this[b];a.t=this.t;a.s=~this.s;return a};BigInteger.prototype.shiftLeft=function(a){var b=nbi();0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b);return b};BigInteger.prototype.shiftRight=function(a){var b=nbi();0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b);return b};
BigInteger.prototype.getLowestSetBit=function(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+lbit(this[a]);return 0>this.s?this.t*this.DB:-1};BigInteger.prototype.bitCount=function(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=cbit(this[c]^b);return a};BigInteger.prototype.testBit=function(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)};BigInteger.prototype.setBit=function(a){return this.changeBit(a,op_or)};
BigInteger.prototype.clearBit=function(a){return this.changeBit(a,op_andnot)};BigInteger.prototype.flipBit=function(a){return this.changeBit(a,op_xor)};BigInteger.prototype.add=function(a){var b=nbi();this.addTo(a,b);return b};BigInteger.prototype.subtract=function(a){var b=nbi();this.subTo(a,b);return b};BigInteger.prototype.multiply=function(a){var b=nbi();this.multiplyTo(a,b);return b};BigInteger.prototype.divide=function(a){var b=nbi();this.divRemTo(a,b,null);return b};
BigInteger.prototype.remainder=function(a){var b=nbi();this.divRemTo(a,null,b);return b};BigInteger.prototype.divideAndRemainder=function(a){var b=nbi(),c=nbi();this.divRemTo(a,b,c);return[b,c]};
BigInteger.prototype.modPow=function(a,b){var c=a.bitLength(),d=nbv(1);if(0>=c)return d;var f=18>c?1:48>c?3:144>c?4:768>c?5:6;b=8>c?new Classic(b):b.isEven()?new Barrett(b):new Montgomery(b);var k=[],l=3,m=f-1,e=(1<<f)-1;k[1]=b.convert(this);if(1<f)for(c=nbi(),b.sqrTo(k[1],c);l<=e;)k[l]=nbi(),b.mulTo(c,k[l-2],k[l]),l+=2;var h=a.t-1,n=!0,g=nbi();for(c=nbits(a[h])-1;0<=h;){if(c>=m)var p=a[h]>>c-m&e;else p=(a[h]&(1<<c+1)-1)<<m-c,0<h&&(p|=a[h-1]>>this.DB+c-m);for(l=f;0==(p&1);)p>>=1,--l;0>(c-=l)&&(c+=
this.DB,--h);if(n)k[p].copyTo(d),n=!1;else{for(;1<l;)b.sqrTo(d,g),b.sqrTo(g,d),l-=2;0<l?b.sqrTo(d,g):(l=d,d=g,g=l);b.mulTo(g,k[p],d)}for(;0<=h&&0==(a[h]&1<<c);)b.sqrTo(d,g),l=d,d=g,g=l,0>--c&&(c=this.DB-1,--h)}return b.revert(d)};
BigInteger.prototype.modInverse=function(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return BigInteger.ZERO;for(var c=a.clone(),d=this.clone(),f=nbv(1),k=nbv(0),l=nbv(0),m=nbv(1);0!=c.signum();){for(;c.isEven();)c.rShiftTo(1,c),b?(f.isEven()&&k.isEven()||(f.addTo(this,f),k.subTo(a,k)),f.rShiftTo(1,f)):k.isEven()||k.subTo(a,k),k.rShiftTo(1,k);for(;d.isEven();)d.rShiftTo(1,d),b?(l.isEven()&&m.isEven()||(l.addTo(this,l),m.subTo(a,m)),l.rShiftTo(1,l)):m.isEven()||m.subTo(a,m),m.rShiftTo(1,
m);0<=c.compareTo(d)?(c.subTo(d,c),b&&f.subTo(l,f),k.subTo(m,k)):(d.subTo(c,d),b&&l.subTo(f,l),m.subTo(k,m))}if(0!=d.compareTo(BigInteger.ONE))return BigInteger.ZERO;if(0<=m.compareTo(a))return m.subtract(a);if(0>m.signum())m.addTo(a,m);else return m;return 0>m.signum()?m.add(a):m};BigInteger.prototype.pow=function(a){return this.exp(a,new NullExp)};
BigInteger.prototype.gcd=function(a){var b=0>this.s?this.negate():this.clone();a=0>a.s?a.negate():a.clone();if(0>b.compareTo(a)){var c=b;b=a;a=c}c=b.getLowestSetBit();var d=a.getLowestSetBit();if(0>d)return b;c<d&&(d=c);0<d&&(b.rShiftTo(d,b),a.rShiftTo(d,a));for(;0<b.signum();)0<(c=b.getLowestSetBit())&&b.rShiftTo(c,b),0<(c=a.getLowestSetBit())&&a.rShiftTo(c,a),0<=b.compareTo(a)?(b.subTo(a,b),b.rShiftTo(1,b)):(a.subTo(b,a),a.rShiftTo(1,a));0<d&&a.lShiftTo(d,a);return a};
BigInteger.prototype.isProbablePrime=function(a){var b,c=this.abs();if(1==c.t&&c[0]<=lowprimes[lowprimes.length-1]){for(b=0;b<lowprimes.length;++b)if(c[0]==lowprimes[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<lowprimes.length;){for(var d=lowprimes[b],f=b+1;f<lowprimes.length&&d<lplim;)d*=lowprimes[f++];for(d=c.modInt(d);b<f;)if(0==d%lowprimes[b++])return!1}return c.millerRabin(a)};BigInteger.prototype.square=function(){var a=nbi();this.squareTo(a);return a};
function Arcfour(){this.j=this.i=0;this.S=[]}Arcfour.prototype.init=function(a){var b,c;for(b=0;256>b;++b)this.S[b]=b;for(b=c=0;256>b;++b){c=c+this.S[b]+a[b%a.length]&255;var d=this.S[b];this.S[b]=this.S[c];this.S[c]=d}this.j=this.i=0};Arcfour.prototype.next=function(){this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;var a=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=a;return this.S[a+this.S[this.i]&255]};function prng_newstate(){return new Arcfour}var rng_state,rng_pool,rng_pptr;
function rng_seed_int(a){rng_pool[rng_pptr++]^=a&255;rng_pool[rng_pptr++]^=a>>8&255;rng_pool[rng_pptr++]^=a>>16&255;rng_pool[rng_pptr++]^=a>>24&255;256<=rng_pptr&&(rng_pptr-=256)}function rng_seed_time(){rng_seed_int((new Date).getTime())}
if(null==rng_pool){rng_pool=[];rng_pptr=0;var t;if(void 0!==window&&(void 0!==window.crypto||void 0!==window.msCrypto)){var crypto=window.crypto||window.msCrypto;if(crypto.getRandomValues){var ua=new Uint8Array(32);crypto.getRandomValues(ua);for(t=0;32>t;++t)rng_pool[rng_pptr++]=ua[t]}else if("Netscape"==navigator.appName&&"5">navigator.appVersion){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}}for(;256>rng_pptr;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=
t>>>8,rng_pool[rng_pptr++]=t&255;rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(null==rng_state){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(a){var b;for(b=0;b<a.length;++b)a[b]=rng_get_byte()}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;function parseBigInt(a,b){return new BigInteger(a,b)}
function linebrk(a,b){for(var c="",d=0;d+b<a.length;)c+=a.substring(d,d+b)+"\n",d+=b;return c+a.substring(d,a.length)}function byte2Hex(a){return 16>a?"0"+a.toString(16):a.toString(16)}
function pkcs1pad2(a,b){if(b<a.length+11)throw"Message too long for RSA";for(var c=[],d=a.length-1;0<=d&&0<b;){var f=a.charCodeAt(d--);128>f?c[--b]=f:127<f&&2048>f?(c[--b]=f&63|128,c[--b]=f>>6|192):(c[--b]=f&63|128,c[--b]=f>>6&63|128,c[--b]=f>>12|224)}c[--b]=0;a=new SecureRandom;for(d=[];2<b;){for(d[0]=0;0==d[0];)a.nextBytes(d);c[--b]=d[0]}c[--b]=2;c[--b]=0;return new BigInteger(c)}
function oaep_mgf1_arr(a,b,c){for(var d="",f=0;d.length<b;)d+=c(String.fromCharCode.apply(String,a.concat([(f&4278190080)>>24,(f&16711680)>>16,(f&65280)>>8,f&255]))),f+=1;return d}
function oaep_pad(a,b,c,d){var f=KJUR.crypto.MessageDigest,k=KJUR.crypto.Util,l=null;c||(c="sha1");"string"===typeof c&&(l=f.getCanonicalAlgName(c),d=f.getHashLength(l),c=function(a){return hextorstr(k.hashHex(rstrtohex(a),l))});if(a.length+2*d+2>b)throw"Message too long for RSA";var m="";for(f=0;f<b-a.length-2*d-2;f+=1)m+="\x00";b=c("")+m+"\u0001"+a;d=Array(d);(new SecureRandom).nextBytes(d);m=oaep_mgf1_arr(d,b.length,c);a=[];for(f=0;f<b.length;f+=1)a[f]=b.charCodeAt(f)^m.charCodeAt(f);c=oaep_mgf1_arr(a,
d.length,c);b=[0];for(f=0;f<d.length;f+=1)b[f+1]=d[f]^c.charCodeAt(f);return new BigInteger(b.concat(a))}function RSAKey(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}RSAKey.prototype.doPublic=function(a){return a.modPowInt(this.e,this.n)};
RSAKey.prototype.setPublic=function(a,b){this.isPublic=!0;this.isPrivate=!1;if("string"!==typeof a)this.n=a,this.e=b;else if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=parseBigInt(a,16),this.e=parseInt(b,16);else throw"Invalid RSA public key";};RSAKey.prototype.encrypt=function(a){a=pkcs1pad2(a,this.n.bitLength()+7>>3);if(null==a)return null;a=this.doPublic(a);if(null==a)return null;a=a.toString(16);return 0==(a.length&1)?a:"0"+a};
RSAKey.prototype.encryptOAEP=function(a,b,c){var d=this.n.bitLength()+7>>3;a=oaep_pad(a,d,b,c);if(null==a)return null;a=this.doPublic(a);if(null==a)return null;for(a=a.toString(16);a.length<2*d;)a="0"+a;return a};RSAKey.prototype.type="RSA";
function pkcs1unpad2(a,b){a=a.toByteArray();for(var c=0;c<a.length&&0==a[c];)++c;if(a.length-c!=b-1||2!=a[c])return null;for(++c;0!=a[c];)if(++c>=a.length)return null;for(b="";++c<a.length;){var d=a[c]&255;128>d?b+=String.fromCharCode(d):191<d&&224>d?(b+=String.fromCharCode((d&31)<<6|a[c+1]&63),++c):(b+=String.fromCharCode((d&15)<<12|(a[c+1]&63)<<6|a[c+2]&63),c+=2)}return b}
function oaep_mgf1_str(a,b,c){for(var d="",f=0;d.length<b;)d+=c(a+String.fromCharCode.apply(String,[(f&4278190080)>>24,(f&16711680)>>16,(f&65280)>>8,f&255])),f+=1;return d}
function oaep_unpad(a,b,c,d){var f=KJUR.crypto.MessageDigest,k=KJUR.crypto.Util,l=null;c||(c="sha1");"string"===typeof c&&(l=f.getCanonicalAlgName(c),d=f.getHashLength(l),c=function(a){return hextorstr(k.hashHex(rstrtohex(a),l))});a=a.toByteArray();for(f=0;f<a.length;f+=1)a[f]&=255;for(;a.length<b;)a.unshift(0);a=String.fromCharCode.apply(String,a);if(a.length<2*d+2)throw"Cipher too short";var m=a.substr(1,d);b=a.substr(d+1);var e=oaep_mgf1_str(b,d,c),h=[];for(f=0;f<m.length;f+=1)h[f]=m.charCodeAt(f)^
e.charCodeAt(f);m=oaep_mgf1_str(String.fromCharCode.apply(String,h),a.length-d,c);a=[];for(f=0;f<b.length;f+=1)a[f]=b.charCodeAt(f)^m.charCodeAt(f);a=String.fromCharCode.apply(String,a);if(a.substr(0,d)!==c(""))throw"Hash mismatch";a=a.substr(d);c=a.indexOf("\u0001");if((-1!=c?a.substr(0,c).lastIndexOf("\x00"):-1)+1!=c)throw"Malformed data";return a.substr(c+1)}
RSAKey.prototype.doPrivate=function(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);var b=a.mod(this.p).modPow(this.dmp1,this.p);for(a=a.mod(this.q).modPow(this.dmq1,this.q);0>b.compareTo(a);)b=b.add(this.p);return b.subtract(a).multiply(this.coeff).mod(this.p).multiply(this.q).add(a)};
RSAKey.prototype.setPrivate=function(a,b,c){this.isPrivate=!0;if("string"!==typeof a)this.n=a,this.e=b,this.d=c;else if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=parseBigInt(a,16),this.e=parseInt(b,16),this.d=parseBigInt(c,16);else throw"Invalid RSA private key";};
RSAKey.prototype.setPrivateEx=function(a,b,c,d,f,k,l,m){this.isPrivate=!0;this.isPublic=!1;if(null==a)throw"RSASetPrivateEx N == null";if(null==b)throw"RSASetPrivateEx E == null";if(0==a.length)throw"RSASetPrivateEx N.length == 0";if(0==b.length)throw"RSASetPrivateEx E.length == 0";if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=parseBigInt(a,16),this.e=parseInt(b,16),this.d=parseBigInt(c,16),this.p=parseBigInt(d,16),this.q=parseBigInt(f,16),this.dmp1=parseBigInt(k,16),this.dmq1=parseBigInt(l,
16),this.coeff=parseBigInt(m,16);else throw"Invalid RSA private key in RSASetPrivateEx";};
RSAKey.prototype.generate=function(a,b){var c=new SecureRandom,d=a>>1;this.e=parseInt(b,16);b=new BigInteger(b,16);for(var f=a/2-100,k=BigInteger.ONE.shiftLeft(f);;){for(;this.p=new BigInteger(a-d,1,c),0!=this.p.subtract(BigInteger.ONE).gcd(b).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(d,1,c),0!=this.q.subtract(BigInteger.ONE).gcd(b).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(0>=this.p.compareTo(this.q)){var l=this.p;this.p=this.q;this.q=l}l=
this.q.subtract(this.p).abs();if(!(l.bitLength()<f||0>=l.compareTo(k))){l=this.p.subtract(BigInteger.ONE);var m=this.q.subtract(BigInteger.ONE),e=l.multiply(m);if(0==e.gcd(b).compareTo(BigInteger.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==a)){this.d=b.modInverse(e);this.dmp1=this.d.mod(l);this.dmq1=this.d.mod(m);this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0};
RSAKey.prototype.decrypt=function(a){if(a.length!=Math.ceil(this.n.bitLength()/4))throw Error("wrong ctext length");a=parseBigInt(a,16);a=this.doPrivate(a);return null==a?null:pkcs1unpad2(a,this.n.bitLength()+7>>3)};RSAKey.prototype.decryptOAEP=function(a,b,c){if(a.length!=Math.ceil(this.n.bitLength()/4))throw Error("wrong ctext length");a=parseBigInt(a,16);a=this.doPrivate(a);return null==a?null:oaep_unpad(a,this.n.bitLength()+7>>3,b,c)};function ECFieldElementFp(a,b){this.x=b;this.q=a}
ECFieldElementFp.prototype.equals=function(a){return a==this?!0:this.q.equals(a.q)&&this.x.equals(a.x)};ECFieldElementFp.prototype.toBigInteger=function(){return this.x};ECFieldElementFp.prototype.negate=function(){return new ECFieldElementFp(this.q,this.x.negate().mod(this.q))};ECFieldElementFp.prototype.add=function(a){return new ECFieldElementFp(this.q,this.x.add(a.toBigInteger()).mod(this.q))};ECFieldElementFp.prototype.subtract=function(a){return new ECFieldElementFp(this.q,this.x.subtract(a.toBigInteger()).mod(this.q))};
ECFieldElementFp.prototype.multiply=function(a){return new ECFieldElementFp(this.q,this.x.multiply(a.toBigInteger()).mod(this.q))};ECFieldElementFp.prototype.square=function(){return new ECFieldElementFp(this.q,this.x.square().mod(this.q))};ECFieldElementFp.prototype.divide=function(a){return new ECFieldElementFp(this.q,this.x.multiply(a.toBigInteger().modInverse(this.q)).mod(this.q))};ECFieldElementFp.prototype.sqrt=function(){return new ECFieldElementFp(this.q,this.x.sqrt().mod(this.q))};
function ECPointFp(a,b,c,d){this.curve=a;this.x=b;this.y=c;this.z=null==d?BigInteger.ONE:d;this.zinv=null}ECPointFp.prototype.getX=function(){null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q));return this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))};ECPointFp.prototype.getY=function(){null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q));return this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))};
ECPointFp.prototype.equals=function(a){return a==this?!0:this.isInfinity()?a.isInfinity():a.isInfinity()?this.isInfinity():a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q).equals(BigInteger.ZERO)?a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q).equals(BigInteger.ZERO):!1};ECPointFp.prototype.isInfinity=function(){return null==this.x&&null==this.y?!0:this.z.equals(BigInteger.ZERO)&&!this.y.toBigInteger().equals(BigInteger.ZERO)};
ECPointFp.prototype.negate=function(){return new ECPointFp(this.curve,this.x,this.y.negate(),this.z)};
ECPointFp.prototype.add=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;var b=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),c=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q);if(BigInteger.ZERO.equals(c))return BigInteger.ZERO.equals(b)?this.twice():this.curve.getInfinity();var d=new BigInteger("3"),f=this.x.toBigInteger(),k=this.y.toBigInteger();a.x.toBigInteger();a.y.toBigInteger();
var l=c.square(),m=l.multiply(c);f=f.multiply(l);l=b.square().multiply(this.z);c=l.subtract(f.shiftLeft(1)).multiply(a.z).subtract(m).multiply(c).mod(this.curve.q);b=f.multiply(d).multiply(b).subtract(k.multiply(m)).subtract(l.multiply(b)).multiply(a.z).add(b.multiply(m)).mod(this.curve.q);a=m.multiply(this.z).multiply(a.z).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(c),this.curve.fromBigInteger(b),a)};
ECPointFp.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var a=new BigInteger("3"),b=this.x.toBigInteger(),c=this.y.toBigInteger(),d=c.multiply(this.z),f=d.multiply(c).mod(this.curve.q);c=this.curve.a.toBigInteger();var k=b.square().multiply(a);BigInteger.ZERO.equals(c)||(k=k.add(this.z.square().multiply(c)));k=k.mod(this.curve.q);c=k.square().subtract(b.shiftLeft(3).multiply(f)).shiftLeft(1).multiply(d).mod(this.curve.q);
a=k.multiply(a).multiply(b).subtract(f.shiftLeft(1)).shiftLeft(2).multiply(f).subtract(k.square().multiply(k)).mod(this.curve.q);d=d.square().multiply(d).shiftLeft(3).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(c),this.curve.fromBigInteger(a),d)};
ECPointFp.prototype.multiply=function(a){if(this.isInfinity())return this;if(0==a.signum())return this.curve.getInfinity();var b=a.multiply(new BigInteger("3")),c=this.negate(),d=this,f=this.curve.q.subtract(a),k=f.multiply(new BigInteger("3")),l=new ECPointFp(this.curve,this.x,this.y),m=l.negate(),e;for(e=b.bitLength()-2;0<e;--e){d=d.twice();var h=b.testBit(e),n=a.testBit(e);h!=n&&(d=d.add(h?this:c))}for(e=k.bitLength()-2;0<e;--e)l=l.twice(),a=k.testBit(e),b=f.testBit(e),a!=b&&(l=l.add(a?l:m));return d};
ECPointFp.prototype.multiplyTwo=function(a,b,c){var d=a.bitLength()>c.bitLength()?a.bitLength()-1:c.bitLength()-1;for(var f=this.curve.getInfinity(),k=this.add(b);0<=d;)f=f.twice(),a.testBit(d)?f=c.testBit(d)?f.add(k):f.add(this):c.testBit(d)&&(f=f.add(b)),--d;return f};function ECCurveFp(a,b,c){this.q=a;this.a=this.fromBigInteger(b);this.b=this.fromBigInteger(c);this.infinity=new ECPointFp(this,null,null)}ECCurveFp.prototype.getQ=function(){return this.q};ECCurveFp.prototype.getA=function(){return this.a};
ECCurveFp.prototype.getB=function(){return this.b};ECCurveFp.prototype.equals=function(a){return a==this?!0:this.q.equals(a.q)&&this.a.equals(a.a)&&this.b.equals(a.b)};ECCurveFp.prototype.getInfinity=function(){return this.infinity};ECCurveFp.prototype.fromBigInteger=function(a){return new ECFieldElementFp(this.q,a)};
ECCurveFp.prototype.decodePointHex=function(a){switch(parseInt(a.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var b=a.substr(0,2);a.substr(2);d=this.fromBigInteger(new BigInteger(d,16));a=this.getA();var c=this.getB();a=d.square().add(a).multiply(d).add(c).sqrt();"03"==b&&(a=a.negate());return new ECPointFp(this,d,a);case 4:case 6:case 7:b=(a.length-2)/2;var d=a.substr(2,b);b=a.substr(b+2,b);return new ECPointFp(this,this.fromBigInteger(new BigInteger(d,16)),this.fromBigInteger(new BigInteger(b,
16)));default:return null}};ECFieldElementFp.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)};ECPointFp.prototype.getEncoded=function(a){var b=function(a,b){a=a.toByteArrayUnsigned();if(b<a.length)a=a.slice(a.length-b);else for(;b>a.length;)a.unshift(0);return a},c=this.getX().toBigInteger(),d=this.getY().toBigInteger();c=b(c,32);a?d.isEven()?c.unshift(2):c.unshift(3):(c.unshift(4),c=c.concat(b(d,32)));return c};
ECPointFp.decodeFrom=function(a,b){var c=b.length-1,d=b.slice(1,1+c/2);b=b.slice(1+c/2,1+c);d.unshift(0);b.unshift(0);d=new BigInteger(d);b=new BigInteger(b);return new ECPointFp(a,a.fromBigInteger(d),a.fromBigInteger(b))};ECPointFp.decodeFromHex=function(a,b){b.substr(0,2);var c=b.length-2,d=b.substr(2,c/2);b=b.substr(2+c/2,c/2);d=new BigInteger(d,16);b=new BigInteger(b,16);return new ECPointFp(a,a.fromBigInteger(d),a.fromBigInteger(b))};
ECPointFp.prototype.add2D=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;if(this.x.equals(a.x))return this.y.equals(a.y)?this.twice():this.curve.getInfinity();var b=a.x.subtract(this.x);b=a.y.subtract(this.y).divide(b);a=b.square().subtract(this.x).subtract(a.x);b=b.multiply(this.x.subtract(a)).subtract(this.y);return new ECPointFp(this.curve,a,b)};
ECPointFp.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var a=this.curve.fromBigInteger(BigInteger.valueOf(2)),b=this.curve.fromBigInteger(BigInteger.valueOf(3));b=this.x.square().multiply(b).add(this.curve.a).divide(this.y.multiply(a));a=b.square().subtract(this.x.multiply(a));b=b.multiply(this.x.subtract(a)).subtract(this.y);return new ECPointFp(this.curve,a,b)};
ECPointFp.prototype.multiply2D=function(a){if(this.isInfinity())return this;if(0==a.signum())return this.curve.getInfinity();var b=a.multiply(new BigInteger("3")),c=this.negate(),d=this,f;for(f=b.bitLength()-2;0<f;--f){d=d.twice();var k=b.testBit(f),l=a.testBit(f);k!=l&&(d=d.add2D(k?this:c))}return d};
ECPointFp.prototype.isOnCurve=function(){var a=this.getX().toBigInteger(),b=this.getY().toBigInteger(),c=this.curve.getA().toBigInteger(),d=this.curve.getB().toBigInteger(),f=this.curve.getQ();b=b.multiply(b).mod(f);a=a.multiply(a).multiply(a).add(c.multiply(a)).add(d).mod(f);return b.equals(a)};ECPointFp.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"};
ECPointFp.prototype.validate=function(){var a=this.curve.getQ();if(this.isInfinity())throw Error("Point is at infinity.");var b=this.getX().toBigInteger(),c=this.getY().toBigInteger();if(0>b.compareTo(BigInteger.ONE)||0<b.compareTo(a.subtract(BigInteger.ONE)))throw Error("x coordinate out of bounds");if(0>c.compareTo(BigInteger.ONE)||0<c.compareTo(a.subtract(BigInteger.ONE)))throw Error("y coordinate out of bounds");if(!this.isOnCurve())throw Error("Point is not on the curve.");if(this.multiply(a).isInfinity())throw Error("Point is not a scalar multiple of G.");
return!0};
var jsonParse=function(){function a(a,b,c){return b?d[b]:String.fromCharCode(parseInt(c,16))}var b=/(?:false|true|null|[\{\}\[\]]|(?:-?\b(?:0|[1-9][0-9]*)(?:\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\b)|(?:"(?:[^\0-\x08\x0a-\x1f"\\]|\\(?:["/\\bfnrt]|u[0-9A-Fa-f]{4}))*"))/g,c=/\\(?:([^u])|u(.{4}))/g,d={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},f=new String(""),k=Object.hasOwnProperty;return function(d,m){d=d.match(b);var e=d[0],h=!1;if("{"===e)var n={};else"["===e?n=[]:(n=[],h=!0);for(var g,
p=[n],l=1-h,r=d.length;l<r;++l)switch(e=d[l],e.charCodeAt(0)){default:var v=p[0];v[g||v.length]=+e;g=void 0;break;case 34:e=e.substring(1,e.length-1);-1!==e.indexOf("\\")&&(e=e.replace(c,a));v=p[0];if(!g)if(v instanceof Array)g=v.length;else{g=e||f;break}v[g]=e;g=void 0;break;case 91:v=p[0];p.unshift(v[g||v.length]=[]);g=void 0;break;case 93:p.shift();break;case 102:v=p[0];v[g||v.length]=!1;g=void 0;break;case 110:v=p[0];v[g||v.length]=null;g=void 0;break;case 116:v=p[0];v[g||v.length]=!0;g=void 0;
break;case 123:v=p[0];p.unshift(v[g||v.length]={});g=void 0;break;case 125:p.shift()}if(h){if(1!==p.length)throw Error();n=n[0]}else if(p.length)throw Error();if(m){var u=function(a,b){var c=a[b];if(c&&"object"===typeof c){var e=null,d;for(d in c)if(k.call(c,d)&&c!==a){var g=u(c,d);void 0!==g?c[d]=g:(e||(e=[]),e.push(d))}if(e)for(d=e.length;0<=--d;)delete c[e[d]]}return m.call(a,b,c)};n=u({"":n},"")}return n}}();"undefined"!=typeof KJUR&&KJUR||(KJUR={});
"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});
KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(a){a=a.toString(16);1==a.length%2&&(a="0"+a);return a};this.bigIntToMinTwosComplementsHex=function(a){var b=a.toString(16);if("-"!=b.substr(0,1))1==b.length%2?b="0"+b:b.match(/^[0-7]/)||(b="00"+b);else{var c=b.substr(1).length;1==c%2?c+=1:b.match(/^[0-7]/)||(c+=2);b="";for(var d=0;d<c;d++)b+="f";b=(new BigInteger(b,16)).xor(a).add(BigInteger.ONE).toString(16).replace(/^-/,"")}return b};this.getPEMStringFromHex=function(a,b){return hextopem(a,
b)};this.newObject=function(a){var b=KJUR.asn1,c=b.ASN1Object,d=b.DERBoolean,f=b.DERInteger,k=b.DERBitString,l=b.DEROctetString,m=b.DERNull,e=b.DERObjectIdentifier,h=b.DEREnumerated,n=b.DERUTF8String,g=b.DERNumericString,p=b.DERPrintableString,q=b.DERTeletexString,r=b.DERIA5String,v=b.DERUTCTime,u=b.DERGeneralizedTime,A=b.DERVisibleString,x=b.DERBMPString,B=b.DERSequence,I=b.DERSet,D=b.DERTaggedObject,E=b.ASN1Util.newObject;if(a instanceof b.ASN1Object)return a;b=Object.keys(a);if(1!=b.length)throw Error("key of param shall be only one.");
b=b[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+b+":"))throw Error("undefined key: "+b);if("bool"==b)return new d(a[b]);if("int"==b)return new f(a[b]);if("bitstr"==b)return new k(a[b]);if("octstr"==b)return new l(a[b]);if("null"==b)return new m(a[b]);if("oid"==b)return new e(a[b]);if("enum"==b)return new h(a[b]);if("utf8str"==b)return new n(a[b]);if("numstr"==b)return new g(a[b]);if("prnstr"==b)return new p(a[b]);
if("telstr"==b)return new q(a[b]);if("ia5str"==b)return new r(a[b]);if("utctime"==b)return new v(a[b]);if("gentime"==b)return new u(a[b]);if("visstr"==b)return new A(a[b]);if("bmpstr"==b)return new x(a[b]);if("asn1"==b)return new c(a[b]);if("seq"==b){D=a[b];a=[];for(c=0;c<D.length;c++)d=E(D[c]),a.push(d);return new B({array:a})}if("set"==b){D=a[b];a=[];for(c=0;c<D.length;c++)d=E(D[c]),a.push(d);return new I({array:a})}if("tag"==b)return B=a[b],"[object Array]"===Object.prototype.toString.call(B)&&
3==B.length?(E=E(B[2]),new D({tag:B[0],explicit:B[1],obj:E})):new D(B)};this.jsonToASN1HEX=function(a){return this.newObject(a).tohex()}};KJUR.asn1.ASN1Util.oidHexToInt=function(a){var b=parseInt(a.substr(0,2),16);b=Math.floor(b/40)+"."+b%40;for(var c="",d=2;d<a.length;d+=2){var f=("00000000"+parseInt(a.substr(d,2),16).toString(2)).slice(-8);c+=f.substr(1,7);"0"==f.substr(0,1)&&(c=new BigInteger(c,2),b=b+"."+c.toString(10),c="")}return b};
KJUR.asn1.ASN1Util.oidIntToHex=function(a){var b=function(a){a=a.toString(16);1==a.length&&(a="0"+a);return a},c=function(a){var c="";a=(new BigInteger(a,10)).toString(2);var d=7-a.length%7;7==d&&(d=0);for(var e="",h=0;h<d;h++)e+="0";a=e+a;for(h=0;h<a.length-1;h+=7)d=a.substr(h,7),h!=a.length-7&&(d="1"+d),c+=b(parseInt(d,2));return c};if(!a.match(/^[0-9.]+$/))throw"malformed oid string: "+a;var d="";a=a.split(".");var f=40*parseInt(a[0])+parseInt(a[1]);d+=b(f);a.splice(0,2);for(f=0;f<a.length;f++)d+=
c(a[f]);return d};
KJUR.asn1.ASN1Object=function(a){this.params=null;this.getLengthHexFromValue=function(){if("undefined"==typeof this.hV||null==this.hV)throw Error("this.hV is null or undefined");if(1==this.hV.length%2)throw Error("value hex must be even length: n=0,v="+this.hV);var a=this.hV.length/2,c=a.toString(16);1==c.length%2&&(c="0"+c);if(128>a)return c;var d=c.length/2;if(15<d)throw Error("ASN.1 length too long to represent by 8x: n = "+a.toString(16));return(128+d).toString(16)+c};this.tohex=function(){if(null==
this.hTLV||this.isModified)this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1;return this.hTLV};this.getEncodedHex=function(){return this.tohex()};this.getValueHex=function(){this.tohex();return this.hV};this.getFreshValueHex=function(){return""};this.setByParam=function(a){this.params=a};void 0!=a&&void 0!=a.tlv&&(this.hTLV=a.tlv,this.isModified=!1)};
KJUR.asn1.DERAbstractString=function(a){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s};this.setString=function(a){this.hTLV=null;this.isModified=!0;this.s=a;this.hV=utf8tohex(this.s).toLowerCase()};this.setStringHex=function(a){this.hTLV=null;this.isModified=!0;this.s=null;this.hV=a};this.getFreshValueHex=function(){return this.hV};"undefined"!=typeof a&&("string"==typeof a?this.setString(a):"undefined"!=typeof a.str?this.setString(a.str):"undefined"!=
typeof a.hex&&this.setStringHex(a.hex))};extendClass(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object);
KJUR.asn1.DERAbstractTime=function(a){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(a){a=a.getTime()+6E4*a.getTimezoneOffset();return new Date(a)};this.formatDate=function(a,c,d){var b=this.zeroPadding;a=this.localDateToUTC(a);var k=String(a.getFullYear());"utc"==c&&(k=k.substr(2,2));c=b(String(a.getMonth()+1),2);var l=b(String(a.getDate()),2),m=b(String(a.getHours()),2),e=b(String(a.getMinutes()),2),h=b(String(a.getSeconds()),2);k=k+c+l+m+e+h;!0===d&&(d=
a.getMilliseconds(),0!=d&&(b=b(String(d),3),b=b.replace(/[0]+$/,""),k=k+"."+b));return k+"Z"};this.zeroPadding=function(a,c){return a.length>=c?a:Array(c-a.length+1).join("0")+a};this.setByParam=function(a){this.hTLV=this.hV=null;this.params=a};this.getString=function(){};this.setString=function(a){this.hTLV=null;this.isModified=!0;void 0==this.params&&(this.params={});this.params.str=a};this.setByDate=function(a){this.hTLV=null;this.isModified=!0;void 0==this.params&&(this.params={});this.params.date=
a};this.setByDateValue=function(a,c,d,f,k,l){a=new Date(Date.UTC(a,c-1,d,f,k,l,0));this.setByDate(a)};this.getFreshValueHex=function(){return this.hV}};extendClass(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object);
KJUR.asn1.DERAbstractStructured=function(a){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(a){this.hTLV=null;this.isModified=!0;this.asn1Array=a};this.appendASN1Object=function(a){this.hTLV=null;this.isModified=!0;this.asn1Array.push(a)};this.asn1Array=[];"undefined"!=typeof a&&"undefined"!=typeof a.array&&(this.asn1Array=a.array)};extendClass(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object);
KJUR.asn1.DERBoolean=function(a){KJUR.asn1.DERBoolean.superclass.constructor.call(this);this.hT="01";this.hTLV=0==a?"010100":"0101ff"};extendClass(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object);
KJUR.asn1.DERInteger=function(a){KJUR.asn1.DERInteger.superclass.constructor.call(this);this.hT="02";this.params=null;var b=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex;this.setByBigInteger=function(a){this.isModified=!0;this.params={bigint:a}};this.setByInteger=function(a){this.isModified=!0;this.params=a};this.setValueHex=function(a){this.isModified=!0;this.params={hex:a}};this.getFreshValueHex=function(){var a=this.params;if(null==a)throw Error("value not set");if("object"==typeof a&&void 0!=
a.hex)return this.hV=a.hex;if("number"==typeof a)a=new BigInteger(String(a),10);else if(void 0!=a["int"])a=new BigInteger(String(a["int"]),10);else if(void 0!=a.bigint)a=a.bigint;else throw Error("wrong parameter");return this.hV=b(a)};void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object);
KJUR.asn1.DERBitString=function(a){if(void 0!==a&&"undefined"!==typeof a.obj){var b=KJUR.asn1.ASN1Util.newObject(a.obj);a.hex="00"+b.tohex()}KJUR.asn1.DERBitString.superclass.constructor.call(this);this.hT="03";this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null;this.isModified=!0;this.hV=a};this.setUnusedBitsAndHexValue=function(a,b){if(0>a||7<a)throw"unused bits shall be from 0 to 7: u = "+a;this.hTLV=null;this.isModified=!0;this.hV="0"+a+b};this.setByBinaryString=function(a){a=a.replace(/0+$/,
"");var b=8-a.length%8;8==b&&(b=0);a+="0000000".substr(0,b);for(var c="",k=0;k<a.length-1;k+=8){var l=a.substr(k,8);l=parseInt(l,2).toString(16);1==l.length&&(l="0"+l);c+=l}this.hTLV=null;this.isModified=!0;this.hV="0"+b+c};this.setByBooleanArray=function(a){for(var b="",c=0;c<a.length;c++)b=1==a[c]?b+"1":b+"0";this.setByBinaryString(b)};this.newFalseArray=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=!1;return b};this.getFreshValueHex=function(){return this.hV};"undefined"!=typeof a&&("string"==
typeof a&&a.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(a):"undefined"!=typeof a.hex?this.setHexValueIncludingUnusedBits(a.hex):"undefined"!=typeof a.bin?this.setByBinaryString(a.bin):"undefined"!=typeof a.array&&this.setByBooleanArray(a.array))};extendClass(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object);
KJUR.asn1.DEROctetString=function(a){if(void 0!==a&&"undefined"!==typeof a.obj){var b=KJUR.asn1.ASN1Util.newObject(a.obj);a.hex=b.tohex()}KJUR.asn1.DEROctetString.superclass.constructor.call(this,a);this.hT="04"};extendClass(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this);this.hT="05";this.hTLV="0500"};extendClass(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object);
KJUR.asn1.DERObjectIdentifier=function(a){KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this);this.hT="06";this.setValueHex=function(a){this.hTLV=null;this.isModified=!0;this.s=null;this.hV=a};this.setValueOidString=function(a){var b=oidtohex(a);if(null==b)throw Error("malformed oid string: "+a);this.hTLV=null;this.isModified=!0;this.s=null;this.hV=b};this.setValueName=function(a){var b=KJUR.asn1.x509.OID.name2oid(a);if(""!==b)this.setValueOidString(b);else throw Error("DERObjectIdentifier oidName undefined: "+
a);};this.setValueNameOrOid=function(a){a.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(a):this.setValueName(a)};this.getFreshValueHex=function(){return this.hV};this.setByParam=function(a){"string"===typeof a?this.setValueNameOrOid(a):void 0!==a.oid?this.setValueNameOrOid(a.oid):void 0!==a.name?this.setValueNameOrOid(a.name):void 0!==a.hex&&this.setValueHex(a.hex)};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object);
KJUR.asn1.DEREnumerated=function(a){KJUR.asn1.DEREnumerated.superclass.constructor.call(this);this.hT="0a";this.setByBigInteger=function(a){this.hTLV=null;this.isModified=!0;this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(a)};this.setByInteger=function(a){a=new BigInteger(String(a),10);this.setByBigInteger(a)};this.setValueHex=function(a){this.hV=a};this.getFreshValueHex=function(){return this.hV};"undefined"!=typeof a&&("undefined"!=typeof a["int"]?this.setByInteger(a["int"]):"number"==
typeof a?this.setByInteger(a):"undefined"!=typeof a.hex&&this.setValueHex(a.hex))};extendClass(KJUR.asn1.DEREnumerated,KJUR.asn1.ASN1Object);KJUR.asn1.DERUTF8String=function(a){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,a);this.hT="0c"};extendClass(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString);KJUR.asn1.DERNumericString=function(a){KJUR.asn1.DERNumericString.superclass.constructor.call(this,a);this.hT="12"};extendClass(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString);
KJUR.asn1.DERPrintableString=function(a){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,a);this.hT="13"};extendClass(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERTeletexString=function(a){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,a);this.hT="14"};extendClass(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERIA5String=function(a){KJUR.asn1.DERIA5String.superclass.constructor.call(this,a);this.hT="16"};
extendClass(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString);KJUR.asn1.DERVisibleString=function(a){KJUR.asn1.DERIA5String.superclass.constructor.call(this,a);this.hT="1a"};extendClass(KJUR.asn1.DERVisibleString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERBMPString=function(a){KJUR.asn1.DERBMPString.superclass.constructor.call(this,a);this.hT="1e"};extendClass(KJUR.asn1.DERBMPString,KJUR.asn1.DERAbstractString);
KJUR.asn1.DERUTCTime=function(a){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,a);this.hT="17";this.params=void 0;this.getFreshValueHex=function(){var a=this.params;void 0==this.params&&(a={date:new Date});if("string"==typeof a)if(a.match(/^[0-9]{12}Z$/)||a.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=stohex(a);else throw Error("malformed string for UTCTime: "+a);else void 0!=a.str?this.hV=stohex(a.str):void 0==a.date&&1==a.millis?this.hV=stohex(this.formatDate(new Date,"utc",!0)):void 0!=a.date&&
a.date instanceof Date?this.hV=stohex(this.formatDate(a.date,"utc",!0===a.millis)):a instanceof Date&&(this.hV=stohex(this.formatDate(a,"utc")));if(void 0==this.hV)throw Error("parameter not specified properly for UTCTime");return this.hV};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime);
KJUR.asn1.DERGeneralizedTime=function(a){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,a);this.hT="18";this.params=a;this.getFreshValueHex=function(){var a=this.params;void 0==this.params&&(a={date:new Date});if("string"==typeof a)if(a.match(/^[0-9]{14}Z$/)||a.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=stohex(a);else throw Error("malformed string for GeneralizedTime: "+a);else void 0!=a.str?this.hV=stohex(a.str):void 0==a.date&&1==a.millis?this.hV=stohex(this.formatDate(new Date,"gen",
!0)):void 0!=a.date&&a.date instanceof Date?this.hV=stohex(this.formatDate(a.date,"gen",!0===a.millis)):a instanceof Date&&(this.hV=stohex(this.formatDate(a,"gen")));if(void 0==this.hV)throw Error("parameter not specified properly for GeneralizedTime");return this.hV};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime);
KJUR.asn1.DERSequence=function(a){KJUR.asn1.DERSequence.superclass.constructor.call(this,a);this.hT="30";this.getFreshValueHex=function(){for(var a="",c=0;c<this.asn1Array.length;c++)a+=this.asn1Array[c].tohex();return this.hV=a}};extendClass(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured);
KJUR.asn1.DERSet=function(a){KJUR.asn1.DERSet.superclass.constructor.call(this,a);this.hT="31";this.sortFlag=!0;this.getFreshValueHex=function(){for(var a=[],c=0;c<this.asn1Array.length;c++)a.push(this.asn1Array[c].tohex());1==this.sortFlag&&a.sort();return this.hV=a.join("")};"undefined"!=typeof a&&"undefined"!=typeof a.sortflag&&0==a.sortflag&&(this.sortFlag=!1)};extendClass(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured);
KJUR.asn1.DERTaggedObject=function(a){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this);var b=KJUR.asn1,c=ASN1HEX.getV,d=b.ASN1Util.newObject;this.hT="a0";this.hV="";this.isExplicit=!0;this.asn1Object=null;this.params={tag:"a0",explicit:!0};this.setASN1Object=function(a,b,c){this.params={tag:b,explicit:a,obj:c}};this.getFreshValueHex=function(){var a=this.params;void 0==a.explicit&&(a.explicit=!0);void 0!=a.tage&&(a.tag=a.tage,a.explicit=!0);void 0!=a.tagi&&(a.tag=a.tagi,a.explicit=!1);
if(void 0!=a.str)this.hV=utf8tohex(a.str);else if(void 0!=a.hex)this.hV=a.hex;else if(void 0!=a.obj){var k;a.obj instanceof b.ASN1Object?k=a.obj.tohex():"object"==typeof a.obj&&(k=d(a.obj).tohex());this.hV=a.explicit?k:c(k,0)}else throw Error("str, hex nor obj not specified");void 0==a.tag&&(a.tag="a0");this.hT=a.tag;this.hTLV=null;this.isModified=!0;return this.hV};this.setByParam=function(a){this.params=a};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object);
var ASN1HEX=new function(){};ASN1HEX.getLblen=function(a,b){if("8"!=a.substr(b+2,1))return 1;a=parseInt(a.substr(b+3,1));return 0==a?-1:0<a&&10>a?a+1:-2};ASN1HEX.getL=function(a,b){var c=ASN1HEX.getLblen(a,b);return 1>c?"":a.substr(b+2,2*c)};ASN1HEX.getVblen=function(a,b){a=ASN1HEX.getL(a,b);return""==a?-1:("8"===a.substr(0,1)?new BigInteger(a.substr(2),16):new BigInteger(a,16)).intValue()};ASN1HEX.getVidx=function(a,b){a=ASN1HEX.getLblen(a,b);return 0>a?a:b+2*(a+1)};
ASN1HEX.getV=function(a,b){var c=ASN1HEX.getVidx(a,b);b=ASN1HEX.getVblen(a,b);return a.substr(c,2*b)};ASN1HEX.getTLV=function(a,b){return a.substr(b,2)+ASN1HEX.getL(a,b)+ASN1HEX.getV(a,b)};ASN1HEX.getTLVblen=function(a,b){return 2+2*ASN1HEX.getLblen(a,b)+2*ASN1HEX.getVblen(a,b)};ASN1HEX.getNextSiblingIdx=function(a,b){var c=ASN1HEX.getVidx(a,b);a=ASN1HEX.getVblen(a,b);return c+2*a};
ASN1HEX.getChildIdx=function(a,b){var c=ASN1HEX,d=[];var f=c.getVidx(a,b);var k=2*c.getVblen(a,b);"03"==a.substr(b,2)&&(f+=2,k-=2);for(b=0;b<=k;){var l=c.getTLVblen(a,f);b+=l;b<=k&&d.push(f);f+=l;if(b>=k)break}return d};ASN1HEX.getNthChildIdx=function(a,b,c){return ASN1HEX.getChildIdx(a,b)[c]};ASN1HEX.getIdxbyList=function(a,b,c,d){var f=ASN1HEX;if(0==c.length)return void 0!==d&&a.substr(b,2)!==d?-1:b;var k=c.shift();b=f.getChildIdx(a,b);return k>=b.length?-1:f.getIdxbyList(a,b[k],c,d)};
ASN1HEX.getIdxbyListEx=function(a,b,c,d){var f=ASN1HEX;if(0==c.length)return void 0!==d&&a.substr(b,2)!==d?-1:b;var k=c.shift();b=f.getChildIdx(a,b);for(var l=0,m=0;m<b.length;m++){var e=a.substr(b[m],2);if("number"==typeof k&&!f.isContextTag(e)&&l==k||"string"==typeof k&&f.isContextTag(e,k))return f.getIdxbyListEx(a,b[m],c,d);f.isContextTag(e)||l++}return-1};ASN1HEX.getTLVbyList=function(a,b,c,d){var f=ASN1HEX;b=f.getIdxbyList(a,b,c,d);return-1==b||b>=a.length?null:f.getTLV(a,b)};
ASN1HEX.getTLVbyListEx=function(a,b,c,d){var f=ASN1HEX;b=f.getIdxbyListEx(a,b,c,d);return-1==b?null:f.getTLV(a,b)};ASN1HEX.getVbyList=function(a,b,c,d,f){var k=ASN1HEX;b=k.getIdxbyList(a,b,c,d);if(-1==b||b>=a.length)return null;a=k.getV(a,b);!0===f&&(a=a.substr(2));return a};ASN1HEX.getVbyListEx=function(a,b,c,d,f){var k=ASN1HEX;b=k.getIdxbyListEx(a,b,c,d);if(-1==b)return null;k=k.getV(a,b);"03"==a.substr(b,2)&&!1!==f&&(k=k.substr(2));return k};
ASN1HEX.getInt=function(a,b,c){void 0==c&&(c=-1);try{var d=a.substr(b,2);if("02"!=d&&"03"!=d)return c;var f=ASN1HEX.getV(a,b);return"02"==d?parseInt(f,16):bitstrtoint(f)}catch(k){return c}};ASN1HEX.getOID=function(a,b,c){void 0==c&&(c=null);try{if("06"!=a.substr(b,2))return c;var d=ASN1HEX.getV(a,b);return hextooid(d)}catch(f){return c}};ASN1HEX.getOIDName=function(a,b,c){void 0==c&&(c=null);try{var d=ASN1HEX.getOID(a,b,c);if(d==c)return c;var f=KJUR.asn1.x509.OID.oid2name(d);return""==f?d:f}catch(k){return c}};
ASN1HEX.getString=function(a,b,c){void 0==c&&(c=null);try{var d=ASN1HEX.getV(a,b);return hextorstr(d)}catch(f){return c}};
ASN1HEX.hextooidstr=function(a){var b=function(a,b){return a.length>=b?a:Array(b-a.length+1).join("0")+a},c=[],d=a.substr(0,2);d=parseInt(d,16);c[0]=new String(Math.floor(d/40));c[1]=new String(d%40);var f=a.substr(2);a=[];for(d=0;d<f.length/2;d++)a.push(parseInt(f.substr(2*d,2),16));f=[];var k="";for(d=0;d<a.length;d++)a[d]&128?k+=b((a[d]&127).toString(2),7):(k+=b((a[d]&127).toString(2),7),f.push(new String(parseInt(k,2))),k="");b=c.join(".");0<f.length&&(b=b+"."+f.join("."));return b};
ASN1HEX.dump=function(a,b,c,d){var f=ASN1HEX,k=f.getV,l=f.dump,m=f.getChildIdx,e=a;a instanceof KJUR.asn1.ASN1Object&&(e=a.tohex());a=function(a,b){return a.length<=2*b?a:a.substr(0,b)+"..(total "+a.length/2+"bytes).."+a.substr(a.length-b,b)};void 0===b&&(b={ommit_long_octet:32});void 0===c&&(c=0);void 0===d&&(d="");var h=b.ommit_long_octet,n=e.substr(c,2);if("01"==n)return e=k(e,c),"00"==e?d+"BOOLEAN FALSE\n":d+"BOOLEAN TRUE\n";if("02"==n)return e=k(e,c),d+"INTEGER "+a(e,h)+"\n";if("03"==n)return e=
k(e,c),f.isASN1HEX(e.substr(2))?a=d+"BITSTRING, encapsulates\n"+l(e.substr(2),b,0,d+"  "):d+"BITSTRING "+a(e,h)+"\n";if("04"==n)return e=k(e,c),f.isASN1HEX(e)?a=d+"OCTETSTRING, encapsulates\n"+l(e,b,0,d+"  "):d+"OCTETSTRING "+a(e,h)+"\n";if("05"==n)return d+"NULL\n";if("06"==n)return l=k(e,c),l=KJUR.asn1.ASN1Util.oidHexToInt(l),f=KJUR.asn1.x509.OID.oid2name(l),l=l.replace(/\./g," "),""!=f?d+"ObjectIdentifier "+f+" ("+l+")\n":d+"ObjectIdentifier ("+l+")\n";if("0a"==n)return d+"ENUMERATED "+parseInt(k(e,
c))+"\n";if("0c"==n)return d+"UTF8String '"+hextoutf8(k(e,c))+"'\n";if("13"==n)return d+"PrintableString '"+hextoutf8(k(e,c))+"'\n";if("14"==n)return d+"TeletexString '"+hextoutf8(k(e,c))+"'\n";if("16"==n)return d+"IA5String '"+hextoutf8(k(e,c))+"'\n";if("17"==n)return d+"UTCTime "+hextoutf8(k(e,c))+"\n";if("18"==n)return d+"GeneralizedTime "+hextoutf8(k(e,c))+"\n";if("1a"==n)return d+"VisualString '"+hextoutf8(k(e,c))+"'\n";if("1e"==n)return d+"BMPString '"+ucs2hextoutf8(k(e,c))+"'\n";if("30"==n){if("3000"==
e.substr(c,4))return d+"SEQUENCE {}\n";a=d+"SEQUENCE\n";c=m(e,c);m=b;2!=c.length&&3!=c.length||"06"!=e.substr(c[0],2)||"04"!=e.substr(c[c.length-1],2)||(f=f.oidname(k(e,c[0])),b=JSON.parse(JSON.stringify(b)),b.x509ExtName=f,m=b);for(f=0;f<c.length;f++)a+=l(e,m,c[f],d+"  ");return a}if("31"==n){a=d+"SET\n";c=m(e,c);for(f=0;f<c.length;f++)a+=l(e,b,c[f],d+"  ");return a}n=parseInt(n,16);if(0!=(n&128)){f=n&31;if(0!=(n&32)){a=d+"["+f+"]\n";c=m(e,c);for(f=0;f<c.length;f++)a+=l(e,b,c[f],d+"  ");return a}e=
k(e,c);if(ASN1HEX.isASN1HEX(e))return a=d+"["+f+"]\n"+l(e,b,0,d+"  ");"68747470"==e.substr(0,8)?e=hextoutf8(e):"subjectAltName"===b.x509ExtName&&2==f&&(e=hextoutf8(e));return d+"["+f+"] "+e+"\n"}return d+"UNKNOWN("+n+") "+k(e,c)+"\n"};
ASN1HEX.parse=function(a){var b=ASN1HEX,c=b.parse,d=b.isASN1HEX,f=b.getV,k=b.getTLV,l=b.getChildIdx;b=KJUR.asn1;var m=b.ASN1Util.oidHexToInt,e=b.x509.OID.oid2name,h=hextoutf8,n=ucs2hextoutf8,g=iso88591hextoutf8,p={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},q=a.substr(0,2);b={};f=f(a,0);if("01"==q)return"0101ff"==a?{bool:!0}:{bool:!1};if("02"==q)return{"int":{hex:f}};if("03"==q)try{if("00"!=f.substr(0,2))throw"not encap";
var r=f.substr(2);if(!d(r))throw"not encap";return{bitstr:{obj:c(r)}}}catch(v){return a=null,10>=f.length&&(a=bitstrtobinstr(f)),null==a?{bitstr:{hex:f}}:{bitstr:{bin:a}}}else if("04"==q)try{if(!d(f))throw"not encap";return{octstr:{obj:c(f)}}}catch(v){return{octstr:{hex:f}}}else{if("05"==q)return{"null":""};if("06"==q)return a=m(f),c=e(a),""==c?{oid:a}:{oid:c};if("0a"==q)return 4<f.length?{"enum":{hex:f}}:{"enum":parseInt(f,16)};if("30"==q||"31"==q){q=p[q];f=[];l=l(a,0);for(d=0;d<l.length;d++)r=k(a,
l[d]),r=c(r),f.push(r);b[q]=f;return b}if("14"==q)return a=g(f),b[p[q]]={str:a},b;if("1e"==q)return a=n(f),b[p[q]]={str:a},b;if(-1!=":0c:12:13:16:17:18:1a:".indexOf(q))return a=h(f),b[p[q]]={str:a},b;if(q.match(/^8[0-9]$/))return a=h(f),null==a|""==a?{tag:{tag:q,explicit:!1,hex:f}}:null!=a.match(/[\x00-\x1F\x7F-\x9F]/)||null!=a.match(/[\u0000-\u001F\u0080\u2013\u009F]/)?{tag:{tag:q,explicit:!1,hex:f}}:{tag:{tag:q,explicit:!1,str:a}};if(q.match(/^a[0-9]$/))try{if(!d(f))throw Error("not encap");return{tag:{tag:q,
explicit:!0,obj:c(f)}}}catch(v){return{tag:{tag:q,explicit:!0,hex:f}}}else return a=new KJUR.asn1.ASN1Object,a.hV=f,a=a.getLengthHexFromValue(),{asn1:{tlv:q+a+f}}}};ASN1HEX.isContextTag=function(a,b){a=a.toLowerCase();try{var c=parseInt(a,16)}catch(f){return-1}if(void 0===b)return 128==(c&192)?!0:!1;try{if(null==b.match(/^\[[0-9]+\]$/))return!1;var d=parseInt(b.substr(1,b.length-1),10);return 31<d?!1:128==(c&192)&&(c&31)==d?!0:!1}catch(f){return!1}};
ASN1HEX.isASN1HEX=function(a){var b=ASN1HEX;if(1==a.length%2)return!1;var c=b.getVblen(a,0),d=a.substr(0,2);b=b.getL(a,0);return a.length-d.length-b.length==2*c?!0:!1};
ASN1HEX.checkStrictDER=function(a,b,c,d,f){var k=ASN1HEX;if(void 0===c){if("string"!=typeof a)throw Error("not hex string");a=a.toLowerCase();if(!KJUR.lang.String.isHex(a))throw Error("not hex string");c=a.length;d=a.length/2;f=128>d?1:Math.ceil(d.toString(16))+1}if(k.getL(a,b).length>2*f)throw Error("L of TLV too long: idx="+b);var l=k.getVblen(a,b);if(l>d)throw Error("value of L too long than hex: idx="+b);var m=k.getTLV(a,b),e=m.length-2-k.getL(a,b).length;if(e!==2*l)throw Error("V string length and L's value not the same:"+
e+"/"+2*l);if(0===b&&a.length!=m.length)throw Error("total length and TLV length unmatch:"+a.length+"!="+m.length);l=a.substr(b,2);if("02"===l&&(m=k.getVidx(a,b),"00"==a.substr(m,2)&&56>a.charCodeAt(m+2)))throw Error("not least zeros for DER INTEGER");if(parseInt(l,16)&32){l=k.getVblen(a,b);m=0;b=k.getChildIdx(a,b);for(e=0;e<b.length;e++){var h=k.getTLV(a,b[e]);m+=h.length;k.checkStrictDER(a,b[e],c,d,f)}if(2*l!=m)throw Error("sum of children's TLV length and L unmatch: "+2*l+"!="+m);}};
ASN1HEX.oidname=function(a){var b=KJUR.asn1;KJUR.lang.String.isHex(a)&&(a=b.ASN1Util.oidHexToInt(a));b=b.x509.OID.oid2name(a);""===b&&(b=a);return b};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});"undefined"!=typeof KJUR.asn1.x509&&KJUR.asn1.x509||(KJUR.asn1.x509={});
KJUR.asn1.x509.Certificate=function(a){KJUR.asn1.x509.Certificate.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERBitString,d=b.DERSequence;b=b.x509;var f=b.TBSCertificate,k=b.AlgorithmIdentifier;this.params=void 0;this.setByParam=function(a){this.params=a};this.sign=function(){var a=this.params,b=a.sigalg;void 0!=a.sigalg.name&&(b=a.sigalg.name);var c=a.tbsobj.tohex();b=new KJUR.crypto.Signature({alg:b});b.init(a.cakey);b.updateHex(c);a.sighex=b.sign()};this.getPEM=function(){return hextopem(this.tohex(),
"CERTIFICATE")};this.tohex=function(){var a=this.params;if(void 0==a.tbsobj||null==a.tbsobj)a.tbsobj=new f(a);void 0==a.sighex&&void 0!=a.cakey&&this.sign();if(void 0==a.sighex)throw Error("sighex or cakey parameter not defined");var b=[];b.push(a.tbsobj);b.push(new k({name:a.sigalg}));b.push(new c({hex:"00"+a.sighex}));return(new d({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.Certificate,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.TBSCertificate=function(a){KJUR.asn1.x509.TBSCertificate.superclass.constructor.call(this);var b=KJUR.asn1,c=b.x509,d=b.DERTaggedObject,f=b.DERInteger,k=b.DERSequence,l=c.AlgorithmIdentifier,m=c.Time,e=c.X500Name,h=c.Extensions,n=c.SubjectPublicKeyInfo;this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=[],b=this.params;if(void 0!=b.version||1!=b.version){var c=2;void 0!=b.version&&(c=b.version-1);c=new d({obj:new f({"int":c})});a.push(c)}a.push(new f(b.serial));
a.push(new l({name:b.sigalg}));a.push(new e(b.issuer));a.push(new k({array:[new m(b.notbefore),new m(b.notafter)]}));a.push(new e(b.subject));a.push(new n(KEYUTIL.getKey(b.sbjpubkey)));void 0!==b.ext&&0<b.ext.length&&a.push(new d({tag:"a3",obj:new h(b.ext)}));return(new KJUR.asn1.DERSequence({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.TBSCertificate,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.Extensions=function(a){KJUR.asn1.x509.Extensions.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERSequence,d=b.x509;this.aParam=[];this.setByParam=function(a){this.aParam=a};this.tohex=function(){for(var a=[],b=0;b<this.aParam.length;b++){var l=this.aParam[b],m=l.extname;if(void 0!=l.extn)l=new d.PrivateExtension(l);else if("subjectKeyIdentifier"==m)l=new d.SubjectKeyIdentifier(l);else if("keyUsage"==m)l=new d.KeyUsage(l);else if("subjectAltName"==m)l=new d.SubjectAltName(l);
else if("issuerAltName"==m)l=new d.IssuerAltName(l);else if("basicConstraints"==m)l=new d.BasicConstraints(l);else if("nameConstraints"==m)l=new d.NameConstraints(l);else if("cRLDistributionPoints"==m)l=new d.CRLDistributionPoints(l);else if("certificatePolicies"==m)l=new d.CertificatePolicies(l);else if("policyMappings"==m)l=new d.PolicyMappings(l);else if("policyConstraints"==m)l=new d.PolicyConstraints(l);else if("inhibitAnyPolicy"==m)l=new d.InhibitAnyPolicy(l);else if("authorityKeyIdentifier"==
m)l=new d.AuthorityKeyIdentifier(l);else if("extKeyUsage"==m)l=new d.ExtKeyUsage(l);else if("authorityInfoAccess"==m)l=new d.AuthorityInfoAccess(l);else if("cRLNumber"==m)l=new d.CRLNumber(l);else if("cRLReason"==m)l=new d.CRLReason(l);else if("ocspNonce"==m)l=new d.OCSPNonce(l);else if("ocspNoCheck"==m)l=new d.OCSPNoCheck(l);else if("adobeTimeStamp"==m)l=new d.AdobeTimeStamp(l);else if("subjectDirectoryAttributes"==m)l=new d.SubjectDirectoryAttributes(l);else throw Error("extension not supported:"+
JSON.stringify(l));null!=l&&a.push(l)}return(new c({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.Extensions,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.Extension=function(a){KJUR.asn1.x509.Extension.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERObjectIdentifier,d=b.DEROctetString,f=b.DERBoolean,k=b.DERSequence;this.tohex=function(){var a=new c({oid:this.oid}),b=new d({hex:this.getExtnValueHex()}),e=[];e.push(a);this.critical&&e.push(new f);e.push(b);return(new k({array:e})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.critical=!1;void 0!==a&&void 0!==a.critical&&(this.critical=a.critical)};
extendClass(KJUR.asn1.x509.Extension,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.KeyUsage=function(a){KJUR.asn1.x509.KeyUsage.superclass.constructor.call(this,a);var b=Error,c={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var a=this.getBinValue();this.asn1ExtnValue=new KJUR.asn1.DERBitString({bin:a});return this.asn1ExtnValue.tohex()};this.getBinValue=function(){var a=this.params;if("object"!=typeof a||"object"!=typeof a.names&&"string"!=
typeof a.bin)throw new b("parameter not yet set");if(void 0!=a.names)return namearraytobinstr(a.names,c);if(void 0!=a.bin)return a.bin;throw new b("parameter not set properly");};this.oid="2.5.29.15";void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.KeyUsage,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.BasicConstraints=function(a){KJUR.asn1.x509.BasicConstraints.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERBoolean,d=b.DERInteger,f=b.DERSequence;this.getExtnValueHex=function(){var a=[];this.cA&&a.push(new c);-1<this.pathLen&&a.push(new d({"int":this.pathLen}));this.asn1ExtnValue=new f({array:a});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.19";this.cA=!1;this.pathLen=-1;void 0!==a&&(void 0!==a.cA&&(this.cA=a.cA),void 0!==a.pathLen&&(this.pathLen=a.pathLen))};
extendClass(KJUR.asn1.x509.BasicConstraints,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.CRLDistributionPoints=function(a){KJUR.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()};this.setByDPArray=function(a){for(var d=[],k=0;k<a.length;k++)if(a[k]instanceof KJUR.asn1.ASN1Object)d.push(a[k]);else{var l=new c.DistributionPoint(a[k]);d.push(l)}this.asn1ExtnValue=new b.DERSequence({array:d})};this.setByOneURI=function(a){a=new c.DistributionPoint({fulluri:a});this.setByDPArray([a])};
this.oid="2.5.29.31";void 0!==a&&(void 0!==a.array?this.setByDPArray(a.array):void 0!==a.uri&&this.setByOneURI(a.uri))};extendClass(KJUR.asn1.x509.CRLDistributionPoints,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.DistributionPoint=function(a){KJUR.asn1.x509.DistributionPoint.superclass.constructor.call(this);var b=KJUR.asn1,c=b.x509.DistributionPointName;this.tohex=function(){var a=new b.DERSequence;if(null!=this.asn1DP){var c=new b.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});a.appendASN1Object(c)}return this.hTLV=a.tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(void 0!==a.dpobj?this.asn1DP=a.dpobj:void 0!==a.dpname?this.asn1DP=new c(a.dpname):void 0!==
a.fulluri&&(this.asn1DP=new c({full:[{uri:a.fulluri}]})))};extendClass(KJUR.asn1.x509.DistributionPoint,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.DistributionPointName=function(a){KJUR.asn1.x509.DistributionPointName.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERTaggedObject;this.tohex=function(){if("full"!=this.type)throw Error("currently type shall be 'full': "+this.type);this.asn1Obj=new c({explicit:!1,tag:this.tag,obj:this.asn1V});return this.hTLV=this.asn1Obj.tohex()};this.getEncodedHex=function(){return this.tohex()};if(void 0!==a)if(b.x509.GeneralNames.prototype.isPrototypeOf(a))this.type="full",this.tag="a0",
this.asn1V=a;else if(void 0!==a.full)this.type="full",this.tag="a0",this.asn1V=new b.x509.GeneralNames(a.full);else throw Error("This class supports GeneralNames only as argument");};extendClass(KJUR.asn1.x509.DistributionPointName,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.CertificatePolicies=function(a){KJUR.asn1.x509.CertificatePolicies.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERSequence,d=b.x509.PolicyInformation;this.params=null;this.getExtnValueHex=function(){for(var a=[],b=0;b<this.params.array.length;b++)a.push(new d(this.params.array[b]));this.asn1ExtnValue=new c({array:a});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.32";void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.CertificatePolicies,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.PolicyInformation=function(a){KJUR.asn1.x509.PolicyInformation.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERSequence,d=b.DERObjectIdentifier,f=b.x509.PolicyQualifierInfo;this.params=null;this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw Error("parameter oid and array missing");var a=[new d(this.params.policyoid)];if(void 0!==this.params.array){for(var b=[],m=0;m<this.params.array.length;m++)b.push(new f(this.params.array[m]));0<
b.length&&a.push(new c({array:b}))}return(new c({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.PolicyInformation,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.PolicyQualifierInfo=function(a){KJUR.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERSequence,d=b.DERIA5String,f=b.DERObjectIdentifier,k=b.x509.UserNotice;this.params=null;this.tohex=function(){if(void 0!==this.params.cps){var a=new c({array:[new f({oid:"1.3.6.1.5.5.7.2.1"}),new d({str:this.params.cps})]});return a.tohex()}if(void 0!=this.params.unotice)return a=new c({array:[new f({oid:"1.3.6.1.5.5.7.2.2"}),new k(this.params.unotice)]}),a.tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.PolicyQualifierInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.UserNotice=function(a){KJUR.asn1.x509.UserNotice.superclass.constructor.call(this,a);var b=KJUR.asn1.DERSequence,c=KJUR.asn1.x509.DisplayText,d=KJUR.asn1.x509.NoticeReference;this.params=null;this.tohex=function(){var a=[];void 0!==this.params.noticeref&&a.push(new d(this.params.noticeref));void 0!==this.params.exptext&&a.push(new c(this.params.exptext));return(new b({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(this.params=a)};
extendClass(KJUR.asn1.x509.UserNotice,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.NoticeReference=function(a){KJUR.asn1.x509.NoticeReference.superclass.constructor.call(this,a);var b=KJUR.asn1.DERSequence,c=KJUR.asn1.DERInteger,d=KJUR.asn1.x509.DisplayText;this.params=null;this.tohex=function(){var a=[];void 0!==this.params.org&&a.push(new d(this.params.org));if(void 0!==this.params.noticenum){for(var k=[],l=this.params.noticenum,m=0;m<l.length;m++)k.push(new c(l[m]));a.push(new b({array:k}))}if(0==a.length)throw Error("parameter is empty");return(new b({array:a})).tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.NoticeReference,KJUR.asn1.ASN1Object);KJUR.asn1.x509.DisplayText=function(a){KJUR.asn1.x509.DisplayText.superclass.constructor.call(this,a);this.hT="0c";void 0!==a&&("ia5"===a.type?this.hT="16":"vis"===a.type?this.hT="1a":"bmp"===a.type&&(this.hT="1e"))};extendClass(KJUR.asn1.x509.DisplayText,KJUR.asn1.DERAbstractString);
KJUR.asn1.x509.PolicyMappings=function(a){KJUR.asn1.x509.PolicyMappings.superclass.constructor.call(this,a);var b=KJUR.asn1.ASN1Util.newObject;this.params=null;this.getExtnValueHex=function(){for(var a=this.params,d=[],f=0;f<a.array.length;f++){var k=a.array[f];d.push({seq:[{oid:k[0]},{oid:k[1]}]})}this.asn1ExtnValue=b({seq:d});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.33";void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.PolicyMappings,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.PolicyConstraints=function(a){KJUR.asn1.x509.PolicyConstraints.superclass.constructor.call(this,a);var b=KJUR.asn1.ASN1Util.newObject;this.params=null;this.getExtnValueHex=function(){var a=this.params,d=[];void 0!=a.reqexp&&d.push({tag:{tagi:"80",obj:{"int":a.reqexp}}});void 0!=a.inhibit&&d.push({tag:{tagi:"81",obj:{"int":a.inhibit}}});this.asn1ExtnValue=b({seq:d});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.36";void 0!==a&&(this.params=a)};
extendClass(KJUR.asn1.x509.PolicyConstraints,KJUR.asn1.x509.Extension);KJUR.asn1.x509.InhibitAnyPolicy=function(a){KJUR.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,a);var b=KJUR.asn1.ASN1Util.newObject;this.params=null;this.getExtnValueHex=function(){this.asn1ExtnValue=b({"int":this.params.skip});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.54";void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.InhibitAnyPolicy,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.NameConstraints=function(a){KJUR.asn1.x509.NameConstraints.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.ASN1Util.newObject,d=b.x509.GeneralSubtree;this.params=null;this.getExtnValueHex=function(){var a=this.params,b=[];if(void 0!=a.permit&&void 0!=a.permit.length){for(var l=[],m=0;m<a.permit.length;m++)l.push(new d(a.permit[m]));b.push({tag:{tagi:"a0",obj:{seq:l}}})}if(void 0!=a.exclude&&void 0!=a.exclude.length){l=[];for(m=0;m<a.exclude.length;m++)l.push(new d(a.exclude[m]));
b.push({tag:{tagi:"a1",obj:{seq:l}}})}this.asn1ExtnValue=c({seq:b});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.30";void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.x509.NameConstraints,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.GeneralSubtree=function(a){KJUR.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var b=KJUR.asn1,c=b.x509.GeneralName,d=b.ASN1Util.newObject;this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params,b=[new c(a)];void 0!=a.min&&b.push({tag:{tagi:"80",obj:{"int":a.min}}});void 0!=a.max&&b.push({tag:{tagi:"81",obj:{"int":a.max}}});return d({seq:b}).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.x509.GeneralSubtree,KJUR.asn1.ASN1Object);KJUR.asn1.x509.ExtKeyUsage=function(a){KJUR.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,a);var b=KJUR.asn1;this.setPurposeArray=function(a){this.asn1ExtnValue=new b.DERSequence;for(var c=0;c<a.length;c++){var f=new b.DERObjectIdentifier(a[c]);this.asn1ExtnValue.appendASN1Object(f)}};this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()};this.oid="2.5.29.37";void 0!==a&&void 0!==a.array&&this.setPurposeArray(a.array)};
extendClass(KJUR.asn1.x509.ExtKeyUsage,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.AuthorityKeyIdentifier=function(a){KJUR.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERTaggedObject,d=b.x509.GeneralNames;this.asn1CertSN=this.asn1CertIssuer=this.asn1KID=null;this.getExtnValueHex=function(){var a=[];this.asn1KID&&a.push(new c({explicit:!1,tag:"80",obj:this.asn1KID}));this.asn1CertIssuer&&a.push(new c({explicit:!1,tag:"a1",obj:new d([{dn:this.asn1CertIssuer}])}));this.asn1CertSN&&a.push(new c({explicit:!1,tag:"82",obj:this.asn1CertSN}));
this.asn1ExtnValue=new b.DERSequence({array:a});return this.asn1ExtnValue.tohex()};this.setKIDByParam=function(a){if(void 0!==a.str||void 0!==a.hex)this.asn1KID=new KJUR.asn1.DEROctetString(a);else if("object"===typeof a&&KJUR.crypto.Util.isKey(a)||"string"===typeof a&&-1!=a.indexOf("BEGIN ")){var b=a;"string"===typeof a&&(b=KEYUTIL.getKey(a));a=KEYUTIL.getKeyID(b);this.asn1KID=new KJUR.asn1.DEROctetString({hex:a})}};this.setCertIssuerByParam=function(a){void 0!==a.str||void 0!==a.ldapstr||void 0!==
a.hex||void 0!==a.certsubject||void 0!==a.certissuer?this.asn1CertIssuer=new KJUR.asn1.x509.X500Name(a):"string"===typeof a&&-1!=a.indexOf("BEGIN ")&&-1!=a.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new KJUR.asn1.x509.X500Name({certissuer:a}))};this.setCertSNByParam=function(a){if(void 0!==a.str||void 0!==a.bigint||void 0!==a.hex)this.asn1CertSN=new KJUR.asn1.DERInteger(a);else if("string"===typeof a&&-1!=a.indexOf("BEGIN ")&&a.indexOf("CERTIFICATE")){var b=new X509;b.readCertPEM(a);a=b.getSerialNumberHex();
this.asn1CertSN=new KJUR.asn1.DERInteger({hex:a})}};this.oid="2.5.29.35";void 0!==a&&(void 0!==a.kid&&this.setKIDByParam(a.kid),void 0!==a.issuer&&this.setCertIssuerByParam(a.issuer),void 0!==a.sn&&this.setCertSNByParam(a.sn),void 0!==a.issuersn&&"string"===typeof a.issuersn&&-1!=a.issuersn.indexOf("BEGIN ")&&a.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(a.issuersn),this.setCertIssuerByParam(a.issuersn)))};extendClass(KJUR.asn1.x509.AuthorityKeyIdentifier,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.SubjectKeyIdentifier=function(a){KJUR.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,a);var b=KJUR.asn1.DEROctetString;this.asn1KID=null;this.getExtnValueHex=function(){this.asn1ExtnValue=this.asn1KID;return this.asn1ExtnValue.tohex()};this.setKIDByParam=function(a){if(void 0!==a.str||void 0!==a.hex)this.asn1KID=new b(a);else if("object"===typeof a&&KJUR.crypto.Util.isKey(a)||"string"===typeof a&&-1!=a.indexOf("BEGIN")){var c=a;"string"===typeof a&&(c=KEYUTIL.getKey(a));
a=KEYUTIL.getKeyID(c);this.asn1KID=new KJUR.asn1.DEROctetString({hex:a})}};this.oid="2.5.29.14";void 0!==a&&void 0!==a.kid&&this.setKIDByParam(a.kid)};extendClass(KJUR.asn1.x509.SubjectKeyIdentifier,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.AuthorityInfoAccess=function(a){KJUR.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,a);this.setAccessDescriptionArray=function(a){var b=[],d=KJUR.asn1,f=d.DERSequence,k=d.DERObjectIdentifier;d=d.x509.GeneralName;for(var l=0;l<a.length;l++){var m=a[l];if(void 0!==m.ocsp)m=new f({array:[new k({oid:"1.3.6.1.5.5.7.48.1"}),new d({uri:m.ocsp})]});else if(void 0!==m.caissuer)m=new f({array:[new k({oid:"1.3.6.1.5.5.7.48.2"}),new d({uri:m.caissuer})]});else throw Error("unknown AccessMethod parameter: "+
JSON.stringify(m));b.push(m)}this.asn1ExtnValue=new f({array:b})};this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()};this.oid="1.3.6.1.5.5.7.1.1";void 0!==a&&void 0!==a.array&&this.setAccessDescriptionArray(a.array)};extendClass(KJUR.asn1.x509.AuthorityInfoAccess,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.SubjectAltName=function(a){KJUR.asn1.x509.SubjectAltName.superclass.constructor.call(this,a);this.setNameArray=function(a){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(a)};this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()};this.oid="2.5.29.17";void 0!==a&&void 0!==a.array&&this.setNameArray(a.array)};extendClass(KJUR.asn1.x509.SubjectAltName,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.IssuerAltName=function(a){KJUR.asn1.x509.IssuerAltName.superclass.constructor.call(this,a);this.setNameArray=function(a){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(a)};this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()};this.oid="2.5.29.18";void 0!==a&&void 0!==a.array&&this.setNameArray(a.array)};extendClass(KJUR.asn1.x509.IssuerAltName,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.SubjectDirectoryAttributes=function(a){KJUR.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERSequence,d=b.ASN1Util.newObject,f=b.x509.OID.name2oid;this.params=null;this.getExtnValueHex=function(){for(var a=[],b=0;b<this.params.array.length;b++){var m=this.params.array[b],e={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==m.attr)e.seq[0].oid=f(m.attr),e.seq[1].set[0]={gentime:m.str};else if("placeOfBirth"==m.attr)e.seq[0].oid=
f(m.attr),e.seq[1].set[0]={utf8str:m.str};else if("gender"==m.attr)e.seq[0].oid=f(m.attr),e.seq[1].set[0]={prnstr:m.str};else if("countryOfCitizenship"==m.attr)e.seq[0].oid=f(m.attr),e.seq[1].set[0]={prnstr:m.str};else if("countryOfResidence"==m.attr)e.seq[0].oid=f(m.attr),e.seq[1].set[0]={prnstr:m.str};else throw Error("unsupported attribute: "+m.attr);a.push(new d(e))}this.asn1ExtnValue=new c({array:a});return this.asn1ExtnValue.tohex()};this.oid="2.5.29.9";void 0!==a&&(this.params=a)};
extendClass(KJUR.asn1.x509.SubjectDirectoryAttributes,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.PrivateExtension=function(a){KJUR.asn1.x509.PrivateExtension.superclass.constructor.call(this,a);var b=KJUR,c=b.lang.String.isHex;b=b.asn1;var d=b.x509.OID.name2oid,f=b.ASN1Util.newObject;this.params=null;this.setByParam=function(a){this.oid=d(a.extname);this.params=a};this.getExtnValueHex=function(){if(void 0==this.params.extname||void 0==this.params.extn)throw Error("extname or extnhex not specified");var a=this.params.extn;if("string"==typeof a&&c(a))return a;if("object"==typeof a)try{return f(a).tohex()}catch(l){}throw Error("unsupported extn value");
};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.PrivateExtension,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.CRL=function(a){KJUR.asn1.x509.CRL.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERSequence,d=b.DERBitString;b=b.x509;var f=b.AlgorithmIdentifier,k=b.TBSCertList;this.params=void 0;this.setByParam=function(a){this.params=a};this.sign=function(){var a=(new k(this.params)).tohex(),b=new KJUR.crypto.Signature({alg:this.params.sigalg});b.init(this.params.cakey);b.updateHex(a);a=b.sign();this.params.sighex=a};this.getPEM=function(){return hextopem(this.tohex(),"X509 CRL")};this.tohex=
function(){var a=this.params;void 0==a.tbsobj&&(a.tbsobj=new k(a));void 0==a.sighex&&void 0!=a.cakey&&this.sign();if(void 0==a.sighex)throw Error("sighex or cakey parameter not defined");var b=[];b.push(a.tbsobj);b.push(new f({name:a.sigalg}));b.push(new d({hex:"00"+a.sighex}));return(new c({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.CRL,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.TBSCertList=function(a){KJUR.asn1.x509.TBSCertList.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERInteger,d=b.DERSequence,f=b.DERTaggedObject;b=b.x509;var k=b.AlgorithmIdentifier,l=b.Time,m=b.Extensions,e=b.X500Name;this.params=null;this.setByParam=function(a){this.params=a};this.getRevCertSequence=function(){for(var a=[],b=this.params.revcert,e=0;e<b.length;e++){var p=[new c(b[e].sn),new l(b[e].date)];void 0!=b[e].ext&&p.push(new m(b[e].ext));a.push(new d({array:p}))}return new d({array:a})};
this.tohex=function(){var a=[],b=this.params;if(void 0!=b.version){var g=new c({"int":b.version-1});a.push(g)}a.push(new k({name:b.sigalg}));a.push(new e(b.issuer));a.push(new l(b.thisupdate));void 0!=b.nextupdate&&a.push(new l(b.nextupdate));void 0!=b.revcert&&a.push(this.getRevCertSequence());void 0!=b.ext&&(b=new m(b.ext),a.push(new f({tag:"a0",explicit:!0,obj:b})));return(new d({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.x509.TBSCertList,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.CRLEntry=function(a){KJUR.asn1.x509.CRLEntry.superclass.constructor.call(this);var b=KJUR.asn1;this.setCertSerial=function(a){this.sn=new b.DERInteger(a)};this.setRevocationDate=function(a){this.time=new b.x509.Time(a)};this.tohex=function(){return this.TLV=(new b.DERSequence({array:[this.sn,this.time]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(void 0!==a.time&&this.setRevocationDate(a.time),void 0!==a.sn&&this.setCertSerial(a.sn))};
extendClass(KJUR.asn1.x509.CRLEntry,KJUR.asn1.ASN1Object);KJUR.asn1.x509.CRLNumber=function(a){KJUR.asn1.x509.CRLNumber.superclass.constructor.call(this,a);this.params=void 0;this.getExtnValueHex=function(){this.asn1ExtnValue=new KJUR.asn1.DERInteger(this.params.num);return this.asn1ExtnValue.tohex()};this.oid="2.5.29.20";void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.CRLNumber,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.CRLReason=function(a){KJUR.asn1.x509.CRLReason.superclass.constructor.call(this,a);this.params=void 0;this.getExtnValueHex=function(){this.asn1ExtnValue=new KJUR.asn1.DEREnumerated(this.params.code);return this.asn1ExtnValue.tohex()};this.oid="2.5.29.21";void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.CRLReason,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.OCSPNonce=function(a){KJUR.asn1.x509.OCSPNonce.superclass.constructor.call(this,a);this.params=void 0;this.getExtnValueHex=function(){this.asn1ExtnValue=new KJUR.asn1.DEROctetString(this.params);return this.asn1ExtnValue.tohex()};this.oid="1.3.6.1.5.5.7.48.1.2";void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.OCSPNonce,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.OCSPNoCheck=function(a){KJUR.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,a);this.params=void 0;this.getExtnValueHex=function(){this.asn1ExtnValue=new KJUR.asn1.DERNull;return this.asn1ExtnValue.tohex()};this.oid="1.3.6.1.5.5.7.48.1.5";void 0!=a&&(this.params=a)};extendClass(KJUR.asn1.x509.OCSPNoCheck,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.AdobeTimeStamp=function(a){KJUR.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,a);var b=KJUR.asn1,c=b.DERInteger,d=b.DERBoolean,f=b.DERSequence,k=b.x509.GeneralName;this.params=null;this.getExtnValueHex=function(){var a=this.params,b=[new c(1)];b.push(new k({uri:a.uri}));void 0!=a.reqauth&&b.push(new d(a.reqauth));this.asn1ExtnValue=new f({array:b});return this.asn1ExtnValue.tohex()};this.oid="1.2.840.113583.1.1.9.1";void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.x509.AdobeTimeStamp,KJUR.asn1.x509.Extension);
KJUR.asn1.x509.X500Name=function(a){KJUR.asn1.x509.X500Name.superclass.constructor.call(this);this.asn1Array=[];this.paramArray=[];this.sRule="utf8";var b=KJUR.asn1,c=b.x509,d=c.RDN;this.setByString=function(a,b){void 0!==b&&(this.sRule=b);a=a.split("/");a.shift();b=[];for(var c=0;c<a.length;c++)if(a[c].match(/^[^=]+=.+$/))b.push(a[c]);else{var m=b.length-1;b[m]=b[m]+"/"+a[c]}for(c=0;c<b.length;c++)this.asn1Array.push(new d({str:b[c],rule:this.sRule}))};this.setByLdapString=function(a,b){void 0!==
b&&(this.sRule=b);a=c.X500Name.ldapToCompat(a);this.setByString(a,b)};this.setByObject=function(a,b){void 0!==b&&(this.sRule=b);for(var c in a)a.hasOwnProperty(c)&&(b=new d({str:c+"="+a[c],rule:this.sRule}),this.asn1Array?this.asn1Array.push(b):this.asn1Array=[b])};this.setByParam=function(a){void 0!==a.rule&&(this.sRule=a.rule);if(void 0!==a.array)this.paramArray=a.array;else if(void 0!==a.str)this.setByString(a.str);else if(void 0!==a.ldapstr)this.setByLdapString(a.ldapstr);else if(void 0!==a.hex)this.hTLV=
a.hex;else if(void 0!==a.certissuer){var b=new X509;b.readCertPEM(a.certissuer);this.hTLV=b.getIssuerHex()}else void 0!==a.certsubject?(b=new X509,b.readCertPEM(a.certsubject),this.hTLV=b.getSubjectHex()):"object"===typeof a&&void 0===a.certsubject&&void 0===a.certissuer&&this.setByObject(a)};this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&0<this.paramArray.length)for(var a=0;a<this.paramArray.length;a++){var c={array:this.paramArray[a]};"utf8"!=this.sRule&&
(c.rule=this.sRule);c=new d(c);this.asn1Array.push(c)}return this.hTLV=(new b.DERSequence({array:this.asn1Array})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.X500Name,KJUR.asn1.ASN1Object);KJUR.asn1.x509.X500Name.compatToLDAP=function(a){if("/"!==a.substr(0,1))throw"malformed input";a=a.substr(1);a=a.split("/");a.reverse();a=a.map(function(a){return a.replace(/,/,"\\,")});return a.join(",")};
KJUR.asn1.x509.X500Name.onelineToLDAP=function(a){return KJUR.asn1.x509.X500Name.compatToLDAP(a)};KJUR.asn1.x509.X500Name.ldapToCompat=function(a){a=a.split(",");for(var b=!1,c=[],d=0;0<a.length;d++){var f=a.shift();!0===b?(b=(c.pop()+","+f).replace(/\\,/g,","),c.push(b),b=!1):c.push(f);"\\"===f.substr(-1,1)&&(b=!0)}c=c.map(function(a){return a.replace("/","\\/")});c.reverse();return"/"+c.join("/")};KJUR.asn1.x509.X500Name.ldapToOneline=function(a){return KJUR.asn1.x509.X500Name.ldapToCompat(a)};
KJUR.asn1.x509.RDN=function(a){KJUR.asn1.x509.RDN.superclass.constructor.call(this);this.asn1Array=[];this.paramArray=[];this.sRule="utf8";var b=KJUR.asn1.x509.AttributeTypeAndValue;this.setByParam=function(a){void 0!==a.rule&&(this.sRule=a.rule);void 0!==a.str&&this.addByMultiValuedString(a.str);void 0!==a.array&&(this.paramArray=a.array)};this.addByString=function(a){this.asn1Array.push(new KJUR.asn1.x509.AttributeTypeAndValue({str:a,rule:this.sRule}))};this.addByMultiValuedString=function(a){a=
KJUR.asn1.x509.RDN.parseString(a);for(var b=0;b<a.length;b++)this.addByString(a[b])};this.tohex=function(){if(0==this.asn1Array.length&&0<this.paramArray.length)for(var a=0;a<this.paramArray.length;a++){var d=this.paramArray[a];void 0!==d.rule&&"utf8"!=this.sRule&&(d.rule=this.sRule);d=new b(d);this.asn1Array.push(d)}return this.TLV=(new KJUR.asn1.DERSet({array:this.asn1Array})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.x509.RDN,KJUR.asn1.ASN1Object);KJUR.asn1.x509.RDN.parseString=function(a){var b=a.split(/\+/),c=!1;a=[];for(var d=0;0<b.length;d++){var f=b.shift();!0===c?(c=(a.pop()+"+"+f).replace(/\\\+/g,"+"),a.push(c),c=!1):a.push(f);"\\"===f.substr(-1,1)&&(c=!0)}c=!1;b=[];for(d=0;0<a.length;d++){f=a.shift();if(!0===c){var k=b.pop();f.match(/"$/)?(c=(k+"+"+f).replace(/^([^=]+)="(.*)"$/,"$1=$2"),b.push(c),c=!1):b.push(k+"+"+f)}else b.push(f);f.match(/^[^=]+="/)&&(c=!0)}return b};
KJUR.asn1.x509.AttributeTypeAndValue=function(a){KJUR.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this);this.sRule="utf8";this.dsType=this.sValue=this.sType=null;var b=KJUR,c=b.asn1,d=c.DERSequence,f=c.DERUTF8String,k=c.DERPrintableString,l=c.DERTeletexString,m=c.DERIA5String,e=c.DERVisibleString,h=c.DERBMPString,n=b.lang.String.isMail,g=b.lang.String.isPrintable;this.setByParam=function(a){void 0!==a.rule&&(this.sRule=a.rule);void 0!==a.ds&&(this.dsType=a.ds);if(void 0===a.value&&
void 0!==a.str)if(a=a.str.match(/^([^=]+)=(.+)$/))this.sType=a[1],this.sValue=a[2];else throw Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);else this.sType=a.type,this.sValue=a.value};this.setByString=function(a,b){void 0!==b&&(this.sRule=b);if(a=a.match(/^([^=]+)=(.+)$/))this.setByAttrTypeAndValueStr(a[1],a[2]);else throw Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);};this._getDsType=function(){var a=this.sType,b=this.sValue,c=this.sRule;if("prn"===c){if("CN"==a&&n(b))return"ia5";
if(g(b))return"prn"}else if("utf8"===c){if("CN"==a&&n(b))return"ia5";if("C"==a)return"prn"}return"utf8"};this.setByAttrTypeAndValueStr=function(a,b,c){void 0!==c&&(this.sRule=c);this.sType=a;this.sValue=b};this.getValueObj=function(a,b){if("utf8"==a)return new f({str:b});if("prn"==a)return new k({str:b});if("tel"==a)return new l({str:b});if("ia5"==a)return new m({str:b});if("vis"==a)return new e({str:b});if("bmp"==a)return new h({str:b});throw Error("unsupported directory string type: type="+a+" value="+
b);};this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var a=KJUR.asn1.x509.OID.atype2obj(this.sType),b=this.getValueObj(this.dsType,this.sValue);return this.TLV=(new d({array:[a,b]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.AttributeTypeAndValue,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.SubjectPublicKeyInfo=function(a){KJUR.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERInteger,d=b.DERBitString,f=b.DERObjectIdentifier,k=b.DERSequence,l=b.ASN1Util.newObject,m=b.x509.AlgorithmIdentifier;this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new k({array:[this.asn1AlgId,this.asn1SubjPKey]})};this.tohex=function(){return this.hTLV=this.getASN1Object().tohex()};
this.getEncodedHex=function(){return this.tohex()};this.setPubKey=function(a){try{if(a instanceof RSAKey){var b=l({seq:[{"int":{bigint:a.n}},{"int":{"int":a.e}}]}).tohex();this.asn1AlgId=new m({name:"rsaEncryption"});this.asn1SubjPKey=new d({hex:"00"+b})}}catch(p){}try{if(a instanceof KJUR.crypto.ECDSA){var e=new f({name:a.curveName});this.asn1AlgId=new m({name:"ecPublicKey",asn1params:e});this.asn1SubjPKey=new d({hex:"00"+a.pubKeyHex})}}catch(p){}try{if(a instanceof KJUR.crypto.DSA){e=new l({seq:[{"int":{bigint:a.p}},
{"int":{bigint:a.q}},{"int":{bigint:a.g}}]});this.asn1AlgId=new m({name:"dsa",asn1params:e});var g=new c({bigint:a.y});this.asn1SubjPKey=new d({hex:"00"+g.tohex()})}}catch(p){}};void 0!==a&&this.setPubKey(a)};extendClass(KJUR.asn1.x509.SubjectPublicKeyInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.Time=function(a){KJUR.asn1.x509.Time.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERUTCTime,d=b.DERGeneralizedTime;this.type=this.params=null;this.setTimeParams=function(a){this.timeParams=a};this.setByParam=function(a){this.params=a};this.getType=function(a){return a.match(/^[0-9]{12}Z$/)?"utc":a.match(/^[0-9]{14}Z$/)?"gen":a.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":a.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null};this.tohex=function(){var a=this.params,b=null;"string"==typeof a&&
(a={str:a});null==a||!a.str||null!=a.type&&void 0!=a.type||(a.type=this.getType(a.str));null!=a&&a.str?("utc"==a.type&&(b=new c(a.str)),"gen"==a.type&&(b=new d(a.str))):b="gen"==this.type?new d:new c;if(null==b)throw Error("wrong setting for Time");return this.TLV=b.tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};
KJUR.asn1.x509.Time_bak=function(a){KJUR.asn1.x509.Time_bak.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERUTCTime,d=b.DERGeneralizedTime;this.setTimeParams=function(a){this.timeParams=a};this.tohex=function(){return this.TLV=(null!=this.timeParams?"utc"==this.type?new c(this.timeParams):new d(this.timeParams):"utc"==this.type?new c:new d).tohex()};this.getEncodedHex=function(){return this.tohex()};this.type="utc";void 0!==a&&(void 0!==a.type?this.type=a.type:void 0!==a.str&&(a.str.match(/^[0-9]{12}Z$/)&&
(this.type="utc"),a.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=a)};extendClass(KJUR.asn1.x509.Time,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.AlgorithmIdentifier=function(a){KJUR.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this);this.asn1Params=this.asn1Alg=this.nameAlg=null;this.paramEmpty=!1;var b=KJUR.asn1,c=b.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw Error("algorithm not specified");if(null!==this.nameAlg){var a=null,f;for(f in c)f===this.nameAlg&&(a=c[f]);if(null!==a)return this.hTLV=a}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=
b.x509.OID.name2obj(this.nameAlg));a=[this.asn1Alg];null!==this.asn1Params&&a.push(this.asn1Params);return this.hTLV=(new b.DERSequence({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&(void 0!==a.name&&(this.nameAlg=a.name),void 0!==a.asn1params&&(this.asn1Params=a.asn1params),void 0!==a.paramempty&&(this.paramEmpty=a.paramempty));null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg&&(void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name),a=this.nameAlg.toLowerCase(),
"withdsa"!==a.substr(-7,7)&&"withecdsa"!==a.substr(-9,9)&&(this.asn1Params=new b.DERNull))};extendClass(KJUR.asn1.x509.AlgorithmIdentifier,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"};
KJUR.asn1.x509.GeneralName=function(a){KJUR.asn1.x509.GeneralName.superclass.constructor.call(this);var b=KJUR.asn1,c=b.x509,d=c.X500Name,f=c.OtherName,k=b.DERIA5String,l=b.DEROctetString,m=b.DERTaggedObject,e=b.ASN1Object,h=Error;this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params;var b=!1;if(void 0!==a.other){var c="a0";a=new f(a.other)}else if(void 0!==a.rfc822)c="81",a=new k({str:a.rfc822});else if(void 0!==a.dns)c="82",a=new k({str:a.dns});else if(void 0!==
a.dn)c="a4",b=!0,a="string"===typeof a.dn?new d({str:a.dn}):a.dn instanceof KJUR.asn1.x509.X500Name?a.dn:new d(a.dn);else if(void 0!==a.ldapdn)c="a4",b=!0,a=new d({ldapstr:a.ldapdn});else if(void 0!==a.certissuer||void 0!==a.certsubj){c="a4";b=!0;var q=null;if(void 0!==a.certsubj){var r=!1;a=a.certsubj}else r=!0,a=a.certissuer;a.match(/^[0-9A-Fa-f]+$/)&&q==a;-1!=a.indexOf("-----BEGIN ")&&(q=pemtohex(a));if(null==q)throw Error("certsubj/certissuer not cert");a=new X509;a.hex=q;r=r?a.getIssuerHex():
a.getSubjectHex();a=new e;a.hTLV=r}else if(void 0!==a.uri)c="86",a=new k({str:a.uri});else if(void 0!==a.ip){c="87";q=a.ip;try{if(q.match(/^[0-9a-f]+$/)){var v=q.length;if(8==v||16==v||32==v||64==v)r=q;else throw"err";}else r=iptohex(q)}catch(u){throw new h("malformed IP address: "+a.ip+":"+u.message);}a=new l({hex:r})}else throw new h("improper params");return(new m({tag:c,explicit:b,obj:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.x509.GeneralName,KJUR.asn1.ASN1Object);KJUR.asn1.x509.GeneralNames=function(a){KJUR.asn1.x509.GeneralNames.superclass.constructor.call(this);var b=KJUR.asn1;this.setByParamArray=function(a){for(var c=0;c<a.length;c++){var f=new b.x509.GeneralName(a[c]);this.asn1Array.push(f)}};this.tohex=function(){return(new b.DERSequence({array:this.asn1Array})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.asn1Array=[];"undefined"!=typeof a&&this.setByParamArray(a)};
extendClass(KJUR.asn1.x509.GeneralNames,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.OtherName=function(a){KJUR.asn1.x509.OtherName.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERObjectIdentifier,d=b.DERSequence,f=b.ASN1Util.newObject;this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params;if(void 0==a.oid||void 0==a.value)throw Error("oid or value not specified");var b=new c({oid:a.oid});a=f({tag:{tag:"a0",explicit:!0,obj:a.value}});return(new d({array:[b,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.x509.OtherName,KJUR.asn1.ASN1Object);
KJUR.asn1.x509.OID=new function(){var a=KJUR.asn1.DERObjectIdentifier;this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",
SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",
commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",
jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",
policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",
timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12",
"des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",
signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1"};this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",
STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"};this.objCache={};this.name2obj=
function(b){if("undefined"!=typeof this.objCache[b])return this.objCache[b];if("undefined"==typeof this.name2oidList[b])throw"Name of ObjectIdentifier not defined: "+b;var c=new a({oid:this.name2oidList[b]});return this.objCache[b]=c};this.atype2obj=function(b){if(void 0!==this.objCache[b])return this.objCache[b];if(b.match(/^\d+\.\d+\.[0-9.]+$/))var c=b;else if(void 0!==this.atype2oidList[b])c=this.atype2oidList[b];else if(void 0!==this.name2oidList[b])c=this.name2oidList[b];else throw Error("AttributeType name undefined: "+
b);c=new a({oid:c});return this.objCache[b]=c};this.registerOIDs=function(a){if(this.checkOIDs(a))for(var b in a)this.name2oidList[b]=a[b]};this.checkOIDs=function(a){try{var b=Object.keys(a);if(0==b.length)return!1;b.map(function(a,b,c){if(!this[a].match(/^[0-2]\.[0-9.]+$/))throw Error("value is not OID");},a);return!0}catch(d){return!1}}};KJUR.asn1.x509.OID.oid2name=function(a){var b=KJUR.asn1.x509.OID.name2oidList,c;for(c in b)if(b[c]==a)return c;return""};
KJUR.asn1.x509.OID.oid2atype=function(a){var b=KJUR.asn1.x509.OID.atype2oidList,c;for(c in b)if(b[c]==a)return c;return a};KJUR.asn1.x509.OID.name2oid=function(a){if(a.match(/^[0-9.]+$/))return a;var b=KJUR.asn1.x509.OID.name2oidList;return void 0===b[a]?"":b[a]};KJUR.asn1.x509.X509Util={};KJUR.asn1.x509.X509Util.newCertPEM=function(a){return(new KJUR.asn1.x509.Certificate(a)).getPEM()};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});
"undefined"!=typeof KJUR.asn1.cms&&KJUR.asn1.cms||(KJUR.asn1.cms={});KJUR.asn1.cms.Attribute=function(a){var b=Error;a=KJUR.asn1;var c=a.DERSequence,d=a.DERSet,f=a.DERObjectIdentifier;this.typeOid=this.params=null;this.setByParam=function(a){this.params=a};this.getValueArray=function(){throw new b("not yet implemented abstract");};this.tohex=function(){var a=new f({oid:this.typeOid}),b=new d({array:this.getValueArray()});return(new c({array:[a,b]})).tohex()};this.getEncodedHex=function(){return this.tohex()}};
extendClass(KJUR.asn1.cms.Attribute,KJUR.asn1.ASN1Object);KJUR.asn1.cms.ContentType=function(a){var b=KJUR.asn1;b.cms.ContentType.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.3";this.getValueArray=function(){return[new b.DERObjectIdentifier(this.params.type)]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.ContentType,KJUR.asn1.cms.Attribute);
KJUR.asn1.cms.MessageDigest=function(a){var b=KJUR.asn1,c=b.DEROctetString;b.cms.MessageDigest.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.4";this.getValueArray=function(){return[new c(this.params)]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.MessageDigest,KJUR.asn1.cms.Attribute);
KJUR.asn1.cms.SigningTime=function(a){var b=KJUR.asn1;b.cms.SigningTime.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.5";this.getValueArray=function(){return[new b.x509.Time(this.params)]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SigningTime,KJUR.asn1.cms.Attribute);
KJUR.asn1.cms.SigningCertificate=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence;c=c.cms;var f=c.ESSCertID;c.SigningCertificate.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.16.2.12";this.getValueArray=function(){if(null==this.params||void 0==this.params||void 0==this.params.array)throw new b("parameter 'array' not specified");for(var c=this.params.array,l=[],m=0;m<c.length;m++){var e=c[m];0!=a.hasis||"string"!=typeof e||-1==e.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(e)||
(e={cert:e});0!=e.hasis&&0==a.hasis&&(e.hasis=!1);l.push(new f(e))}c=new d({array:l});return[new d({array:[c]})]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SigningCertificate,KJUR.asn1.cms.Attribute);
KJUR.asn1.cms.ESSCertID=function(a){KJUR.asn1.cms.ESSCertID.superclass.constructor.call(this);var b=Error,c=KJUR,d=c.asn1,f=d.DEROctetString,k=d.DERSequence,l=d.cms.IssuerSerial;this.params=null;this.getCertHash=function(a,e){if(void 0!=a.hash)return a.hash;if("string"==typeof a&&-1==a.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(a))return a;if("string"==typeof a)var d=a;else if(void 0!=a.cert)d=a.cert;else throw new b("hash nor cert unspecified");d=-1!=d.indexOf("-----BEGIN")?pemtohex(d):d;"string"==
typeof a&&(-1!=a.indexOf("-----BEGIN")?d=pemtohex(a):ASN1HEX.isASN1HEX(a)&&(d=a));if(void 0!=a.alg)a=a.alg;else if(void 0!=e)a=e;else throw new b("hash alg unspecified");return c.crypto.Util.hashHex(d,a)};this.tohex=function(){var a=this.params,b=this.getCertHash(a,"sha1"),c=[];c.push(new f({hex:b}));("string"==typeof a&&-1!=a.indexOf("-----BEGIN")||void 0!=a.cert&&0!=a.hasis||void 0!=a.issuer&&void 0!=a.serial)&&c.push(new l(a));return(new k({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.ESSCertID,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.SigningCertificateV2=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence;c=c.cms;var f=c.ESSCertIDv2;c.SigningCertificateV2.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.16.2.47";this.getValueArray=function(){if(null==this.params||void 0==this.params||void 0==this.params.array)throw new b("parameter 'array' not specified");for(var c=this.params.array,l=[],m=0;m<c.length;m++){var e=c[m];void 0==a.alg&&0!=a.hasis||"string"!=typeof e||-1==e.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(e)||
(e={cert:e});void 0==e.alg&&void 0!=a.alg&&(e.alg=a.alg);0!=e.hasis&&0==a.hasis&&(e.hasis=!1);l.push(new f(e))}c=new d({array:l});return[new d({array:[c]})]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SigningCertificateV2,KJUR.asn1.cms.Attribute);
KJUR.asn1.cms.ESSCertIDv2=function(a){KJUR.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DEROctetString,d=b.DERSequence,f=b.cms.IssuerSerial,k=b.x509.AlgorithmIdentifier;this.params=null;this.tohex=function(){var a=this.params,b=this.getCertHash(a,"sha256"),e=[];void 0!=a.alg&&"sha256"!=a.alg&&e.push(new k({name:a.alg}));e.push(new c({hex:b}));("string"==typeof a&&-1!=a.indexOf("-----BEGIN")||void 0!=a.cert&&0!=a.hasis||void 0!=a.issuer&&void 0!=a.serial)&&e.push(new f(a));
return(new d({array:e})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.ESSCertIDv2,KJUR.asn1.cms.ESSCertID);
KJUR.asn1.cms.IssuerSerial=function(a){var b=Error,c=KJUR.asn1,d=c.DERInteger,f=c.DERSequence,k=c.x509.GeneralNames,l=X509;c.cms.IssuerSerial.superclass.constructor.call(this);this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params;if("string"==typeof a&&-1!=a.indexOf("-----BEGIN")||void 0!=a.cert){var c=void 0!=a.cert?a.cert:a;a=new l;a.readCertPEM(c);c=a.getIssuer();a={hex:a.getSerialNumberHex()}}else if(void 0!=a.issuer&&a.serial)c=a.issuer,a=a.serial;else throw new b("cert or issuer and serial parameter not specified");
c=new k([{dn:c}]);a=new d(a);return(new f({array:[c,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.IssuerSerial,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.SignerIdentifier=function(a){var b=KJUR.asn1.cms,c=b.IssuerAndSerialNumber,d=b.SubjectKeyIdentifier;b.SignerIdentifier.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if("isssn"==a.type)return(new c(a)).tohex();if("skid"==a.type)return(new d(a)).tohex();throw Error("wrong property for isssn or skid");};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SignerIdentifier,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.IssuerAndSerialNumber=function(a){var b=KJUR.asn1,c=b.DERInteger,d=b.DERSequence,f=b.x509.X500Name,k=X509,l=Error;b.cms.IssuerAndSerialNumber.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if("string"==typeof a&&-1!=a.indexOf("-----BEGIN")||void 0!=a.cert){var b=void 0!=a.cert?a.cert:a;a=new k;a.readCertPEM(b);b=a.getIssuer();a={hex:a.getSerialNumberHex()}}else if(void 0!=a.issuer&&a.serial)b=a.issuer,a=a.serial;else throw new l("cert or issuer and serial parameter not specified");
b=new f(b);a=new c(a);return(new d({array:[b,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.IssuerAndSerialNumber,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.SubjectKeyIdentifier=function(a){var b=KJUR.asn1,c=b.ASN1Util.newObject,d=X509,f=Error;b.cms.SubjectKeyIdentifier.superclass.constructor.call(this);this.tohex=function(){var a=this.params;if(void 0==a.cert&&void 0==a.skid)throw new f("property cert nor skid undefined");if(void 0!=a.cert)var b=(new d(a.cert)).getExtSubjectKeyIdentifier().kid.hex;else void 0!=a.skid&&(b=a.skid);return c({tag:{tage:"a0",obj:{octstr:{hex:b}}}}).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SubjectKeyIdentifier,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.AttributeList=function(a){var b=Error,c=KJUR.asn1,d=c.DERSet,f=c.cms;f.AttributeList.superclass.constructor.call(this);this.hTLV=this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params;if(null!=this.hTLV)return this.hTLV;var c=!0;void 0!=a.sortflag&&(c=a.sortflag);a=a.array;for(var m=[],e=0;e<a.length;e++){var h=a[e],n=h.attr;if("contentType"==n)m.push(new f.ContentType(h));else if("messageDigest"==n)m.push(new f.MessageDigest(h));else if("signingTime"==
n)m.push(new f.SigningTime(h));else if("signingCertificate"==n)m.push(new f.SigningCertificate(h));else if("signingCertificateV2"==n)m.push(new f.SigningCertificateV2(h));else if("signaturePolicyIdentifier"==n)m.push(new KJUR.asn1.cades.SignaturePolicyIdentifier(h));else if("signatureTimeStamp"==n||"timeStampToken"==n)m.push(new KJUR.asn1.cades.SignatureTimeStamp(h));else throw new b("unknown attr: "+n);}return this.hTLV=(new d({array:m,sortflag:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.AttributeList,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.SignerInfo=function(a){var b=Error,c=KJUR,d=c.asn1,f=d.DERInteger,k=d.DEROctetString,l=d.DERSequence,m=d.DERTaggedObject,e=d.cms,h=e.SignerIdentifier,n=e.AttributeList,g=d.x509.AlgorithmIdentifier,p=c.crypto,q=KEYUTIL;e.SignerInfo.superclass.constructor.call(this);this.params=null;this.sign=function(){var a=this.params,b=a.sigalg,c=(new n(a.sattrs)).tohex(),e=q.getKey(a.signkey);b=new p.Signature({alg:b});b.init(e);b.updateHex(c);c=b.sign();a.sighex=c};this.tohex=function(){var a=this.params,
c=[];c.push(new f({"int":a.version}));c.push(new h(a.id));c.push(new g({name:a.hashalg}));if(void 0!=a.sattrs){var e=new n(a.sattrs);try{c.push(new m({tag:"a0",explicit:!1,obj:e}))}catch(A){throw new b("si sattr error: "+A);}}void 0!=a.sigalgfield?c.push(new g({name:a.sigalgfield})):c.push(new g({name:a.sigalg}));void 0==a.sighex&&void 0!=a.signkey&&this.sign();c.push(new k({hex:a.sighex}));if(void 0!=a.uattrs){e=new n(a.uattrs);try{c.push(new m({tag:"a1",explicit:!1,obj:e}))}catch(A){throw new b("si uattr error: "+
A);}}return(new l({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SignerInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.EncapsulatedContentInfo=function(a){var b=KJUR.asn1,c=b.DERTaggedObject,d=b.DERSequence,f=b.DERObjectIdentifier,k=b.DEROctetString;b.cms.EncapsulatedContentInfo.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=[];b.push(new f(a.type));void 0==a.content||void 0==a.content.hex&&void 0==a.content.str||1==a.isDetached||(a=new k(a.content),a=new c({tag:"a0",explicit:!0,obj:a}),b.push(a));return(new d({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};
this.setByParam=function(a){this.params=a};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.EncapsulatedContentInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.ContentInfo=function(a){var b=KJUR.asn1,c=b.DERTaggedObject,d=b.DERSequence,f=b.DERObjectIdentifier;KJUR.asn1.cms.ContentInfo.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=[];b.push(new f(a.type));a=new c({tag:"a0",explicit:!0,obj:a.obj});b.push(a);return(new d({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!=a&&this.setByParam(a)};
extendClass(KJUR.asn1.cms.ContentInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.SignedData=function(a){var b=KJUR.asn1,c=b.DERInteger,d=b.DERSet,f=b.DERSequence,k=b.cms,l=k.EncapsulatedContentInfo,m=k.SignerInfo,e=k.ContentInfo,h=k.CertificateSet,n=k.RevocationInfoChoices,g=b.x509.AlgorithmIdentifier;KJUR.asn1.cms.SignedData.superclass.constructor.call(this);this.params=null;this.checkAndFixParam=function(){var a=this.params;this._setDigestAlgs(a);this._setContentTypeByEContent(a);this._setMessageDigestByEContent(a);this._setSignerInfoVersion(a);this._setSignedDataVersion(a)};
this._setDigestAlgs=function(a){for(var b={},c=a.sinfos,e=0;e<c.length;e++)b[c[e].hashalg]=1;a.hashalgs=Object.keys(b).sort()};this._setContentTypeByEContent=function(a){var b=a.econtent.type;a=a.sinfos;for(var c=0;c<a.length;c++)this._getAttrParamByName(a[c],"contentType").type=b};this._setMessageDigestByEContent=function(a){var b=a.econtent,c=b.content.hex;void 0==c&&"data"==b.type&&void 0!=b.content.str&&(c=rstrtohex(b.content.str));a=a.sinfos;for(b=0;b<a.length;b++){var e=a[b],d=e.hashalg;e=this._getAttrParamByName(e,
"messageDigest");d=KJUR.crypto.Util.hashHex(c,d);e.hex=d}};this._getAttrParamByName=function(a,b){a=a.sattrs.array;for(var c=0;c<a.length;c++)if(a[c].attr==b)return a[c]};this._setSignerInfoVersion=function(a){a=a.sinfos;for(var b=0;b<a.length;b++){var c=a[b],e=1;"skid"==c.id.type&&(e=3);c.version=e}};this._setSignedDataVersion=function(a){var b=this._getSignedDataVersion(a);a.version=b};this._getSignedDataVersion=function(a){if(void 0!=a.revinfos)for(var b=a.revinfos,c=0;c<b.length;c++)if(void 0!=
b[c].ocsp)return 5;b=a.sinfos;for(c=0;c<b.length;c++)if(3==a.sinfos[c].version)return 3;return"data"!=a.econtent.type?3:1};this.tohex=function(){var a=this.params;void 0!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare();1!=a.fixed&&this.checkAndFixParam();var b=[];b.push(new c({"int":a.version}));for(var e=[],k=0;k<a.hashalgs.length;k++)e.push(new g({name:a.hashalgs[k]}));b.push(new d({array:e}));b.push(new l(a.econtent));void 0!=a.certs&&b.push(new h(a.certs));void 0!=a.revinfos&&b.push(new n(a.revinfos));
e=[];for(k=0;k<a.sinfos.length;k++)e.push(new m(a.sinfos[k]));b.push(new d({array:e}));return(new f({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.getContentInfo=function(){return new e({type:"signed-data",obj:this})};this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.SignedData,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.CertificateSet=function(a){KJUR.asn1.cms.CertificateSet.superclass.constructor.call(this);var b=Error,c=KJUR.asn1,d=c.DERTaggedObject,f=c.DERSet,k=c.ASN1Object;this.params=null;this.tohex=function(){var a=this.params,c=[];if(a instanceof Array)var e=a;else if(void 0!=a.array)e=a.array;else throw new b("cert array not specified");for(var h=0;h<e.length;h++){var n=pemtohex(e[h]),g=new k;g.hTLV=n;c.push(g)}c={array:c};0==a.sortflag&&(c.sortflag=!1);a=new f(c);return(new d({tag:"a0",explicit:!1,
obj:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.CertificateSet,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.RevocationInfoChoices=function(a){KJUR.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if(!a instanceof Array)throw Error("params is not array");for(var c=[],d=0;d<a.length;d++)c.push(new KJUR.asn1.cms.RevocationInfoChoice(a[d]));return KJUR.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:c}}}).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};
extendClass(KJUR.asn1.cms.RevocationInfoChoices,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.RevocationInfoChoice=function(a){KJUR.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if(void 0!=a.crl&&"string"==typeof a.crl){var c=a.crl;-1!=a.crl.indexOf("-----BEGIN")&&(c=pemtohex(a.crl));return c}if(void 0!=a.ocsp)return KJUR.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new KJUR.asn1.cms.OtherRevocationFormat(a)}}).tohex();throw Error("property crl or ocsp undefined");};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.RevocationInfoChoice,KJUR.asn1.ASN1Object);
KJUR.asn1.cms.OtherRevocationFormat=function(a){KJUR.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var b=Error,c=KJUR,d=c.asn1.ASN1Util.newObject,f=c.lang.String.isHex;this.params=null;this.tohex=function(){var a=this.params;if(void 0==a.ocsp)throw new b("property ocsp not specified");if(!f(a.ocsp)||!ASN1HEX.isASN1HEX(a.ocsp))throw new b("ocsp value not ASN.1 hex string");return d({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:a.ocsp}}]}).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cms.OtherRevocationFormat,KJUR.asn1.ASN1Object);KJUR.asn1.cms.CMSUtil=new function(){};KJUR.asn1.cms.CMSUtil.newSignedData=function(a){return new KJUR.asn1.cms.SignedData(a)};
KJUR.asn1.cms.CMSUtil.verifySignedData=function(a){var b=KJUR,c=b.lang.String.isHex,d=ASN1HEX,f=d.getVbyList,k=d.getTLVbyList,l=d.getIdxbyList,m=d.getChildIdx,e=d.getTLV,h=d.oidname,n=b.crypto.Util.hashHex;void 0!==a.cms||c(a.cms);a=a.cms;b={isValid:!1,parse:{}};(function(a,b){if("2a864886f70d010702"!==f(a,0,[0],"06"))return b;b.cmsType="signedData";b.econtent=f(a,0,[1,0,2,1,0]);for(var c,e=3;6>e;e++)if(c=l(a,0,[1,0,e]),void 0!==c){var d=a.substr(c,2);"a0"===d&&(b.certsIdx=c);"a1"===d&&(b.revinfosIdx=
c);"31"===d&&(b.signerinfosIdx=c)}b.signerInfos=[];c=b.signerinfosIdx;if(void 0!==c)for(c=m(a,c),b.signerInfoIdxList=c,e=0;e<c.length;e++){d={idx:c[e]};var g=a,n=d,p=n.idx;n.signerid_issuer1=k(g,p,[1,0],"30");n.signerid_serial1=f(g,p,[1,1],"02");n.hashalg=h(f(g,p,[2,0],"06"));var B=l(g,p,[3],"a0");n.idxSignedAttrs=B;var I=g;B=m(I,B);n.signedAttrIdxList=B;for(var D=0;D<B.length;D++){var E=B[D],C=f(I,E,[0],"06");"2a864886f70d010905"===C?(E=hextoutf8(f(I,E,[1,0])),n.saSigningTime=E):"2a864886f70d010904"===
C&&(E=f(I,E,[1,0],"04"),n.saMessageDigest=E)}I=m(g,p).length;if(6>I)throw"malformed SignerInfo";n.sigalg=h(f(g,p,[I-2,0],"06"));n.sigval=f(g,p,[I-1],"04");b.signerInfos.push(d)}})(a,b.parse);(function(a,b){for(var c=b.parse.signerInfos,d=c.length,g=!0,h=0;h<d;h++){var f=c[h],p=a,k=b,l=f;l.verifyDetail={};var D=l.verifyDetail,E=k.parse.econtent,C=l.hashalg,G=l.saMessageDigest;D.validMessageDigest=!1;n(E,C)===G&&(D.validMessageDigest=!0);var L=p,K=k;C=l;G=K.parse.certsIdx;if(void 0===K.certs){E=[];
K.certkeys=[];var J=m(L,G);for(G=0;G<J.length;G++){var M=e(L,J[G]),w=new X509;w.readCertHex(M);E[G]=w;K.certkeys[G]=w.getPublicKey()}K.certs=E}else E=K.certs;K.cccc=E.length;K.cccci=J.length;for(G=0;G<E.length;G++)L=w.getIssuerHex(),K=w.getSerialNumberHex(),C.signerid_issuer1===L&&C.signerid_serial1===K&&(C.certkey_idx=G);D.validSignatureValue=!1;E=l.sigalg;p="31"+e(p,l.idxSignedAttrs).substr(2);l.signedattrshex=p;k=k.certs[l.certkey_idx].getPublicKey();E=new KJUR.crypto.Signature({alg:E});E.init(k);
E.updateHex(p);k=E.verify(l.sigval);D.validSignatureValue_isValid=k;!0===k&&(D.validSignatureValue=!0);l.isValid=!1;D.validMessageDigest&&D.validSignatureValue&&(l.isValid=!0);f.isValid||(g=!1)}b.isValid=g})(a,b);return b};
KJUR.asn1.cms.CMSParser=function(){var a=Error,b=X509,c=new b,d=ASN1HEX,f=d.getV,k=d.getTLV,l=d.getTLVbyList,m=d.getTLVbyListEx,e=d.getVbyList,h=d.getVbyListEx,n=d.getChildIdx;this.getCMSSignedData=function(a){a=l(a,0,[1,0]);return this.getSignedData(a)};this.getSignedData=function(a){var b=n(a,0),c={},e=f(a,b[0]);e=parseInt(e,16);c.version=e;e=k(a,b[1]);c.hashalgs=this.getHashAlgArray(e);b=k(a,b[2]);c.econtent=this.getEContent(b);b=m(a,0,["[0]"]);null!=b&&(c.certs=this.getCertificateSet(b));m(a,
0,["[1]"]);a=m(a,0,[3]);c.sinfos=this.getSignerInfos(a);return c};this.getHashAlgArray=function(a){for(var c=n(a,0),e=new b,d=[],g=0;g<c.length;g++){var h=k(a,c[g]);h=e.getAlgorithmIdentifierName(h);d.push(h)}return d};this.getEContent=function(a){var b={},c=e(a,0,[0]);a=e(a,0,[1,0]);b.type=KJUR.asn1.x509.OID.oid2name(ASN1HEX.hextooidstr(c));b.content={hex:a};return b};this.getSignerInfos=function(a){for(var b=[],c=n(a,0),e=0;e<c.length;e++){var d=k(a,c[e]);d=this.getSignerInfo(d);b.push(d)}return b};
this.getSignerInfo=function(a){var b={},e=n(a,0),g=d.getInt(a,e[0],-1);-1!=g&&(b.version=g);g=k(a,e[1]);g=this.getIssuerAndSerialNumber(g);b.id=g;e=k(a,e[2]);e=c.getAlgorithmIdentifierName(e);b.hashalg=e;e=m(a,0,["[0]"]);null!=e&&(e=this.getAttributeList(e),b.sattrs=e);e=m(a,0,[3]);e=c.getAlgorithmIdentifierName(e);b.sigalg=e;e=h(a,0,[4]);b.sighex=e;a=m(a,0,["[1]"]);null!=a&&(a=this.getAttributeList(a),b.uattrs=a);return b};this.getSignerIdentifier=function(a){if("30"==a.substr(0,2))return this.getIssuerAndSerialNumber(a);
throw Error("SKID of signerIdentifier not supported");};this.getIssuerAndSerialNumber=function(a){var b={type:"isssn"},e=n(a,0),d=k(a,e[0]);b.issuer=c.getX500Name(d);a=f(a,e[1]);b.serial={hex:a};return b};this.getAttributeList=function(a){for(var b=[],c=n(a,0),e=0;e<c.length;e++){var d=k(a,c[e]);d=this.getAttribute(d);b.push(d)}return{array:b}};this.getAttribute=function(a){var b={},c=n(a,0),e=d.getOID(a,c[0]);e=KJUR.asn1.x509.OID.oid2name(e);b.attr=e;a=k(a,c[1]);c=n(a,0);if(1==c.length)b.valhex=
k(a,c[0]);else{for(var g=[],h=0;h<c.length;h++)g.push(k(a,c[h]));b.valhex=g}"contentType"==e?this.setContentType(b):"messageDigest"==e?this.setMessageDigest(b):"signingTime"==e?this.setSigningTime(b):"signingCertificate"==e?this.setSigningCertificate(b):"signingCertificateV2"==e?this.setSigningCertificateV2(b):"signaturePolicyIdentifier"==e&&this.setSignaturePolicyIdentifier(b);return b};this.setContentType=function(a){var b=d.getOIDName(a.valhex,0,null);null!=b&&(a.type=b,delete a.valhex)};this.setSigningTime=
function(a){var b=f(a.valhex,0);b=hextoutf8(b);a.str=b;delete a.valhex};this.setMessageDigest=function(a){var b=f(a.valhex,0);a.hex=b;delete a.valhex};this.setSigningCertificate=function(a){var b=n(a.valhex,0);if(0<b.length){for(var c=k(a.valhex,b[0]),e=n(c,0),d=[],g=0;g<e.length;g++){var h=k(c,e[g]);h=this.getESSCertID(h);d.push(h)}a.array=d}1<b.length&&(b=k(a.valhex,b[1]),a.polhex=b);delete a.valhex};this.setSignaturePolicyIdentifier=function(a){var c=n(a.valhex,0);if(0<c.length){var e=d.getOID(a.valhex,
c[0]);a.oid=e}if(1<c.length){e=new b;c=n(a.valhex,c[1]);var g=k(a.valhex,c[0]);e=e.getAlgorithmIdentifierName(g);a.alg=e;e=f(a.valhex,c[1]);a.hash=e}delete a.valhex};this.setSigningCertificateV2=function(a){var b=n(a.valhex,0);if(0<b.length){for(var c=k(a.valhex,b[0]),e=n(c,0),d=[],g=0;g<e.length;g++){var h=k(c,e[g]);h=this.getESSCertIDv2(h);d.push(h)}a.array=d}1<b.length&&(b=k(a.valhex,b[1]),a.polhex=b);delete a.valhex};this.getESSCertID=function(a){var b={},c=n(a,0);if(0<c.length){var e=f(a,c[0]);
b.hash=e}1<c.length&&(a=k(a,c[1]),a=this.getIssuerSerial(a),void 0!=a.serial&&(b.serial=a.serial),void 0!=a.issuer&&(b.issuer=a.issuer));return b};this.getESSCertIDv2=function(b){var e={},d=n(b,0);if(1>d.length||3<d.length)throw new a("wrong number of elements");var g=0;if("30"==b.substr(d[0],2)){var h=k(b,d[0]);e.alg=c.getAlgorithmIdentifierName(h);g++}else e.alg="sha256";h=f(b,d[g]);e.hash=h;d.length>g+1&&(b=k(b,d[g+1]),b=this.getIssuerSerial(b),e.issuer=b.issuer,e.serial=b.serial);return e};this.getIssuerSerial=
function(a){var b={},e=n(a,0),d=k(a,e[0]);d=c.getGeneralNames(d)[0].dn;b.issuer=d;a=f(a,e[1]);b.serial={hex:a};return b};this.getCertificateSet=function(a){for(var b=n(a,0),c=[],e=0;e<b.length;e++){var d=k(a,b[e]);"30"==d.substr(0,2)&&(d=hextopem(d,"CERTIFICATE"),c.push(d))}return{array:c,sortflag:!1}}};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});"undefined"!=typeof KJUR.asn1.tsp&&KJUR.asn1.tsp||(KJUR.asn1.tsp={});
KJUR.asn1.tsp.TimeStampToken=function(a){var b=KJUR.asn1.tsp;b.TimeStampToken.superclass.constructor.call(this);this.params=null;this.getEncodedHexPrepare=function(){var a=new b.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=a.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.TimeStampToken,KJUR.asn1.cms.SignedData);
KJUR.asn1.tsp.TSTInfo=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.DERInteger,f=b.DERBoolean,k=b.DERGeneralizedTime,l=b.DERObjectIdentifier,m=b.DERTaggedObject,e=b.tsp,h=e.MessageImprint,n=e.Accuracy;b=b.x509.GeneralName;e.TSTInfo.superclass.constructor.call(this);this.dVersion=new d({"int":1});this.dTsa=this.dNonce=this.dOrdering=this.dAccuracy=this.dGenTime=this.dSerial=this.dMessageImprint=this.dPolicy=null;this.tohex=function(){var a=[this.dVersion];if(null==this.dPolicy)throw Error("policy shall be specified.");
a.push(this.dPolicy);if(null==this.dMessageImprint)throw Error("messageImprint shall be specified.");a.push(this.dMessageImprint);if(null==this.dSerial)throw Error("serialNumber shall be specified.");a.push(this.dSerial);if(null==this.dGenTime)throw Error("genTime shall be specified.");a.push(this.dGenTime);null!=this.dAccuracy&&a.push(this.dAccuracy);null!=this.dOrdering&&a.push(this.dOrdering);null!=this.dNonce&&a.push(this.dNonce);null!=this.dTsa&&a.push(this.dTsa);return this.hTLV=(new c({array:a})).tohex()};
this.getEncodedHex=function(){return this.tohex()};if(void 0!==a){if("string"==typeof a.policy){if(!a.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new l({oid:a.policy})}void 0!==a.messageImprint&&(this.dMessageImprint=new h(a.messageImprint));void 0!==a.serial&&(this.dSerial=new d(a.serial));void 0!==a.genTime&&(this.dGenTime=new k(a.genTime));void 0!==a.accuracy&&(this.dAccuracy=new n(a.accuracy));void 0!==a.ordering&&1==a.ordering&&(this.dOrdering=new f);void 0!==
a.nonce&&(this.dNonce=new d(a.nonce));void 0!==a.tsa&&(this.dTsa=new m({tag:"a0",explicit:!0,obj:new b({dn:a.tsa})}))}};extendClass(KJUR.asn1.tsp.TSTInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.Accuracy=function(a){var b=KJUR.asn1,c=b.ASN1Util.newObject;b.tsp.Accuracy.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=[];void 0!=a.seconds&&"number"==typeof a.seconds&&b.push({"int":a.seconds});void 0!=a.millis&&"number"==typeof a.millis&&b.push({tag:{tagi:"80",obj:{"int":a.millis}}});void 0!=a.micros&&"number"==typeof a.micros&&b.push({tag:{tagi:"81",obj:{"int":a.micros}}});return c({seq:b}).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.Accuracy,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.MessageImprint=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.DEROctetString,f=b.x509.AlgorithmIdentifier;b.tsp.MessageImprint.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=new f({name:a.alg});a=new d({hex:a.hash});return(new c({array:[b,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};
extendClass(KJUR.asn1.tsp.MessageImprint,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.TimeStampReq=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.DERInteger,f=b.DERBoolean,k=b.DERObjectIdentifier;b=b.tsp;var l=b.MessageImprint;b.TimeStampReq.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=[];b.push(new d({"int":1}));a.messageImprint instanceof KJUR.asn1.ASN1Object?b.push(a.messageImprint):b.push(new l(a.messageImprint));void 0!=a.policy&&b.push(new k(a.policy));void 0!=a.nonce&&b.push(new d(a.nonce));1==a.certreq&&b.push(new f);
return(new c({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.TimeStampReq,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.TimeStampResp=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.tsp,f=d.PKIStatusInfo;d.TimeStampResp.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,l=[];if(void 0!=a.econtent||void 0!=a.tst)if(void 0!=a.statusinfo?l.push(new f(a.statusinfo)):l.push(new f("granted")),void 0!=a.econtent)l.push((new d.TimeStampToken(a)).getContentInfo());else if(a.tst instanceof b.ASN1Object)l.push(a.tst);else throw Error("improper member tst value");else if(void 0!=
a.statusinfo)l.push(new f(a.statusinfo));else throw Error("parameter for token nor statusinfo not specified");return(new c({array:l})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.TimeStampResp,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.PKIStatusInfo=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence;c=c.tsp;var f=c.PKIStatus,k=c.PKIFreeText,l=c.PKIFailureInfo;c.PKIStatusInfo.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,c=[];if("string"==typeof a)c.push(new f(a));else{if(void 0==a.status)throw new b("property 'status' unspecified");c.push(new f(a.status));void 0!=a.statusstr&&c.push(new k(a.statusstr));void 0!=a.failinfo&&c.push(new l(a.failinfo))}return(new d({array:c})).tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.PKIStatusInfo,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.PKIStatus=function(a){var b=Error,c=KJUR.asn1,d=c.DERInteger;c.tsp.PKIStatus.superclass.constructor.call(this);var f={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null;this.tohex=function(){var a=this.params;if("string"==typeof a)try{var c=f[a]}catch(m){throw new b("undefined name: "+a);}else if("number"==typeof a)c=a;else throw new b("unsupported params");return(new d({"int":c})).tohex()};this.getEncodedHex=function(){return this.tohex()};
void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.PKIStatus,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.PKIFreeText=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence,f=c.DERUTF8String;c.tsp.PKIFreeText.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if(!a instanceof Array)throw new b("wrong params: not array");for(var c=[],m=0;m<a.length;m++)c.push(new f({str:a[m]}));return(new d({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.PKIFreeText,KJUR.asn1.ASN1Object);
KJUR.asn1.tsp.PKIFailureInfo=function(a){var b=Error,c=KJUR.asn1,d=c.DERBitString,f={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};c.tsp.PKIFailureInfo.superclass.constructor.call(this);this.params=null;this.getBinValue=function(){var a=this.params;if("number"==typeof a&&0<=a&&25>=a){a=(0|1<<a).toString(2);for(var c="",d=a.length-1;0<=d;d--)c+=a[d];return c}if("string"==typeof a&&void 0!=f[a])return namearraytobinstr([a],
f);if("object"==typeof a&&void 0!=a.length)return namearraytobinstr(a,f);throw new b("wrong params");};this.tohex=function(){var a=this.getBinValue();return(new d({bin:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.tsp.PKIFailureInfo,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.AbstractTSAAdapter=function(a){this.getTSTHex=function(a,c){throw"not implemented yet";}};
KJUR.asn1.tsp.SimpleTSAAdapter=function(a){var b=KJUR,c=b.asn1.tsp,d=b.crypto.Util.hashHex;c.SimpleTSAAdapter.superclass.constructor.call(this);this.params=null;this.serial=0;this.getTSTHex=function(a,b){a=d(a,b);this.params.econtent.content.messageImprint={alg:b,hash:a};this.params.econtent.content.serial={"int":this.serial++};this.params.econtent.content.nonce={"int":Math.floor(1E9*Math.random())};return(new c.TimeStampToken(this.params)).getContentInfoEncodedHex()};void 0!==a&&(this.params=a)};
extendClass(KJUR.asn1.tsp.SimpleTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter);KJUR.asn1.tsp.FixedTSAAdapter=function(a){var b=KJUR,c=b.asn1.tsp,d=b.crypto.Util.hashHex;c.FixedTSAAdapter.superclass.constructor.call(this);this.params=null;this.getTSTHex=function(a,b){a=d(a,b);this.params.econtent.content.messageImprint={alg:b,hash:a};return(new c.TimeStampToken(this.params)).getContentInfoEncodedHex()};void 0!==a&&(this.params=a)};extendClass(KJUR.asn1.tsp.FixedTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter);
KJUR.asn1.tsp.TSPUtil=new function(){};KJUR.asn1.tsp.TSPUtil.newTimeStampToken=function(a){return new KJUR.asn1.tsp.TimeStampToken(a)};KJUR.asn1.tsp.TSPUtil.parseTimeStampReq=function(a){return(new KJUR.asn1.tsp.TSPParser).getTimeStampReq(a)};KJUR.asn1.tsp.TSPUtil.parseMessageImprint=function(a){return(new KJUR.asn1.tsp.TSPParser).getMessageImprint(a)};
KJUR.asn1.tsp.TSPParser=function(){var a=new X509,b=ASN1HEX,c=b.getV,d=b.getTLV,f=b.getIdxbyList,k=b.getChildIdx,l="granted grantedWithMods rejection waiting revocationWarning revocationNotification".split(" "),m={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(a){var b=k(a,0);if(1==b.length)return this.getPKIStatusInfo(d(a,b[0]));if(1<b.length){var c=this.getPKIStatusInfo(d(a,
b[0]));a=d(a,b[1]);a=this.getToken(a);a.statusinfo=c;return a}};this.getToken=function(a){a=(new KJUR.asn1.cms.CMSParser).getCMSSignedData(a);this.setTSTInfo(a);return a};this.setTSTInfo=function(a){a=a.econtent;if("tstinfo"==a.type){var b=this.getTSTInfo(a.content.hex);a.content=b}};this.getTSTInfo=function(b){var e={},n=k(b,0),g=c(b,n[1]);e.policy=hextooid(g);g=d(b,n[2]);e.messageImprint=this.getMessageImprint(g);g=c(b,n[3]);e.serial={hex:g};g=c(b,n[4]);e.genTime={str:hextoutf8(g)};g=0;if(5<n.length&&
"30"==b.substr(n[5],2)){var m=d(b,n[5]);e.accuracy=this.getAccuracy(m);g++}n.length>5+g&&"01"==b.substr(n[5+g],2)&&("ff"==c(b,n[5+g])&&(e.ordering=!0),g++);n.length>5+g&&"02"==b.substr(n[5+g],2)&&(m=c(b,n[5+g]),e.nonce={hex:m},g++);n.length>5+g&&"a0"==b.substr(n[5+g],2)&&(m=d(b,n[5+g]),m="30"+m.substr(2),pGeneralNames=a.getGeneralNames(m),e.tsa=pGeneralNames[0].dn,g++);n.length>5+g&&"a1"==b.substr(n[5+g],2)&&(b=d(b,n[5+g]),b="30"+b.substr(2),b=a.getExtParamArray(b),e.ext=b);return e};this.getAccuracy=
function(a){for(var b={},e=k(a,0),d=0;d<e.length;d++){var m=a.substr(e[d],2),f=c(a,e[d]);f=parseInt(f,16);"02"==m?b.seconds=f:"80"==m?b.millis=f:"81"==m&&(b.micros=f)}return b};this.getMessageImprint=function(a){if("30"!=a.substr(0,2))throw Error("head of messageImprint hex shall be x30");var e={};k(a,0);var d=f(a,0,[0,0]);d=c(a,d);var g=b.hextooidstr(d);d=KJUR.asn1.x509.OID.oid2name(g);if(""==d)throw Error("hashAlg name undefined: "+g);g=f(a,0,[1]);e.alg=d;e.hash=c(a,g);return e};this.getPKIStatusInfo=
function(a){var b={},e=k(a,0),g=0;try{var m=c(a,e[0]),f=parseInt(m,16);b.status=l[f]}catch(r){}1<e.length&&"30"==a.substr(e[1],2)&&(m=d(a,e[1]),b.statusstr=this.getPKIFreeText(m),g++);e.length>g&&"03"==a.substr(e[1+g],2)&&(a=d(a,e[1+g]),b.failinfo=this.getPKIFailureInfo(a));return b};this.getPKIFreeText=function(a){for(var c=[],e=k(a,0),d=0;d<e.length;d++)c.push(b.getString(a,e[d]));return c};this.getPKIFailureInfo=function(a){a=b.getInt(a,0);return void 0!=m[a]?m[a]:a};this.getTimeStampReq=function(a){var e=
{certreq:!1},m=k(a,0);if(2>m.length)throw Error("TimeStampReq must have at least 2 items");var g=d(a,m[1]);e.messageImprint=KJUR.asn1.tsp.TSPUtil.parseMessageImprint(g);for(g=2;g<m.length;g++){var f=m[g],l=a.substr(f,2);if("06"==l){var r=c(a,f);e.policy=b.hextooidstr(r)}"02"==l&&(e.nonce=c(a,f));"01"==l&&(e.certreq=!0)}return e}};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});
"undefined"!=typeof KJUR.asn1.cades&&KJUR.asn1.cades||(KJUR.asn1.cades={});KJUR.asn1.cades.SignaturePolicyIdentifier=function(a){var b=KJUR.asn1.cades,c=b.SignaturePolicyId;b.SignaturePolicyIdentifier.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.16.2.15";this.params=null;this.getValueArray=function(){return[new c(this.params)]};this.setByParam=function(a){this.params=a};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.SignaturePolicyIdentifier,KJUR.asn1.cms.Attribute);
KJUR.asn1.cades.SignaturePolicyId=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.DERObjectIdentifier;b=b.cades;var f=b.OtherHashAlgAndValue;b.SignaturePolicyId.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,b=[];b.push(new d(a.oid));b.push(new f(a));return(new c({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.SignaturePolicyId,KJUR.asn1.ASN1Object);
KJUR.asn1.cades.OtherHashAlgAndValue=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence,f=c.DEROctetString,k=c.x509.AlgorithmIdentifier;c.cades.OtherHashAlgAndValue.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if(void 0==a.alg)throw new b("property 'alg' not specified");if(void 0==a.hash&&void 0==a.cert)throw new b("property 'hash' nor 'cert' not specified");var c=null;if(void 0!=a.hash)c=a.hash;else if(void 0!=a.cert){if("string"!=typeof a.cert)throw new b("cert not string");
c=a.cert;-1!=a.cert.indexOf("-----BEGIN")&&(c=pemtohex(a.cert));c=KJUR.crypto.Util.hashHex(c,a.alg)}var e=[];e.push(new k({name:a.alg}));e.push(new f({hex:c}));return(new d({array:e})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.OtherHashAlgAndValue,KJUR.asn1.ASN1Object);
KJUR.asn1.cades.OtherHashValue=function(a){KJUR.asn1.cades.OtherHashValue.superclass.constructor.call(this);var b=Error,c=KJUR.asn1.DEROctetString;this.params=null;this.tohex=function(){var a=this.params;if(void 0==a.hash&&void 0==a.cert)throw new b("hash or cert not specified");var f=null;if(void 0!=a.hash)f=a.hash;else if(void 0!=a.cert){if("string"!=typeof a.cert)throw new b("cert not string");f=a.cert;-1!=a.cert.indexOf("-----BEGIN")&&(f=pemtohex(a.cert));f=KJUR.crypto.Util.hashHex(f,"sha1")}return(new c({hex:f})).tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.OtherHashValue,KJUR.asn1.ASN1Object);
KJUR.asn1.cades.SignatureTimeStamp=function(a){var b=Error,c=KJUR,d=c.lang.String.isHex;c=c.asn1;var f=c.ASN1Object;c.cades.SignatureTimeStamp.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.16.2.14";this.params=null;this.getValueArray=function(){var a=this.params;if(void 0!=a.tst){if(d(a.tst)){var c=new f;c.hTLV=a.tst;return[c]}if(a.tst instanceof f)return[a.tst];throw new b("params.tst has wrong value");}if(void 0!=a.res){c=a.res;c instanceof f&&(c=c.tohex());if("string"!=typeof c||
!d(c))throw new b("params.res has wrong value");ASN1HEX.getTLVbyList(c,0,[1]);c=new f;c.hTLV=a.tst;return[c]}};null!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.SignatureTimeStamp,KJUR.asn1.cms.Attribute);
KJUR.asn1.cades.CompleteCertificateRefs=function(a){var b=Error,c=KJUR,d=c.asn1,f=d.DERSequence;d=d.cades;var k=d.OtherCertID,l=c.lang.String.isHex;d.CompleteCertificateRefs.superclass.constructor.call(this);this.typeOid="1.2.840.113549.1.9.16.2.21";this.params=null;this.getValueArray=function(){for(var a=this.params,c=[],d=0;d<a.array.length;d++){var n=a.array[d];if("string"==typeof n)if(-1!=n.indexOf("-----BEGIN"))n={cert:n};else if(l(n))n={hash:n};else throw new b("unsupported value: "+n);void 0!=
a.alg&&void 0==n.alg&&(n.alg=a.alg);void 0!=a.hasis&&void 0==n.hasis&&(n.hasis=a.hasis);n=new k(n);c.push(n)}return[new f({array:c})]};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.CompleteCertificateRefs,KJUR.asn1.cms.Attribute);
KJUR.asn1.cades.OtherCertID=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.cms.IssuerSerial;b=b.cades;var f=b.OtherHashValue,k=b.OtherHashAlgAndValue;b.OtherCertID.superclass.constructor.call(this);this.params=a;this.tohex=function(){var a=this.params;"string"==typeof a&&(-1!=a.indexOf("-----BEGIN")?a={cert:a}:_isHex(a)&&(a={hash:a}));var b=[];var e=void 0!=a.alg?new k(a):new f(a);b.push(e);if(void 0!=a.cert&&1==a.hasis||void 0!=a.issuer&&void 0!=a.serial)a=new d(a),b.push(a);return(new c({array:b})).tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.OtherCertID,KJUR.asn1.ASN1Object);
KJUR.asn1.cades.OtherHash=function(a){var b=KJUR,c=b.asn1.cades,d=c.OtherHashAlgAndValue,f=c.OtherHashValue,k=b.lang.String.isHex;c.OtherHash.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;"string"==typeof a&&(-1!=a.indexOf("-----BEGIN")?a={cert:a}:k(a)&&(a={hash:a}));return(void 0!=a.alg?new d(a):new f(a)).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.cades.OtherHash,KJUR.asn1.ASN1Object);
KJUR.asn1.cades.CAdESUtil=new function(){};KJUR.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(a){return(new KJUR.asn1.cms.CMSParser).getCMSSignedData(a)};
KJUR.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(a,b,c){var d=ASN1HEX,f=d.getChildIdx;c=d.getTLV;var k=d.getV,l=KJUR.asn1;d=l.ASN1Object;var m=l.cms;l=m.AttributeList;var e=m.SignerInfo;m={};b=f(a,b);if(6!=b.length)throw"not supported items for SignerInfo (!=6)";f=b.shift();m.version=c(a,f);f=b.shift();m.si=c(a,f);f=b.shift();m.digalg=c(a,f);f=b.shift();m.sattrs=c(a,f);f=b.shift();m.sigalg=c(a,f);b=b.shift();m.sig=c(a,b);m.sigval=k(a,b);m.obj=new e;a=new d;a.hTLV=m.version;m.obj.dCMSVersion=
a;a=new d;a.hTLV=m.si;m.obj.dSignerIdentifier=a;a=new d;a.hTLV=m.digalg;m.obj.dDigestAlgorithm=a;a=new d;a.hTLV=m.sattrs;m.obj.dSignedAttrs=a;a=new d;a.hTLV=m.sigalg;m.obj.dSigAlg=a;a=new d;a.hTLV=m.sig;m.obj.dSig=a;m.obj.dUnsignedAttrs=new l;return m};"undefined"!=typeof KJUR.asn1.csr&&KJUR.asn1.csr||(KJUR.asn1.csr={});
KJUR.asn1.csr.CertificationRequest=function(a){var b=KJUR.asn1,c=b.DERBitString,d=b.DERSequence;b=b.csr;var f=b.CertificationRequestInfo;b.CertificationRequest.superclass.constructor.call(this);this.setByParam=function(a){this.params=a};this.sign=function(){var a=(new f(this.params)).tohex(),b=new KJUR.crypto.Signature({alg:this.params.sigalg});b.init(this.params.sbjprvkey);b.updateHex(a);a=b.sign();this.params.sighex=a};this.getPEM=function(){return hextopem(this.tohex(),"CERTIFICATE REQUEST")};
this.tohex=function(){var a=this.params,b=new KJUR.asn1.csr.CertificationRequestInfo(this.params),m=new KJUR.asn1.x509.AlgorithmIdentifier({name:a.sigalg});void 0==a.sighex&&void 0!=a.sbjprvkey&&this.sign();if(void 0==a.sighex)throw Error("sighex or sbjprvkey parameter not defined");a=new c({hex:"00"+a.sighex});return(new d({array:[b,m,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.csr.CertificationRequest,KJUR.asn1.ASN1Object);
KJUR.asn1.csr.CertificationRequestInfo=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.DERInteger,f=b.DERUTF8String,k=b.DERTaggedObject,l=b.ASN1Util.newObject,m=b.x509,e=m.X500Name,h=m.Extensions,n=m.SubjectPublicKeyInfo;b.csr.CertificationRequestInfo.superclass.constructor.call(this);this.params=null;this.setByParam=function(a){void 0!=a&&(this.params=a)};this.tohex=function(){var a=this.params,b=[];b.push(new d({"int":0}));b.push(new e(a.subject));b.push(new n(KEYUTIL.getKey(a.sbjpubkey)));if(void 0!=
a.attrs){a=a.attrs;for(var m=Error,r=KJUR.asn1.x509.Extensions,v=[],u=0;u<a.length;u++){var A=a[u],x=A.attr;if("extensionRequest"==x)A={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[new r(A.ext)]}]},v.push(A);else if("unstructuredName"==x)A={seq:[{oid:"1.2.840.113549.1.9.2"},{set:A.names}]},v.push(A);else if("challengePassword"==x)A={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:A.password}]}]},v.push(A);else throw new m("unknown CSR attribute");}a=l({tag:{tage:"a0",obj:{set:v}}});b.push(a)}else void 0!=
a.extreq?(a=new h(a.extreq),a=l({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[a]}]}}}),b.push(a)):b.push(new k({tag:"a0",explicit:!1,obj:new f({str:""})}));return(new c({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!=a&&this.setByParam(a)};extendClass(KJUR.asn1.csr.CertificationRequestInfo,KJUR.asn1.ASN1Object);KJUR.asn1.csr.AttributeList=function(a){};extendClass(KJUR.asn1.csr.AttributeList,KJUR.asn1.ASN1Object);KJUR.asn1.csr.CSRUtil=new function(){};
KJUR.asn1.csr.CSRUtil.newCSRPEM=function(a){return(new KJUR.asn1.csr.CertificationRequest(a)).getPEM()};
KJUR.asn1.csr.CSRUtil.getParam=function(a,b){var c=ASN1HEX,d=c.getV,f=c.getIdxbyList,k=c.getTLVbyList,l=c.getTLVbyListEx;c=c.getVbyListEx;var m={};if(-1==a.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw Error("argument is not PEM file");a=pemtohex(a,"CERTIFICATE REQUEST");b&&(m.tbs=k(a,0,[0]));try{var e=l(a,0,[0,1]);if("3000"==e)m.subject={};else{var h=new X509;m.subject=h.getX500Name(e)}}catch(p){}h=l(a,0,[0,2]);h=KEYUTIL.getKey(h,null,"pkcs8pub");m.sbjpubkey=KEYUTIL.getPEM(h,"PKCS8PUB");f=f(a,
0,[0,3,0,0],"06");d="2a864886f70d01090e"!=d(a,f)?null:k(a,0,[0,3,0,1,0],"30");h=new X509;null!=d&&(m.extreq=h.getExtParamArray(d));try{var n=l(a,0,[1],"30");h=new X509;m.sigalg=h.getAlgorithmIdentifierName(n)}catch(p){}try{var g=c(a,0,[2]);m.sighex=g}catch(p){}return m};
KJUR.asn1.csr.CSRUtil.verifySignature=function(a){try{var b=null;"string"==typeof a&&-1!=a.indexOf("-----BEGIN CERTIFICATE REQUEST")?b=KJUR.asn1.csr.CSRUtil.getParam(a,!0):"object"==typeof a&&void 0!=a.sbjpubkey&&void 0!=a.sigalg&&void 0!=a.sighex&&void 0!=a.tbs&&(b=a);if(null==b)return!1;var c=new KJUR.crypto.Signature({alg:b.sigalg});c.init(b.sbjpubkey);c.updateHex(b.tbs);return c.verify(b.sighex)}catch(d){return alert(d),!1}};"undefined"!=typeof KJUR&&KJUR||(KJUR={});
"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={});"undefined"!=typeof KJUR.asn1.ocsp&&KJUR.asn1.ocsp||(KJUR.asn1.ocsp={});KJUR.asn1.ocsp.DEFAULT_HASH="sha1";
KJUR.asn1.ocsp.OCSPResponse=function(a){KJUR.asn1.ocsp.OCSPResponse.superclass.constructor.call(this);var b=KJUR.asn1.ASN1Util.newObject,c=KJUR.asn1.ocsp.ResponseBytes,d="successful malformedRequest internalError tryLater _not_used_ sigRequired unauthorized".split(" ");this.params=null;this._getStatusCode=function(){var a=this.params.resstatus;return"number"==typeof a?a:"string"!=typeof a?-1:d.indexOf(a)};this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params,d=this._getStatusCode();
if(-1==d)throw Error("responseStatus not supported: "+a.resstatus);if(0!=d)return b({seq:[{"enum":{"int":d}}]}).tohex();a=new c(a);return b({seq:[{"enum":{"int":0}},{tag:{tag:"a0",explicit:!0,obj:a}}]}).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.OCSPResponse,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.ResponseBytes=function(a){KJUR.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERSequence,d=b.DERObjectIdentifier,f=b.DEROctetString,k=b.ocsp.BasicOCSPResponse;this.params=null;this.setByParam=function(a){this.params=a};this.tohex=function(){var a=this.params;if("ocspBasic"!=a.restype)throw Error("not supported responseType: "+a.restype);a=new k(a);var b=[];b.push(new d({name:"ocspBasic"}));b.push(new f({hex:a.tohex()}));return(new c({array:b})).tohex()};
this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.ResponseBytes,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.BasicOCSPResponse=function(a){KJUR.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var b=Error,c=KJUR.asn1,d=c.ASN1Object,f=c.DERSequence,k=c.DERTaggedObject,l=c.DERBitString,m=c.x509.AlgorithmIdentifier;c=c.ocsp;_SingleResponseList=c.SingleResponseList;_ResponseData=c.ResponseData;this.params=null;this.setByParam=function(a){this.params=a};this.sign=function(){var a=this.params,b=a.tbsresp.tohex(),c=new KJUR.crypto.Signature({alg:a.sigalg});c.init(a.reskey);c.updateHex(b);
a.sighex=c.sign()};this.tohex=function(){var a=this.params;void 0==a.tbsresp&&(a.tbsresp=new _ResponseData(a));void 0==a.sighex&&void 0!=a.reskey&&this.sign();var c=[];c.push(a.tbsresp);c.push(new m({name:a.sigalg}));c.push(new l({hex:"00"+a.sighex}));if(void 0!=a.certs&&void 0!=a.certs.length){for(var n=[],g=0;g<a.certs.length;g++){var p=a.certs[g];if(!ASN1HEX.isASN1HEX(p))if(p.match(/-----BEGIN/))p=pemtohex(p);else throw new b("certs["+g+"] not hex or PEM");n.push(new d({tlv:p}))}a=new f({array:n});
c.push(new k({tag:"a0",explicit:!0,obj:a}))}return(new f({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.BasicOCSPResponse,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.ResponseData=function(a){KJUR.asn1.ocsp.ResponseData.superclass.constructor.call(this);var b=Error,c=KJUR.asn1,d=c.DERSequence,f=c.DERGeneralizedTime,k=c.DERTaggedObject,l=c.x509.Extensions;c=c.ocsp;var m=c.ResponderID;_SingleResponseList=c.SingleResponseList;this.params=null;this.tohex=function(){var a=this.params;void 0!=a.respid&&new b("respid not specified");void 0!=a.prodat&&new b("prodat not specified");void 0!=a.array&&new b("array not specified");var c=[];c.push(new m(a.respid));
c.push(new f(a.prodat));c.push(new _SingleResponseList(a.array));void 0!=a.ext&&(a=new l(a.ext),c.push(new k({tag:"a1",explicit:!0,obj:a})));return(new d({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.ResponseData,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.ResponderID=function(a){KJUR.asn1.ocsp.ResponderID.superclass.constructor.call(this);var b=KJUR,c=b.asn1,d=c.ASN1Util.newObject,f=c.x509.X500Name,k=b.lang.String.isHex,l=Error;this.params=null;this.tohex=function(){var a=this.params;if(void 0!=a.key){var b=null;"string"==typeof a.key?(k(a.key)&&(b=a.key),a.key.match(/-----BEGIN CERTIFICATE/)&&(a=new X509(a.key),a=a.getExtSubjectKeyIdentifier(),null!=a&&(b=a.kid.hex))):a.key instanceof X509&&(a=a.key.getExtSubjectKeyIdentifier(),null!=
a&&(b=a.kid.hex));if(null==b)throw new l("wrong key member value");b=d({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:b}}}});return b.tohex()}if(void 0!=a.name){b=null;"string"==typeof a.name&&a.name.match(/-----BEGIN CERTIFICATE/)?(a=new X509(a.name),b=a.getSubject()):a.name instanceof X509?b=a.name.getSubject():"object"!=typeof a.name||void 0==a.name.array&&void 0==a.name.str||(b=a.name);if(null==b)throw new l("wrong name member value");b=d({tag:{tag:"a1",explicit:!0,obj:new f(b)}});return b.tohex()}throw new l("key or name not specified");
};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.ResponderID,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.SingleResponseList=function(a){KJUR.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var b=KJUR.asn1,c=b.DERSequence,d=b.ocsp.SingleResponse;this.params=null;this.tohex=function(){var a=this.params;if("object"!=typeof a||void 0==a.length)throw Error("params not specified properly");for(var b=[],l=0;l<a.length;l++)b.push(new d(a[l]));return(new c({array:b})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!==
a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.SingleResponseList,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.SingleResponse=function(a){var b=Error,c=KJUR.asn1,d=c.DERSequence,f=c.DERGeneralizedTime,k=c.DERTaggedObject,l=c.ocsp,m=l.CertID,e=l.CertStatus,h=c.x509.Extensions;l.SingleResponse.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params,c=[];if(void 0==a.certid)throw new b("certid unspecified");if(void 0==a.status)throw new b("status unspecified");if(void 0==a.thisupdate)throw new b("thisupdate unspecified");c.push(new m(a.certid));c.push(new e(a.status));
c.push(new f(a.thisupdate));if(void 0!=a.nextupdate){var p=new f(a.nextupdate);c.push(new k({tag:"a0",explicit:!0,obj:p}))}void 0!=a.ext&&(a=new h(a.ext),c.push(new k({tag:"a1",explicit:!0,obj:a})));return(new d({array:c})).tohex()};this.getEncodedHex=function(){return this.tohex()};this.setByParam=function(a){this.params=a};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.SingleResponse,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.CertID=function(a){var b=KJUR,c=b.asn1,d=c.DEROctetString,f=c.DERInteger,k=c.DERSequence,l=c.x509.AlgorithmIdentifier,m=b.crypto.Util.hashHex,e=X509,h=ASN1HEX.getVbyList;c.ocsp.CertID.superclass.constructor.call(this);this.DEFAULT_HASH="sha1";this.params=null;this.setByValue=function(a,b,c,e){void 0==e&&(e=this.DEFAULT_HASH);this.params={alg:e,issname:a,isskey:b,sbjsn:c}};this.setByCert=function(a,b,c){void 0==c&&(c=this.DEFAULT_HASH);this.params={alg:c,issuerCert:a,subjectCert:b}};
this.getParamByCerts=function(a,b,c){void 0==c&&(c=this.DEFAULT_HASH);var d=new e(a);a=new e(b);b=m(d.getSubjectHex(),c);d=d.getPublicKeyHex();d=m(h(d,0,[1],"03",!0),c);a=a.getSerialNumberHex();return{alg:c,issname:b,isskey:d,sbjsn:a}};this.tohex=function(){if("object"!=typeof this.params)throw Error("params not set");var a=this.params;var b=void 0==a.alg?this.DEFAULT_HASH:a.alg;if(void 0!=a.issuerCert&&void 0!=a.subjectCert){a=this.getParamByCerts(a.issuerCert,a.subjectCert,b);var c=a.issname;var e=
a.isskey;a=a.sbjsn}else if(void 0!=a.issname&&void 0!=a.isskey&&void 0!=a.sbjsn)c=a.issname,e=a.isskey,a=a.sbjsn;else throw Error("required param members not defined");b=new l({name:b});c=new d({hex:c});e=new d({hex:e});a=new f({hex:a});return this.hTLV=(new k({array:[b,c,e,a]})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.CertID,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.CertStatus=function(a){KJUR.asn1.ocsp.CertStatus.superclass.constructor.call(this);this.params=null;this.tohex=function(){var a=this.params;if("good"==a.status)return"8000";if("unknown"==a.status)return"8200";if("revoked"==a.status){var c=[{gentime:{str:a.time}}];void 0!=a.reason&&c.push({tag:{tag:"a0",explicit:!0,obj:{"enum":{"int":a.reason}}}});return KJUR.asn1.ASN1Util.newObject({tag:{tag:"a1",explicit:!1,obj:{seq:c}}}).tohex()}throw Error("bad status");};this.getEncodedHex=function(){return this.tohex()};
this.setByParam=function(a){this.params=a};void 0!==a&&this.setByParam(a)};extendClass(KJUR.asn1.ocsp.CertStatus,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.Request=function(a){var b=KJUR.asn1,c=b.DERSequence;b=b.ocsp;b.Request.superclass.constructor.call(this);this.dExt=this.dReqCert=null;this.tohex=function(){var a=[];if(null===this.dReqCert)throw"reqCert not set";a.push(this.dReqCert);return this.hTLV=(new c({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};"undefined"!==typeof a&&(this.dReqCert=new b.CertID(a))};extendClass(KJUR.asn1.ocsp.Request,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.TBSRequest=function(a){var b=KJUR.asn1,c=b.DERSequence,d=b.ocsp;d.TBSRequest.superclass.constructor.call(this);this.version=0;this.dRequestorName=null;this.dRequestList=[];this.dRequestExt=null;this.setRequestListByParam=function(a){for(var b=[],c=0;c<a.length;c++){var m=new d.Request(a[0]);b.push(m)}this.dRequestList=b};this.tohex=function(){var a=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var b=
new c({array:this.dRequestList});a.push(b);if(null!==this.dRequestExt)throw"requestExtensions not supported";return this.hTLV=(new c({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&void 0!==a.reqList&&this.setRequestListByParam(a.reqList)};extendClass(KJUR.asn1.ocsp.TBSRequest,KJUR.asn1.ASN1Object);
KJUR.asn1.ocsp.OCSPRequest=function(a){var b=KJUR.asn1,c=b.DERSequence;b=b.ocsp;b.OCSPRequest.superclass.constructor.call(this);this.dOptionalSignature=this.dTbsRequest=null;this.tohex=function(){var a=[];if(null!==this.dTbsRequest)a.push(this.dTbsRequest);else throw"tbsRequest not set";if(null!==this.dOptionalSignature)throw"optionalSignature not supported";return this.hTLV=(new c({array:a})).tohex()};this.getEncodedHex=function(){return this.tohex()};void 0!==a&&void 0!==a.reqList&&(this.dTbsRequest=
new b.TBSRequest(a))};extendClass(KJUR.asn1.ocsp.OCSPRequest,KJUR.asn1.ASN1Object);KJUR.asn1.ocsp.OCSPUtil={};KJUR.asn1.ocsp.OCSPUtil.getRequestHex=function(a,b,c){var d=KJUR.asn1.ocsp;void 0===c&&(c=d.DEFAULT_HASH);return(new d.OCSPRequest({reqList:[{alg:c,issuerCert:a,subjectCert:b}]})).tohex()};
KJUR.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(a){var b=ASN1HEX,c=b.getVbyList,d=b.getVbyListEx,f=b.getIdxbyList;b=b.getV;var k={};try{var l=d(a,0,[0],"0a");k.responseStatus=parseInt(l,16)}catch(n){}if(0!==k.responseStatus)return k;try{var m=f(a,0,[1,0,1,0,0,2,0,1]);"80"===a.substr(m,2)?k.certStatus="good":"a1"===a.substr(m,2)?(k.certStatus="revoked",k.revocationTime=hextoutf8(c(a,m,[0]))):"82"===a.substr(m,2)&&(k.certStatus="unknown")}catch(n){}try{var e=f(a,0,[1,0,1,0,0,2,0,2]);k.thisUpdate=
hextoutf8(b(a,e))}catch(n){}try{var h=f(a,0,[1,0,1,0,0,2,0,3]);"a0"===a.substr(h,2)&&(k.nextUpdate=hextoutf8(c(a,h,[0])))}catch(n){}return k};
KJUR.asn1.ocsp.OCSPParser=function(){var a=Error,b=X509,c=new b,d=ASN1HEX,f=d.getV,k=d.getTLV,l=d.getIdxbyList,m=d.getVbyList,e=d.getTLVbyList,h=d.getVbyListEx,n=d.getTLVbyListEx,g=d.getChildIdx;this.getOCSPRequest=function(b){var c=g(b,0);if(1!=c.length&&2!=c.length)throw new a("wrong number elements: "+c.length);return this.getTBSRequest(k(b,c[0]))};this.getTBSRequest=function(a){var b={},e=n(a,0,[0],"30");b.array=this.getRequestList(e);a=n(a,0,["[2]",0],"30");null!=a&&(b.ext=c.getExtParamArray(a));
return b};this.getRequestList=function(a){for(var b=[],c=g(a,0),e=0;e<c.length;e++)a=k(a,c[e]),b.push(this.getRequest(a));return b};this.getRequest=function(b){var e=g(b,0);if(1!=e.length&&2!=e.length)throw new a("wrong number elements: "+e.length);var d=this.getCertID(k(b,e[0]));2==e.length&&(e=l(b,0,[1,0]),d.ext=c.getExtParamArray(k(b,e)));return d};this.getCertID=function(c){var e=g(c,0);if(4!=e.length)throw new a("wrong number elements: "+e.length);var d=new b,h={};h.alg=d.getAlgorithmIdentifierName(k(c,
e[0]));h.issname=f(c,e[1]);h.isskey=f(c,e[2]);h.sbjsn=f(c,e[3]);return h};this.getOCSPResponse=function(a){var b=g(a,0),c=f(a,b[0]);c=parseInt(c);if(1==b.length)return{resstatus:c};a=e(a,0,[1,0]);a=this.getResponseBytes(a);a.resstatus=c;return a};this.getResponseBytes=function(a){var b=g(a,0);var c=e(a,0,[1,0]);c=this.getBasicOCSPResponse(c);a=f(a,b[0]);c.restype=KJUR.asn1.x509.OID.oid2name(hextooid(a));return c};this.getBasicOCSPResponse=function(a){var b=g(a,0);var c=this.getResponseData(k(a,b[0]));
var e=new X509;c.alg=e.getAlgorithmIdentifierName(k(a,b[1]));b=f(a,b[2]);c.sighex=b.substr(2);a=h(a,0,["[0]"]);if(null!=a){b=g(a,0);e=[];for(var d=0;d<b.length;d++){var m=k(a,b[d]);e.push(m)}c.certs=e}return c};this.getResponseData=function(a){var b=g(a,0),c=b.length,d={},h=0;"a0"==a.substr(b[0],2)&&h++;d.respid=this.getResponderID(k(a,b[h++]));var m=f(a,b[h++]);d.prodat=hextoutf8(m);d.array=this.getSingleResponseList(k(a,b[h++]));"a1"==a.substr(b[c-1],2)&&(a=e(a,b[c-1],[0]),b=new X509,d.ext=b.getExtParamArray(a));
return d};this.getResponderID=function(a){var b={};if("a2"==a.substr(0,2)){var c=m(a,0,[0]);b.key=c}"a1"==a.substr(0,2)&&(a=e(a,0,[0]),c=new X509,b.name=c.getX500Name(a));return b};this.getSingleResponseList=function(a){for(var b=g(a,0),c=[],e=0;e<b.length;e++){var d=this.getSingleResponse(k(a,b[e]));c.push(d)}return c};this.getSingleResponse=function(a){var b=g(a,0),c={},d=this.getCertID(k(a,b[0]));c.certid=d;d=this.getCertStatus(k(a,b[1]));c.status=d;"18"==a.substr(b[2],2)&&(d=f(a,b[2]),c.thisupdate=
hextoutf8(d));for(d=3;d<b.length;d++){if("a0"==a.substr(b[d],2)){var h=m(a,b[d],[0],"18");c.nextupdate=hextoutf8(h)}if("a1"==a.substr(b[d],2)){h=new X509;var n=e(a,0,[d,0]);c.ext=h.getExtParamArray(n)}}return c};this.getCertStatus=function(a){var b={};if("8000"==a)return{status:"good"};if("8200"==a)return{status:"unknown"};"a1"==a.substr(0,2)&&(b.status="revoked",a=m(a,0,[0]),a=hextoutf8(a),b.time=a);return b}};var KJUR;"undefined"!=typeof KJUR&&KJUR||(KJUR={});
"undefined"!=typeof KJUR.lang&&KJUR.lang||(KJUR.lang={});KJUR.lang.String=function(){};function Base64x(){}function stoBA(a){for(var b=[],c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}function BAtos(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function BAtohex(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}function stohex(a){return BAtohex(stoBA(a))}function stob64(a){return hex2b64(stohex(a))}
function stob64u(a){return b64tob64u(hex2b64(stohex(a)))}function b64utos(a){return BAtos(b64toBA(b64utob64(a)))}function b64tob64u(a){a=a.replace(/=/g,"");a=a.replace(/\+/g,"-");return a=a.replace(/\//g,"_")}function b64utob64(a){2==a.length%4?a+="==":3==a.length%4&&(a+="=");a=a.replace(/-/g,"+");return a=a.replace(/_/g,"/")}function hextob64u(a){1==a.length%2&&(a="0"+a);return b64tob64u(hex2b64(a))}function b64utohex(a){return b64tohex(b64utob64(a))}var utf8tob64u,b64utoutf8;
"function"===typeof Buffer?(utf8tob64u=function(a){return b64tob64u(Buffer.from(a,"utf8").toString("base64"))},b64utoutf8=function(a){return Buffer.from(b64utob64(a),"base64").toString("utf8")}):(utf8tob64u=function(a){return hextob64u(uricmptohex(encodeURIComponentAll(a)))},b64utoutf8=function(a){return decodeURIComponent(hextouricmp(b64utohex(a)))});function utf8tob64(a){return hex2b64(uricmptohex(encodeURIComponentAll(a)))}
function b64toutf8(a){return decodeURIComponent(hextouricmp(b64tohex(a)))}function utf8tohex(a){return uricmptohex(encodeURIComponentAll(a)).toLowerCase()}function hextoutf8(a){try{return decodeURIComponent(hextouricmp(a))}catch(b){return null}}function iso88591hextoutf8(a){return hextoutf8(iso88591hextoutf8hex(a))}function utf8toiso88591hex(a){return utf8hextoiso88591hex(utf8tohex(a))}
function iso88591hextoutf8hex(a){a=a.match(/.{1,2}/g);for(var b=[],c=0;c<a.length;c++){var d=parseInt(a[c],16);161<=d&&191>=d?(b.push("c2"),b.push(a[c])):192<=d&&255>=d?(b.push("c3"),b.push((d-64).toString(16))):b.push(a[c])}return b.join("")}function utf8hextoiso88591hex(a){a=a.match(/.{1,2}/g);for(var b=[],c=0;c<a.length;c++)if("c2"==a[c])c++,b.push(a[c]);else if("c3"==a[c]){c++;var d=parseInt(a[c],16)+64;b.push(d.toString(16))}else b.push(a[c]);return b.join("")}
function hextorstr(a){for(var b="",c=0;c<a.length-1;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b}function rstrtohex(a){for(var b="",c=0;c<a.length;c++)b+=("0"+a.charCodeAt(c).toString(16)).slice(-2);return b}function hextob64(a){return hex2b64(a)}function hextob64nl(a){return foldnl(hextob64(a),64)}function foldnl(a,b){return a.replace(new RegExp("(.{"+b+"})","g"),"$1\r\n")}function b64nltohex(a){a=a.replace(/[^0-9A-Za-z\/+=]*/g,"");return b64tohex(a)}
function b64topem(a,b){return"-----BEGIN "+b+"-----\r\n"+foldnl(a,64)+"\r\n-----END "+b+"-----\r\n"}function hextopem(a,b){return"-----BEGIN "+b+"-----\r\n"+foldnl(hextob64(a),64)+"\r\n-----END "+b+"-----\r\n"}
function pemtohex(a,b){if(-1==a.indexOf("-----BEGIN "))throw Error("can't find PEM header");void 0!==b?(a=a.replace(new RegExp("^[^]*-----BEGIN "+b+"-----"),""),a=a.replace(new RegExp("-----END "+b+"-----[^]*$"),"")):(a=a.replace(/^[^]*-----BEGIN [^-]+-----/,""),a=a.replace(/-----END [^-]+-----[^]*$/,""));return b64nltohex(a)}
function pemtob64(a){if(-1==a.indexOf("-----BEGIN ")||-1==a.indexOf("-----END "))return null;a=a.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,"");a=a.replace(/-----END [\s\S]+$/m,"");a=a.replace(/\s+/g,"");return a.match(/^[0-9a-zA-Z+/=]+$/)?a:null}
function hextoArrayBuffer(a){if(0!=a.length%2)throw"input is not even length";if(null==a.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var b=new ArrayBuffer(a.length/2),c=new DataView(b),d=0;d<a.length/2;d++)c.setUint8(d,parseInt(a.substr(2*d,2),16));return b}function ArrayBuffertohex(a){for(var b="",c=new DataView(a),d=0;d<a.byteLength;d++)b+=("00"+c.getUint8(d).toString(16)).slice(-2);return b}
function zulutomsec(a){var b;a=timetogen(a);if(b=a.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/)){a=parseInt(b[1]);var c=parseInt(b[2])-1;var d=parseInt(b[3]);var f=parseInt(b[4]);var k=parseInt(b[5]);var l=parseInt(b[6]);var m=0;b=b[7];""!==b&&(m=(b.substr(1)+"00").substr(0,3),m=parseInt(m));return Date.UTC(a,c,d,f,k,l,m)}throw Error("unsupported zulu format: "+a);}
function msectozulu(a){var b=new Date(a);a=("0000"+b.getUTCFullYear()).slice(-4);var c=("00"+(b.getUTCMonth()+1)).slice(-2),d=("00"+b.getUTCDate()).slice(-2),f=("00"+b.getUTCHours()).slice(-2),k=("00"+b.getUTCMinutes()).slice(-2),l=("00"+b.getUTCSeconds()).slice(-2);b=("000"+b.getUTCMilliseconds()).slice(-3);b=b.replace(/0+$/,"");return a+c+d+f+k+l+(""!=b?"."+b:b)+"Z"}function zulutosec(a){return Math.round(zulutomsec(a)/1E3)}function zulutodate(a){return new Date(zulutomsec(a))}
function datetozulu(a,b,c){var d=a.getUTCFullYear();if(b){if(1950>d||2049<d)throw"not proper year for UTCTime: "+d;b=(""+d).slice(-2)}else b=("000"+d).slice(-4);b+=("0"+(a.getUTCMonth()+1)).slice(-2);b+=("0"+a.getUTCDate()).slice(-2);b+=("0"+a.getUTCHours()).slice(-2);b+=("0"+a.getUTCMinutes()).slice(-2);b+=("0"+a.getUTCSeconds()).slice(-2);c&&(a=a.getUTCMilliseconds(),0!==a&&(a=("00"+a).slice(-3),a=a.replace(/0+$/g,""),b+="."+a));return b+"Z"}
function timetogen(a){return a.match(/^[0-9]{12}Z$/)||a.match(/^[0-9]{12}[.][0-9]*Z$/)?a.match(/^[0-4]/)?"20"+a:"19"+a:a}function uricmptohex(a){return a.replace(/%/g,"")}function hextouricmp(a){return a.replace(/(..)/g,"%$1")}
function ipv6tohex(a){if(!a.match(/^[0-9A-Fa-f:]+$/))throw"malformed IPv6 address";a=a.toLowerCase();var b=a.split(":").length-1;if(2>b)throw"malformed IPv6 address";b=":".repeat(7-b+2);a=a.replace("::",b);a=a.split(":");if(8!=a.length)throw"malformed IPv6 address";for(b=0;8>b;b++)a[b]=("0000"+a[b]).slice(-4);return a.join("")}
function hextoipv6(a){if(!a.match(/^[0-9A-Fa-f]{32}$/))throw Error("malformed IPv6 address: "+a);a=a.toLowerCase();a=a.match(/.{1,4}/g);a=a.map(function(a){return a.replace(/^0+/,"")});a=a.map(function(a){return""==a?"0":a});a=":"+a.join(":")+":";var b=a.match(/:(0:){2,}/g);if(null==b)return a.slice(1,-1);b=b.sort().slice(-1)[0];a=a.replace(b.substr(0,b.length-1),":");"::"!=a.substr(0,2)&&(a=a.substr(1));"::"!=a.substr(-2,2)&&(a=a.substr(0,a.length-1));return a}
function hextoip(a){var b=Error("malformed hex value");if(!a.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw b;if(8==a.length){var c;try{return c=parseInt(a.substr(0,2),16)+"."+parseInt(a.substr(2,2),16)+"."+parseInt(a.substr(4,2),16)+"."+parseInt(a.substr(6,2),16)}catch(d){throw b;}}else if(16==a.length)try{return hextoip(a.substr(0,8))+"/"+ipprefixlen(a.substr(8))}catch(d){throw b;}else{if(32==a.length)return hextoipv6(a);if(64==a.length)try{return hextoipv6(a.substr(0,32))+"/"+ipprefixlen(a.substr(32))}catch(d){throw b;
}else return a}}function ipprefixlen(a){var b=Error("malformed mask");try{var c=(new BigInteger(a,16)).toString(2)}catch(d){throw b;}if(!c.match(/^1*0*$/))throw b;return c.replace(/0+$/,"").length}
function iptohex(a){var b=Error("malformed IP address");a=a.toLowerCase(a);if(!a.match(/^[0-9a-f.:/]+$/))throw b;if(a.match(/^[0-9.]+$/)){a=a.split(".");if(4!==a.length)throw b;var c="";try{for(var d=0;4>d;d++){var f=parseInt(a[d]);c+=("0"+f.toString(16)).slice(-2)}return c}catch(k){throw b;}}else{if(a.match(/^[0-9.]+\/[0-9]+$/))return b=a.split("/"),iptohex(b[0])+ipnetmask(parseInt(b[1]),32);if(a.match(/^[0-9a-f:]+$/)&&-1!==a.indexOf(":"))return ipv6tohex(a);if(a.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==
a.indexOf(":"))return b=a.split("/"),ipv6tohex(b[0])+ipnetmask(parseInt(b[1]),128);throw b;}}function ipnetmask(a,b){if(32==b&&0==a)return"00000000";if(128==b&&0==a)return"00000000000000000000000000000000";a=Array(a+1).join("1")+Array(b-a+1).join("0");return(new BigInteger(a,2)).toString(16)}
function ucs2hextoutf8(a){return a.match(/.{4}/g).map(function(a){var b=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2),16);if(0==b&128>d)return String.fromCharCode(d);if(8>b)return a=128|d&63,hextoutf8((192|(b&7)<<3|(d&192)>>6).toString(16)+a.toString(16));a=128|(b&15)<<2|(d&192)>>6;d=128|d&63;return hextoutf8((224|(b&240)>>4).toString(16)+a.toString(16)+d.toString(16))}).join("")}
function encodeURIComponentAll(a){a=encodeURIComponent(a);for(var b="",c=0;c<a.length;c++)"%"==a[c]?(b+=a.substr(c,3),c+=2):b=b+"%"+stohex(a[c]);return b}function newline_toUnix(a){return a=a.replace(/\r\n/mg,"\n")}function newline_toDos(a){a=a.replace(/\r\n/mg,"\n");return a=a.replace(/\n/mg,"\r\n")}KJUR.lang.String.isInteger=function(a){return a.match(/^[0-9]+$/)?!0:a.match(/^-[0-9]+$/)?!0:!1};KJUR.lang.String.isHex=function(a){return ishex(a)};
function ishex(a){return 0==a.length%2&&(a.match(/^[0-9a-f]+$/)||a.match(/^[0-9A-F]+$/))?!0:!1}KJUR.lang.String.isBase64=function(a){a=a.replace(/\s+/g,"");return a.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&0==a.length%4?!0:!1};KJUR.lang.String.isBase64URL=function(a){if(a.match(/[+/=]/))return!1;a=b64utob64(a);return KJUR.lang.String.isBase64(a)};function isBase64URLDot(a){return a.match(/^[0-9A-Za-z-_.]+$/)?!0:!1}
KJUR.lang.String.isIntegerArray=function(a){a=a.replace(/\s+/g,"");return a.match(/^\[[0-9,]+\]$/)?!0:!1};KJUR.lang.String.isPrintable=function(a){return null!==a.match(/^[0-9A-Za-z '()+,-./:=?]*$/)?!0:!1};KJUR.lang.String.isIA5=function(a){return null!==a.match(/^[\x20-\x21\x23-\x7f]*$/)?!0:!1};KJUR.lang.String.isMail=function(a){return null!==a.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)?!0:!1};
function hextoposhex(a){return 1==a.length%2?"0"+a:"7"<a.substr(0,1)?"00"+a:a}function intarystrtohex(a){a=a.replace(/^\s*\[\s*/,"");a=a.replace(/\s*\]\s*$/,"");a=a.replace(/\s*/g,"");try{return a.split(/,/).map(function(a,c,d){a=parseInt(a);if(0>a||255<a)throw"integer not in range 0-255";return("00"+a.toString(16)).slice(-2)}).join("")}catch(b){throw"malformed integer array string: "+b;}}
var strdiffidx=function(a,b){var c=a.length;a.length>b.length&&(c=b.length);for(var d=0;d<c;d++)if(a.charCodeAt(d)!=b.charCodeAt(d))return d;return a.length!=b.length?c:-1};
function oidtohex(a){var b=function(a){a=a.toString(16);1==a.length&&(a="0"+a);return a},c=function(a){var c="";a=parseInt(a,10).toString(2);var e=7-a.length%7;7==e&&(e=0);for(var d="",n=0;n<e;n++)d+="0";a=d+a;for(n=0;n<a.length-1;n+=7)e=a.substr(n,7),n!=a.length-7&&(e="1"+e),c+=b(parseInt(e,2));return c};try{if(!a.match(/^[0-9.]+$/))return null;var d="",f=a.split("."),k=40*parseInt(f[0],10)+parseInt(f[1],10);d+=b(k);f.splice(0,2);for(a=0;a<f.length;a++)d+=c(f[a]);return d}catch(l){return null}}
function hextooid(a){if(!ishex(a))return null;try{var b=[],c=a.substr(0,2),d=parseInt(c,16);b[0]=new String(Math.floor(d/40));b[1]=new String(d%40);var f=a.substr(2);a=[];for(c=0;c<f.length/2;c++)a.push(parseInt(f.substr(2*c,2),16));f=[];d="";for(c=0;c<a.length;c++)a[c]&128?d+=strpad((a[c]&127).toString(2),7):(d+=strpad((a[c]&127).toString(2),7),f.push(new String(parseInt(d,2))),d="");var k=b.join(".");0<f.length&&(k=k+"."+f.join("."));return k}catch(l){return null}}
var strpad=function(a,b,c){void 0==c&&(c="0");return a.length>=b?a:Array(b-a.length+1).join(c)+a};function bitstrtoint(a){if(0!=a.length%2)return-1;a=a.toLowerCase();if(null==a.match(/^[0-9a-f]+$/))return-1;try{var b=a.substr(0,2);if("00"==b)return parseInt(a.substr(2),16);var c=parseInt(b,16);if(7<c)return-1;var d=a.substr(2),f=parseInt(d,16).toString(2);"0"==f&&(f="00000000");f=f.slice(0,0-c);var k=parseInt(f,2);return NaN==k?-1:k}catch(l){return-1}}
function inttobitstr(a){if("number"!=typeof a||0>a)return null;var b=Number(a).toString(2);a=8-b.length%8;8==a&&(a=0);b+=strpad("",a,"0");b=parseInt(b,2).toString(16);1==b.length%2&&(b="0"+b);return"0"+a+b}
function bitstrtobinstr(a){if("string"!=typeof a||0!=a.length%2||!a.match(/^[0-9a-f]+$/))return null;try{var b=parseInt(a.substr(0,2),16);if(0>b||7<b)return null;var c=a.substr(2);a="";for(var d=0;d<c.length;d+=2){var f=c.substr(d,2),k=parseInt(f,16).toString(2);k=("0000000"+k).slice(-8);a+=k}return a.substr(0,a.length-b)}catch(l){return null}}
function binstrtobitstr(a){if("string"!=typeof a||null==a.match(/^[01]+$/))return null;try{var b=parseInt(a,2);return inttobitstr(b)}catch(c){return null}}function namearraytobinstr(a,b){for(var c=0,d=0;d<a.length;d++)c|=1<<b[a[d]];a=c.toString(2);b="";for(d=a.length-1;0<=d;d--)b+=a[d];return b}function aryval(a,b,c){if("object"==typeof a){b=String(b).split(".");for(var d=0;d<b.length&&a;d++){var f=b[d];f.match(/^[0-9]+$/)&&(f=parseInt(f));a=a[f]}return a||!1===a?a:c}}
function extendClass(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superclass=b.prototype;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={});
KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"};this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",
sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",
SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"};
this.CRYPTOJSMESSAGEDIGESTNAME={md5:CryptoJS.algo.MD5,sha1:CryptoJS.algo.SHA1,sha224:CryptoJS.algo.SHA224,sha256:CryptoJS.algo.SHA256,sha384:CryptoJS.algo.SHA384,sha512:CryptoJS.algo.SHA512,ripemd160:CryptoJS.algo.RIPEMD160};this.getDigestInfoHex=function(a,b){if("undefined"==typeof this.DIGESTINFOHEAD[b])throw"alg not supported in Util.DIGESTINFOHEAD: "+b;return this.DIGESTINFOHEAD[b]+a};this.getPaddedDigestInfoHex=function(a,b,c){var d=this.getDigestInfoHex(a,b);a=c/4;if(d.length+22>a)throw"key is too short for SigAlg: keylen="+
c+","+b;b="00"+d;c="";a=a-4-b.length;for(d=0;d<a;d+=2)c+="ff";return"0001"+c+b};this.hashString=function(a,b){return(new KJUR.crypto.MessageDigest({alg:b})).digestString(a)};this.hashHex=function(a,b){return(new KJUR.crypto.MessageDigest({alg:b})).digestHex(a)};this.sha1=function(a){return this.hashString(a,"sha1")};this.sha256=function(a){return this.hashString(a,"sha256")};this.sha256Hex=function(a){return this.hashHex(a,"sha256")};this.sha512=function(a){return this.hashString(a,"sha512")};this.sha512Hex=
function(a){return this.hashHex(a,"sha512")};this.isKey=function(a){return a instanceof RSAKey||a instanceof KJUR.crypto.DSA||a instanceof KJUR.crypto.ECDSA?!0:!1}};KJUR.crypto.Util.md5=function(a){return(new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"})).digestString(a)};KJUR.crypto.Util.ripemd160=function(a){return(new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"})).digestString(a)};KJUR.crypto.Util.SECURERANDOMGEN=new SecureRandom;
KJUR.crypto.Util.getRandomHexOfNbytes=function(a){a=Array(a);KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(a);return BAtohex(a)};KJUR.crypto.Util.getRandomBigIntegerOfNbytes=function(a){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbytes(a),16)};KJUR.crypto.Util.getRandomHexOfNbits=function(a){var b=a%8;a=Array((a-b)/8+1);KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(a);a[0]&=255<<b&255^255;return BAtohex(a)};
KJUR.crypto.Util.getRandomBigIntegerOfNbits=function(a){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbits(a),16)};KJUR.crypto.Util.getRandomBigIntegerZeroToMax=function(a){for(var b=a.bitLength();;){var c=KJUR.crypto.Util.getRandomBigIntegerOfNbits(b);if(-1!=a.compareTo(c))return c}};KJUR.crypto.Util.getRandomBigIntegerMinToMax=function(a,b){var c=a.compareTo(b);if(1==c)throw"biMin is greater than biMax";if(0==c)return a;b=b.subtract(a);return KJUR.crypto.Util.getRandomBigIntegerZeroToMax(b).add(a)};
KJUR.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(a,c){a=KJUR.crypto.MessageDigest.getCanonicalAlgName(a);null!==a&&void 0===c&&(c=KJUR.crypto.Util.DEFAULTPROVIDER[a]);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)&&"cryptojs"==c){try{this.md=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a].create()}catch(d){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+d;}this.updateString=function(a){this.md.update(a)};this.updateHex=function(a){a=CryptoJS.enc.Hex.parse(a);
this.md.update(a)};this.digest=function(){return this.md.finalize().toString(CryptoJS.enc.Hex)};this.digestString=function(a){this.updateString(a);return this.digest()};this.digestHex=function(a){this.updateHex(a);return this.digest()}}if(-1!=":sha256:".indexOf(a)&&"sjcl"==c){try{this.md=new sjcl.hash.sha256}catch(d){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+d;}this.updateString=function(a){this.md.update(a)};this.updateHex=function(a){a=sjcl.codec.hex.toBits(a);this.md.update(a)};this.digest=
function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)};this.digestString=function(a){this.updateString(a);return this.digest()};this.digestHex=function(a){this.updateHex(a);return this.digest()}}};this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName;};this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName;};this.digest=function(){throw"digest() not supported for this alg/prov: "+
this.algName+"/"+this.provName;};this.digestString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName;};this.digestHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName;};void 0!==a&&void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))};
KJUR.crypto.MessageDigest.getCanonicalAlgName=function(a){"string"===typeof a&&(a=a.toLowerCase(),a=a.replace(/-/,""));return a};KJUR.crypto.MessageDigest.getHashLength=function(a){var b=KJUR.crypto.MessageDigest,c=b.getCanonicalAlgName(a);if(void 0===b.HASHLENGTH[c])throw"not supported algorithm: "+a;return b.HASHLENGTH[c]};KJUR.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20};
KJUR.crypto.Mac=function(a){this.setAlgAndProvider=function(a,c){a=a.toLowerCase();null==a&&(a="hmacsha1");a=a.toLowerCase();if("hmac"!=a.substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+a;void 0===c&&(c=KJUR.crypto.Util.DEFAULTPROVIDER[a]);this.algProv=a+"/"+c;a=a.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)&&"cryptojs"==c){try{this.mac=CryptoJS.algo.HMAC.create(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a],this.pass)}catch(d){throw"setAlgAndProvider hash alg set fail hashAlg="+
a+"/"+d;}this.updateString=function(a){this.mac.update(a)};this.updateHex=function(a){a=CryptoJS.enc.Hex.parse(a);this.mac.update(a)};this.doFinal=function(){return this.mac.finalize().toString(CryptoJS.enc.Hex)};this.doFinalString=function(a){this.updateString(a);return this.doFinal()};this.doFinalHex=function(a){this.updateHex(a);return this.doFinal()}}};this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algProv;};this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+
this.algProv;};this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv;};this.doFinalString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algProv;};this.doFinalHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv;};this.setPassword=function(a){if("string"==typeof a){var b=a;1!=a.length%2&&a.match(/^[0-9A-Fa-f]+$/)||(b=rstrtohex(a))}else{if("object"!=typeof a)throw"KJUR.crypto.Mac unsupported password type: "+
a;b=null;if(void 0!==a.hex){if(0!=a.hex.length%2||!a.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+a.hex;b=a.hex}void 0!==a.utf8&&(b=utf8tohex(a.utf8));void 0!==a.rstr&&(b=rstrtohex(a.rstr));void 0!==a.b64&&(b=b64tohex(a.b64));void 0!==a.b64u&&(b=b64utohex(a.b64u));if(null==b)throw"KJUR.crypto.Mac unsupported password type: "+a;}this.pass=CryptoJS.enc.Hex.parse(b)};void 0!==a&&(void 0!==a.pass&&this.setPassword(a.pass),void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=
KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))};
KJUR.crypto.Signature=function(a){var b=null;this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))};this._zeroPaddingOfSignature=function(a,b){var c="";b=b/4-a.length;for(var d=0;d<b;d++)c+="0";return c+a};this.setAlgAndProvider=function(a,b){this._setAlgNames();if("cryptojs/jsrsa"!=b)throw Error("provider not supported: "+
b);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(f){throw Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+f);}this.init=function(a,b){var c=null;try{c=void 0===b?KEYUTIL.getKey(a):KEYUTIL.getKey(a,b)}catch(m){throw"init failed:"+m;}if(!0===c.isPrivate)this.prvKey=c,this.state="SIGN";else if(!0===c.isPublic)this.pubKey=c,this.state="VERIFY";else throw"init failed.:"+c;};this.updateString=
function(a){this.md.updateString(a)};this.updateHex=function(a){this.md.updateHex(a)};this.sign=function(){this.sHashHex=this.md.digest();void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==KJUR.crypto.ECDSA&&(this.prvKey=new KJUR.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex}));if(this.prvKey instanceof RSAKey&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof
RSAKey&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof KJUR.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign};this.signString=function(a){this.updateString(a);return this.sign()};this.signHex=function(a){this.updateHex(a);
return this.sign()};this.verify=function(a){this.sHashHex=this.md.digest();void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==KJUR.crypto.ECDSA&&(this.pubKey=new KJUR.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex}));if(this.pubKey instanceof RSAKey&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof RSAKey&&"rsa"===this.pubkeyAlgName||void 0!==KJUR.crypto.ECDSA&&
this.pubKey instanceof KJUR.crypto.ECDSA||void 0!==KJUR.crypto.DSA&&this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;}}};this.init=function(a,b){throw"init(key, pass) not supported for this alg:prov="+this.algProvName;};this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName;};this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+
this.algProvName;};this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName;};this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName;};this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName;};this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName;};this.initParams=a;if(void 0!==a&&(void 0!==a.alg&&(this.algName=a.alg,this.provName=void 0===
a.prov?KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==a.psssaltlen&&(this.pssSaltLen=a.psssaltlen),void 0!==a.prvkeypem)){if(void 0!==a.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{b=KEYUTIL.getKey(a.prvkeypem),this.init(b)}catch(c){throw"fatal error to load pem private key: "+c;}}};KJUR.crypto.Cipher=function(a){};
KJUR.crypto.Cipher.encrypt=function(a,b,c){if(b instanceof RSAKey&&b.isPublic){var d=KJUR.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.encrypt(a);if("RSAOAEP"===d)return b.encryptOAEP(a,"sha1");d=d.match(/^RSAOAEP(\d+)$/);if(null!==d)return b.encryptOAEP(a,"sha"+d[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+c;}throw"Cipher.encrypt: unsupported key or algorithm";};
KJUR.crypto.Cipher.decrypt=function(a,b,c){if(b instanceof RSAKey&&b.isPrivate){var d=KJUR.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.decrypt(a);if("RSAOAEP"===d)return b.decryptOAEP(a,"sha1");d=d.match(/^RSAOAEP(\d+)$/);if(null!==d)return b.decryptOAEP(a,"sha"+d[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+c;}throw"Cipher.decrypt: unsupported key or algorithm";};
KJUR.crypto.Cipher.getAlgByKeyAndName=function(a,b){if(a instanceof RSAKey){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(b))return b;if(null===b||void 0===b)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+b;}throw"getAlgByKeyAndName: not supported algorithm name: "+b;};
KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};"undefined"!=typeof KJUR&&KJUR||(KJUR={});
"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={});
KJUR.crypto.ECDSA=function(a){var b=Error,c=KJUR.crypto.ECDSA,d=KJUR.crypto.ECParameterDB,f=c.getName,k=ASN1HEX,l=k.getVbyListEx,m=k.isASN1HEX,e=new SecureRandom;this.type="EC";this.isPublic=this.isPrivate=!1;this.getBigRandom=function(a){return(new BigInteger(a.bitLength(),e)).mod(a.subtract(BigInteger.ONE)).add(BigInteger.ONE)};this.setNamedCurve=function(a){this.ecparams=d.getByName(a);this.pubKeyHex=this.prvKeyHex=null;this.curveName=a};this.setPrivateKeyHex=function(a){this.isPrivate=!0;this.prvKeyHex=
a};this.setPublicKeyHex=function(a){this.isPublic=!0;this.pubKeyHex=a};this.getPublicKeyXYHex=function(){var a=this.pubKeyHex;if("04"!==a.substr(0,2))throw"this method supports uncompressed format(04) only";var b=this.ecparams.keycharlen;if(a.length!==2+2*b)throw"malformed public key hex length";var c={};c.x=a.substr(2,b);c.y=a.substr(2+b);return c};this.getShortNISTPCurveName=function(){var a=this.curveName;return"secp256r1"===a||"NIST P-256"===a||"P-256"===a||"prime256v1"===a?"P-256":"secp384r1"===
a||"NIST P-384"===a||"P-384"===a?"P-384":"secp521r1"===a||"NIST P-521"===a||"P-521"===a?"P-521":null};this.generateKeyPairHex=function(){var a=this.getBigRandom(this.ecparams.n),b=this.ecparams.keycharlen;a=("0000000000"+a.toString(16)).slice(-b);this.setPrivateKeyHex(a);b=this.generatePublicKeyHex();return{ecprvhex:a,ecpubhex:b}};this.generatePublicKeyHex=function(){var a=new BigInteger(this.prvKeyHex,16),b=this.ecparams.G.multiply(a);a=b.getX().toBigInteger();b=b.getY().toBigInteger();var c=this.ecparams.keycharlen;
a=("0000000000"+a.toString(16)).slice(-c);b=("0000000000"+b.toString(16)).slice(-c);a="04"+a+b;this.setPublicKeyHex(a);return a};this.signWithMessageHash=function(a){return this.signHex(a,this.prvKeyHex)};this.signHex=function(a,b){b=new BigInteger(b,16);var e=this.ecparams.n,d=new BigInteger(a.substring(0,this.ecparams.keycharlen),16);do{var h=this.getBigRandom(e);a=this.ecparams.G.multiply(h).getX().toBigInteger().mod(e)}while(0>=a.compareTo(BigInteger.ZERO));b=h.modInverse(e).multiply(d.add(b.multiply(a))).mod(e);
return c.biRSSigToASN1Sig(a,b)};this.sign=function(a,b){var c=this.ecparams.n,e=BigInteger.fromByteArrayUnsigned(a);do{var d=this.getBigRandom(c);a=this.ecparams.G.multiply(d).getX().toBigInteger().mod(c)}while(0>=a.compareTo(BigInteger.ZERO));b=d.modInverse(c).multiply(e.add(b.multiply(a))).mod(c);return this.serializeSig(a,b)};this.verifyWithMessageHash=function(a,b){return this.verifyHex(a,b,this.pubKeyHex)};this.verifyHex=function(a,b,e){try{var d=c.parseSigHex(b);var g=d.r;var h=d.s;var m=ECPointFp.decodeFromHex(this.ecparams.curve,
e),n=new BigInteger(a.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(n,g,h,m)}catch(A){return!1}};this.verify=function(a,b,c){if(Bitcoin.Util.isArray(b)){b=this.parseSig(b);var e=b.r;b=b.s}else if("object"===typeof b&&b.r&&b.s)e=b.r,b=b.s;else throw"Invalid value for signature";if(!(c instanceof ECPointFp))if(Bitcoin.Util.isArray(c))c=ECPointFp.decodeFrom(this.ecparams.curve,c);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";a=BigInteger.fromByteArrayUnsigned(a);
return this.verifyRaw(a,e,b,c)};this.verifyRaw=function(a,b,c,e){var d=this.ecparams.n,g=this.ecparams.G;if(0>b.compareTo(BigInteger.ONE)||0<=b.compareTo(d)||0>c.compareTo(BigInteger.ONE)||0<=c.compareTo(d))return!1;c=c.modInverse(d);a=a.multiply(c).mod(d);c=b.multiply(c).mod(d);return g.multiply(a).add(e.multiply(c)).getX().toBigInteger().mod(d).equals(b)};this.serializeSig=function(a,b){a=a.toByteArraySigned();b=b.toByteArraySigned();var c=[];c.push(2);c.push(a.length);c=c.concat(a);c.push(2);c.push(b.length);
c=c.concat(b);c.unshift(c.length);c.unshift(48);return c};this.parseSig=function(a){if(48!=a[0])throw Error("Signature not a valid DERSequence");var b=2;if(2!=a[b])throw Error("First element in signature must be a DERInteger");var c=a.slice(b+2,b+2+a[b+1]);b+=2+a[b+1];if(2!=a[b])throw Error("Second element in signature must be a DERInteger");a=a.slice(b+2,b+2+a[b+1]);c=BigInteger.fromByteArrayUnsigned(c);a=BigInteger.fromByteArrayUnsigned(a);return{r:c,s:a}};this.parseSigCompact=function(a){if(65!==
a.length)throw"Signature has the wrong length";var b=a[0]-27;if(0>b||7<b)throw"Invalid signature type";var c=this.ecparams.n,e=BigInteger.fromByteArrayUnsigned(a.slice(1,33)).mod(c);a=BigInteger.fromByteArrayUnsigned(a.slice(33,65)).mod(c);return{r:e,s:a,i:b}};this.readPKCS5PrvKeyHex=function(a){if(!1===m(a))throw Error("not ASN.1 hex string");try{var b=l(a,0,["[0]",0],"06");var c=l(a,0,[1],"04");try{var e=l(a,0,["[1]",0],"03")}catch(q){}}catch(q){throw Error("malformed PKCS#1/5 plain ECC private key");
}this.curveName=f(b);if(void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName);this.setPublicKeyHex(e);this.setPrivateKeyHex(c);this.isPublic=!1};this.readPKCS8PrvKeyHex=function(a){if(!1===m(a))throw new b("not ASN.1 hex string");try{l(a,0,[1,0],"06");var c=l(a,0,[1,1],"06");var e=l(a,0,[2,0,1],"04");try{var d=l(a,0,[2,0,"[1]",0],"03")}catch(q){}}catch(q){throw new b("malformed PKCS#8 plain ECC private key");}this.curveName=f(c);if(void 0===this.curveName)throw new b("unsupported curve name");
this.setNamedCurve(this.curveName);this.setPublicKeyHex(d);this.setPrivateKeyHex(e);this.isPublic=!1};this.readPKCS8PubKeyHex=function(a){if(!1===m(a))throw new b("not ASN.1 hex string");try{l(a,0,[0,0],"06");var c=l(a,0,[0,1],"06");var e=l(a,0,[1],"03")}catch(p){throw new b("malformed PKCS#8 ECC public key");}this.curveName=f(c);if(null===this.curveName)throw new b("unsupported curve name");this.setNamedCurve(this.curveName);this.setPublicKeyHex(e)};this.readCertPubKeyHex=function(a,c){if(!1===m(a))throw new b("not ASN.1 hex string");
try{var e=l(a,0,[0,5,0,1],"06");var d=l(a,0,[0,5,1],"03")}catch(q){throw new b("malformed X.509 certificate ECC public key");}this.curveName=f(e);if(null===this.curveName)throw new b("unsupported curve name");this.setNamedCurve(this.curveName);this.setPublicKeyHex(d)};void 0!==a&&void 0!==a.curve&&(this.curveName=a.curve);void 0===this.curveName&&(this.curveName="secp256r1");this.setNamedCurve(this.curveName);void 0!==a&&(void 0!==a.prv&&this.setPrivateKeyHex(a.prv),void 0!==a.pub&&this.setPublicKeyHex(a.pub))};
KJUR.crypto.ECDSA.parseSigHex=function(a){var b=KJUR.crypto.ECDSA.parseSigHexInHexRS(a);a=new BigInteger(b.r,16);b=new BigInteger(b.s,16);return{r:a,s:b}};
KJUR.crypto.ECDSA.parseSigHexInHexRS=function(a){var b=ASN1HEX,c=b.getChildIdx,d=b.getV;b.checkStrictDER(a,0);if("30"!=a.substr(0,2))throw Error("signature is not a ASN.1 sequence");c=c(a,0);if(2!=c.length)throw Error("signature shall have two elements");b=c[0];c=c[1];if("02"!=a.substr(b,2))throw Error("1st item not ASN.1 integer");if("02"!=a.substr(c,2))throw Error("2nd item not ASN.1 integer");b=d(a,b);a=d(a,c);return{r:b,s:a}};
KJUR.crypto.ECDSA.asn1SigToConcatSig=function(a){var b=KJUR.crypto.ECDSA.parseSigHexInHexRS(a);a=b.r;b=b.s;if(130<=a.length&&134>=a.length){if(0!=a.length%2)throw Error("unknown ECDSA sig r length error");if(0!=b.length%2)throw Error("unknown ECDSA sig s length error");"00"==a.substr(0,2)&&(a=a.substr(2));"00"==b.substr(0,2)&&(b=b.substr(2));var c=Math.max(a.length,b.length);a=("000000"+a).slice(-c);b=("000000"+b).slice(-c);return a+b}"00"==a.substr(0,2)&&2==a.length%32&&(a=a.substr(2));"00"==b.substr(0,
2)&&2==b.length%32&&(b=b.substr(2));30==a.length%32&&(a="00"+a);30==b.length%32&&(b="00"+b);if(0!=a.length%32)throw Error("unknown ECDSA sig r length error");if(0!=b.length%32)throw Error("unknown ECDSA sig s length error");return a+b};KJUR.crypto.ECDSA.concatSigToASN1Sig=function(a){if(0!=a.length%4)throw Error("unknown ECDSA concatinated r-s sig length error");var b=a.substr(0,a.length/2);a=a.substr(a.length/2);return KJUR.crypto.ECDSA.hexRSSigToASN1Sig(b,a)};
KJUR.crypto.ECDSA.hexRSSigToASN1Sig=function(a,b){a=new BigInteger(a,16);b=new BigInteger(b,16);return KJUR.crypto.ECDSA.biRSSigToASN1Sig(a,b)};KJUR.crypto.ECDSA.biRSSigToASN1Sig=function(a,b){var c=KJUR.asn1;a=new c.DERInteger({bigint:a});b=new c.DERInteger({bigint:b});return(new c.DERSequence({array:[a,b]})).tohex()};
KJUR.crypto.ECDSA.getName=function(a){return"2b8104001f"===a?"secp192k1":"2a8648ce3d030107"===a?"secp256r1":"2b8104000a"===a?"secp256k1":"2b81040021"===a?"secp224r1":"2b81040022"===a?"secp384r1":"2b81040023"===a?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(a)?"secp256r1":-1!=="|secp256k1|".indexOf(a)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(a)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(a)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(a)?
"secp521r1":null};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={});
KJUR.crypto.ECParameterDB=new function(){var a={},b={};this.getByName=function(c){var d=c;"undefined"!=typeof b[d]&&(d=b[c]);if("undefined"!=typeof a[d])return a[d];throw"unregistered EC curve name: "+d;};this.regist=function(c,d,f,k,l,m,e,h,n,g,p,q){a[c]={};f=new BigInteger(f,16);k=new BigInteger(k,16);l=new BigInteger(l,16);m=new BigInteger(m,16);e=new BigInteger(e,16);f=new ECCurveFp(f,k,l);h=f.decodePointHex("04"+h+n);a[c].name=c;a[c].keylen=d;a[c].keycharlen=2*Math.ceil(d/8);a[c].curve=f;a[c].G=
h;a[c].n=m;a[c].h=e;a[c].oid=p;a[c].info=q;for(d=0;d<g.length;d++)b[g[d]]=c}};KJUR.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field");
KJUR.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field");
KJUR.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field");
KJUR.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]);
KJUR.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]);
KJUR.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]);
KJUR.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]);
KJUR.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]);
KJUR.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7",
"3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]);
KJUR.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409",
"1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={});
KJUR.crypto.DSA=function(){var a=ASN1HEX,b=a.getVbyListEx,c=a.isASN1HEX;this.x=this.y=this.g=this.q=this.p=null;this.type="DSA";this.isPublic=this.isPrivate=!1;this.setPrivate=function(a,b,c,l,m){this.isPrivate=!0;this.p=a;this.q=b;this.g=c;this.y=l;this.x=m};this.setPrivateHex=function(a,b,c,l,m){a=new BigInteger(a,16);b=new BigInteger(b,16);c=new BigInteger(c,16);l="string"===typeof l&&1<l.length?new BigInteger(l,16):null;m=new BigInteger(m,16);this.setPrivate(a,b,c,l,m)};this.setPublic=function(a,
b,c,l){this.isPublic=!0;this.p=a;this.q=b;this.g=c;this.y=l;this.x=null};this.setPublicHex=function(a,b,c,l){a=new BigInteger(a,16);b=new BigInteger(b,16);c=new BigInteger(c,16);l=new BigInteger(l,16);this.setPublic(a,b,c,l)};this.signWithMessageHash=function(a){var b=this.p,c=this.q,d=this.g,m=this.x,e=KJUR.crypto.Util.getRandomBigIntegerMinToMax(BigInteger.ONE.add(BigInteger.ONE),c.subtract(BigInteger.ONE));a=a.substr(0,c.bitLength()/4);a=new BigInteger(a,16);b=d.modPow(e,b).mod(c);c=e.modInverse(c).multiply(a.add(m.multiply(b))).mod(c);
return KJUR.asn1.ASN1Util.jsonToASN1HEX({seq:[{"int":{bigint:b}},{"int":{bigint:c}}]})};this.verifyWithMessageHash=function(a,b){var c=this.p,d=this.q,m=this.g,e=this.y,h=this.parseASN1Signature(b);b=h[0];h=h[1];a=a.substr(0,d.bitLength()/4);a=new BigInteger(a,16);if(0<BigInteger.ZERO.compareTo(b)||0<b.compareTo(d))throw"invalid DSA signature";if(0<=BigInteger.ZERO.compareTo(h)||0<h.compareTo(d))throw"invalid DSA signature";h=h.modInverse(d);a=a.multiply(h).mod(d);h=b.multiply(h).mod(d);return 0==
m.modPow(a,c).multiply(e.modPow(h,c)).mod(c).mod(d).compareTo(b)};this.parseASN1Signature=function(a){try{var c=new BigInteger(b(a,0,[0],"02"),16),d=new BigInteger(b(a,0,[1],"02"),16);return[c,d]}catch(l){throw Error("malformed ASN.1 DSA signature");}};this.readPKCS5PrvKeyHex=function(a){if(!1===c(a))throw Error("not ASN.1 hex string");try{var d=b(a,0,[1],"02");var k=b(a,0,[2],"02");var l=b(a,0,[3],"02");var m=b(a,0,[4],"02");var e=b(a,0,[5],"02")}catch(h){throw Error("malformed PKCS#1/5 plain DSA private key");
}this.setPrivateHex(d,k,l,m,e)};this.readPKCS8PrvKeyHex=function(a){if(!1===c(a))throw Error("not ASN.1 hex string");try{var d=b(a,0,[1,1,0],"02");var k=b(a,0,[1,1,1],"02");var l=b(a,0,[1,1,2],"02");var m=b(a,0,[2,0],"02")}catch(e){throw Error("malformed PKCS#8 plain DSA private key");}this.setPrivateHex(d,k,l,null,m)};this.readPKCS8PubKeyHex=function(a){if(!1===c(a))throw Error("not ASN.1 hex string");try{var d=b(a,0,[0,1,0],"02");var k=b(a,0,[0,1,1],"02");var l=b(a,0,[0,1,2],"02");var m=b(a,0,[1,
0],"02")}catch(e){throw Error("malformed PKCS#8 DSA public key");}this.setPublicHex(d,k,l,m)};this.readCertPubKeyHex=function(a,f){if(!1===c(a))throw Error("not ASN.1 hex string");try{var d=b(a,0,[0,5,0,1,0],"02");var l=b(a,0,[0,5,0,1,1],"02");var m=b(a,0,[0,5,0,1,2],"02");var e=b(a,0,[0,5,1,0],"02")}catch(h){throw Error("malformed X.509 certificate DSA public key");}this.setPublicHex(d,l,m,e)}};
var KEYUTIL=function(){var a=function(a,c,d){return b(CryptoJS.AES,a,c,d)},b=function(a,b,c,d){b=CryptoJS.enc.Hex.parse(b);c=CryptoJS.enc.Hex.parse(c);d=CryptoJS.enc.Hex.parse(d);var e={};e.key=c;e.iv=d;e.ciphertext=b;a=a.decrypt(e,c,{iv:d});return CryptoJS.enc.Hex.stringify(a)},c=function(a,b,c){return d(CryptoJS.AES,a,b,c)},d=function(a,b,c,d){b=CryptoJS.enc.Hex.parse(b);c=CryptoJS.enc.Hex.parse(c);d=CryptoJS.enc.Hex.parse(d);a=a.encrypt(b,c,{iv:d});a=CryptoJS.enc.Hex.parse(a.toString());return CryptoJS.enc.Base64.stringify(a)},
f={"AES-256-CBC":{proc:a,eproc:c,keylen:32,ivlen:16},"AES-192-CBC":{proc:a,eproc:c,keylen:24,ivlen:16},"AES-128-CBC":{proc:a,eproc:c,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(a,c,d){return b(CryptoJS.TripleDES,a,c,d)},eproc:function(a,b,c){return d(CryptoJS.TripleDES,a,b,c)},keylen:24,ivlen:8},"DES-CBC":{proc:function(a,c,d){return b(CryptoJS.DES,a,c,d)},eproc:function(a,b,c){return d(CryptoJS.DES,a,b,c)},keylen:8,ivlen:8}},k=function(a){var b={},c=a.match(/DEK-Info: ([^,]+),([0-9A-Fa-f]+)/m);
c&&(b.cipher=c[1],b.ivsalt=c[2]);if(c=a.match(/-----BEGIN ([A-Z]+) PRIVATE KEY-----/))b.type=c[1];c=-1;var e=0;-1!=a.indexOf("\r\n\r\n")&&(c=a.indexOf("\r\n\r\n"),e=2);-1!=a.indexOf("\n\n")&&(c=a.indexOf("\n\n"),e=1);var d=a.indexOf("-----END");-1!=c&&-1!=d&&(a=a.substring(c+2*e,d-e),a=a.replace(/\s+/g,""),b.data=a);return b},l=function(a,b,c){c=c.substring(0,16);c=CryptoJS.enc.Hex.parse(c);var e=CryptoJS.enc.Utf8.parse(b),d=f[a].keylen+f[a].ivlen;b="";for(var h=null;;){var m=CryptoJS.algo.MD5.create();
null!=h&&m.update(h);m.update(e);m.update(c);h=m.finalize();b+=CryptoJS.enc.Hex.stringify(h);if(b.length>=2*d)break}c={};c.keyhex=b.substr(0,2*f[a].keylen);c.ivhex=b.substr(2*f[a].keylen,2*f[a].ivlen);return c},m=function(a,b,c,d){a=CryptoJS.enc.Base64.parse(a);a=CryptoJS.enc.Hex.stringify(a);return(0,f[b].proc)(a,c,d)};return{version:"1.0.0",parsePKCS5PEM:function(a){return k(a)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(a,b,c){return l(a,b,c)},decryptKeyB64:function(a,b,c,d){return m(a,b,c,
d)},getDecryptedKeyHex:function(a,b){var c=k(a);a=c.cipher;var e=c.ivsalt;c=c.data;b=l(a,b,e).keyhex;return m(c,a,b,e)},getEncryptedPKCS5PEMFromPrvKeyHex:function(a,b,c,d,m){if("undefined"==typeof d||null==d)d="AES-256-CBC";if("undefined"==typeof f[d])throw Error("KEYUTIL unsupported algorithm: "+d);if("undefined"==typeof m||null==m)m=CryptoJS.lib.WordArray.random(f[d].ivlen),m=CryptoJS.enc.Hex.stringify(m).toUpperCase();c=l(d,c,m).keyhex;b=(0,f[d].eproc)(b,c,m).replace(/(.{64})/g,"$1\r\n");d="-----BEGIN "+
a+" PRIVATE KEY-----\r\nProc-Type: 4,ENCRYPTED\r\nDEK-Info: "+(d+","+m+"\r\n");d+="\r\n";d+=b;return d+("\r\n-----END "+a+" PRIVATE KEY-----\r\n")},parseHexOfEncryptedPKCS8:function(a){var b=ASN1HEX,c=b.getChildIdx,e=b.getV;b={};var d=c(a,0);if(2!=d.length)throw Error("malformed format: SEQUENCE(0).items != 2: "+d.length);b.ciphertext=e(a,d[1]);var m=c(a,d[0]);if(2!=m.length)throw Error("malformed format: SEQUENCE(0.0).items != 2: "+m.length);if("2a864886f70d01050d"!=e(a,m[0]))throw Error("this only supports pkcs5PBES2");
d=c(a,m[1]);if(2!=m.length)throw Error("malformed format: SEQUENCE(0.0.1).items != 2: "+d.length);m=c(a,d[1]);if(2!=m.length)throw Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+m.length);if("2a864886f70d0307"!=e(a,m[0]))throw"this only supports TripleDES";b.encryptionSchemeAlg="TripleDES";b.encryptionSchemeIV=e(a,m[1]);d=c(a,d[0]);if(2!=d.length)throw Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+d.length);if("2a864886f70d01050c"!=e(a,d[0]))throw Error("this only supports pkcs5PBKDF2");
c=c(a,d[1]);if(2>c.length)throw Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+c.length);b.pbkdf2Salt=e(a,c[0]);a=e(a,c[1]);try{b.pbkdf2Iter=parseInt(a,16)}catch(r){throw Error("malformed format pbkdf2Iter: "+a);}return b},getPBKDF2KeyHexFromParam:function(a,b){var c=CryptoJS.enc.Hex.parse(a.pbkdf2Salt);a=CryptoJS.PBKDF2(b,c,{keySize:6,iterations:a.pbkdf2Iter});return CryptoJS.enc.Hex.stringify(a)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(a,b){a=pemtohex(a,"ENCRYPTED PRIVATE KEY");
a=this.parseHexOfEncryptedPKCS8(a);var c=KEYUTIL.getPBKDF2KeyHexFromParam(a,b);b={};b.ciphertext=CryptoJS.enc.Hex.parse(a.ciphertext);c=CryptoJS.enc.Hex.parse(c);a=CryptoJS.enc.Hex.parse(a.encryptionSchemeIV);a=CryptoJS.TripleDES.decrypt(b,c,{iv:a});return CryptoJS.enc.Hex.stringify(a)},getKeyFromEncryptedPKCS8PEM:function(a,b){a=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b);return this.getKeyFromPlainPrivatePKCS8Hex(a)},parsePlainPrivatePKCS8Hex:function(a){var b=ASN1HEX,c=b.getChildIdx,e=b.getV,
d={algparam:null};if("30"!=a.substr(0,2))throw Error("malformed plain PKCS8 private key(code:001)");var m=c(a,0);if(3>m.length)throw Error("malformed plain PKCS8 private key(code:002)");if("30"!=a.substr(m[1],2))throw Error("malformed PKCS8 private key(code:003)");c=c(a,m[1]);if(2!=c.length)throw Error("malformed PKCS8 private key(code:004)");if("06"!=a.substr(c[0],2))throw Error("malformed PKCS8 private key(code:005)");d.algoid=e(a,c[0]);"06"==a.substr(c[1],2)&&(d.algparam=e(a,c[1]));if("04"!=a.substr(m[2],
2))throw Error("malformed PKCS8 private key(code:006)");d.keyidx=b.getVidx(a,m[2]);return d},getKeyFromPlainPrivatePKCS8PEM:function(a){a=pemtohex(a,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(a)},getKeyFromPlainPrivatePKCS8Hex:function(a){var b=this.parsePlainPrivatePKCS8Hex(a);if("2a864886f70d010101"==b.algoid)b=new RSAKey;else if("2a8648ce380401"==b.algoid)b=new KJUR.crypto.DSA;else if("2a8648ce3d0201"==b.algoid)b=new KJUR.crypto.ECDSA;else throw Error("unsupported private key algorithm");
b.readPKCS8PrvKeyHex(a);return b},_getKeyFromPublicPKCS8Hex:function(a){var b=ASN1HEX.getVbyList(a,0,[0,0],"06");if("2a864886f70d010101"===b)b=new RSAKey;else if("2a8648ce380401"===b)b=new KJUR.crypto.DSA;else if("2a8648ce3d0201"===b)b=new KJUR.crypto.ECDSA;else throw Error("unsupported PKCS#8 public key hex");b.readPKCS8PubKeyHex(a);return b},parsePublicRawRSAKeyHex:function(a){var b=ASN1HEX,c=b.getChildIdx;b=b.getV;var e={};if("30"!=a.substr(0,2))throw Error("malformed RSA key(code:001)");c=c(a,
0);if(2!=c.length)throw Error("malformed RSA key(code:002)");if("02"!=a.substr(c[0],2))throw Error("malformed RSA key(code:003)");e.n=b(a,c[0]);if("02"!=a.substr(c[1],2))throw Error("malformed RSA key(code:004)");e.e=b(a,c[1]);return e},parsePublicPKCS8Hex:function(a){var b=ASN1HEX,c=b.getChildIdx,e=b.getV,d={algparam:null},m=c(a,0);if(2!=m.length)throw Error("outer DERSequence shall have 2 elements: "+m.length);var f=m[0];if("30"!=a.substr(f,2))throw Error("malformed PKCS8 public key(code:001)");
c=c(a,f);if(2!=c.length)throw Error("malformed PKCS8 public key(code:002)");if("06"!=a.substr(c[0],2))throw Error("malformed PKCS8 public key(code:003)");d.algoid=e(a,c[0]);"06"==a.substr(c[1],2)?d.algparam=e(a,c[1]):"30"==a.substr(c[1],2)&&(d.algparam={},d.algparam.p=b.getVbyList(a,c[1],[0],"02"),d.algparam.q=b.getVbyList(a,c[1],[1],"02"),d.algparam.g=b.getVbyList(a,c[1],[2],"02"));if("03"!=a.substr(m[1],2))throw Error("malformed PKCS8 public key(code:004)");d.key=e(a,m[1]).substr(2);return d}}}();
KEYUTIL.getKey=function(a,b,c){var d=ASN1HEX,f=d.getChildIdx;d=d.getVbyList;var k=KJUR.crypto,l=k.ECDSA;k=k.DSA;var m=pemtohex,e=KEYUTIL;if("undefined"!=typeof RSAKey&&a instanceof RSAKey||"undefined"!=typeof l&&a instanceof l||"undefined"!=typeof k&&a instanceof k)return a;if(void 0!==a.curve&&void 0!==a.xy&&void 0===a.d)return new l({pub:a.xy,curve:a.curve});if(void 0!==a.curve&&void 0!==a.d)return new l({prv:a.d,curve:a.curve});if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d)return k=
new RSAKey,k.setPublic(a.n,a.e),k;if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.co&&void 0===a.qi)return k=new RSAKey,k.setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),k;if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0===a.p)return k=new RSAKey,k.setPrivate(a.n,a.e,a.d),k;if(void 0!==a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0===a.x)return k=new k,k.setPublic(a.p,a.q,a.g,a.y),k;if(void 0!==
a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0!==a.x)return k=new k,k.setPrivate(a.p,a.q,a.g,a.y,a.x),k;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d)return k=new RSAKey,k.setPublic(b64utohex(a.n),b64utohex(a.e)),k;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.qi)return k=new RSAKey,k.setPrivateEx(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d),b64utohex(a.p),b64utohex(a.q),b64utohex(a.dp),b64utohex(a.dq),
b64utohex(a.qi)),k;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d)return k=new RSAKey,k.setPrivate(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d)),k;if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0===a.d)return d=new l({curve:a.crv}),l=d.ecparams.keycharlen,k=("0000000000"+b64utohex(a.x)).slice(-l),b=("0000000000"+b64utohex(a.y)).slice(-l),d.setPublicKeyHex("04"+k+b),d;if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0!==a.d)return d=new l({curve:a.crv}),
l=d.ecparams.keycharlen,k=("0000000000"+b64utohex(a.x)).slice(-l),b=("0000000000"+b64utohex(a.y)).slice(-l),k="04"+k+b,a=("0000000000"+b64utohex(a.d)).slice(-l),d.setPublicKeyHex(k),d.setPrivateKeyHex(a),d;if("pkcs5prv"===c){d=f(a,0);if(9===d.length)k=new RSAKey,k.readPKCS5PrvKeyHex(a);else if(6===d.length)k=new k,k.readPKCS5PrvKeyHex(a);else if(2<d.length&&"04"===a.substr(d[1],2))k=new l,k.readPKCS5PrvKeyHex(a);else throw Error("unsupported PKCS#1/5 hexadecimal key");return k}if("pkcs8prv"===c)return k=
e.getKeyFromPlainPrivatePKCS8Hex(a);if("pkcs8pub"===c)return e._getKeyFromPublicPKCS8Hex(a);if("x509pub"===c)return X509.getPublicKeyFromCertHex(a);if(-1!=a.indexOf("-END CERTIFICATE-",0)||-1!=a.indexOf("-END X509 CERTIFICATE-",0)||-1!=a.indexOf("-END TRUSTED CERTIFICATE-",0))return X509.getPublicKeyFromCertPEM(a);if(-1!=a.indexOf("-END PUBLIC KEY-"))return a=pemtohex(a,"PUBLIC KEY"),e._getKeyFromPublicPKCS8Hex(a);if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&&-1==a.indexOf("4,ENCRYPTED"))return a=m(a,
"RSA PRIVATE KEY"),e.getKey(a,null,"pkcs5prv");if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&&-1==a.indexOf("4,ENCRYPTED"))return a=m(a,"DSA PRIVATE KEY"),l=d(a,0,[1],"02"),b=d(a,0,[2],"02"),c=d(a,0,[3],"02"),f=d(a,0,[4],"02"),a=d(a,0,[5],"02"),k=new k,k.setPrivate(new BigInteger(l,16),new BigInteger(b,16),new BigInteger(c,16),new BigInteger(f,16),new BigInteger(a,16)),k;if(-1!=a.indexOf("-END EC PRIVATE KEY-")&&-1==a.indexOf("4,ENCRYPTED"))return a=m(a,"EC PRIVATE KEY"),e.getKey(a,null,"pkcs5prv");if(-1!=
a.indexOf("-END PRIVATE KEY-"))return e.getKeyFromPlainPrivatePKCS8PEM(a);if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED"))return a=e.getDecryptedKeyHex(a,b),d=new RSAKey,d.readPKCS5PrvKeyHex(a),d;if(-1!=a.indexOf("-END EC PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED")){a=e.getDecryptedKeyHex(a,b);k=d(a,0,[1],"04");b=d(a,0,[2,0],"06");a=d(a,0,[3,0],"03").substr(2);if(void 0!==KJUR.crypto.OID.oidhex2name[b])d=KJUR.crypto.OID.oidhex2name[b];else throw Error("undefined OID(hex) in KJUR.crypto.OID: "+
b);d=new l({curve:d});d.setPublicKeyHex(a);d.setPrivateKeyHex(k);d.isPublic=!1;return d}if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED"))return a=e.getDecryptedKeyHex(a,b),l=d(a,0,[1],"02"),b=d(a,0,[2],"02"),c=d(a,0,[3],"02"),f=d(a,0,[4],"02"),a=d(a,0,[5],"02"),k=new k,k.setPrivate(new BigInteger(l,16),new BigInteger(b,16),new BigInteger(c,16),new BigInteger(f,16),new BigInteger(a,16)),k;if(-1!=a.indexOf("-END ENCRYPTED PRIVATE KEY-"))return e.getKeyFromEncryptedPKCS8PEM(a,
b);throw Error("not supported argument");};
KEYUTIL.generateKeypair=function(a,b){if("RSA"==a){a=new RSAKey;a.generate(b,"10001");a.isPrivate=!0;a.isPublic=!0;b=new RSAKey;var c=a.n.toString(16),d=a.e.toString(16);b.setPublic(c,d);b.isPrivate=!1;b.isPublic=!0;c={};c.prvKeyObj=a;c.pubKeyObj=b;return c}if("EC"==a)return c=(new KJUR.crypto.ECDSA({curve:b})).generateKeyPairHex(),a=new KJUR.crypto.ECDSA({curve:b}),a.setPublicKeyHex(c.ecpubhex),a.setPrivateKeyHex(c.ecprvhex),a.isPrivate=!0,a.isPublic=!1,b=new KJUR.crypto.ECDSA({curve:b}),b.setPublicKeyHex(c.ecpubhex),
b.isPrivate=!1,b.isPublic=!0,c={},c.prvKeyObj=a,c.pubKeyObj=b,c;throw Error("unknown algorithm: "+a);};
KEYUTIL.getPEM=function(a,b,c,d,f,k){function l(a){return p({seq:[{"int":0},{"int":{bigint:a.n}},{"int":a.e},{"int":{bigint:a.d}},{"int":{bigint:a.p}},{"int":{bigint:a.q}},{"int":{bigint:a.dmp1}},{"int":{bigint:a.dmq1}},{"int":{bigint:a.coeff}}]})}function m(a){return p({seq:[{"int":1},{octstr:{hex:a.prvKeyHex}},{tag:["a0",!0,{oid:{name:a.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]})}function e(a){return p({seq:[{"int":0},{"int":{bigint:a.p}},{"int":{bigint:a.q}},{"int":{bigint:a.g}},
{"int":{bigint:a.y}},{"int":{bigint:a.x}}]})}var h=KJUR,n=h.asn1,g=n.DERObjectIdentifier;f=n.DERInteger;var p=n.ASN1Util.newObject;n=n.x509.SubjectPublicKeyInfo;var q=h.crypto;h=q.DSA;q=q.ECDSA;if((void 0!==RSAKey&&a instanceof RSAKey||void 0!==h&&a instanceof h||void 0!==q&&a instanceof q)&&1==a.isPublic&&(void 0===b||"PKCS8PUB"==b))return a=new n(a),a=a.tohex(),hextopem(a,"PUBLIC KEY");if("PKCS1PRV"==b&&void 0!==RSAKey&&a instanceof RSAKey&&(void 0===c||null==c)&&1==a.isPrivate)return a=l(a),a=
a.tohex(),hextopem(a,"RSA PRIVATE KEY");if("PKCS1PRV"==b&&void 0!==q&&a instanceof q&&(void 0===c||null==c)&&1==a.isPrivate)return c=(new g({name:a.curveName})).tohex(),a=m(a).tohex(),c=""+hextopem(c,"EC PARAMETERS"),c+=hextopem(a,"EC PRIVATE KEY");if("PKCS1PRV"==b&&void 0!==h&&a instanceof h&&(void 0===c||null==c)&&1==a.isPrivate)return a=e(a),a=a.tohex(),hextopem(a,"DSA PRIVATE KEY");if("PKCS5PRV"==b&&void 0!==RSAKey&&a instanceof RSAKey&&void 0!==c&&null!=c&&1==a.isPrivate)return a=l(a),a=a.tohex(),
void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",a,c,d,k);if("PKCS5PRV"==b&&void 0!==q&&a instanceof q&&void 0!==c&&null!=c&&1==a.isPrivate)return a=m(a),a=a.tohex(),void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",a,c,d,k);if("PKCS5PRV"==b&&void 0!==h&&a instanceof h&&void 0!==c&&null!=c&&1==a.isPrivate)return a=e(a),a=a.tohex(),void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",a,c,d,k);d=function(a,b){var c=CryptoJS.lib.WordArray.random(8),
e=CryptoJS.lib.WordArray.random(8);b=CryptoJS.PBKDF2(b,c,{keySize:6,iterations:100});a=CryptoJS.enc.Hex.parse(a);a=CryptoJS.TripleDES.encrypt(a,b,{iv:e})+"";c=CryptoJS.enc.Hex.stringify(c);e=CryptoJS.enc.Hex.stringify(e);return(new p({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:c}},{"int":100}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:e}}]}]}]},{octstr:{hex:a}}]})).tohex()};if("PKCS8PRV"==b&&void 0!=RSAKey&&a instanceof RSAKey&&1==a.isPrivate){k=
l(a);k=k.tohex();a=p({seq:[{"int":0},{seq:[{oid:{name:"rsaEncryption"}},{"null":!0}]},{octstr:{hex:k}}]});a=a.tohex();if(void 0===c||null==c)return hextopem(a,"PRIVATE KEY");a=d(a,c);return hextopem(a,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&void 0!==q&&a instanceof q&&1==a.isPrivate){k={seq:[{"int":1},{octstr:{hex:a.prvKeyHex}}]};"string"==typeof a.pubKeyHex&&k.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]});k=new p(k);k=k.tohex();a=p({seq:[{"int":0},{seq:[{oid:{name:"ecPublicKey"}},
{oid:{name:a.curveName}}]},{octstr:{hex:k}}]});a=a.tohex();if(void 0===c||null==c)return hextopem(a,"PRIVATE KEY");a=d(a,c);return hextopem(a,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&void 0!==h&&a instanceof h&&1==a.isPrivate){k=new f({bigint:a.x});k=k.tohex();a=p({seq:[{"int":0},{seq:[{oid:{name:"dsa"}},{seq:[{"int":{bigint:a.p}},{"int":{bigint:a.q}},{"int":{bigint:a.g}}]}]},{octstr:{hex:k}}]});a=a.tohex();if(void 0===c||null==c)return hextopem(a,"PRIVATE KEY");a=d(a,c);return hextopem(a,"ENCRYPTED PRIVATE KEY")}throw Error("unsupported object nor format");
};KEYUTIL.getKeyFromCSRPEM=function(a){a=pemtohex(a,"CERTIFICATE REQUEST");return KEYUTIL.getKeyFromCSRHex(a)};KEYUTIL.getKeyFromCSRHex=function(a){a=KEYUTIL.parseCSRHex(a);return KEYUTIL.getKey(a.p8pubkeyhex,null,"pkcs8pub")};
KEYUTIL.parseCSRHex=function(a){var b=ASN1HEX,c=b.getChildIdx;b=b.getTLV;var d={};if("30"!=a.substr(0,2))throw Error("malformed CSR(code:001)");var f=c(a,0);if(1>f.length)throw Error("malformed CSR(code:002)");if("30"!=a.substr(f[0],2))throw Error("malformed CSR(code:003)");c=c(a,f[0]);if(3>c.length)throw Error("malformed CSR(code:004)");d.p8pubkeyhex=b(a,c[2]);return d};
KEYUTIL.getKeyID=function(a){var b=KEYUTIL,c=ASN1HEX;"string"===typeof a&&-1!=a.indexOf("BEGIN ")&&(a=b.getKey(a));a=pemtohex(b.getPEM(a));b=c.getIdxbyList(a,0,[1]);c=c.getV(a,b).substring(2);return KJUR.crypto.Util.hashHex(c,"sha1")};
KEYUTIL.getJWK=function(a,b,c,d,f){var k={},l,m=KJUR.crypto.Util.hashHex;if("string"==typeof a){var e=KEYUTIL.getKey(a);-1!=a.indexOf("CERTIFICATE")&&(l=pemtohex(a))}else if("object"==typeof a)a instanceof X509?(e=a.getPublicKey(),l=a.hex):e=a;else throw Error("unsupported keyinfo type");if(e instanceof RSAKey&&e.isPrivate)k.kty="RSA",k.n=hextob64u(e.n.toString(16)),k.e=hextob64u(e.e.toString(16)),k.d=hextob64u(e.d.toString(16)),k.p=hextob64u(e.p.toString(16)),k.q=hextob64u(e.q.toString(16)),k.dp=
hextob64u(e.dmp1.toString(16)),k.dq=hextob64u(e.dmq1.toString(16)),k.qi=hextob64u(e.coeff.toString(16));else if(e instanceof RSAKey&&e.isPublic)k.kty="RSA",k.n=hextob64u(e.n.toString(16)),k.e=hextob64u(e.e.toString(16));else if(e instanceof KJUR.crypto.ECDSA&&e.isPrivate){a=e.getShortNISTPCurveName();if("P-256"!==a&&"P-384"!==a&&"P-521"!==a)throw Error("unsupported curve name for JWT: "+a);var h=e.getPublicKeyXYHex();k.kty="EC";k.crv=a;k.x=hextob64u(h.x);k.y=hextob64u(h.y);k.d=hextob64u(e.prvKeyHex)}else if(e instanceof
KJUR.crypto.ECDSA&&e.isPublic){a=e.getShortNISTPCurveName();if("P-256"!==a&&"P-384"!==a&&"P-521"!==a)throw Error("unsupported curve name for JWT: "+a);h=e.getPublicKeyXYHex();k.kty="EC";k.crv=a;k.x=hextob64u(h.x);k.y=hextob64u(h.y)}if(void 0==k.kty)throw Error("unsupported keyinfo");e.isPrivate||1==b||(k.kid=KJUR.jws.JWS.getJWKthumbprint(k));void 0!=l&&1!=c&&(k.x5c=[hex2b64(l)]);void 0!=l&&1!=d&&(k.x5t=b64tob64u(hex2b64(m(l,"sha1"))));void 0!=l&&1!=f&&(k["x5t#S256"]=b64tob64u(hex2b64(m(l,"sha256"))));
return k};KEYUTIL.getJWKFromKey=function(a){return KEYUTIL.getJWK(a,!0,!0,!0,!0)};RSAKey.getPosArrayOfChildrenFromHex=function(a){return ASN1HEX.getChildIdx(a,0)};RSAKey.getHexValueArrayOfChildrenFromHex=function(a){var b=ASN1HEX.getV,c=RSAKey.getPosArrayOfChildrenFromHex(a),d=b(a,c[0]),f=b(a,c[1]),k=b(a,c[2]),l=b(a,c[3]),m=b(a,c[4]),e=b(a,c[5]),h=b(a,c[6]),n=b(a,c[7]);a=b(a,c[8]);c=[];c.push(d,f,k,l,m,e,h,n,a);return c};
RSAKey.prototype.readPrivateKeyFromPEMString=function(a){a=pemtohex(a);a=RSAKey.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])};RSAKey.prototype.readPKCS5PrvKeyHex=function(a){a=RSAKey.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])};
RSAKey.prototype.readPKCS8PrvKeyHex=function(a){var b=ASN1HEX,c=b.getVbyListEx;if(!1===b.isASN1HEX(a))throw Error("not ASN.1 hex string");try{var d=c(a,0,[2,0,1],"02");var f=c(a,0,[2,0,2],"02");var k=c(a,0,[2,0,3],"02");var l=c(a,0,[2,0,4],"02");var m=c(a,0,[2,0,5],"02");var e=c(a,0,[2,0,6],"02");var h=c(a,0,[2,0,7],"02");var n=c(a,0,[2,0,8],"02")}catch(g){throw Error("malformed PKCS#8 plain RSA private key");}this.setPrivateEx(d,f,k,l,m,e,h,n)};
RSAKey.prototype.readPKCS5PubKeyHex=function(a){var b=ASN1HEX,c=b.getV;if(!1===b.isASN1HEX(a))throw Error("keyHex is not ASN.1 hex string");var d=b.getChildIdx(a,0);if(2!==d.length||"02"!==a.substr(d[0],2)||"02"!==a.substr(d[1],2))throw Error("wrong hex for PKCS#5 public key");b=c(a,d[0]);a=c(a,d[1]);this.setPublic(b,a)};
RSAKey.prototype.readPKCS8PubKeyHex=function(a){var b=ASN1HEX;if(!1===b.isASN1HEX(a))throw Error("not ASN.1 hex string");if("06092a864886f70d010101"!==b.getTLVbyListEx(a,0,[0,0]))throw Error("not PKCS8 RSA public key");a=b.getTLVbyListEx(a,0,[1,0]);this.readPKCS5PubKeyHex(a)};RSAKey.prototype.readCertPubKeyHex=function(a,b){b=new X509;b.readCertHex(a);a=b.getPublicKeyHex();this.readPKCS8PubKeyHex(a)};var _RE_HEXDECONLY=/[^0-9a-f]/gi;
function _rsasign_getHexPaddedDigestInfoForString(a,b,c){a=KJUR.crypto.Util.hashString(a,c);return KJUR.crypto.Util.getPaddedDigestInfoHex(a,c,b)}function _zeroPaddingOfSignature(a,b){var c="";b=b/4-a.length;for(var d=0;d<b;d++)c+="0";return c+a}RSAKey.prototype.sign=function(a,b){a=KJUR.crypto.Util.hashString(a,b);return this.signWithMessageHash(a,b)};
RSAKey.prototype.signWithMessageHash=function(a,b){a=KJUR.crypto.Util.getPaddedDigestInfoHex(a,b,this.n.bitLength());a=parseBigInt(a,16);a=this.doPrivate(a).toString(16);return _zeroPaddingOfSignature(a,this.n.bitLength())};function pss_mgf1_str(a,b,c){for(var d="",f=0;d.length<b;)d+=hextorstr(c(rstrtohex(a+String.fromCharCode.apply(String,[(f&4278190080)>>24,(f&16711680)>>16,(f&65280)>>8,f&255])))),f+=1;return d}
RSAKey.prototype.signPSS=function(a,b,c){a=KJUR.crypto.Util.hashHex(rstrtohex(a),b);void 0===c&&(c=-1);return this.signWithMessageHashPSS(a,b,c)};
RSAKey.prototype.signWithMessageHashPSS=function(a,b,c){var d=hextorstr(a);a=d.length;var f=this.n.bitLength()-1,k=Math.ceil(f/8),l=function(a){return KJUR.crypto.Util.hashHex(a,b)};if(-1===c||void 0===c)c=a;else if(-2===c)c=k-a-2;else if(-2>c)throw Error("invalid salt length");if(k<a+c+2)throw Error("data too long");var m="";0<c&&(m=Array(c),(new SecureRandom).nextBytes(m),m=String.fromCharCode.apply(String,m));var e=hextorstr(l(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+d+m))),h=[];for(d=0;d<
k-c-a-2;d+=1)h[d]=0;c=String.fromCharCode.apply(String,h)+"\u0001"+m;l=pss_mgf1_str(e,c.length,l);m=[];for(d=0;d<c.length;d+=1)m[d]=c.charCodeAt(d)^l.charCodeAt(d);m[0]&=~(65280>>8*k-f&255);for(d=0;d<a;d++)m.push(e.charCodeAt(d));m.push(188);return _zeroPaddingOfSignature(this.doPrivate(new BigInteger(m)).toString(16),this.n.bitLength())};function _rsasign_getDecryptSignatureBI(a,b,c){var d=new RSAKey;d.setPublic(b,c);return d.doPublic(a)}
function _rsasign_getHexDigestInfoFromSig(a,b,c){return _rsasign_getDecryptSignatureBI(a,b,c).toString(16).replace(/^1f+00/,"")}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(a){for(var b in KJUR.crypto.Util.DIGESTINFOHEAD){var c=KJUR.crypto.Util.DIGESTINFOHEAD[b],d=c.length;if(a.substring(0,d)==c)return[b,a.substring(d)]}return[]}
RSAKey.prototype.verify=function(a,b){b=b.toLowerCase();if(null==b.match(/^[0-9a-f]+$/))return!1;var c=parseBigInt(b,16);b=this.n.bitLength();if(c.bitLength()>b)return!1;c=this.doPublic(c).toString(16);if(c.length+3!=b/4)return!1;b=c.replace(/^1f+00/,"");c=_rsasign_getAlgNameAndHashFromHexDisgestInfo(b);if(0==c.length)return!1;b=c[1];a=KJUR.crypto.Util.hashString(a,c[0]);return b==a};
RSAKey.prototype.verifyWithMessageHash=function(a,b){if(b.length!=Math.ceil(this.n.bitLength()/4))return!1;b=parseBigInt(b,16);if(b.bitLength()>this.n.bitLength())return 0;b=this.doPublic(b).toString(16).replace(/^1f+00/,"");b=_rsasign_getAlgNameAndHashFromHexDisgestInfo(b);return 0==b.length?!1:b[1]==a};RSAKey.prototype.verifyPSS=function(a,b,c,d){a=KJUR.crypto.Util.hashHex(rstrtohex(a),c);void 0===d&&(d=-1);return this.verifyWithMessageHashPSS(a,b,c,d)};
RSAKey.prototype.verifyWithMessageHashPSS=function(a,b,c,d){if(b.length!=Math.ceil(this.n.bitLength()/4))return!1;var f=new BigInteger(b,16);b=function(a){return KJUR.crypto.Util.hashHex(a,c)};a=hextorstr(a);var k=a.length,l=this.n.bitLength()-1,m=Math.ceil(l/8);if(-1===d||void 0===d)d=k;else if(-2===d)d=m-k-2;else if(-2>d)throw Error("invalid salt length");if(m<k+d+2)throw Error("data too long");var e=this.doPublic(f).toByteArray();for(f=0;f<e.length;f+=1)e[f]&=255;for(;e.length<m;)e.unshift(0);
if(188!==e[m-1])throw Error("encoded message does not end in 0xbc");e=String.fromCharCode.apply(String,e);var h=e.substr(0,m-k-1);e=e.substr(h.length,k);var n=65280>>8*m-l&255;if(0!==(h.charCodeAt(0)&n))throw Error("bits beyond keysize not zero");var g=pss_mgf1_str(e,h.length,b);l=[];for(f=0;f<h.length;f+=1)l[f]=h.charCodeAt(f)^g.charCodeAt(f);l[0]&=~n;k=m-k-d-2;for(f=0;f<k;f+=1)if(0!==l[f])throw Error("leftmost octets not zero");if(1!==l[k])throw Error("0x01 marker not found");return e===hextorstr(b(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+
a+String.fromCharCode.apply(String,l.slice(-d)))))};RSAKey.SALT_LEN_HLEN=-1;RSAKey.SALT_LEN_MAX=-2;RSAKey.SALT_LEN_RECOVER=-2;
function X509(a){var b=ASN1HEX,c=b.getChildIdx,d=b.getV,f=b.parse,k=b.getTLV,l=b.getVbyList,m=b.getVbyListEx,e=b.getTLVbyList,h=b.getTLVbyListEx,n=b.getIdxbyList,g=b.getIdxbyListEx,p=b.getVidx,q=b.getInt,r=b.oidname,v=b.hextooidstr,u=pemtohex,A=Error;try{var x=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(E){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"};this.hex=null;this.foffset=this.version=0;this.aExtInfo=null;this.getVersion=function(){if(null===this.hex||0!==
this.version)return this.version;var a=e(this.hex,0,[0,0]);if("a0"==a.substr(0,2)){a=e(a,0,[0]);a=q(a,0);if(0>a||2<a)throw Error("malformed version field");return this.version=a+1}this.version=1;this.foffset=-1;return 1};this.getSerialNumberHex=function(){return m(this.hex,0,[0,0],"02")};this.getSignatureAlgorithmField=function(){var a=h(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(a)};this.getAlgorithmIdentifierName=function(a){for(var b in x)if(a===x[b])return b;return r(m(a,0,[0],"06"))};
this.getIssuer=function(a,b){return this.getX500Name(this.getIssuerHex(),a,b)};this.getIssuerHex=function(){return e(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return this.getIssuer().str};this.getSubject=function(a,b){return this.getX500Name(this.getSubjectHex(),a,b)};this.getSubjectHex=function(){return e(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return this.getSubject().str};this.getNotBefore=function(){var a=l(this.hex,0,[0,4+this.foffset,
0]);a=a.replace(/(..)/g,"%$1");return a=decodeURIComponent(a)};this.getNotAfter=function(){var a=l(this.hex,0,[0,4+this.foffset,1]);a=a.replace(/(..)/g,"%$1");return a=decodeURIComponent(a)};this.getPublicKeyHex=function(){return this.getSPKI()};this.getSPKI=function(){return e(this.hex,0,[0,6+this.foffset],"30")};this.getSPKIValue=function(){var a=this.getSPKI();return null==a?null:l(a,0,[1],"03",!0)};this.getPublicKeyIdx=function(){return n(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyContentIdx=
function(){var a=this.getPublicKeyIdx();return n(this.hex,a,[1,0],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.getSignatureAlgorithmName=function(){var a=e(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(a)};this.getSignatureValueHex=function(){return l(this.hex,0,[2],"03",!0)};this.verifySignature=function(a){var b=this.getSignatureAlgorithmField(),c=this.getSignatureValueHex(),d=e(this.hex,0,[0],"30");b=new KJUR.crypto.Signature({alg:b});
b.init(a);b.updateHex(d);return b.verify(c)};this.parseExt=function(a){if(void 0===a){a=this.hex;if(3!==this.version)return-1;var e=n(a,0,[0,7,0],"30");e=c(a,e)}else{a=pemtohex(a);e=n(a,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=d(a,e)){this.aExtInfo=[];return}e=n(a,0,[0,3,0,1,0],"30");e=c(a,e);this.hex=a}this.aExtInfo=[];for(var g=0;g<e.length;g++){var m={critical:!1},h=0;3===c(a,e[g]).length&&(m.critical=!0,h=1);m.oid=b.hextooidstr(l(a,e[g],[0],"06"));h=n(a,e[g],[1+h]);m.vidx=p(a,h);this.aExtInfo.push(m)}};
this.getExtInfo=function(a){var b=this.aExtInfo,c=a;a.match(/^[0-9.]+$/)||(c=KJUR.asn1.x509.OID.name2oid(a));if(""!==c)for(a=0;a<b.length;a++)if(b[a].oid===c)return b[a]};this.getCriticalExtV=function(a,b,c){if(void 0!=b)return[b,c];a=this.getExtInfo(a);return void 0==a?[null,null]:[k(this.hex,a.vidx),a.critical]};this.getExtBasicConstraints=function(a,b){if(void 0===a&&void 0===b){var c=this.getExtInfo("basicConstraints");if(void 0===c)return;a=k(this.hex,c.vidx);b=c.critical}c={extname:"basicConstraints"};
b&&(c.critical=!0);if("3000"===a)return c;if("30030101ff"===a)return c.cA=!0,c;if("30060101ff02"===a.substr(0,12))return a=d(a,10),a=parseInt(a,16),c.cA=!0,c.pathLen=a,c;throw Error("hExtV parse error: "+a);};this.getExtNameConstraints=function(a,b){var e=this.getCriticalExtV("nameConstraints",a,b);a=e[0];b=e[1];if(null!=a){e={extname:"nameConstraints"};b&&(e.critical=!0);b=c(a,0);for(var d=0;d<b.length;d++){for(var g=[],m=c(a,b[d]),h=0;h<m.length;h++){var f=k(a,m[h]);f=this.getGeneralSubtree(f);
g.push(f)}m=a.substr(b[d],2);"a0"==m?e.permit=g:"a1"==m&&(e.exclude=g)}return e}};this.getGeneralSubtree=function(a){var b=c(a,0),e=b.length;if(1>e||2<e)throw Error("wrong num elements");for(var g=this.getGeneralName(k(a,b[0])),m=1;m<e;m++){var h=a.substr(b[m],2),f=d(a,b[m]);f=parseInt(f,16);"80"==h&&(g.min=f);"81"==h&&(g.max=f)}return g};this.getExtKeyUsage=function(a,b){b=this.getCriticalExtV("keyUsage",a,b);a=b[0];b=b[1];if(null!=a){var c={extname:"keyUsage"};b&&(c.critical=!0);c.names=this.getExtKeyUsageString(a).split(",");
return c}};this.getExtKeyUsageBin=function(a){if(void 0===a){a=this.getExtInfo("keyUsage");if(void 0===a)return"";a=k(this.hex,a.vidx)}if(8!=a.length&&10!=a.length)throw Error("malformed key usage value: "+a);var b="000000000000000"+parseInt(a.substr(6),16).toString(2);8==a.length&&(b=b.slice(-8));10==a.length&&(b=b.slice(-16));b=b.replace(/0+$/,"");""==b&&(b="0");return b};this.getExtKeyUsageString=function(a){a=this.getExtKeyUsageBin(a);for(var b=[],c=0;c<a.length;c++)"1"==a.substr(c,1)&&b.push(X509.KEYUSAGE_NAME[c]);
return b.join(",")};this.getExtSubjectKeyIdentifier=function(a,b){if(void 0===a&&void 0===b){var c=this.getExtInfo("subjectKeyIdentifier");if(void 0===c)return;a=k(this.hex,c.vidx);b=c.critical}c={extname:"subjectKeyIdentifier"};b&&(c.critical=!0);a=d(a,0);c.kid={hex:a};return c};this.getExtAuthorityKeyIdentifier=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("authorityKeyIdentifier");if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e={extname:"authorityKeyIdentifier"};b&&(e.critical=
!0);b=c(a,0);for(var g=0;g<b.length;g++){var m=a.substr(b[g],2);"80"===m&&(e.kid={hex:d(a,b[g])});if("a1"===m){var h=k(a,b[g]);h=this.getGeneralNames(h);e.issuer=h[0].dn}"82"===m&&(e.sn={hex:d(a,b[g])})}return e};this.getExtExtKeyUsage=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e={extname:"extKeyUsage",array:[]};b&&(e.critical=!0);b=c(a,0);for(var g=0;g<b.length;g++)e.array.push(r(d(a,b[g])));return e};this.getExtExtKeyUsageName=
function(){var a=this.getExtInfo("extKeyUsage");if(void 0===a)return a;var b=[];a=k(this.hex,a.vidx);if(""===a)return b;for(var e=c(a,0),g=0;g<e.length;g++)b.push(r(d(a,e[g])));return b};this.getExtSubjectAltName=function(a,b){if(void 0===a&&void 0===b){b=this.getExtInfo("subjectAltName");if(void 0===b)return;a=k(this.hex,b.vidx);b=b.critical}var c={extname:"subjectAltName",array:[]};b&&(c.critical=!0);c.array=this.getGeneralNames(a);return c};this.getExtIssuerAltName=function(a,b){if(void 0===a&&
void 0===b){b=this.getExtInfo("issuerAltName");if(void 0===b)return;a=k(this.hex,b.vidx);b=b.critical}var c={extname:"issuerAltName",array:[]};b&&(c.critical=!0);c.array=this.getGeneralNames(a);return c};this.getGeneralNames=function(a){for(var b=c(a,0),e=[],d=0;d<b.length;d++){var g=this.getGeneralName(k(a,b[d]));void 0!==g&&e.push(g)}return e};this.getGeneralName=function(a){var b=a.substr(0,2),c=d(a,0),e=hextorstr(c);if("81"==b)return{rfc822:e};if("82"==b)return{dns:e};if("86"==b)return{uri:e};
if("87"==b)return{ip:hextoip(c)};if("a4"==b)return{dn:this.getX500Name(c)};if("a0"==b)return{other:this.getOtherName(a)}};this.getExtSubjectAltName2=function(){var a=this.getExtInfo("subjectAltName");if(void 0===a)return a;for(var b=[],e=k(this.hex,a.vidx),g=c(e,0),m=0;m<g.length;m++){var h=e.substr(g[m],2);a=d(e,g[m]);if("81"===h){var f=hextoutf8(a);b.push(["MAIL",f])}"82"===h&&(f=hextoutf8(a),b.push(["DNS",f]));"84"===h&&(f=X509.hex2dn(a,0),b.push(["DN",f]));"86"===h&&(f=hextoutf8(a),b.push(["URI",
f]));"87"===h&&(f=hextoip(a),b.push(["IP",f]))}return b};this.getExtCRLDistributionPoints=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("cRLDistributionPoints");if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e={extname:"cRLDistributionPoints",array:[]};b&&(e.critical=!0);b=c(a,0);for(var d=0;d<b.length;d++){var g=k(a,b[d]);e.array.push(this.getDistributionPoint(g))}return e};this.getDistributionPoint=function(a){for(var b={},e=c(a,0),d=0;d<e.length;d++){var g=a.substr(e[d],
2),m=k(a,e[d]);"a0"==g&&(b.dpname=this.getDistributionPointName(m))}return b};this.getDistributionPointName=function(a){for(var b={},e=c(a,0),d=0;d<e.length;d++){var g=a.substr(e[d],2),m=k(a,e[d]);"a0"==g&&(b.full=this.getGeneralNames(m))}return b};this.getExtCRLDistributionPointsURI=function(){var a=this.getExtCRLDistributionPoints();if(void 0==a)return a;a=a.array;for(var b=[],c=0;c<a.length;c++)try{void 0!=a[c].dpname.full[0].uri&&b.push(a[c].dpname.full[0].uri)}catch(L){}return b};this.getExtAIAInfo=
function(){var a=this.getExtInfo("authorityInfoAccess");if(void 0===a)return a;var b={ocsp:[],caissuer:[]};a=c(this.hex,a.vidx);for(var e=0;e<a.length;e++){var d=l(this.hex,a[e],[0],"06"),g=l(this.hex,a[e],[1],"86");"2b06010505073001"===d&&b.ocsp.push(hextoutf8(g));"2b06010505073002"===d&&b.caissuer.push(hextoutf8(g))}return b};this.getExtAuthorityInfoAccess=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e=
{extname:"authorityInfoAccess",array:[]};b&&(e.critical=!0);b=c(a,0);for(var d=0;d<b.length;d++){var g=m(a,b[d],[0],"06"),h=l(a,b[d],[1],"86");h=hextoutf8(h);if("2b06010505073001"==g)e.array.push({ocsp:h});else if("2b06010505073002"==g)e.array.push({caissuer:h});else throw Error("unknown method: "+g);}return e};this.getExtCertificatePolicies=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("certificatePolicies");if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e={extname:"certificatePolicies",
array:[]};b&&(e.critical=!0);b=c(a,0);for(var d=0;d<b.length;d++){var g=k(a,b[d]);g=this.getPolicyInformation(g);e.array.push(g)}return e};this.getPolicyInformation=function(a){var b={},e=l(a,0,[0],"06");b.policyoid=r(e);e=g(a,0,[1],"30");if(-1!=e){b.array=[];e=c(a,e);for(var d=0;d<e.length;d++){var m=k(a,e[d]);m=this.getPolicyQualifierInfo(m);b.array.push(m)}}return b};this.getOtherName=function(a){var b={},e=c(a,0),d=l(a,e[0],[],"06");a=l(a,e[1],[]);b.oid=r(d);b.value=f(a);return b};this.getPolicyQualifierInfo=
function(a){var b={},c=l(a,0,[0],"06");"2b06010505070201"===c?(a=m(a,0,[1],"16"),b.cps=hextorstr(a)):"2b06010505070202"===c&&(a=e(a,0,[1],"30"),b.unotice=this.getUserNotice(a));return b};this.getUserNotice=function(a){var c=null;try{return c=b.parse(a),this._asn1ToUnotice(c)}catch(G){}};this._asn1ToUnotice=function(a){try{var b={},c=aryval(a,"seq");for(a=0;a<c.length;a++){var e=this._asn1ToNoticeRef(c[a]);void 0!=e&&(b.noticeref=e);var d=this.asn1ToDisplayText(c[a]);void 0!=d&&(b.exptext=d)}if(0<
Object.keys(b).length)return b}catch(J){}};this._asn1ToNoticeRef=function(a){try{var b={},c=aryval(a,"seq");for(a=0;a<c.length;a++){var e=this._asn1ToNoticeNum(c[a]);void 0!=e&&(b.noticenum=e);var d=this.asn1ToDisplayText(c[a]);void 0!=d&&(b.org=d)}if(0<Object.keys(b).length)return b}catch(J){}};this._asn1ToNoticeNum=function(a){try{var b=aryval(a,"seq");a=[];for(var c=0;c<b.length;c++)a.push(parseInt(aryval(b[c],"int.hex"),16));return a}catch(L){}};this.getDisplayText=function(a){var b={};b.type=
{"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[a.substr(0,2)];b.str=hextorstr(d(a,0));return b};this.asn1ToDisplayText=function(a){if(void 0!=a.utf8str)return{type:"utf8",str:a.utf8str.str};if(void 0!=a.ia5str)return{type:"ia5",str:a.ia5str.str};if(void 0!=a.visstr)return{type:"vis",str:a.visstr.str};if(void 0!=a.bmpstr)return{type:"bmp",str:a.bmpstr.str};if(void 0!=a.prnstr)return{type:"prn",str:a.prnstr.str}};this.getExtPolicyMappings=function(a,b){var c=this.getCriticalExtV("policyMappings",a,b);
a=c[0];b=c[1];if(null!=a){c={extname:"policyMappings"};b&&(c.critical=!0);try{var e=f(a).seq;a=[];for(b=0;b<e.length;b++){var d=e[b].seq;a.push([d[0].oid,d[1].oid])}c.array=a}catch(J){throw new A("malformed policyMappings");}return c}};this.getExtPolicyConstraints=function(a,b){var c=this.getCriticalExtV("policyConstraints",a,b);a=c[0];b=c[1];if(null!=a){c={extname:"policyConstraints"};b&&(c.critical=!0);a=f(a);try{var e=a.seq;for(a=0;a<e.length;a++){var d=e[a].tag;0==d.explicit&&("80"==d.tag&&(c.reqexp=
parseInt(d.hex,16)),"81"==d.tag&&(c.inhibit=parseInt(d.hex,16)))}}catch(J){return new A("malformed policyConstraints value")}return c}};this.getExtInhibitAnyPolicy=function(a,b){var c=this.getCriticalExtV("inhibitAnyPolicy",a,b);a=c[0];b=c[1];if(null!=a){c={extname:"inhibitAnyPolicy"};b&&(c.critical=!0);a=q(a,0);if(-1==a)return new A("wrong value");c.skip=a;return c}};this.getExtCRLNumber=function(a,b){var c={extname:"cRLNumber"};b&&(c.critical=!0);if("02"==a.substr(0,2))return c.num={hex:d(a,0)},
c;throw new A("hExtV parse error: "+a);};this.getExtCRLReason=function(a,b){var c={extname:"cRLReason"};b&&(c.critical=!0);if("0a"==a.substr(0,2))return c.code=parseInt(d(a,0),16),c;throw Error("hExtV parse error: "+a);};this.getExtOcspNonce=function(a,b){var c={extname:"ocspNonce"};b&&(c.critical=!0);a=d(a,0);c.hex=a;return c};this.getExtOcspNoCheck=function(a,b){a={extname:"ocspNoCheck"};b&&(a.critical=!0);return a};this.getExtAdobeTimeStamp=function(a,b){if(void 0===a&&void 0===b){var e=this.getExtInfo("adobeTimeStamp");
if(void 0===e)return;a=k(this.hex,e.vidx);b=e.critical}e={extname:"adobeTimeStamp"};b&&(e.critical=!0);b=c(a,0);if(1<b.length){var d=k(a,b[1]);d=this.getGeneralName(d);void 0!=d.uri&&(e.uri=d.uri)}2<b.length&&(a=k(a,b[2]),"0101ff"==a&&(e.reqauth=!0),"010100"==a&&(e.reqauth=!1));return e};var B=function(a){var b={};try{var c=KJUR.asn1.x509.OID.name2oid(a.seq[0].oid);b.type=KJUR.asn1.x509.OID.oid2atype(c);var e=a.seq[1];if(void 0!=e.utf8str)b.ds="utf8",b.value=e.utf8str.str;else if(void 0!=e.numstr)b.ds=
"num",b.value=e.numstr.str;else if(void 0!=e.telstr)b.ds="tel",b.value=e.telstr.str;else if(void 0!=e.prnstr)b.ds="prn",b.value=e.prnstr.str;else if(void 0!=e.ia5str)b.ds="ia5",b.value=e.ia5str.str;else if(void 0!=e.visstr)b.ds="vis",b.value=e.visstr.str;else if(void 0!=e.bmpstr)b.ds="bmp",b.value=e.bmpstr.str;else throw"error";return b}catch(K){throw new Erorr("improper ASN.1 parsed AttrTypeAndValue");}},I=function(a){try{return a.set.map(function(a){return B(a)})}catch(C){throw Error("improper ASN.1 parsed RDN: "+
C);}},D=function(a){try{return a.seq.map(function(a){return I(a)})}catch(C){throw Error("improper ASN.1 parsed X500Name: "+C);}};this.getX500NameRule=function(a){for(var b=null,c=[],e=0;e<a.length;e++)for(var d=a[e],g=0;g<d.length;g++)c.push(d[g]);for(e=0;e<c.length;e++){g=c[e];a=g.ds;d=g.value;g=g.type;if("prn"!=a&&"utf8"!=a&&"ia5"!=a)return"mixed";if("ia5"==a)if("CN"==g&&KJUR.lang.String.isMail(d))continue;else return"mixed";if("C"==g)if("prn"==a)continue;else return"mixed";if(null==b)b=a;else if(b!==
a)return"mixed"}return null==b?"prn":b};this.getAttrTypeAndValue=function(a){a=f(a);return B(a)};this.getRDN=function(a){a=f(a);return I(a)};this.getX500NameArray=function(a){a=f(a);return D(a)};this.getX500Name=function(a,b,c){var e=this.getX500NameArray(a),d={str:this.dnarraytostr(e)};d.array=e;1==c&&(d.hex=a);1==b&&(d.canon=this.c14nRDNArray(e));return d};this.readCertPEM=function(a){this.readCertHex(u(a))};this.readCertHex=function(a){this.hex=a;this.getVersion();try{n(this.hex,0,[0,7],"a3"),
this.parseExt()}catch(C){}};this.getParam=function(a){var b={};void 0==a&&(a={});b.version=this.getVersion();b.serial={hex:this.getSerialNumberHex()};b.sigalg=this.getSignatureAlgorithmField();b.issuer=this.getIssuer(a.dncanon,a.dnhex);b.notbefore=this.getNotBefore();b.notafter=this.getNotAfter();b.subject=this.getSubject(a.dncanon,a.dnhex);b.sbjpubkey=hextopem(this.getPublicKeyHex(),"PUBLIC KEY");void 0!=this.aExtInfo&&0<this.aExtInfo.length&&(b.ext=this.getExtParamArray());b.sighex=this.getSignatureValueHex();
1==a.tbshex&&(b.tbshex=e(this.hex,0,[0]));1==a.nodnarray&&(delete b.issuer.array,delete b.subject.array);return b};this.getExtParamArray=function(a){void 0==a&&-1!=g(this.hex,0,[0,"[3]"])&&(a=h(this.hex,0,[0,"[3]",0],"30"));for(var b=[],e=c(a,0),d=0;d<e.length;d++){var m=k(a,e[d]);m=this.getExtParam(m);null!=m&&b.push(m)}return b};this.getExtParam=function(a){var b=c(a,0).length;if(2!=b&&3!=b)throw Error("wrong number elements in Extension: "+b+" "+a);var d=v(l(a,0,[0],"06")),g=!1;3==b&&"0101ff"==
e(a,0,[1])&&(g=!0);a=e(a,0,[b-1,0]);b=void 0;"2.5.29.14"==d?b=this.getExtSubjectKeyIdentifier(a,g):"2.5.29.15"==d?b=this.getExtKeyUsage(a,g):"2.5.29.17"==d?b=this.getExtSubjectAltName(a,g):"2.5.29.18"==d?b=this.getExtIssuerAltName(a,g):"2.5.29.19"==d?b=this.getExtBasicConstraints(a,g):"2.5.29.30"==d?b=this.getExtNameConstraints(a,g):"2.5.29.31"==d?b=this.getExtCRLDistributionPoints(a,g):"2.5.29.32"==d?b=this.getExtCertificatePolicies(a,g):"2.5.29.33"==d?b=this.getExtPolicyMappings(a,g):"2.5.29.35"==
d?b=this.getExtAuthorityKeyIdentifier(a,g):"2.5.29.36"==d?b=this.getExtPolicyConstraints(a,g):"2.5.29.37"==d?b=this.getExtExtKeyUsage(a,g):"2.5.29.54"==d?b=this.getExtInhibitAnyPolicy(a,g):"1.3.6.1.5.5.7.1.1"==d?b=this.getExtAuthorityInfoAccess(a,g):"2.5.29.20"==d?b=this.getExtCRLNumber(a,g):"2.5.29.21"==d?b=this.getExtCRLReason(a,g):"1.3.6.1.5.5.7.48.1.2"==d?b=this.getExtOcspNonce(a,g):"1.3.6.1.5.5.7.48.1.5"==d?b=this.getExtOcspNoCheck(a,g):"1.2.840.113583.1.1.9.1"==d?b=this.getExtAdobeTimeStamp(a,
g):void 0!=X509.EXT_PARSER[d]&&(b=X509.EXT_PARSER[d](d,g,a));if(void 0!=b)return b;d={extname:d,extn:a};g&&(d.critical=!0);return d};this.findExt=function(a,b){for(var c=0;c<a.length;c++)if(a[c].extname==b)return a[c];return null};this.updateExtCDPFullURI=function(a,b){a=this.findExt(a,"cRLDistributionPoints");if(null!=a&&void 0!=a.array){a=a.array;for(var c=0;c<a.length;c++)if(void 0!=a[c].dpname&&void 0!=a[c].dpname.full)for(var e=a[c].dpname.full,d=0;d<e.length;d++){var g=e[c];void 0!=g.uri&&(g.uri=
b)}}};this.updateExtAIAOCSP=function(a,b){a=this.findExt(a,"authorityInfoAccess");if(null!=a&&void 0!=a.array){a=a.array;for(var c=0;c<a.length;c++)void 0!=a[c].ocsp&&(a[c].ocsp=b)}};this.updateExtAIACAIssuer=function(a,b){a=this.findExt(a,"authorityInfoAccess");if(null!=a&&void 0!=a.array){a=a.array;for(var c=0;c<a.length;c++)void 0!=a[c].caissuer&&(a[c].caissuer=b)}};this.dnarraytostr=function(a){function b(a){return a.map(function(a){return(a.type+"="+a.value).replace(/\+/,"\\+")}).join("+")}return"/"+
a.map(function(a){return b(a).replace(/\//,"\\/")}).join("/")};this.setCanonicalizedDN=function(a){if(void 0!=a.str&&void 0==a.array){var b=(new KJUR.asn1.x509.X500Name({str:a.str})).tohex();b=this.getX500NameArray(b)}else b=a.array;void 0==a.canon&&(a.canon=this.c14nRDNArray(b))};this.c14nRDNArray=function(a){for(var b=[],c=0;c<a.length;c++){for(var e=a[c],d=[],g=0;g<e.length;g++){var m=e[g],h=m.value;h=h.replace(/^\s*/,"");h=h.replace(/\s*$/,"");h=h.replace(/\s+/g," ");h=h.toLowerCase();d.push(m.type.toLowerCase()+
"="+h)}b.push(d.join("+"))}return"/"+b.join("/")};this.getInfo=function(){var a=function(a){var b="";a=a.array;for(var c=0;c<a.length;c++){var e=a[c];void 0!=e.dn&&(b+="    dn: "+e.dn.str+"\n");void 0!=e.ip&&(b+="    ip: "+e.ip+"\n");void 0!=e.rfc822&&(b+="    rfc822: "+e.rfc822+"\n");void 0!=e.dns&&(b+="    dns: "+e.dns+"\n");void 0!=e.uri&&(b+="    uri: "+e.uri+"\n");if(void 0!=e.other){var d=e.other.oid;e=JSON.stringify(e.other.value).replace(/"/g,"");b+="    other: "+d+"="+e+"\n"}}return b=b.replace(/\n$/,
"")},b=function(a){var b="";a=a.array;for(var c=0;c<a.length;c++){var e=a[c];b+="    policy oid: "+e.policyoid+"\n";if(void 0!==e.array)for(var d=0;d<e.array.length;d++){var g=e.array[d];void 0!==g.cps&&(b+="    cps: "+g.cps+"\n")}}return b},c=function(a){var b="";a=a.array;for(var c=0;c<a.length;c++){var e=a[c];try{void 0!==e.dpname.full[0].uri&&(b+="    "+e.dpname.full[0].uri+"\n")}catch(N){}try{void 0!==e.dname.full[0].dn.hex&&(b+="    "+X509.hex2dn(e.dpname.full[0].dn.hex)+"\n")}catch(N){}}return b},
e=function(a){var b="";a=a.array;for(var c=0;c<a.length;c++){var e=a[c];void 0!==e.caissuer&&(b+="    caissuer: "+e.caissuer+"\n");void 0!==e.ocsp&&(b+="    ocsp: "+e.ocsp+"\n")}return b};var d="Basic Fields\n  serial number: "+(this.getSerialNumberHex()+"\n");d+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";d+="  issuer: "+this.getIssuerString()+"\n";d+="  notBefore: "+this.getNotBefore()+"\n";d+="  notAfter: "+this.getNotAfter()+"\n";d+="  subject: "+this.getSubjectString()+"\n";
d+="  subject public key info: \n";var g=this.getPublicKey();d+="    key algorithm: "+g.type+"\n";"RSA"===g.type&&(d+="    n="+hextoposhex(g.n.toString(16)).substr(0,16)+"...\n",d+="    e="+hextoposhex(g.e.toString(16))+"\n");g=this.aExtInfo;if(void 0!==g&&null!==g){d+="X509v3 Extensions:\n";for(var m=0;m<g.length;m++){var h=g[m],f=KJUR.asn1.x509.OID.oid2name(h.oid);""===f&&(f=h.oid);var k="";!0===h.critical&&(k="CRITICAL");d+="  "+f+" "+k+":\n";"basicConstraints"===f?(h=this.getExtBasicConstraints(),
void 0===h.cA?d+="    {}\n":(d+="    cA=true",void 0!==h.pathLen&&(d+=", pathLen="+h.pathLen),d+="\n")):"policyMappings"==f?(h=this.getExtPolicyMappings().array.map(function(a){return a[0]+":"+a[1]}).join(", "),d+="    "+h+"\n"):"policyConstraints"==f?(h=this.getExtPolicyConstraints(),d+="    ",void 0!=h.reqexp&&(d+=" reqexp="+h.reqexp),void 0!=h.inhibit&&(d+=" inhibit="+h.inhibit),d+="\n"):"inhibitAnyPolicy"==f?(h=this.getExtInhibitAnyPolicy(),d+="    skip="+h.skip+"\n"):"keyUsage"==f?d+="    "+
this.getExtKeyUsageString()+"\n":"subjectKeyIdentifier"==f?d+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n":"authorityKeyIdentifier"==f?(h=this.getExtAuthorityKeyIdentifier(),void 0!==h.kid&&(d+="    kid="+h.kid.hex+"\n")):"extKeyUsage"==f?(h=this.getExtExtKeyUsage().array,d+="    "+h.join(", ")+"\n"):"subjectAltName"==f?(h=a(this.getExtSubjectAltName()),d+=h+"\n"):"cRLDistributionPoints"==f?(h=this.getExtCRLDistributionPoints(),d+=c(h)):"authorityInfoAccess"==f?(h=this.getExtAuthorityInfoAccess(),
d+=e(h)):"certificatePolicies"==f&&(d+=b(this.getExtCertificatePolicies()))}}d+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n";return d+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"};"string"==typeof a&&(-1!=a.indexOf("-----BEGIN")?this.readCertPEM(a):KJUR.lang.String.isHex(a)&&this.readCertHex(a))}X509.EXT_PARSER={};X509.registExtParser=function(a,b){X509.EXT_PARSER[a]=b};X509.hex2dn=function(a,b){void 0===b&&(b=0);var c=new X509;ASN1HEX.getTLV(a,b);return c.getX500Name(a).str};
X509.hex2rdn=function(a,b){void 0===b&&(b=0);if("31"!==a.substr(b,2))throw Error("malformed RDN");var c=[];b=ASN1HEX.getChildIdx(a,b);for(var d=0;d<b.length;d++)c.push(X509.hex2attrTypeValue(a,b[d]));c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};
X509.hex2attrTypeValue=function(a,b){var c=ASN1HEX,d=c.getV;void 0===b&&(b=0);if("30"!==a.substr(b,2))throw Error("malformed attribute type and value");b=c.getChildIdx(a,b);2===b.length&&"06"===a.substr(b[0],2)||"malformed attribute type and value";c=d(a,b[0]);c=KJUR.asn1.ASN1Util.oidHexToInt(c);c=KJUR.asn1.x509.OID.oid2atype(c);a=d(a,b[1]);a=hextorstr(a);return c+"="+a};X509.getPublicKeyFromCertHex=function(a){var b=new X509;b.readCertHex(a);return b.getPublicKey()};
X509.getPublicKeyFromCertPEM=function(a){var b=new X509;b.readCertPEM(a);return b.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(a){var b=ASN1HEX.getVbyList,c={};c.algparam=null;var d=new X509;d.readCertPEM(a);a=d.getPublicKeyHex();c.keyhex=b(a,0,[1],"03").substr(2);c.algoid=b(a,0,[0,0],"06");"2a8648ce3d0201"===c.algoid&&(c.algparam=b(a,0,[0,1],"06"));return c};X509.KEYUSAGE_NAME="digitalSignature nonRepudiation keyEncipherment dataEncipherment keyAgreement keyCertSign cRLSign encipherOnly decipherOnly".split(" ");
var X509CRL=function(a){var b=KJUR.lang.String.isHex,c=ASN1HEX,d=c.getV,f=c.getTLV,k=c.getVbyList,l=c.getTLVbyList,m=c.getTLVbyListEx,e=c.getIdxbyList,h=c.getIdxbyListEx,n=c.getChildIdx,g=new X509;this.parsed=this.posRevCert=this.posSigAlg=this.hex=null;this._setPos=function(){var a=e(this.hex,0,[0,0]);a=this.hex.substr(a,2);if("02"==a)this.posSigAlg=1;else if("30"==a)this.posSigAlg=0;else throw Error("malformed 1st item of TBSCertList: "+a);a=e(this.hex,0,[0,this.posSigAlg+3]);a=this.hex.substr(a,
2);if("17"==a||"18"==a)a=e(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,-1!=a&&(a=this.hex.substr(a,2),"30"==a&&(this.posRevCert=this.posSigAlg+4));else if("30"==a)this.posRevCert=this.posSigAlg+3;else if("a0"==a)this.posRevCert=null;else throw Error("malformed nextUpdate or revCert tag: "+a);};this.getVersion=function(){return 0==this.posSigAlg?null:parseInt(k(this.hex,0,[0,0],"02"),16)+1};this.getSignatureAlgorithmField=function(){var a=l(this.hex,0,[0,this.posSigAlg],"30");return g.getAlgorithmIdentifierName(a)};
this.getIssuer=function(){return g.getX500Name(this.getIssuerHex())};this.getIssuerHex=function(){return l(this.hex,0,[0,this.posSigAlg+1],"30")};this.getThisUpdate=function(){var a=k(this.hex,0,[0,this.posSigAlg+2]);return result=hextorstr(a)};this.getNextUpdate=function(){var a=e(this.hex,0,[0,this.posSigAlg+3]),b=this.hex.substr(a,2);return"17"!=b&&"18"!=b?null:hextorstr(d(this.hex,a))};this.getRevCertArray=function(){if(null==this.posRevCert)return null;var a=[],b=e(this.hex,0,[0,this.posRevCert]);
b=n(this.hex,b);for(var c=0;c<b.length;c++){var d=f(this.hex,b[c]);a.push(this.getRevCert(d))}return a};this.getRevCert=function(a){var b={},c=n(a,0);b.sn={hex:k(a,0,[0],"02")};b.date=hextorstr(k(a,0,[1]));3==c.length&&(b.ext=g.getExtParamArray(l(a,0,[2])));return b};this.findRevCert=function(a){a=(new X509(a)).getSerialNumberHex();return this.findRevCertBySN(a)};this.findRevCertBySN=function(a){null==this.parsed&&this.getParam();if(null==this.parsed.revcert)return null;for(var b=this.parsed.revcert,
c=0;c<b.length;c++)if(a==b[c].sn.hex)return b[c];return null};this.getSignatureValueHex=function(){return k(this.hex,0,[2],"03",!0)};this.verifySignature=function(a){var b=this.getSignatureAlgorithmField(),c=this.getSignatureValueHex(),e=l(this.hex,0,[0],"30");b=new KJUR.crypto.Signature({alg:b});b.init(a);b.updateHex(e);return b.verify(c)};this.getParam=function(a){var b={},c=this.getVersion();null!=c&&(b.version=c);b.sigalg=this.getSignatureAlgorithmField();b.issuer=this.getIssuer();b.thisupdate=
this.getThisUpdate();c=this.getNextUpdate();null!=c&&(b.nextupdate=c);c=this.getRevCertArray();null!=c&&(b.revcert=c);-1!=h(this.hex,0,[0,"[0]"])&&(c=m(this.hex,0,[0,"[0]",0]),b.ext=g.getExtParamArray(c));b.sighex=this.getSignatureValueHex();this.parsed=b;"object"==typeof a&&(1==a.tbshex&&(b.tbshex=l(this.hex,0,[0])),1==a.nodnarray&&delete b.issuer.array);return b};"string"==typeof a&&(b(a)?this.hex=a:a.match(/-----BEGIN X509 CRL/)&&(this.hex=pemtohex(a)),this._setPos())};
"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={});
KJUR.jws.JWS=function(){var a=KJUR.jws.JWS.isSafeJSONString;this.parseJWS=function(b,c){if(void 0===this.parsedJWS||!c&&void 0===this.parsedJWS.sigvalH){var d=b.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==d)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var f=d[1];b=d[2];d=d[3];this.parsedJWS={};this.parsedJWS.headB64U=f;this.parsedJWS.payloadB64U=b;this.parsedJWS.sigvalB64U=d;this.parsedJWS.si=f+"."+b;c||(c=b64utohex(d),d=parseBigInt(c,16),this.parsedJWS.sigvalH=c,this.parsedJWS.sigvalBI=
d);f=b64utoutf8(f);b=b64utoutf8(b);this.parsedJWS.headS=f;this.parsedJWS.payloadS=b;if(!a(f,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+f;}}};
KJUR.jws.JWS.sign=function(a,b,c,d,f){var k=KJUR,l=k.jws.JWS,m=l.readSafeJSONString,e=l.isSafeJSONString,h=k.crypto;k=h.Mac;h=h.Signature;var n=JSON;if("string"!=typeof b&&"object"!=typeof b)throw"spHeader must be JSON string or object: "+b;if("object"==typeof b){var g=b;var p=n.stringify(g)}if("string"==typeof b){p=b;if(!e(p))throw"JWS Head is not safe JSON string: "+p;g=m(p)}b=c;"object"==typeof c&&(b=n.stringify(c));""!=a&&null!=a||void 0===g.alg||(a=g.alg);""!=a&&null!=a&&void 0===g.alg&&(g.alg=
a,p=n.stringify(g));if(a!==g.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+g.alg;if(void 0===l.jwsalg2sigalg[a])throw"unsupported alg name: "+a;a=l.jwsalg2sigalg[a];p=utf8tob64u(p);c=utf8tob64u(b);p=p+"."+c;c="";if("Hmac"==a.substr(0,4)){if(void 0===d)throw"mac key shall be specified for HS* alg";d=new k({alg:a,prov:"cryptojs",pass:d});d.updateString(p);c=d.doFinal()}else-1!=a.indexOf("withECDSA")?(k=new h({alg:a}),k.init(d,f),k.updateString(p),d=k.sign(),c=KJUR.crypto.ECDSA.asn1SigToConcatSig(d)):
"none"!=a&&(k=new h({alg:a}),k.init(d,f),k.updateString(p),c=k.sign());d=hextob64u(c);return p+"."+d};
KJUR.jws.JWS.verify=function(a,b,c){var d=KJUR,f=d.jws.JWS,k=f.readSafeJSONString,l=d.crypto;d=l.ECDSA;var m=l.Mac,e=l.Signature;if(!isBase64URLDot(a))return!1;var h=a.split(".");if(3!==h.length)return!1;l=h[0]+"."+h[1];a=b64utohex(h[2]);k=k(b64utoutf8(h[0]));if(void 0===k.alg)throw"algorithm not specified in header";h=k.alg;var n=h.substr(0,2);if(null!=c&&"[object Array]"===Object.prototype.toString.call(c)&&0<c.length&&-1==(":"+c.join(":")+":").indexOf(":"+h+":"))throw"algorithm '"+h+"' not accepted in the list";
if("none"!=h&&null===b)throw"key shall be specified to verify.";"string"==typeof b&&-1!=b.indexOf("-----BEGIN ")&&(b=KEYUTIL.getKey(b));if(!("RS"!=n&&"PS"!=n||b instanceof RSAKey))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==n&&!(b instanceof d))throw"key shall be a ECDSA obj for ES* algs";if(void 0===f.jwsalg2sigalg[k.alg])throw"unsupported alg name: "+h;c=f.jwsalg2sigalg[h];if("none"==c)throw"not supported";if("Hmac"==c.substr(0,4)){if(void 0===b)throw"hexadecimal key shall be specified for HMAC";
b=new m({alg:c,pass:b});b.updateString(l);b=b.doFinal();return a==b}if(-1!=c.indexOf("withECDSA")){f=null;try{f=d.concatSigToASN1Sig(a)}catch(g){return!1}d=new e({alg:c});d.init(b);d.updateString(l);return d.verify(f)}d=new e({alg:c});d.init(b);d.updateString(l);return d.verify(a)};
KJUR.jws.JWS.parse=function(a){a=a.split(".");var b={},c;if(2!=a.length&&3!=a.length)throw"malformed sJWS: wrong number of '.' splitted elements";var d=a[0];var f=a[1];3==a.length&&(c=a[2]);b.headerObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(d));b.payloadObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(f));b.headerPP=JSON.stringify(b.headerObj,null,"  ");b.payloadPP=null==b.payloadObj?b64utoutf8(f):JSON.stringify(b.payloadObj,null,"  ");void 0!==c&&(b.sigHex=b64utohex(c));return b};
KJUR.jws.JWS.verifyJWT=function(a,b,c){var d=KJUR.jws,f=d.JWS,k=f.readSafeJSONString,l=f.inArray,m=f.includedArray;if(!isBase64URLDot(a))return!1;var e=a.split(".");if(3!=e.length)return!1;var h=e[0],n=e[1];b64utohex(e[2]);e=k(b64utoutf8(h));k=k(b64utoutf8(n));if(void 0===e.alg)return!1;if(void 0===c.alg)throw"acceptField.alg shall be specified";if(!l(e.alg,c.alg)||void 0!==k.iss&&"object"===typeof c.iss&&!l(k.iss,c.iss)||void 0!==k.sub&&"object"===typeof c.sub&&!l(k.sub,c.sub))return!1;if(void 0!==
k.aud&&"object"===typeof c.aud)if("string"==typeof k.aud){if(!l(k.aud,c.aud))return!1}else if("object"==typeof k.aud&&!m(k.aud,c.aud))return!1;d=d.IntDate.getNow();void 0!==c.verifyAt&&"number"===typeof c.verifyAt&&(d=c.verifyAt);if(void 0===c.gracePeriod||"number"!==typeof c.gracePeriod)c.gracePeriod=0;return void 0!==k.exp&&"number"==typeof k.exp&&k.exp+c.gracePeriod<d||void 0!==k.nbf&&"number"==typeof k.nbf&&d<k.nbf-c.gracePeriod||void 0!==k.iat&&"number"==typeof k.iat&&d<k.iat-c.gracePeriod||
void 0!==k.jti&&void 0!==c.jti&&k.jti!==c.jti||!f.verify(a,b,c.alg)?!1:!0};KJUR.jws.JWS.includedArray=function(a,b){var c=KJUR.jws.JWS.inArray;if(null===a||"object"!==typeof a||"number"!==typeof a.length)return!1;for(var d=0;d<a.length;d++)if(!c(a[d],b))return!1;return!0};KJUR.jws.JWS.inArray=function(a,b){if(null===b||"object"!==typeof b||"number"!==typeof b.length)return!1;for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1};
KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"};KJUR.jws.JWS.isSafeJSONString=function(a,b,c){var d=null;try{d=jsonParse(a);if("object"!=typeof d||d.constructor===Array)return 0;b&&(b[c]=d);return 1}catch(f){return 0}};
KJUR.jws.JWS.readSafeJSONString=function(a){var b=null;try{return b=jsonParse(a),"object"!=typeof b||b.constructor===Array?null:b}catch(c){return null}};KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(a){a=a.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==a)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return a[1]};
KJUR.jws.JWS.getJWKthumbprint=function(a){if("RSA"!==a.kty&&"EC"!==a.kty&&"oct"!==a.kty)throw"unsupported algorithm for JWK Thumprint";var b="{";if("RSA"===a.kty){if("string"!=typeof a.n||"string"!=typeof a.e)throw"wrong n and e value for RSA key";b+='"e":"'+a.e+'",';b+='"kty":"'+a.kty+'",';b+='"n":"'+a.n+'"}'}else if("EC"===a.kty){if("string"!=typeof a.crv||"string"!=typeof a.x||"string"!=typeof a.y)throw"wrong crv, x and y value for EC key";b+='"crv":"'+a.crv+'",';b+='"kty":"'+a.kty+'",';b+='"x":"'+
a.x+'",';b+='"y":"'+a.y+'"}'}else if("oct"===a.kty){if("string"!=typeof a.k)throw"wrong k value for oct(symmetric) key";b+='"kty":"'+a.kty+'",';b+='"k":"'+a.k+'"}'}a=rstrtohex(b);a=KJUR.crypto.Util.hashHex(a,"sha256");return hextob64u(a)};KJUR.jws.IntDate={};
KJUR.jws.IntDate.get=function(a){var b=KJUR.jws.IntDate,c=b.getNow;b=b.getZulu;if("now"==a)return c();if("now + 1hour"==a)return c()+3600;if("now + 1day"==a)return c()+86400;if("now + 1month"==a)return c()+2592E3;if("now + 1year"==a)return c()+31536E3;if(a.match(/Z$/))return b(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a;};KJUR.jws.IntDate.getZulu=function(a){return zulutosec(a)};KJUR.jws.IntDate.getNow=function(){return~~(new Date/1E3)};
KJUR.jws.IntDate.intDate2UTCString=function(a){return(new Date(1E3*a)).toUTCString()};KJUR.jws.IntDate.intDate2Zulu=function(a){var b=new Date(1E3*a);a=("0000"+b.getUTCFullYear()).slice(-4);var c=("00"+(b.getUTCMonth()+1)).slice(-2),d=("00"+b.getUTCDate()).slice(-2),f=("00"+b.getUTCHours()).slice(-2),k=("00"+b.getUTCMinutes()).slice(-2);b=("00"+b.getUTCSeconds()).slice(-2);return a+c+d+f+k+b+"Z"};"undefined"!=typeof KJUR&&KJUR||(KJUR={});"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={});
KJUR.jws.JWSJS=function(){var a=KJUR.jws.JWS,b=a.readSafeJSONString;this.aHeader=[];this.sPayload="";this.aSignature=[];this.init=function(){this.aHeader=[];this.sPayload=void 0;this.aSignature=[]};this.initWithJWS=function(a){this.init();a=a.split(".");if(3!=a.length)throw"malformed input JWS";this.aHeader.push(a[0]);this.sPayload=a[1];this.aSignature.push(a[2])};this.addSignature=function(a,b,f,k){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var c=
this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var d=KJUR.jws.JWS.sign(a,b,this.sPayload,f,k).split(".");this.aHeader.push(d[0]);this.aSignature.push(d[2])}catch(e){throw this.aHeader.length>c&&this.aHeader.pop(),this.aSignature.length>c&&this.aSignature.pop(),"addSignature failed: "+e;}};this.verifyAll=function(a){if(this.aHeader.length!==a.length||this.aSignature.length!==a.length)return!1;for(var b=0;b<a.length;b++){var c=a[b];
if(2!==c.length||!1===this.verifyNth(b,c[0],c[1]))return!1}return!0};this.verifyNth=function(b,d,f){if(this.aHeader.length<=b||this.aSignature.length<=b)return!1;b=this.aHeader[b]+"."+this.sPayload+"."+this.aSignature[b];var c=!1;try{c=a.verify(b,d,f)}catch(l){return!1}return c};this.readJWSJS=function(a){if("string"===typeof a){a=b(a);if(null==a)throw"argument is not safe JSON object string";this.aHeader=a.headers;this.sPayload=a.payload;this.aSignature=a.signatures}else try{if(0<a.headers.length)this.aHeader=
a.headers;else throw"malformed header";if("string"===typeof a.payload)this.sPayload=a.payload;else throw"malformed signatures";if(0<a.signatures.length)this.aSignature=a.signatures;else throw"malformed signatures";}catch(d){throw"malformed JWS-JS JSON object: "+d;}};this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}};this.isEmpty=function(){return 0==this.aHeader.length?1:0}};var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var txml=function(){function a(a,c){function m(b){for(var c=[];a[g];)if(60==a.charCodeAt(g)){if(47===a.charCodeAt(g+1)){var e=g+2;g=a.indexOf(">",g);if(-1==a.substring(e,g).indexOf(b))throw b=a.substring(0,g).split("\n"),Error("Unexpected close tag\nLine: "+(b.length-1)+"\nColumn: "+(b[b.length-1].length+1)+"\nChar: "+a[g]);g+1&&(g+=1);break}else if(33===a.charCodeAt(g+1)){if(45==a.charCodeAt(g+2)){for(e=g;-1!==g&&(62!==a.charCodeAt(g)||45!=a.charCodeAt(g-1)||45!=a.charCodeAt(g-2)||-1==g);)g=a.indexOf(">",
g+1);-1===g&&(g=a.length);k&&c.push(a.substring(e,g+1))}else if(91===a.charCodeAt(g+2)&&91===a.charCodeAt(g+8)&&"cdata"===a.substr(g+3,5).toLowerCase()){e=a.indexOf("]]\x3e",g);-1==e?(c.push(a.substr(g+9)),g=a.length):(c.push(a.substring(g+9,e)),g=e+3);continue}else{e=g+1;g+=2;for(var d=!1;(62!==a.charCodeAt(g)||!0===d)&&a[g];)91===a.charCodeAt(g)?d=!0:!0===d&&93===a.charCodeAt(g)&&(d=!1),g++;c.push(a.substring(e,g))}g++;continue}e=h();c.push(e);"?"===e.tagName[0]&&(c.push.apply(c,$jscomp.arrayFromIterable(e.children)),
e.children=[])}else e=g,g=a.indexOf("<",g)-1,-2===g&&(g=a.length),e=a.slice(e,g+1),(l||0<e.trim().length)&&c.push(e),g++;return c}function e(){for(var b=g;-1===r.indexOf(a[g])&&a[g];)g++;return a.slice(b,g)}function h(){g++;for(var b=e(),c={},d=[];62!==a.charCodeAt(g)&&a[g];){var h=a.charCodeAt(g);if(64<h&&91>h||96<h&&123>h){h=e();for(var f=a.charCodeAt(g);f&&39!==f&&34!==f&&!(64<f&&91>f||96<f&&123>f)&&62!==f;)g++,f=a.charCodeAt(g);if(39===f||34===f){if(f=g+1,g=a.indexOf(a[g],f),f=a.slice(f,g),-1===
g)return{tagName:b,attributes:c,children:d}}else f=null,g--;c[h]=f}g++}47!==a.charCodeAt(g-1)?"script"==b?(d=g+1,g=a.indexOf("\x3c/script>",g),d=[a.slice(d,g)],g+=9):"style"==b?(d=g+1,g=a.indexOf("</style>",g),d=[a.slice(d,g)],g+=8):-1===v.indexOf(b)?(g++,d=m(b)):g++:g++;return{tagName:b,attributes:c,children:d}}function f(){var b=(new RegExp("\\s"+c.attrName+"\\s*=['\"]"+c.attrValue+"['\"]")).exec(a);return b?b.index:-1}c=c||{};var g=c.pos||0,k=!!c.keepComments,l=!!c.keepWhitespace,r="\r\n\t>/= ",
v=c.noChildNodes||"img br input meta link hr".split(" "),u=null;if(void 0!==c.attrValue)for(c.attrName=c.attrName||"id",u=[];-1!==(g=f());)g=a.lastIndexOf("<",g),-1!==g&&u.push(h()),a=a.substr(g),g=0;else u=c.parseNode?h():m("");c.filter&&(u=d(u,c.filter));if(c.simplify)return b(Array.isArray(u)?u:[u]);c.setPos&&(u.pos=g);return u}function b(a){var c={};if(!a.length)return"";if(1===a.length&&"string"==typeof a[0])return a[0];a.forEach(function(a){if("object"===typeof a){c[a.tagName]||(c[a.tagName]=
[]);var e=b(a.children);c[a.tagName].push(e);Object.keys(a.attributes).length&&(e._attributes=a.attributes)}});for(var d in c)1==c[d].length&&(c[d]=c[d][0]);return c}function c(a,b){b=void 0===b?{}:b;var d={};if(!a.length)return d;if(1===a.length&&"string"==typeof a[0])return Object.keys(b).length?{_attributes:b,value:a[0]}:a[0];a.forEach(function(a){if("object"===typeof a){d[a.tagName]||(d[a.tagName]=[]);var b=c(a.children||[],a.attributes);d[a.tagName].push(b);Object.keys(a.attributes).length&&
(b._attributes=a.attributes)}});return d}function d(a,b,c,e){c=void 0===c?0:c;e=void 0===e?"":e;var h=[];a.forEach(function(a,g){"object"===typeof a&&b(a,g,c,e)&&h.push(a);a.children&&(a=d(a.children,b,c+1,(e?e+".":"")+g+"."+a.tagName),h=h.concat(a))});return h}function f(a){if(Array.isArray(a)){var b="";a.forEach(function(a){b+=" "+f(a);b=b.trim()});return b}return"object"===typeof a?f(a.children):" "+a}return{parse:a,simplify:b,simplifyLostLess:c,filter:d,stringify:function(a){function b(a){if(a)for(var e=
0;e<a.length;e++)if("string"==typeof a[e])c+=a[e].trim();else{var d=void 0,g=a[e];c+="<"+g.tagName;for(d in g.attributes)c=null===g.attributes[d]?c+(" "+d):-1===g.attributes[d].indexOf('"')?c+(" "+d+'="'+g.attributes[d].trim()+'"'):c+(" "+d+"='"+g.attributes[d].trim()+"'");"?"===g.tagName[0]?c+="?>":(c+=">",b(g.children),c+="</"+g.tagName+">")}}var c="";b(a);return c},toContentString:f,getElementById:function(b,c,d){b=a(b,{attrValue:c});return d?tXml.simplify(b):b[0]},getElementsByClassName:function(b,
c,d){b=a(b,{attrName:"class",attrValue:"[a-zA-Z0-9- ]*"+c+"[a-zA-Z0-9- ]*"});return d?tXml.simplify(b):b}}}();!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.forge=b():a.forge=b()}(window,function(){return function(a){function b(d){if(c[d])return c[d].exports;var f=c[d]={i:d,l:!1,exports:{}};return a[d].call(f.exports,f,f.exports,b),f.l=!0,f.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,k){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:k})},b.r=function(a){"undefined"!=typeof Symbol&&
Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"});Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if((1&c&&(a=b(a)),8&c)||4&c&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var f in a)b.d(d,f,function(b){return a[b]}.bind(null,f));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};
return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=32)}([function(a,b){a.exports={options:{usePureJavaScript:!1}}},function(a,b,c){(function(b){function d(a){if(8!==a&&16!==a&&24!==a&&32!==a)throw Error("Only 8, 16, 24, or 32 bits supported: "+a);}function k(a){if(this.data="",this.read=0,"string"==typeof a)this.data=a;else if(e.isArrayBuffer(a)||e.isArrayBufferView(a))if("undefined"!=typeof Buffer&&a instanceof Buffer)this.data=a.toString("binary");
else{a=new Uint8Array(a);try{this.data=String.fromCharCode.apply(null,a)}catch(B){for(var b=0;b<a.length;++b)this.putByte(a[b])}}else(a instanceof k||"object"==typeof a&&"string"==typeof a.data&&"number"==typeof a.read)&&(this.data=a.data,this.read=a.read);this._constructedStringLength=0}var l=c(0),m=c(35),e=a.exports=l.util=l.util||{};!function(){if("undefined"!=typeof process&&process.nextTick&&!process.browser)return e.nextTick=process.nextTick,void("function"==typeof setImmediate?e.setImmediate=
setImmediate:e.setImmediate=e.nextTick);if("function"==typeof setImmediate)return e.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(e.nextTick=function(a){return setImmediate(a)});if(e.setImmediate=function(a){setTimeout(a,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var a=[];e.setImmediate=function(b){a.push(b);1===a.length&&window.postMessage("forge.setImmediate","*")};window.addEventListener("message",function(b){b.source===window&&"forge.setImmediate"===
b.data&&(b.stopPropagation(),b=a.slice(),a.length=0,b.forEach(function(a){a()}))},!0)}if("undefined"!=typeof MutationObserver){var b=Date.now(),c=!0,d=document.createElement("div");a=[];(new MutationObserver(function(){var b=a.slice();a.length=0;b.forEach(function(a){a()})})).observe(d,{attributes:!0});var g=e.setImmediate;e.setImmediate=function(e){15<Date.now()-b?(b=Date.now(),g(e)):(a.push(e),1===a.length&&d.setAttribute("a",c=!c))}}e.nextTick=e.setImmediate}();e.isNodejs="undefined"!=typeof process&&
process.versions&&process.versions.node;e.globalScope=e.isNodejs?b:"undefined"==typeof self?window:self;e.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};e.isArrayBuffer=function(a){return"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer};e.isArrayBufferView=function(a){return a&&e.isArrayBuffer(a.buffer)&&void 0!==a.byteLength};e.ByteBuffer=k;e.ByteStringBuffer=k;e.ByteStringBuffer.prototype._optimizeConstructedString=function(a){this._constructedStringLength+=
a;4096<this._constructedStringLength&&(this.data.substr(0,1),this._constructedStringLength=0)};e.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};e.ByteStringBuffer.prototype.isEmpty=function(){return 0>=this.length()};e.ByteStringBuffer.prototype.putByte=function(a){return this.putBytes(String.fromCharCode(a))};e.ByteStringBuffer.prototype.fillWithByte=function(a,b){a=String.fromCharCode(a);for(var c=this.data;0<b;)1&b&&(c+=a),0<(b>>>=1)&&(a+=a);return this.data=c,
this._optimizeConstructedString(b),this};e.ByteStringBuffer.prototype.putBytes=function(a){return this.data+=a,this._optimizeConstructedString(a.length),this};e.ByteStringBuffer.prototype.putString=function(a){return this.putBytes(e.encodeUtf8(a))};e.ByteStringBuffer.prototype.putInt16=function(a){return this.putBytes(String.fromCharCode(a>>8&255)+String.fromCharCode(255&a))};e.ByteStringBuffer.prototype.putInt24=function(a){return this.putBytes(String.fromCharCode(a>>16&255)+String.fromCharCode(a>>
8&255)+String.fromCharCode(255&a))};e.ByteStringBuffer.prototype.putInt32=function(a){return this.putBytes(String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a))};e.ByteStringBuffer.prototype.putInt16Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255))};e.ByteStringBuffer.prototype.putInt24Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>
16&255))};e.ByteStringBuffer.prototype.putInt32Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>24&255))};e.ByteStringBuffer.prototype.putInt=function(a,b){d(b);var c="";do b-=8,c+=String.fromCharCode(a>>b&255);while(0<b);return this.putBytes(c)};e.ByteStringBuffer.prototype.putSignedInt=function(a,b){return 0>a&&(a+=2<<b-1),this.putInt(a,b)};e.ByteStringBuffer.prototype.putBuffer=function(a){return this.putBytes(a.getBytes())};
e.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};e.ByteStringBuffer.prototype.getInt16=function(){var a=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,a};e.ByteStringBuffer.prototype.getInt24=function(){var a=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,a};e.ByteStringBuffer.prototype.getInt32=function(){var a=this.data.charCodeAt(this.read)<<
24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,a};e.ByteStringBuffer.prototype.getInt16Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,a};e.ByteStringBuffer.prototype.getInt24Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,a};e.ByteStringBuffer.prototype.getInt32Le=
function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,a};e.ByteStringBuffer.prototype.getInt=function(a){d(a);var b=0;do b=(b<<8)+this.data.charCodeAt(this.read++),a-=8;while(0<a);return b};e.ByteStringBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a);a=2<<a-2;return b>=a&&(b-=a<<1),b};e.ByteStringBuffer.prototype.getBytes=function(a){var b;return a?(a=Math.min(this.length(),
a),b=this.data.slice(this.read,this.read+a),this.read+=a):0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear()),b};e.ByteStringBuffer.prototype.bytes=function(a){return void 0===a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)};e.ByteStringBuffer.prototype.at=function(a){return this.data.charCodeAt(this.read+a)};e.ByteStringBuffer.prototype.setAt=function(a,b){return this.data=this.data.substr(0,this.read+a)+String.fromCharCode(b)+this.data.substr(this.read+
a+1),this};e.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};e.ByteStringBuffer.prototype.copy=function(){var a=e.createBuffer(this.data);return a.read=this.read,a};e.ByteStringBuffer.prototype.compact=function(){return 0<this.read&&(this.data=this.data.slice(this.read),this.read=0),this};e.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};e.ByteStringBuffer.prototype.truncate=function(a){a=Math.max(0,this.length()-a);return this.data=
this.data.substr(this.read,a),this.read=0,this};e.ByteStringBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.length;++b){var c=this.data.charCodeAt(b);16>c&&(a+="0");a+=c.toString(16)}return a};e.ByteStringBuffer.prototype.toString=function(){return e.decodeUtf8(this.bytes())};e.DataBuffer=function(a,b){b=b||{};this.read=b.readOffset||0;this.growSize=b.growSize||1024;var c=e.isArrayBuffer(a),d=e.isArrayBufferView(a);if(c||d)return this.data=c?new DataView(a):new DataView(a.buffer,
a.byteOffset,a.byteLength),void(this.write="writeOffset"in b?b.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0));this.write=0;null!=a&&this.putBytes(a);"writeOffset"in b&&(this.write=b.writeOffset)};e.DataBuffer.prototype.length=function(){return this.write-this.read};e.DataBuffer.prototype.isEmpty=function(){return 0>=this.length()};e.DataBuffer.prototype.accommodate=function(a,b){if(this.length()>=a)return this;b=Math.max(b||this.growSize,a);a=new Uint8Array(this.data.buffer,
this.data.byteOffset,this.data.byteLength);b=new Uint8Array(this.length()+b);return b.set(a),this.data=new DataView(b.buffer),this};e.DataBuffer.prototype.putByte=function(a){return this.accommodate(1),this.data.setUint8(this.write++,a),this};e.DataBuffer.prototype.fillWithByte=function(a,b){this.accommodate(b);for(var c=0;c<b;++c)this.data.setUint8(a);return this};e.DataBuffer.prototype.putBytes=function(a,b){if(e.isArrayBufferView(a))return a=(c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength)).byteLength-
c.byteOffset,this.accommodate(a),(new Uint8Array(this.data.buffer,this.write)).set(c),this.write+=a,this;if(e.isArrayBuffer(a)){var c=new Uint8Array(a);return this.accommodate(c.byteLength),(new Uint8Array(this.data.buffer)).set(c,this.write),this.write+=c.byteLength,this}if(a instanceof e.DataBuffer||"object"==typeof a&&"number"==typeof a.read&&"number"==typeof a.write&&e.isArrayBufferView(a.data))return c=new Uint8Array(a.data.byteLength,a.read,a.length()),this.accommodate(c.byteLength),(new Uint8Array(a.data.byteLength,
this.write)).set(c),this.write+=c.byteLength,this;if(a instanceof e.ByteStringBuffer&&(a=a.data,b="binary"),b=b||"binary","string"==typeof a){var d;if("hex"===b)return this.accommodate(Math.ceil(a.length/2)),d=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.hex.decode(a,d,this.write),this;if("base64"===b)return this.accommodate(3*Math.ceil(a.length/4)),d=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.base64.decode(a,d,this.write),this;if("utf8"===b&&(a=e.encodeUtf8(a),
b="binary"),"binary"===b||"raw"===b)return this.accommodate(a.length),d=new Uint8Array(this.data.buffer,this.write),this.write+=e.binary.raw.decode(d),this;if("utf16"===b)return this.accommodate(2*a.length),d=new Uint16Array(this.data.buffer,this.write),this.write+=e.text.utf16.encode(d),this;throw Error("Invalid encoding: "+b);}throw Error("Invalid parameter: "+a);};e.DataBuffer.prototype.putBuffer=function(a){return this.putBytes(a),a.clear(),this};e.DataBuffer.prototype.putString=function(a){return this.putBytes(a,
"utf16")};e.DataBuffer.prototype.putInt16=function(a){return this.accommodate(2),this.data.setInt16(this.write,a),this.write+=2,this};e.DataBuffer.prototype.putInt24=function(a){return this.accommodate(3),this.data.setInt16(this.write,a>>8&65535),this.data.setInt8(this.write,a>>16&255),this.write+=3,this};e.DataBuffer.prototype.putInt32=function(a){return this.accommodate(4),this.data.setInt32(this.write,a),this.write+=4,this};e.DataBuffer.prototype.putInt16Le=function(a){return this.accommodate(2),
this.data.setInt16(this.write,a,!0),this.write+=2,this};e.DataBuffer.prototype.putInt24Le=function(a){return this.accommodate(3),this.data.setInt8(this.write,a>>16&255),this.data.setInt16(this.write,a>>8&65535,!0),this.write+=3,this};e.DataBuffer.prototype.putInt32Le=function(a){return this.accommodate(4),this.data.setInt32(this.write,a,!0),this.write+=4,this};e.DataBuffer.prototype.putInt=function(a,b){d(b);this.accommodate(b/8);do b-=8,this.data.setInt8(this.write++,a>>b&255);while(0<b);return this};
e.DataBuffer.prototype.putSignedInt=function(a,b){return d(b),this.accommodate(b/8),0>a&&(a+=2<<b-1),this.putInt(a,b)};e.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};e.DataBuffer.prototype.getInt16=function(){var a=this.data.getInt16(this.read);return this.read+=2,a};e.DataBuffer.prototype.getInt24=function(){var a=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,a};e.DataBuffer.prototype.getInt32=function(){var a=this.data.getInt32(this.read);
return this.read+=4,a};e.DataBuffer.prototype.getInt16Le=function(){var a=this.data.getInt16(this.read,!0);return this.read+=2,a};e.DataBuffer.prototype.getInt24Le=function(){var a=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,a};e.DataBuffer.prototype.getInt32Le=function(){var a=this.data.getInt32(this.read,!0);return this.read+=4,a};e.DataBuffer.prototype.getInt=function(a){d(a);var b=0;do b=(b<<8)+this.data.getInt8(this.read++),a-=8;while(0<a);return b};
e.DataBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a);a=2<<a-2;return b>=a&&(b-=a<<1),b};e.DataBuffer.prototype.getBytes=function(a){var b;return a?(a=Math.min(this.length(),a),b=this.data.slice(this.read,this.read+a),this.read+=a):0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear()),b};e.DataBuffer.prototype.bytes=function(a){return void 0===a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)};e.DataBuffer.prototype.at=function(a){return this.data.getUint8(this.read+
a)};e.DataBuffer.prototype.setAt=function(a,b){return this.data.setUint8(a,b),this};e.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};e.DataBuffer.prototype.copy=function(){return new e.DataBuffer(this)};e.DataBuffer.prototype.compact=function(){if(0<this.read){var a=new Uint8Array(this.data.buffer,this.read),b=new Uint8Array(a.byteLength);b.set(a);this.data=new DataView(b);this.write-=this.read;this.read=0}return this};e.DataBuffer.prototype.clear=function(){return this.data=
new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};e.DataBuffer.prototype.truncate=function(a){return this.write=Math.max(0,this.length()-a),this.read=Math.min(this.read,this.write),this};e.DataBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.byteLength;++b){var c=this.data.getUint8(b);16>c&&(a+="0");a+=c.toString(16)}return a};e.DataBuffer.prototype.toString=function(a){var b=new Uint8Array(this.data,this.read,this.length());if("binary"===(a=a||"utf8")||"raw"===a)return e.binary.raw.encode(b);
if("hex"===a)return e.binary.hex.encode(b);if("base64"===a)return e.binary.base64.encode(b);if("utf8"===a)return e.text.utf8.decode(b);if("utf16"===a)return e.text.utf16.decode(b);throw Error("Invalid encoding: "+a);};e.createBuffer=function(a,b){return b=b||"raw",void 0!==a&&"utf8"===b&&(a=e.encodeUtf8(a)),new e.ByteBuffer(a)};e.fillString=function(a,b){for(var c="";0<b;)1&b&&(c+=a),0<(b>>>=1)&&(a+=a);return c};e.xorBytes=function(a,b,c){for(var e="",d,g="",h=0,m=0;0<c;--c,++h)d=a.charCodeAt(h)^
b.charCodeAt(h),10<=m&&(e+=g,g="",m=0),g+=String.fromCharCode(d),++m;return e+g};e.hexToBytes=function(a){var b="",c=0;for(1&a.length&&(c=1,b+=String.fromCharCode(parseInt(a[0],16)));c<a.length;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b};e.bytesToHex=function(a){return e.createBuffer(a).toHex()};e.int32ToBytes=function(a){return String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a)};var h=[62,-1,-1,-1,63,52,53,
54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];e.encode64=function(a,b){for(var c,e,d,g="",h="",m=0;m<a.length;)c=a.charCodeAt(m++),e=a.charCodeAt(m++),d=a.charCodeAt(m++),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c>>2),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((3&c)<<
4|e>>4),isNaN(e)?g+="==":(g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((15&e)<<2|d>>6),g+=isNaN(d)?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(63&d)),b&&g.length>b&&(h+=g.substr(0,b)+"\r\n",g=g.substr(b));return h+g};e.decode64=function(a){a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");for(var b,c,e,d,g="",m=0;m<a.length;)b=h[a.charCodeAt(m++)-43],c=h[a.charCodeAt(m++)-43],e=h[a.charCodeAt(m++)-43],d=h[a.charCodeAt(m++)-43],g+=String.fromCharCode(b<<
2|c>>4),64!==e&&(g+=String.fromCharCode((15&c)<<4|e>>2),64!==d&&(g+=String.fromCharCode((3&e)<<6|d)));return g};e.encodeUtf8=function(a){return unescape(encodeURIComponent(a))};e.decodeUtf8=function(a){return decodeURIComponent(escape(a))};e.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:m.encode,decode:m.decode}};e.binary.raw.encode=function(a){return String.fromCharCode.apply(null,a)};e.binary.raw.decode=function(a,b,c){var e=b;e||(e=new Uint8Array(a.length));for(var d=c=c||0,g=0;g<a.length;++g)e[d++]=
a.charCodeAt(g);return b?d-c:e};e.binary.hex.encode=e.bytesToHex;e.binary.hex.decode=function(a,b,c){var e=b;e||(e=new Uint8Array(Math.ceil(a.length/2)));var d=0,g=c=c||0;for(1&a.length&&(d=1,e[g++]=parseInt(a[0],16));d<a.length;d+=2)e[g++]=parseInt(a.substr(d,2),16);return b?g-c:e};e.binary.base64.encode=function(a,b){for(var c,e,d,g="",h="",m=0;m<a.byteLength;)c=a[m++],e=a[m++],d=a[m++],g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c>>2),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((3&
c)<<4|e>>4),isNaN(e)?g+="==":(g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((15&e)<<2|d>>6),g+=isNaN(d)?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(63&d)),b&&g.length>b&&(h+=g.substr(0,b)+"\r\n",g=g.substr(b));return h+g};e.binary.base64.decode=function(a,b,c){var e=b;e||(e=new Uint8Array(3*Math.ceil(a.length/4)));a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");for(var d=0,g=c=c||0;d<a.length;){var m=h[a.charCodeAt(d++)-43];var f=h[a.charCodeAt(d++)-
43];var n=h[a.charCodeAt(d++)-43];var k=h[a.charCodeAt(d++)-43];e[g++]=m<<2|f>>4;64!==n&&(e[g++]=(15&f)<<4|n>>2,64!==k&&(e[g++]=(3&n)<<6|k))}return b?g-c:e.subarray(0,g)};e.binary.base58.encode=function(a,b){return e.binary.baseN.encode(a,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",b)};e.binary.base58.decode=function(a,b){return e.binary.baseN.decode(a,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",b)};e.text={utf8:{},utf16:{}};e.text.utf8.encode=function(a,b,c){a=e.encodeUtf8(a);
var d=b;d||(d=new Uint8Array(a.length));for(var g=c=c||0,h=0;h<a.length;++h)d[g++]=a.charCodeAt(h);return b?g-c:d};e.text.utf8.decode=function(a){return e.decodeUtf8(String.fromCharCode.apply(null,a))};e.text.utf16.encode=function(a,b,c){var e=b;e||(e=new Uint8Array(2*a.length));for(var d=new Uint16Array(e.buffer),g=c=c||0,h=c,m=0;m<a.length;++m)d[h++]=a.charCodeAt(m),g+=2;return b?g-c:e};e.text.utf16.decode=function(a){return String.fromCharCode.apply(null,new Uint16Array(a.buffer))};e.deflate=function(a,
b,c){if(b=e.decode64(a.deflate(e.encode64(b)).rval),c)a=2,32&b.charCodeAt(1)&&(a=6),b=b.substring(a,b.length-4);return b};e.inflate=function(a,b,c){a=a.inflate(e.encode64(b)).rval;return null===a?null:e.decode64(a)};var n=function(a,b,c){if(!a)throw Error("WebStorage not available.");var d;if(null===c?d=a.removeItem(b):(c=e.encode64(JSON.stringify(c)),d=a.setItem(b,c)),void 0!==d&&!0!==d.rval)throw a=Error(d.error.message),a.id=d.error.id,a.name=d.error.name,a;},g=function(a,b){if(!a)throw Error("WebStorage not available.");
b=a.getItem(b);if(a.init)if(null===b.rval){if(b.error)throw a=Error(b.error.message),a.id=b.error.id,a.name=b.error.name,a;b=null}else b=b.rval;return null!==b&&(b=JSON.parse(e.decode64(b))),b},p=function(a,b,c,e){var d=g(a,b);null===d&&(d={});d[c]=e;n(a,b,d)},q=function(a,b,c){a=g(a,b);return null!==a&&(a=c in a?a[c]:null),a},r=function(a,b,c){var e=g(a,b);if(null!==e&&c in e){delete e[c];c=!0;for(var d in e){c=!1;break}c&&(e=null);n(a,b,e)}},v=function(a,b){n(a,b,null)},u=function(a,b,c){var e=
null;void 0===c&&(c=["web","flash"]);var d=!1,g=null,h;for(h in c){var m=c[h];try{if("flash"===m||"both"===m){if(null===b[0])throw Error("Flash local storage not available.");e=a.apply(this,b);d="flash"===m}"web"!==m&&"both"!==m||(b[0]=localStorage,e=a.apply(this,b),d=!0)}catch(L){g=L}if(d)break}if(!d)throw g;return e};e.setItem=function(a,b,c,e,d){u(p,arguments,d)};e.getItem=function(a,b,c,e){return u(q,arguments,e)};e.removeItem=function(a,b,c,e){u(r,arguments,e)};e.clearItems=function(a,b,c){u(v,
arguments,c)};e.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};e.format=function(a){for(var b,c,e=/%./g,d=0,g=[],h=0;b=e.exec(a);)switch(0<(c=a.substring(h,e.lastIndex-2)).length&&g.push(c),h=e.lastIndex,b=b[0][1],b){case "s":case "o":d<arguments.length?g.push(arguments[1+d++]):g.push("<?>");break;case "%":g.push("%");break;default:g.push("<%"+b+"?>")}return g.push(a.substring(h)),g.join("")};e.formatNumber=function(a,b,c,e){var d=isNaN(b=Math.abs(b))?2:b;b=void 0===
c?",":c;e=void 0===e?".":e;c=0>a?"-":"";var g=parseInt(a=Math.abs(+a||0).toFixed(d),10)+"",h=3<g.length?g.length%3:0;return c+(h?g.substr(0,h)+e:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+e)+(d?b+Math.abs(a-g).toFixed(d).slice(2):"")};e.formatSize=function(a){return 1073741824<=a?e.formatNumber(a/1073741824,2,".","")+" GiB":1048576<=a?e.formatNumber(a/1048576,2,".","")+" MiB":1024<=a?e.formatNumber(a/1024,0)+" KiB":e.formatNumber(a,0)+" bytes"};e.bytesFromIP=function(a){return-1!==a.indexOf(".")?
e.bytesFromIPv4(a):-1!==a.indexOf(":")?e.bytesFromIPv6(a):null};e.bytesFromIPv4=function(a){if(4!==(a=a.split(".")).length)return null;for(var b=e.createBuffer(),c=0;c<a.length;++c){var d=parseInt(a[c],10);if(isNaN(d))return null;b.putByte(d)}return b.getBytes()};e.bytesFromIPv6=function(a){for(var b=0,c=2*(8-(a=a.split(":").filter(function(a){return 0===a.length&&++b,!0})).length+b),d=e.createBuffer(),g=0;8>g;++g)if(a[g]&&0!==a[g].length){var h=e.hexToBytes(a[g]);2>h.length&&d.putByte(0);d.putBytes(h)}else d.fillWithByte(0,
c),c=0;return d.getBytes()};e.bytesToIP=function(a){return 4===a.length?e.bytesToIPv4(a):16===a.length?e.bytesToIPv6(a):null};e.bytesToIPv4=function(a){if(4!==a.length)return null;for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b.join(".")};e.bytesToIPv6=function(a){if(16!==a.length)return null;for(var b=[],c=[],d=0,g=0;g<a.length;g+=2){for(var h=e.bytesToHex(a[g]+a[g+1]);"0"===h[0]&&"0"!==h;)h=h.substr(1);if("0"===h){var m=c[c.length-1],f=b.length;m&&f===m.end+1?(m.end=f,m.end-m.start>
c[d].end-c[d].start&&(d=c.length-1)):c.push({start:f,end:f})}b.push(h)}0<c.length&&(a=c[d],0<a.end-a.start&&(b.splice(a.start,a.end-a.start+1,""),0===a.start&&b.unshift(""),7===a.end&&b.push("")));return b.join(":")};e.estimateCores=function(a,b){if("function"==typeof a&&(b=a,a={}),a=a||{},"cores"in e&&!a.update)return b(null,e.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&0<navigator.hardwareConcurrency)return e.cores=navigator.hardwareConcurrency,b(null,e.cores);if("undefined"==
typeof Worker)return e.cores=1,b(null,e.cores);if("undefined"==typeof Blob)return e.cores=2,b(null,e.cores);var c=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(a){a=Date.now();for(var b=a+4;Date.now()<b;);self.postMessage({st:a,et:b})})}.toString(),")()"],{type:"application/javascript"}));!function G(a,d,g){if(0===d){var h=Math.floor(a.reduce(function(a,b){return a+b},0)/a.length);return e.cores=Math.max(1,h),URL.revokeObjectURL(c),b(null,e.cores)}!function(a,
b){for(var e=[],d=[],g=0;g<a;++g){var h=new Worker(c);h.addEventListener("message",function(c){if(d.push(c.data),d.length===a){for(c=0;c<a;++c)e[c].terminate();b(null,d)}});e.push(h)}for(g=0;g<a;++g)e[g].postMessage(g)}(g,function(b,c){a.push(function(a,b){for(var c=[],e=0;e<a;++e)for(var d=b[e],g=c[e]=[],h=0;h<a;++h)if(e!==h){var m=b[h];(d.st>m.st&&d.st<m.et||m.st>d.st&&m.st<d.et)&&g.push(h)}return c.reduce(function(a,b){return Math.max(a,b.length)},0)}(g,c));G(a,d-1,g)})}([],5,16)}}).call(this,
c(34))},function(a,b,c){var d=c(0);c(5);c(23);c(24);c(1);d.random&&d.random.getBytes?a.exports=d.random:function(b){function c(){var a=d.prng.create(f);return a.getBytes=function(b,c){return a.generate(b,c)},a.getBytesSync=function(b){return a.generate(b)},a}var f={},m=Array(4),e=d.util.createBuffer();f.formatKey=function(a){var b=d.util.createBuffer(a);return(a=Array(4))[0]=b.getInt32(),a[1]=b.getInt32(),a[2]=b.getInt32(),a[3]=b.getInt32(),d.aes._expandKey(a,!1)};f.formatSeed=function(a){var b=d.util.createBuffer(a);
return(a=Array(4))[0]=b.getInt32(),a[1]=b.getInt32(),a[2]=b.getInt32(),a[3]=b.getInt32(),a};f.cipher=function(a,b){return d.aes._updateBlock(a,b,m,!1),e.putInt32(m[0]),e.putInt32(m[1]),e.putInt32(m[2]),e.putInt32(m[3]),e.getBytes()};f.increment=function(a){return++a[3],a};f.md=d.md.sha256;var h=c(),n=null,g=d.util.globalScope,p=g.crypto||g.msCrypto;if(p&&p.getRandomValues&&(n=function(a){return p.getRandomValues(a)}),d.options.usePureJavaScript||!d.util.isNodejs&&!n){if("undefined"==typeof window||
window.document,h.collectInt(+new Date,32),"undefined"!=typeof navigator){n="";for(var q in navigator)try{"string"==typeof navigator[q]&&(n+=navigator[q])}catch(r){}h.collect(n);n=null}b&&(b().mousemove(function(a){h.collectInt(a.clientX,16);h.collectInt(a.clientY,16)}),b().keypress(function(a){h.collectInt(a.charCode,8)}))}if(d.random)for(q in h)d.random[q]=h[q];else d.random=h;d.random.createInstance=c;a.exports=d.random}("undefined"!=typeof jQuery?jQuery:null)},function(a,b,c){function d(a,b,c){if(c>
b){var e=Error("Too few bytes to parse DER.");throw e.available=a.length(),e.remaining=b,e.requested=c,e;}}var f=c(0);c(1);c(6);var k=a.exports=f.asn1=f.asn1||{};k.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};k.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};k.create=function(a,b,c,d,g){if(f.util.isArray(d)){for(var e=
[],h=0;h<d.length;++h)void 0!==d[h]&&e.push(d[h]);d=e}a={tagClass:a,type:b,constructed:c,composed:c||f.util.isArray(d),value:d};return g&&"bitStringContents"in g&&(a.bitStringContents=g.bitStringContents,a.original=k.copy(a)),a};k.copy=function(a,b){if(f.util.isArray(a)){var c=[];for(var e=0;e<a.length;++e)c.push(k.copy(a[e],b));return c}return"string"==typeof a?a:(c={tagClass:a.tagClass,type:a.type,constructed:a.constructed,composed:a.composed,value:k.copy(a.value,b)},b&&!b.excludeBitStringContents&&
(c.bitStringContents=a.bitStringContents),c)};k.equals=function(a,b,c){if(f.util.isArray(a)){if(!f.util.isArray(b)||a.length!==b.length)return!1;for(c=0;c<a.length;++c)if(!k.equals(a[c],b[c]))return!1;return!0}if(typeof a!=typeof b)return!1;if("string"==typeof a)return a===b;var e=a.tagClass===b.tagClass&&a.type===b.type&&a.constructed===b.constructed&&a.composed===b.composed&&k.equals(a.value,b.value);return c&&c.includeBitStringContents&&(e=e&&a.bitStringContents===b.bitStringContents),e};k.getBerValueLength=
function(a){var b=a.getByte();if(128!==b)return 128&b?a.getInt((127&b)<<3):b};k.fromDer=function(a,b){void 0===b&&(b={strict:!0,parseAllBytes:!0,decodeBitStrings:!0});"boolean"==typeof b&&(b={strict:b,parseAllBytes:!0,decodeBitStrings:!0});"strict"in b||(b.strict=!0);"parseAllBytes"in b||(b.parseAllBytes=!0);"decodeBitStrings"in b||(b.decodeBitStrings=!0);"string"==typeof a&&(a=f.util.createBuffer(a));var c=a.length(),e=function u(a,b,c,e){d(a,b,2);var h=a.getByte();b--;var m=192&h,f=31&h;var n=a.length();
var l,p;var C=b;var v=a.getByte();if(C--,128!==v){if(128&v?(v&=127,d(a,C,v),C=a.getInt(v<<3)):C=v,0>C)throw Error("Negative length: "+C);}else C=void 0;if(b-=n-a.length(),void 0!==C&&C>b){if(e.strict)throw c=Error("Too few bytes to read ASN.1 value."),c.available=a.length(),c.remaining=b,c.requested=C,c;C=b}if(h=32==(32&h))if(l=[],void 0===C)for(;;){if(d(a,b,2),a.bytes(2)===String.fromCharCode(0,0)){a.getBytes(2);b-=2;break}n=a.length();l.push(u(a,b,c+1,e));b-=n-a.length()}else for(;0<C;)n=a.length(),
l.push(u(a,C,c+1,e)),b-=n-a.length(),C-=n-a.length();void 0===l&&m===k.Class.UNIVERSAL&&f===k.Type.BITSTRING&&(p=a.bytes(C));if(void 0===l&&e.decodeBitStrings&&m===k.Class.UNIVERSAL&&f===k.Type.BITSTRING&&1<C){v=a.read;var L=b,q=0;if(f===k.Type.BITSTRING&&(d(a,b,1),q=a.getByte(),b--),0===q)try{n=a.length();var r=u(a,b,c+1,{strict:!0,decodeBitStrings:!0}),M=n-a.length();b-=M;f==k.Type.BITSTRING&&M++;var w=r.tagClass;M!==C||w!==k.Class.UNIVERSAL&&w!==k.Class.CONTEXT_SPECIFIC||(l=[r])}catch(y){}void 0===
l&&(a.read=v,b=L)}if(void 0===l){if(void 0===C){if(e.strict)throw Error("Non-constructed ASN.1 object of indefinite length.");C=b}if(f===k.Type.BMPSTRING)for(l="";0<C;C-=2)d(a,b,2),l+=String.fromCharCode(a.getInt16()),b-=2;else l=a.getBytes(C)}return k.create(m,f,h,l,void 0===p?null:{bitStringContents:p})}(a,a.length(),0,b);if(b.parseAllBytes&&0!==a.length())throw b=Error("Unparsed DER bytes remain after ASN.1 parsing."),b.byteCount=c,b.remaining=a.length(),b;return e};k.toDer=function(a){var b=f.util.createBuffer(),
c=a.tagClass|a.type,d=f.util.createBuffer(),g=!1;if("bitStringContents"in a&&(g=!0,a.original&&(g=k.equals(a,a.original))),g)d.putBytes(a.bitStringContents);else if(a.composed)for(a.constructed?c|=32:d.putByte(0),g=0;g<a.value.length;++g)void 0!==a.value[g]&&d.putBuffer(k.toDer(a.value[g]));else if(a.type===k.Type.BMPSTRING)for(g=0;g<a.value.length;++g)d.putInt16(a.value.charCodeAt(g));else a.type===k.Type.INTEGER&&1<a.value.length&&(0===a.value.charCodeAt(0)&&0==(128&a.value.charCodeAt(1))||255===
a.value.charCodeAt(0)&&128==(128&a.value.charCodeAt(1)))?d.putBytes(a.value.substr(1)):d.putBytes(a.value);if(b.putByte(c),127>=d.length())b.putByte(127&d.length());else{c=d.length();a="";do a+=String.fromCharCode(255&c),c>>>=8;while(0<c);b.putByte(128|a.length);for(g=a.length-1;0<=g;--g)b.putByte(a.charCodeAt(g))}return b.putBuffer(d),b};k.oidToDer=function(a){var b=a.split("."),c=f.util.createBuffer();c.putByte(40*parseInt(b[0],10)+parseInt(b[1],10));for(var d=2;d<b.length;++d){var g=!0;a=[];var m=
parseInt(b[d],10);do{var k=127&m;m>>>=7;g||(k|=128);a.push(k);g=!1}while(0<m);for(g=a.length-1;0<=g;--g)c.putByte(a[g])}return c};k.derToOid=function(a){"string"==typeof a&&(a=f.util.createBuffer(a));var b=a.getByte();var c=Math.floor(b/40)+"."+b%40;for(var d=0;0<a.length();)d<<=7,128&(b=a.getByte())?d+=127&b:(c+="."+(d+b),d=0);return c};k.utcTimeToDate=function(a){var b=new Date,c=parseInt(a.substr(0,2),10);c=50<=c?1900+c:2E3+c;var d=parseInt(a.substr(2,2),10)-1,g=parseInt(a.substr(4,2),10),m=parseInt(a.substr(6,
2),10),f=parseInt(a.substr(8,2),10),k=0;if(11<a.length){var l=a.charAt(10),u=10;"+"!==l&&"-"!==l&&(k=parseInt(a.substr(10,2),10),u+=2)}(b.setUTCFullYear(c,d,g),b.setUTCHours(m,f,k,0),!u||"+"!==(l=a.charAt(u))&&"-"!==l)||(a=60*parseInt(a.substr(u+1,2),10)+parseInt(a.substr(u+4,2),10),a*=6E4,"+"===l?b.setTime(+b-a):b.setTime(+b+a));return b};k.generalizedTimeToDate=function(a){var b=new Date,c=parseInt(a.substr(0,4),10),d=parseInt(a.substr(4,2),10)-1,g=parseInt(a.substr(6,2),10),m=parseInt(a.substr(8,
2),10),f=parseInt(a.substr(10,2),10),k=parseInt(a.substr(12,2),10),l=0,u=0,A=!1;"Z"===a.charAt(a.length-1)&&(A=!0);var x=a.length-5,B=a.charAt(x);"+"!==B&&"-"!==B||(u=60*parseInt(a.substr(x+1,2),10)+parseInt(a.substr(x+4,2),10),u*=6E4,"+"===B&&(u*=-1),A=!0);return"."===a.charAt(14)&&(l=1E3*parseFloat(a.substr(14),10)),A?(b.setUTCFullYear(c,d,g),b.setUTCHours(m,f,k,l),b.setTime(+b+u)):(b.setFullYear(c,d,g),b.setHours(m,f,k,l)),b};k.dateToUtcTime=function(a){if("string"==typeof a)return a;var b="",
c=[];c.push((""+a.getUTCFullYear()).substr(2));c.push(""+(a.getUTCMonth()+1));c.push(""+a.getUTCDate());c.push(""+a.getUTCHours());c.push(""+a.getUTCMinutes());c.push(""+a.getUTCSeconds());for(a=0;a<c.length;++a)2>c[a].length&&(b+="0"),b+=c[a];return b+"Z"};k.dateToGeneralizedTime=function(a){if("string"==typeof a)return a;var b="",c=[];c.push(""+a.getUTCFullYear());c.push(""+(a.getUTCMonth()+1));c.push(""+a.getUTCDate());c.push(""+a.getUTCHours());c.push(""+a.getUTCMinutes());c.push(""+a.getUTCSeconds());
for(a=0;a<c.length;++a)2>c[a].length&&(b+="0"),b+=c[a];return b+"Z"};k.integerToDer=function(a){var b=f.util.createBuffer();if(-128<=a&&128>a)return b.putSignedInt(a,8);if(-32768<=a&&32768>a)return b.putSignedInt(a,16);if(-8388608<=a&&8388608>a)return b.putSignedInt(a,24);if(-2147483648<=a&&2147483648>a)return b.putSignedInt(a,32);b=Error("Integer too large; max is 32-bits.");throw b.integer=a,b;};k.derToInteger=function(a){"string"==typeof a&&(a=f.util.createBuffer(a));var b=8*a.length();if(32<b)throw Error("Integer too large; max is 32-bits.");
return a.getSignedInt(b)};k.validate=function(a,b,c,d){var e=!1;if(a.tagClass!==b.tagClass&&void 0!==b.tagClass||a.type!==b.type&&void 0!==b.type)d&&(a.tagClass!==b.tagClass&&d.push("["+b.name+'] Expected tag class "'+b.tagClass+'", got "'+a.tagClass+'"'),a.type!==b.type&&d.push("["+b.name+'] Expected type "'+b.type+'", got "'+a.type+'"'));else if(a.constructed===b.constructed||void 0===b.constructed){if(e=!0,b.value&&f.util.isArray(b.value))for(var h=0,m=0;e&&m<b.value.length;++m)e=b.value[m].optional||
!1,a.value[h]&&((e=k.validate(a.value[h],b.value[m],c,d))?++h:b.value[m].optional&&(e=!0)),!e&&d&&d.push("["+b.name+'] Tag class "'+b.tagClass+'", type "'+b.type+'" expected value length "'+b.value.length+'", got "'+a.value.length+'"');if(e&&c&&(b.capture&&(c[b.capture]=a.value),b.captureAsn1&&(c[b.captureAsn1]=a),b.captureBitStringContents&&"bitStringContents"in a&&(c[b.captureBitStringContents]=a.bitStringContents),b.captureBitStringValue&&"bitStringContents"in a))if(2>a.bitStringContents.length)c[b.captureBitStringValue]=
"";else{if(0!==a.bitStringContents.charCodeAt(0))throw Error("captureBitStringValue only supported for zero unused bits");c[b.captureBitStringValue]=a.bitStringContents.slice(1)}}else d&&d.push("["+b.name+'] Expected constructed "'+b.constructed+'", got "'+a.constructed+'"');return e};var l=/[^\\u0000-\\u00ff]/;k.prettyPrint=function(a,b,c){var d="";c=c||2;0<(b=b||0)&&(d+="\n");for(var e="",h=0;h<b*c;++h)e+=" ";switch(d+=e+"Tag: ",a.tagClass){case k.Class.UNIVERSAL:d+="Universal:";break;case k.Class.APPLICATION:d+=
"Application:";break;case k.Class.CONTEXT_SPECIFIC:d+="Context-Specific:";break;case k.Class.PRIVATE:d+="Private:"}if(a.tagClass===k.Class.UNIVERSAL)switch(d+=a.type,a.type){case k.Type.NONE:d+=" (None)";break;case k.Type.BOOLEAN:d+=" (Boolean)";break;case k.Type.INTEGER:d+=" (Integer)";break;case k.Type.BITSTRING:d+=" (Bit string)";break;case k.Type.OCTETSTRING:d+=" (Octet string)";break;case k.Type.NULL:d+=" (Null)";break;case k.Type.OID:d+=" (Object Identifier)";break;case k.Type.ODESC:d+=" (Object Descriptor)";
break;case k.Type.EXTERNAL:d+=" (External or Instance of)";break;case k.Type.REAL:d+=" (Real)";break;case k.Type.ENUMERATED:d+=" (Enumerated)";break;case k.Type.EMBEDDED:d+=" (Embedded PDV)";break;case k.Type.UTF8:d+=" (UTF8)";break;case k.Type.ROID:d+=" (Relative Object Identifier)";break;case k.Type.SEQUENCE:d+=" (Sequence)";break;case k.Type.SET:d+=" (Set)";break;case k.Type.PRINTABLESTRING:d+=" (Printable String)";break;case k.Type.IA5String:d+=" (IA5String (ASCII))";break;case k.Type.UTCTIME:d+=
" (UTC time)";break;case k.Type.GENERALIZEDTIME:d+=" (Generalized time)";break;case k.Type.BMPSTRING:d+=" (BMP String)"}else d+=a.type;if(d+="\n",d+=e+"Constructed: "+a.constructed+"\n",a.composed){var m=0,r="";for(h=0;h<a.value.length;++h)void 0!==a.value[h]&&(m+=1,r+=k.prettyPrint(a.value[h],b+1,c),h+1<a.value.length&&(r+=","));d+=e+"Sub values: "+m+r}else{if(d+=e+"Value: ",a.type===k.Type.OID)b=k.derToOid(a.value),d+=b,f.pki&&f.pki.oids&&b in f.pki.oids&&(d+=" ("+f.pki.oids[b]+") ");if(a.type===
k.Type.INTEGER)try{d+=k.derToInteger(a.value)}catch(v){d+="0x"+f.util.bytesToHex(a.value)}else if(a.type===k.Type.BITSTRING){if(1<a.value.length?d+="0x"+f.util.bytesToHex(a.value.slice(1)):d+="(none)",0<a.value.length)a=a.value.charCodeAt(0),1==a?d+=" (1 unused bit shown)":1<a&&(d+=" ("+a+" unused bits shown)")}else if(a.type===k.Type.OCTETSTRING)l.test(a.value)||(d+="("+a.value+") "),d+="0x"+f.util.bytesToHex(a.value);else if(a.type===k.Type.UTF8)try{d+=f.util.decodeUtf8(a.value)}catch(v){if("URI malformed"!==
v.message)throw v;d+="0x"+f.util.bytesToHex(a.value)+" (malformed UTF8)"}else a.type===k.Type.PRINTABLESTRING||a.type===k.Type.IA5String?d+=a.value:l.test(a.value)?d+="0x"+f.util.bytesToHex(a.value):0===a.value.length?d+="[null]":d+=a.value}return d}},function(a,b,c){b=c(0);a.exports=b.md=b.md||{};b.md.algorithms=b.md.algorithms||{}},function(a,b,c){function d(a,b){e.cipher.registerAlgorithm(a,function(){return new e.aes.Algorithm(a,b)})}function f(){r=!0;g=[0,1,2,4,8,16,32,64,128,27,54];for(var a=
Array(256),b=0;128>b;++b)a[b]=b<<1,a[b+128]=b+128<<1^283;h=Array(256);n=Array(256);p=Array(4);q=Array(4);for(b=0;4>b;++b)p[b]=Array(256),q[b]=Array(256);var c,d,e,f,m=0,k=0;for(b=0;256>b;++b){var l=(l=k^k<<1^k<<2^k<<3^k<<4)>>8^255&l^99;h[m]=l;n[l]=m;var G=(f=a[l])<<24^l<<16^l<<8^l^f;var L=((c=a[m])^(d=a[c])^(e=a[d]))<<24^(m^e)<<16^(m^d^e)<<8^m^c^e;for(var K=0;4>K;++K)p[K][m]=G,q[K][l]=L,G=G<<24|G>>>8,L=L<<24|L>>>8;0===m?m=k=1:(m=c^a[a[a[c^e]]],k^=a[a[k]])}}function k(a,b){a=a.slice(0);for(var c=1,
d=a.length,e=4*(d+6+1),f=d;f<e;++f){var m=a[f-1];0==f%d?(m=h[m>>>16&255]<<24^h[m>>>8&255]<<16^h[255&m]<<8^h[m>>>24]^g[c]<<24,c++):6<d&&4==f%d&&(m=h[m>>>24]<<24^h[m>>>16&255]<<16^h[m>>>8&255]<<8^h[255&m]);a[f]=a[f-d]^m}if(b){m=q[0];c=q[1];d=q[2];for(var k=q[3],n=a.slice(0),l=(f=0,(e=a.length)-4);f<e;f+=4,l-=4)if(0===f||f===e-4)n[f]=a[l],n[f+1]=a[l+3],n[f+2]=a[l+2],n[f+3]=a[l+1];else for(var p=0;4>p;++p)b=a[l+p],n[f+(3&-p)]=m[h[b>>>24]]^c[h[b>>>16&255]]^d[h[b>>>8&255]]^k[h[255&b]];a=n}return a}function l(a,
b,c,d){var e,g,f,m,k,l=a.length/4-1;d?(e=q[0],g=q[1],f=q[2],m=q[3],k=n):(e=p[0],g=p[1],f=p[2],m=p[3],k=h);var v=b[0]^a[0];var r=b[d?3:1]^a[1];var u=b[2]^a[2];b=b[d?1:3]^a[3];for(var A=3,x=1;x<l;++x){var y=e[v>>>24]^g[r>>>16&255]^f[u>>>8&255]^m[255&b]^a[++A];var F=e[r>>>24]^g[u>>>16&255]^f[b>>>8&255]^m[255&v]^a[++A];var P=e[u>>>24]^g[b>>>16&255]^f[v>>>8&255]^m[255&r]^a[++A];b=e[b>>>24]^g[v>>>16&255]^f[r>>>8&255]^m[255&u]^a[++A];v=y;r=F;u=P}c[0]=k[v>>>24]<<24^k[r>>>16&255]<<16^k[u>>>8&255]<<8^k[255&
b]^a[++A];c[d?3:1]=k[r>>>24]<<24^k[u>>>16&255]<<16^k[b>>>8&255]<<8^k[255&v]^a[++A];c[2]=k[u>>>24]<<24^k[b>>>16&255]<<16^k[v>>>8&255]<<8^k[255&r]^a[++A];c[d?1:3]=k[b>>>24]<<24^k[v>>>16&255]<<16^k[r>>>8&255]<<8^k[255&u]^a[++A]}function m(a){var b,c="AES-"+((a=a||{}).mode||"CBC").toUpperCase(),d=(b=a.decrypt?e.cipher.createDecipher(c,a.key):e.cipher.createCipher(c,a.key)).start;return b.start=function(a,c){var g=null;c instanceof e.util.ByteBuffer&&(g=c,c={});(c=c||{}).output=g;c.iv=a;d.call(b,c)},b}
var e=c(0);c(13);c(19);c(1);a.exports=e.aes=e.aes||{};e.aes.startEncrypting=function(a,b,c,d){a=m({key:a,output:c,decrypt:!1,mode:d});return a.start(b),a};e.aes.createEncryptionCipher=function(a,b){return m({key:a,output:null,decrypt:!1,mode:b})};e.aes.startDecrypting=function(a,b,c,d){a=m({key:a,output:c,decrypt:!0,mode:d});return a.start(b),a};e.aes.createDecryptionCipher=function(a,b){return m({key:a,output:null,decrypt:!0,mode:b})};e.aes.Algorithm=function(a,b){r||f();var c=this;c.name=a;c.mode=
new b({blockSize:16,cipher:{encrypt:function(a,b){return l(c._w,a,b,!1)},decrypt:function(a,b){return l(c._w,a,b,!0)}}});c._init=!1};e.aes.Algorithm.prototype.initialize=function(a){if(!this._init){var b=a.key;if("string"!=typeof b||16!==b.length&&24!==b.length&&32!==b.length){if(e.util.isArray(b)&&(16===b.length||24===b.length||32===b.length)){var c=b;b=e.util.createBuffer();for(var d=0;d<c.length;++d)b.putByte(c[d])}}else b=e.util.createBuffer(b);if(!e.util.isArray(b)){c=b;b=[];var g=c.length();
if(16===g||24===g||32===g)for(g>>>=2,d=0;d<g;++d)b.push(c.getInt32())}if(!e.util.isArray(b)||4!==b.length&&6!==b.length&&8!==b.length)throw Error("Invalid key parameter.");c=-1!==["CFB","OFB","CTR","GCM"].indexOf(this.mode.name);this._w=k(b,a.decrypt&&!c);this._init=!0}};e.aes._expandKey=function(a,b){return r||f(),k(a,b)};e.aes._updateBlock=l;d("AES-ECB",e.cipher.modes.ecb);d("AES-CBC",e.cipher.modes.cbc);d("AES-CFB",e.cipher.modes.cfb);d("AES-OFB",e.cipher.modes.ofb);d("AES-CTR",e.cipher.modes.ctr);
d("AES-GCM",e.cipher.modes.gcm);var h,n,g,p,q,r=!1},function(a,b,c){function d(a,b){f[a]=b;f[b]=a}b=c(0);b.pki=b.pki||{};var f=a.exports=b.pki.oids=b.oids=b.oids||{};d("1.2.840.113549.1.1.1","rsaEncryption");d("1.2.840.113549.1.1.4","md5WithRSAEncryption");d("1.2.840.113549.1.1.5","sha1WithRSAEncryption");d("1.2.840.113549.1.1.7","RSAES-OAEP");d("1.2.840.113549.1.1.8","mgf1");d("1.2.840.113549.1.1.9","pSpecified");d("1.2.840.113549.1.1.10","RSASSA-PSS");d("1.2.840.113549.1.1.11","sha256WithRSAEncryption");
d("1.2.840.113549.1.1.12","sha384WithRSAEncryption");d("1.2.840.113549.1.1.13","sha512WithRSAEncryption");d("1.3.101.112","EdDSA25519");d("1.2.840.10040.4.3","dsa-with-sha1");d("1.3.14.3.2.7","desCBC");d("1.3.14.3.2.26","sha1");d("1.3.14.3.2.29","sha1WithRSASignature");d("2.16.840.1.101.3.4.2.1","sha256");d("2.16.840.1.101.3.4.2.2","sha384");d("2.16.840.1.101.3.4.2.3","sha512");d("2.16.840.1.101.3.4.2.4","sha224");d("2.16.840.1.101.3.4.2.5","sha512-224");d("2.16.840.1.101.3.4.2.6","sha512-256");d("1.2.840.113549.2.2",
"md2");d("1.2.840.113549.2.5","md5");d("1.2.840.113549.1.7.1","data");d("1.2.840.113549.1.7.2","signedData");d("1.2.840.113549.1.7.3","envelopedData");d("1.2.840.113549.1.7.4","signedAndEnvelopedData");d("1.2.840.113549.1.7.5","digestedData");d("1.2.840.113549.1.7.6","encryptedData");d("1.2.840.113549.1.9.1","emailAddress");d("1.2.840.113549.1.9.2","unstructuredName");d("1.2.840.113549.1.9.3","contentType");d("1.2.840.113549.1.9.4","messageDigest");d("1.2.840.113549.1.9.5","signingTime");d("1.2.840.113549.1.9.6",
"counterSignature");d("1.2.840.113549.1.9.7","challengePassword");d("1.2.840.113549.1.9.8","unstructuredAddress");d("1.2.840.113549.1.9.14","extensionRequest");d("1.2.840.113549.1.9.20","friendlyName");d("1.2.840.113549.1.9.21","localKeyId");d("1.2.840.113549.1.9.22.1","x509Certificate");d("1.2.840.113549.1.12.10.1.1","keyBag");d("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");d("1.2.840.113549.1.12.10.1.3","certBag");d("1.2.840.113549.1.12.10.1.4","crlBag");d("1.2.840.113549.1.12.10.1.5","secretBag");
d("1.2.840.113549.1.12.10.1.6","safeContentsBag");d("1.2.840.113549.1.5.13","pkcs5PBES2");d("1.2.840.113549.1.5.12","pkcs5PBKDF2");d("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");d("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");d("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");d("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");d("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");d("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");d("1.2.840.113549.2.7",
"hmacWithSHA1");d("1.2.840.113549.2.8","hmacWithSHA224");d("1.2.840.113549.2.9","hmacWithSHA256");d("1.2.840.113549.2.10","hmacWithSHA384");d("1.2.840.113549.2.11","hmacWithSHA512");d("1.2.840.113549.3.7","des-EDE3-CBC");d("2.16.840.1.101.3.4.1.2","aes128-CBC");d("2.16.840.1.101.3.4.1.22","aes192-CBC");d("2.16.840.1.101.3.4.1.42","aes256-CBC");d("2.5.4.3","commonName");d("2.5.4.4","surname");d("2.5.4.5","serialNumber");d("2.5.4.6","countryName");d("2.5.4.7","localityName");d("2.5.4.8","stateOrProvinceName");
d("2.5.4.9","streetAddress");d("2.5.4.10","organizationName");d("2.5.4.11","organizationalUnitName");d("2.5.4.12","title");d("2.5.4.13","description");d("2.5.4.15","businessCategory");d("2.5.4.17","postalCode");d("2.5.4.42","givenName");d("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");d("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");d("2.16.840.1.113730.1.1","nsCertType");d("2.16.840.1.113730.1.13","nsComment");f["2.5.29.1"]="authorityKeyIdentifier";
f["2.5.29.2"]="keyAttributes";f["2.5.29.3"]="certificatePolicies";f["2.5.29.4"]="keyUsageRestriction";f["2.5.29.5"]="policyMapping";f["2.5.29.6"]="subtreesConstraint";f["2.5.29.7"]="subjectAltName";f["2.5.29.8"]="issuerAltName";f["2.5.29.9"]="subjectDirectoryAttributes";f["2.5.29.10"]="basicConstraints";f["2.5.29.11"]="nameConstraints";f["2.5.29.12"]="policyConstraints";f["2.5.29.13"]="basicConstraints";d("2.5.29.14","subjectKeyIdentifier");d("2.5.29.15","keyUsage");f["2.5.29.16"]="privateKeyUsagePeriod";
d("2.5.29.17","subjectAltName");d("2.5.29.18","issuerAltName");d("2.5.29.19","basicConstraints");f["2.5.29.20"]="cRLNumber";f["2.5.29.21"]="cRLReason";f["2.5.29.22"]="expirationDate";f["2.5.29.23"]="instructionCode";f["2.5.29.24"]="invalidityDate";f["2.5.29.25"]="cRLDistributionPoints";f["2.5.29.26"]="issuingDistributionPoint";f["2.5.29.27"]="deltaCRLIndicator";f["2.5.29.28"]="issuingDistributionPoint";f["2.5.29.29"]="certificateIssuer";f["2.5.29.30"]="nameConstraints";d("2.5.29.31","cRLDistributionPoints");
d("2.5.29.32","certificatePolicies");f["2.5.29.33"]="policyMappings";f["2.5.29.34"]="policyConstraints";d("2.5.29.35","authorityKeyIdentifier");f["2.5.29.36"]="policyConstraints";d("2.5.29.37","extKeyUsage");f["2.5.29.46"]="freshestCRL";f["2.5.29.54"]="inhibitAnyPolicy";d("1.3.6.1.4.1.11129.2.4.2","timestampList");d("1.3.6.1.5.5.7.1.1","authorityInfoAccess");d("1.3.6.1.5.5.7.3.1","serverAuth");d("1.3.6.1.5.5.7.3.2","clientAuth");d("1.3.6.1.5.5.7.3.3","codeSigning");d("1.3.6.1.5.5.7.3.4","emailProtection");
d("1.3.6.1.5.5.7.3.8","timeStamping")},function(a,b,c){function d(a){for(var b=a.name+": ",c=[],d=function(a,b){return" "+b},h=0;h<a.values.length;++h)c.push(a.values[h].replace(/^(\S+\r\n)/,d));b+=c.join(",")+"\r\n";c=0;a=-1;for(h=0;h<b.length;++h,++c)65<c&&-1!==a?(c=b[a],","===c?(++a,b=b.substr(0,a)+"\r\n "+b.substr(a)):b=b.substr(0,a)+"\r\n"+c+b.substr(a+1),c=h-a-1,a=-1,++h):" "!==b[h]&&"\t"!==b[h]&&","!==b[h]||(a=h);return b}var f=c(0);c(1);a=a.exports=f.pem=f.pem||{};a.encode=function(a,b){b=
b||{};var c,e="-----BEGIN "+a.type+"-----\r\n";if(a.procType&&(e+=d({name:"Proc-Type",values:[String(a.procType.version),a.procType.type]})),a.contentDomain&&(e+=d({name:"Content-Domain",values:[a.contentDomain]})),a.dekInfo&&(c={name:"DEK-Info",values:[a.dekInfo.algorithm]},a.dekInfo.parameters&&c.values.push(a.dekInfo.parameters),e+=d(c)),a.headers)for(c=0;c<a.headers.length;++c)e+=d(a.headers[c]);return a.procType&&(e+="\r\n"),e+=f.util.encode64(a.body,b.maxline||64)+"\r\n",e+("-----END "+a.type+
"-----\r\n")};a.decode=function(a){for(var b,c=[],d=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,h=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,k=/\r?\n/;b=d.exec(a);){var g=b[1];"NEW CERTIFICATE REQUEST"===g&&(g="CERTIFICATE REQUEST");g={type:g,procType:null,contentDomain:null,dekInfo:null,headers:[],body:f.util.decode64(b[3])};if(c.push(g),b[2]){for(var p=b[2].split(k),q=0;b&&q<p.length;){b=p[q].replace(/\s+$/,"");for(var r=q+1;r<p.length;++r){var v=
p[r];if(!/\s/.test(v[0]))break;b+=v;q=r}if(b=b.match(h)){r={name:b[1],values:[]};v=b[2].split(",");for(var u=0;u<v.length;++u)r.values.push(v[u].replace(/^\s+/,""));if(g.procType)if(g.contentDomain||"Content-Domain"!==r.name)if(g.dekInfo||"DEK-Info"!==r.name)g.headers.push(r);else{if(0===r.values.length)throw Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');g.dekInfo={algorithm:v[0],parameters:v[1]||null}}else g.contentDomain=v[0]||"";else{if("Proc-Type"!==
r.name)throw Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==r.values.length)throw Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');g.procType={version:v[0],type:v[1]}}}++q}if("ENCRYPTED"===g.procType&&!g.dekInfo)throw Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".');}}if(0===c.length)throw Error("Invalid PEM formatted message.");return c}},function(a,
b,c){var d=c(0);c(4);c(1);(a.exports=d.hmac=d.hmac||{}).create=function(){var a=null,b=null,c=null,m={start:function(e,h){if(null!==e)if("string"==typeof e){if(!((e=e.toLowerCase())in d.md.algorithms))throw Error('Unknown hash algorithm "'+e+'"');a=d.md.algorithms[e].create()}else a=e;if(null!==h){if("string"==typeof h)h=d.util.createBuffer(h);else if(d.util.isArray(h)){e=h;h=d.util.createBuffer();for(var f=0;f<e.length;++f)h.putByte(e[f])}var g=h.length();g>a.blockLength&&(a.start(),a.update(h.bytes()),
h=a.digest());b=d.util.createBuffer();c=d.util.createBuffer();g=h.length();for(f=0;f<g;++f)e=h.at(f),b.putByte(54^e),c.putByte(92^e);if(g<a.blockLength)for(e=a.blockLength-g,f=0;f<e;++f)b.putByte(54),c.putByte(92);b=b.bytes();c=c.bytes()}a.start();a.update(b)},update:function(b){a.update(b)},getMac:function(){var b=a.digest().bytes();return a.start(),a.update(c),a.update(b),a.digest()}};return m.digest=m.getMac,m}},function(a,b,c){function d(a,b,c){for(var d,e,h,f,m,k,l,A=c.length();64<=A;){e=a.h0;
h=a.h1;f=a.h2;m=a.h3;k=a.h4;for(l=0;16>l;++l)d=c.getInt32(),b[l]=d,d=(e<<5|e>>>27)+(m^h&(f^m))+k+1518500249+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;for(;20>l;++l)d=(d=b[l-3]^b[l-8]^b[l-14]^b[l-16])<<1|d>>>31,b[l]=d,d=(e<<5|e>>>27)+(m^h&(f^m))+k+1518500249+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;for(;32>l;++l)d=(d=b[l-3]^b[l-8]^b[l-14]^b[l-16])<<1|d>>>31,b[l]=d,d=(e<<5|e>>>27)+(h^f^m)+k+1859775393+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;for(;40>l;++l)d=(d=b[l-6]^b[l-16]^b[l-28]^b[l-32])<<2|d>>>30,b[l]=d,
d=(e<<5|e>>>27)+(h^f^m)+k+1859775393+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;for(;60>l;++l)d=(d=b[l-6]^b[l-16]^b[l-28]^b[l-32])<<2|d>>>30,b[l]=d,d=(e<<5|e>>>27)+(h&f|m&(h^f))+k+2400959708+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;for(;80>l;++l)d=(d=b[l-6]^b[l-16]^b[l-28]^b[l-32])<<2|d>>>30,b[l]=d,d=(e<<5|e>>>27)+(h^f^m)+k+3395469782+d,k=m,m=f,f=(h<<30|h>>>2)>>>0,h=e,e=d;a.h0=a.h0+e|0;a.h1=a.h1+h|0;a.h2=a.h2+f|0;a.h3=a.h3+m|0;a.h4=a.h4+k|0;A-=64}}var f=c(0);c(4);c(1);a=a.exports=f.sha1=f.sha1||{};f.md.sha1=
f.md.algorithms.sha1=a;a.create=function(){l||(k=String.fromCharCode(128),k+=f.util.fillString(String.fromCharCode(0),64),l=!0);var a=null,b=f.util.createBuffer(),c=Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){n.messageLength=0;n.fullMessageLength=n.messageLength64=[];for(var c=n.messageLengthSize/4,d=0;d<c;++d)n.fullMessageLength.push(0);return b=f.util.createBuffer(),a={h0:1732584193,h1:4023233417,h2:2562383102,
h3:271733878,h4:3285377520},n}};return n.start(),n.update=function(e,h){"utf8"===h&&(e=f.util.encodeUtf8(e));h=e.length;n.messageLength+=h;h=[h/4294967296>>>0,h>>>0];for(var g=n.fullMessageLength.length-1;0<=g;--g)n.fullMessageLength[g]+=h[1],h[1]=h[0]+(n.fullMessageLength[g]/4294967296>>>0),n.fullMessageLength[g]>>>=0,h[0]=h[1]/4294967296>>>0;return b.putBytes(e),d(a,c,b),(2048<b.read||0===b.length())&&b.compact(),n},n.digest=function(){var e=f.util.createBuffer();e.putBytes(b.bytes());var h;e.putBytes(k.substr(0,
n.blockLength-(n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize&n.blockLength-1)));for(var m=8*n.fullMessageLength[0],l=0;l<n.fullMessageLength.length-1;++l)m+=(h=8*n.fullMessageLength[l+1])/4294967296>>>0,e.putInt32(m>>>0),m=h>>>0;e.putInt32(m);h={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3,h4:a.h4};d(h,c,e);e=f.util.createBuffer();return e.putInt32(h.h0),e.putInt32(h.h1),e.putInt32(h.h2),e.putInt32(h.h3),e.putInt32(h.h4),e},n};var k=null,l=!1},function(a,b,c){function d(a,b){l.cipher.registerAlgorithm(a,
function(){return new l.des.Algorithm(a,b)})}function f(a,b,c,d){var f=32===a.length?3:9;d=3===f?d?[30,-2,-2]:[0,32,2]:d?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var k=b[0],l=b[1];k^=(b=252645135&(k>>>4^l))<<4;k^=(b=65535&(k>>>16^(l^=b)))<<16;k^=b=858993459&((l^=b)>>>2^k);k^=b=16711935&((l^=b<<2)>>>8^k);k=(k^=(b=1431655765&(k>>>1^(l^=b<<8)))<<1)<<1|k>>>31;l=(l^=b)<<1|l>>>31;for(var v=0;v<f;v+=3){for(var C=d[v+1],G=d[v+2],L=d[v];L!=C;L+=G){var u=l^a[L],A=(l>>>4|l<<28)^a[L+1];b=k;k=l;l=
b^(e[u>>>24&63]|n[u>>>16&63]|p[u>>>8&63]|r[63&u]|m[A>>>24&63]|h[A>>>16&63]|g[A>>>8&63]|q[63&A])}b=k;k=l;l=b}l=l>>>1|l<<31;l^=b=1431655765&((k=k>>>1|k<<31)>>>1^l);l^=(b=16711935&(l>>>8^(k^=b<<1)))<<8;l^=(b=858993459&(l>>>2^(k^=b)))<<2;l^=b=65535&((k^=b)>>>16^l);l^=b=252645135&((k^=b<<16)>>>4^l);c[0]=k^b<<4;c[1]=l}function k(a){var b,c="DES-"+((a=a||{}).mode||"CBC").toUpperCase(),d=(b=a.decrypt?l.cipher.createDecipher(c,a.key):l.cipher.createCipher(c,a.key)).start;return b.start=function(a,c){var e=
null;c instanceof l.util.ByteBuffer&&(e=c,c={});(c=c||{}).output=e;c.iv=a;d.call(b,c)},b}var l=c(0);c(13);c(19);c(1);a.exports=l.des=l.des||{};l.des.startEncrypting=function(a,b,c,d){a=k({key:a,output:c,decrypt:!1,mode:d||(null===b?"ECB":"CBC")});return a.start(b),a};l.des.createEncryptionCipher=function(a,b){return k({key:a,output:null,decrypt:!1,mode:b})};l.des.startDecrypting=function(a,b,c,d){a=k({key:a,output:c,decrypt:!0,mode:d||(null===b?"ECB":"CBC")});return a.start(b),a};l.des.createDecryptionCipher=
function(a,b){return k({key:a,output:null,decrypt:!0,mode:b})};l.des.Algorithm=function(a,b){var c=this;c.name=a;c.mode=new b({blockSize:8,cipher:{encrypt:function(a,b){return f(c._keys,a,b,!1)},decrypt:function(a,b){return f(c._keys,a,b,!0)}}});c._init=!1};l.des.Algorithm.prototype.initialize=function(a){if(!this._init){a=l.util.createBuffer(a.key);if(0===this.name.indexOf("3DES")&&24!==a.length())throw Error("Invalid Triple-DES key size: "+8*a.length());for(var b,c=[0,4,536870912,536870916,65536,
65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],d=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],e=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],g=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],h=[0,262144,16,262160,0,262144,16,262160,4096,266240,
4112,266256,4096,266240,4112,266256],f=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],m=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],k=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],n=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],
p=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],v=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],q=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],r=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,
257,261,1,5,257,261],F=8<a.length()?3:1,P=[],Q=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],U=0,O=0;O<F;O++){var N=a.getInt32(),H=a.getInt32();N^=(b=252645135&(N>>>4^H))<<4;N^=b=65535&((H^=b)>>>-16^N);N^=(b=858993459&(N>>>2^(H^=b<<-16)))<<2;N^=b=65535&((H^=b)>>>-16^N);N^=(b=1431655765&(N>>>1^(H^=b<<-16)))<<1;N^=b=16711935&((H^=b)>>>8^N);b=(N^(b=1431655765&(N>>>1^(H^=b<<8)))<<1)<<8|(H^=b)>>>20&240;N=H<<24|H<<8&16711680|H>>>8&65280|H>>>24&240;H=b;for(var R=0;R<Q.length;++R){Q[R]?(N=N<<2|N>>>26,H=H<<2|H>>>26):
(N=N<<1|N>>>27,H=H<<1|H>>>27);var V=c[(N&=-15)>>>28]|d[N>>>24&15]|e[N>>>20&15]|g[N>>>16&15]|h[N>>>12&15]|f[N>>>8&15]|m[N>>>4&15],S=k[(H&=-15)>>>28]|n[H>>>24&15]|p[H>>>20&15]|v[H>>>16&15]|q[H>>>12&15]|r[H>>>8&15]|y[H>>>4&15];b=65535&(S>>>16^V);P[U++]=V^b;P[U++]=S^b<<16}}this._keys=P;this._init=!0}};d("DES-ECB",l.cipher.modes.ecb);d("DES-CBC",l.cipher.modes.cbc);d("DES-CFB",l.cipher.modes.cfb);d("DES-OFB",l.cipher.modes.ofb);d("DES-CTR",l.cipher.modes.ctr);d("3DES-ECB",l.cipher.modes.ecb);d("3DES-CBC",
l.cipher.modes.cbc);d("3DES-CFB",l.cipher.modes.cfb);d("3DES-OFB",l.cipher.modes.ofb);d("3DES-CTR",l.cipher.modes.ctr);var m=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,
66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],e=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,
-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],h=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,
134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],n=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,
8396928],g=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,
1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],p=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,
16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],q=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,
2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],r=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,
268701760,266240,266240,4160,4160,262208,268435456,268701696]},function(a,b,c){function d(a,b,c){var d=g.util.createBuffer();b=Math.ceil(b.n.bitLength()/8);if(a.length>b-11)throw d=Error("Message is too long for PKCS#1 v1.5 padding."),d.length=a.length,d.max=b-11,d;d.putByte(0);d.putByte(c);b=b-3-a.length;if(0===c||1===c){var e=0===c?0:255;for(c=0;c<b;++c)d.putByte(e)}else for(;0<b;){var h=0,f=g.random.getBytes(b);for(c=0;c<b;++c)0===(e=f.charCodeAt(c))?++h:d.putByte(e);b=h}return d.putByte(0),d.putBytes(a),
d}function f(a,b,c,d){b=Math.ceil(b.n.bitLength()/8);a=g.util.createBuffer(a);var e=a.getByte(),h=a.getByte();if(0!==e||c&&0!==h&&1!==h||!c&&2!=h||c&&0===h&&void 0===d)throw Error("Encryption block is invalid.");c=0;if(0===h)for(c=b-3-d,d=0;d<c;++d){if(0!==a.getByte())throw Error("Encryption block is invalid.");}else if(1===h)for(c=0;1<a.length();){if(255!==a.getByte()){--a.read;break}++c}else if(2===h)for(c=0;1<a.length();){if(0===a.getByte()){--a.read;break}++c}if(0!==a.getByte()||c!==b-3-a.length())throw Error("Encryption block is invalid.");
return a.getBytes()}function k(a,b,c){function d(){e(a.pBits,function(b,d){return b?c(b):(a.p=d,null!==a.q?h(b,a.q):void e(a.qBits,h))})}function e(a,b){g.prime.generateProbablePrime(a,f,b)}function h(b,g){if(b)return c(b);if(a.q=g,0>a.p.compareTo(a.q))b=a.p,a.p=a.q,a.q=b;if(0!==a.p.subtract(p.ONE).gcd(a.e).compareTo(p.ONE))return a.p=null,void d();if(0!==a.q.subtract(p.ONE).gcd(a.e).compareTo(p.ONE))return a.q=null,void e(a.qBits,h);if(a.p1=a.p.subtract(p.ONE),a.q1=a.q.subtract(p.ONE),a.phi=a.p1.multiply(a.q1),
0!==a.phi.gcd(a.e).compareTo(p.ONE))return a.p=a.q=null,void d();if(a.n=a.p.multiply(a.q),a.n.bitLength()!==a.bits)return a.q=null,void e(a.qBits,h);b=a.e.modInverse(a.phi);a.keys={privateKey:u.rsa.setPrivateKey(a.n,a.e,b,a.p,a.q,b.mod(a.p1),b.mod(a.q1),a.q.modInverse(a.p)),publicKey:u.rsa.setPublicKey(a.n,a.e)};c(null,a.keys)}"function"==typeof b&&(c=b,b={});var f={algorithm:{name:(b=b||{}).algorithm||"PRIMEINC",options:{workers:b.workers||2,workLoad:b.workLoad||100,workerScript:b.workerScript}}};
"prng"in b&&(f.prng=b.prng);d()}function l(a){a=a.toString(16);"8"<=a[0]&&(a="00"+a);a=g.util.hexToBytes(a);return 1<a.length&&(0===a.charCodeAt(0)&&0==(128&a.charCodeAt(1))||255===a.charCodeAt(0)&&128==(128&a.charCodeAt(1)))?a.substr(1):a}function m(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}function e(a){return void 0!==v.globalScope&&"object"==typeof v.globalScope.crypto&&"object"==typeof v.globalScope.crypto.subtle&&"function"==
typeof v.globalScope.crypto.subtle[a]}function h(a){return void 0!==v.globalScope&&"object"==typeof v.globalScope.msCrypto&&"object"==typeof v.globalScope.msCrypto.subtle&&"function"==typeof v.globalScope.msCrypto.subtle[a]}function n(a){a=g.util.hexToBytes(a.toString(16));for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}var g=c(0);if(c(3),c(12),c(6),c(26),c(27),c(2),c(1),void 0===p)var p=g.jsbn.BigInteger;var q=g.util.isNodejs?c(16):null,r=g.asn1,v=g.util;g.pki=
g.pki||{};a.exports=g.pki.rsa=g.rsa=g.rsa||{};var u=g.pki,A=[6,4,2,4,2,4,6,2],x={name:"PrivateKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,
capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},B={name:"RSAPrivateKey",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",
tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",
tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},I={name:"RSAPublicKey",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,
constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},D=g.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,
type:r.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},E={name:"DigestInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,
constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:r.Class.UNIVERSAL,type:r.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},C=function(a){if(!(a.algorithm in u.oids)){var b=Error("Unknown message digest algorithm.");
throw b.algorithm=a.algorithm,b;}var c=r.oidToDer(u.oids[a.algorithm]).getBytes();b=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);var d=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);d.value.push(r.create(r.Class.UNIVERSAL,r.Type.OID,!1,c));d.value.push(r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,""));a=r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,a.digest().getBytes());return b.value.push(d),b.value.push(a),r.toDer(b).getBytes()},G=function(a,b,c){if(c)return a.modPow(b.e,b.n);if(!b.p||
!b.q)return a.modPow(b.d,b.n);b.dP||(b.dP=b.d.mod(b.p.subtract(p.ONE)));b.dQ||(b.dQ=b.d.mod(b.q.subtract(p.ONE)));b.qInv||(b.qInv=b.q.modInverse(b.p));do c=new p(g.util.bytesToHex(g.random.getBytes(b.n.bitLength()/8)),16);while(0<=c.compareTo(b.n)||!c.gcd(b.n).equals(p.ONE));var d=(a=a.multiply(c.modPow(b.e,b.n)).mod(b.n)).mod(b.p).modPow(b.dP,b.p);for(a=a.mod(b.q).modPow(b.dQ,b.q);0>d.compareTo(a);)d=d.add(b.p);return d.subtract(a).multiply(b.qInv).mod(b.p).multiply(b.q).add(a).multiply(c.modInverse(b.n)).mod(b.n)};
u.rsa.encrypt=function(a,b,c){var e,h=c,f=Math.ceil(b.n.bitLength()/8);!1!==c&&!0!==c?(h=2===c,e=d(a,b,c)):(e=g.util.createBuffer()).putBytes(a);a=new p(e.toHex(),16);b=G(a,b,h).toString(16);h=g.util.createBuffer();for(f-=Math.ceil(b.length/2);0<f;)h.putByte(0),--f;return h.putBytes(g.util.hexToBytes(b)),h.getBytes()};u.rsa.decrypt=function(a,b,c,d){var e=Math.ceil(b.n.bitLength()/8);if(a.length!==e)throw b=Error("Encrypted message length is invalid."),b.length=a.length,b.expected=e,b;a=new p(g.util.createBuffer(a).toHex(),
16);if(0<=a.compareTo(b.n))throw Error("Encrypted message is invalid.");a=G(a,b,c).toString(16);var h=g.util.createBuffer();for(e-=Math.ceil(a.length/2);0<e;)h.putByte(0),--e;return h.putBytes(g.util.hexToBytes(a)),!1!==d?f(h.getBytes(),b,c):h.getBytes()};u.rsa.createKeyPairGenerationState=function(a,b,c){"string"==typeof a&&(a=parseInt(a,10));a=a||2048;var d,e=(c=c||{}).prng||g.random;c=c.algorithm||"PRIMEINC";if("PRIMEINC"!==c)throw Error("Invalid key generation algorithm: "+c);return(d={algorithm:c,
state:0,bits:a,rng:{nextBytes:function(a){for(var b=e.getBytesSync(a.length),c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}},eInt:b||65537,e:new p(null),p:null,q:null,qBits:a>>1,pBits:a-(a>>1),pqState:0,num:null,keys:null}).e.fromInt(d.eInt),d};u.rsa.stepKeyPairGenerationState=function(a,b){"algorithm"in a||(a.algorithm="PRIMEINC");var c=new p(null);c.fromInt(30);for(var d,e=0,g=function(a,b){return a|b},h=+new Date,f=0;null===a.keys&&(0>=b||f<b);){if(0===a.state){d=null===a.p?a.pBits:a.qBits;var k=d-1;
0===a.pqState?(a.num=new p(d,a.rng),a.num.testBit(k)||a.num.bitwiseTo(p.ONE.shiftLeft(k),g,a.num),a.num.dAddOffset(31-a.num.mod(c).byteValue(),0),e=0,++a.pqState):1===a.pqState?a.num.bitLength()>d?a.pqState=0:a.num.isProbablePrime(m(a.num.bitLength()))?++a.pqState:a.num.dAddOffset(A[e++%8],0):2===a.pqState?a.pqState=0===a.num.subtract(p.ONE).gcd(a.e).compareTo(p.ONE)?3:0:3===a.pqState&&(a.pqState=0,null===a.p?a.p=a.num:a.q=a.num,null!==a.p&&null!==a.q&&++a.state,a.num=null)}else 1===a.state?(0>a.p.compareTo(a.q)&&
(a.num=a.p,a.p=a.q,a.q=a.num),++a.state):2===a.state?(a.p1=a.p.subtract(p.ONE),a.q1=a.q.subtract(p.ONE),a.phi=a.p1.multiply(a.q1),++a.state):3===a.state?0===a.phi.gcd(a.e).compareTo(p.ONE)?++a.state:(a.p=null,a.q=null,a.state=0):4===a.state?(a.n=a.p.multiply(a.q),a.n.bitLength()===a.bits?++a.state:(a.q=null,a.state=0)):5===a.state&&(d=a.e.modInverse(a.phi),a.keys={privateKey:u.rsa.setPrivateKey(a.n,a.e,d,a.p,a.q,d.mod(a.p1),d.mod(a.q1),a.q.modInverse(a.p)),publicKey:u.rsa.setPublicKey(a.n,a.e)});
f+=(d=+new Date)-h;h=d}return null!==a.keys};u.rsa.generateKeyPair=function(a,b,c,d){if(1===arguments.length?"object"==typeof a?(c=a,a=void 0):"function"==typeof a&&(d=a,a=void 0):2===arguments.length?"number"==typeof a?"function"==typeof b?(d=b,b=void 0):"number"!=typeof b&&(c=b,b=void 0):(c=a,d=b,a=void 0,b=void 0):3===arguments.length&&("number"==typeof b?"function"==typeof c&&(d=c,c=void 0):(d=c,c=b,b=void 0)),c=c||{},void 0===a&&(a=c.bits||2048),void 0===b&&(b=c.e||65537),!g.options.usePureJavaScript&&
!c.prng&&256<=a&&16384>=a&&(65537===b||3===b))if(d){if(g.util.isNodejs&&"function"==typeof q.generateKeyPair)return q.generateKeyPair("rsa",{modulusLength:a,publicExponent:b,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,b,c){if(a)return d(a);d(null,{privateKey:u.privateKeyFromPem(c),publicKey:u.publicKeyFromPem(b)})});if(e("generateKey")&&e("exportKey"))return v.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:a,
publicExponent:n(b),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return v.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){d(a)}).then(function(a){a&&(a=u.privateKeyFromAsn1(r.fromDer(g.util.createBuffer(a))),d(null,{privateKey:a,publicKey:u.setRsaPublicKey(a.n,a.e)}))});if(h("generateKey")&&h("exportKey")){var f=v.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:a,publicExponent:n(b),hash:{name:"SHA-256"}},!0,["sign",
"verify"]);return f.oncomplete=function(a){a=v.globalScope.msCrypto.subtle.exportKey("pkcs8",a.target.result.privateKey);a.oncomplete=function(a){a=u.privateKeyFromAsn1(r.fromDer(g.util.createBuffer(a.target.result)));d(null,{privateKey:a,publicKey:u.setRsaPublicKey(a.n,a.e)})};a.onerror=function(a){d(a)}},void(f.onerror=function(a){d(a)})}}else if(g.util.isNodejs&&"function"==typeof q.generateKeyPairSync)return f=q.generateKeyPairSync("rsa",{modulusLength:a,publicExponent:b,publicKeyEncoding:{type:"spki",
format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}}),{privateKey:u.privateKeyFromPem(f.privateKey),publicKey:u.publicKeyFromPem(f.publicKey)};f=u.rsa.createKeyPairGenerationState(a,b,c);if(!d)return u.rsa.stepKeyPairGenerationState(f,0),f.keys;k(f,c,d)};u.setRsaPublicKey=u.rsa.setPublicKey=function(a,b){var c={n:a,e:b,encrypt:function(a,b,e){if("string"==typeof b?b=b.toUpperCase():void 0===b&&(b="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===b)b={encode:function(a,b,c){return d(a,b,2).getBytes()}};
else if("RSA-OAEP"===b||"RSAES-OAEP"===b)b={encode:function(a,b){return g.pkcs1.encode_rsa_oaep(b,a,e)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(b))b={encode:function(a){return a}};else if("string"==typeof b)throw Error('Unsupported encryption scheme: "'+b+'".');a=b.encode(a,c,!0);return u.rsa.encrypt(a,c,!0)},verify:function(a,b,d,e){"string"==typeof d?d=d.toUpperCase():void 0===d&&(d="RSASSA-PKCS1-V1_5");void 0===e&&(e={_parseAllDigestBytes:!0});"_parseAllDigestBytes"in e||(e._parseAllDigestBytes=
!0);"RSASSA-PKCS1-V1_5"===d?d={verify:function(a,b){b=f(b,c,!0);var d=r.fromDer(b,{parseAllBytes:e._parseAllDigestBytes});b={};var h=[];if(!r.validate(d,E,b,h))throw(m=Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.")).errors=h,m;var m;d=r.derToOid(b.algorithmIdentifier);if(d!==g.oids.md2&&d!==g.oids.md5&&d!==g.oids.sha1&&d!==g.oids.sha224&&d!==g.oids.sha256&&d!==g.oids.sha384&&d!==g.oids.sha512&&d!==g.oids["sha512-224"]&&d!==g.oids["sha512-256"])throw(m=Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.")).oid=
d,m;if(!(d!==g.oids.md2&&d!==g.oids.md5||"parameters"in b))throw Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return a===b.digest}}:"NONE"!==d&&"NULL"!==d&&null!==d||(d={verify:function(a,b){return a===f(b,c,!0)}});b=u.rsa.decrypt(b,c,!0,!1);return d.verify(a,b,c.n.bitLength())}};return c};u.setRsaPrivateKey=u.rsa.setPrivateKey=function(a,b,c,d,e,h,m,k){var l={n:a,e:b,d:c,p:d,q:e,dP:h,dQ:m,qInv:k,decrypt:function(a,
b,c){"string"==typeof b?b=b.toUpperCase():void 0===b&&(b="RSAES-PKCS1-V1_5");a=u.rsa.decrypt(a,l,!1,!1);if("RSAES-PKCS1-V1_5"===b)b={decode:f};else if("RSA-OAEP"===b||"RSAES-OAEP"===b)b={decode:function(a,b){return g.pkcs1.decode_rsa_oaep(b,a,c)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(b))throw Error('Unsupported encryption scheme: "'+b+'".');b={decode:function(a){return a}}}return b.decode(a,l,!1)},sign:function(a,b){var c=!1;"string"==typeof b&&(b=b.toUpperCase());void 0===b||"RSASSA-PKCS1-V1_5"===
b?(b={encode:C},c=1):"NONE"!==b&&"NULL"!==b&&null!==b||(b={encode:function(){return a}},c=1);b=b.encode(a,l.n.bitLength());return u.rsa.encrypt(b,l,c)}};return l};u.wrapRsaPrivateKey=function(a){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(0).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(u.oids.rsaEncryption).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")]),
r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,r.toDer(a).getBytes())])};u.privateKeyFromAsn1=function(a){var b,c,d,e,h,f,m,k,l={},n=[];if(r.validate(a,x,l,n)&&(a=r.fromDer(g.util.createBuffer(l.privateKey))),l={},n=[],!r.validate(a,B,l,n))throw a=Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey."),a.errors=n,a;return b=g.util.createBuffer(l.privateKeyModulus).toHex(),c=g.util.createBuffer(l.privateKeyPublicExponent).toHex(),d=g.util.createBuffer(l.privateKeyPrivateExponent).toHex(),
e=g.util.createBuffer(l.privateKeyPrime1).toHex(),h=g.util.createBuffer(l.privateKeyPrime2).toHex(),f=g.util.createBuffer(l.privateKeyExponent1).toHex(),m=g.util.createBuffer(l.privateKeyExponent2).toHex(),k=g.util.createBuffer(l.privateKeyCoefficient).toHex(),u.setRsaPrivateKey(new p(b,16),new p(c,16),new p(d,16),new p(e,16),new p(h,16),new p(f,16),new p(m,16),new p(k,16))};u.privateKeyToAsn1=u.privateKeyToRSAPrivateKey=function(a){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,
r.Type.INTEGER,!1,r.integerToDer(0).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.n)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.e)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.d)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.p)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.q)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.dP)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.dQ)),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.qInv))])};u.publicKeyFromAsn1=function(a){var b=
{},c=[];if(r.validate(a,D,b,c)){var d;a=r.derToOid(b.publicKeyOid);if(a!==u.oids.rsaEncryption)throw(d=Error("Cannot read public key. Unknown OID.")).oid=a,d;a=b.rsaPublicKey}if(c=[],!r.validate(a,I,b,c))throw(d=Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=c,d;c=g.util.createBuffer(b.publicKeyModulus).toHex();b=g.util.createBuffer(b.publicKeyExponent).toHex();return u.setRsaPublicKey(new p(c,16),new p(b,16))};u.publicKeyToAsn1=u.publicKeyToSubjectPublicKeyInfo=
function(a){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(u.oids.rsaEncryption).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")]),r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,[u.publicKeyToRSAPublicKey(a)])])};u.publicKeyToRSAPublicKey=function(a){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,l(a.n)),r.create(r.Class.UNIVERSAL,
r.Type.INTEGER,!1,l(a.e))])}},function(a,b,c){function d(a,b,c){this.data=[];null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function f(){return new d(null)}function k(a,b,c,d,e,g){var h=16383&b;for(b>>=14;0<=--g;){var f=16383&this.data[a],m=this.data[a++]>>14,k=b*f+m*h;e=((f=h*f+((16383&k)<<14)+c.data[d]+e)>>28)+(k>>14)+b*m;c.data[d++]=268435455&f}return e}function l(a){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(a)}
function m(a,b){a=I[a.charCodeAt(b)];return null==a?-1:a}function e(a){var b=f();return b.fromInt(a),b}function h(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=a>>1&&(c+=1),c}function n(a){this.m=a}function g(a){this.m=a;this.mp=a.invDigit();this.mpl=32767&this.mp;this.mph=this.mp>>15;this.um=(1<<a.DB-15)-1;this.mt2=2*a.t}function p(a,b){return a&b}function q(a,b){return a|b}function r(a,b){return a^b}function v(a,b){return a&
~b}function u(){}function A(a){return a}function x(a){this.r2=f();this.q3=f();d.ONE.dlShiftTo(2*a.t,this.r2);this.mu=this.r2.divide(a);this.m=a}var B;b=c(0);a.exports=b.jsbn=b.jsbn||{};b.jsbn.BigInteger=d;"undefined"==typeof navigator?(d.prototype.am=k,B=28):"Microsoft Internet Explorer"==navigator.appName?(d.prototype.am=function(a,b,c,d,e,g){var h=32767&b;for(b>>=15;0<=--g;){var f=32767&this.data[a],m=this.data[a++]>>15,k=b*f+m*h;e=((f=h*f+((32767&k)<<15)+c.data[d]+(1073741823&e))>>>30)+(k>>>15)+
b*m+(e>>>30);c.data[d++]=1073741823&f}return e},B=30):"Netscape"!=navigator.appName?(d.prototype.am=function(a,b,c,d,e,g){for(;0<=--g;){var h=b*this.data[a++]+c.data[d]+e;e=Math.floor(h/67108864);c.data[d++]=67108863&h}return e},B=26):(d.prototype.am=k,B=28);d.prototype.DB=B;d.prototype.DM=(1<<B)-1;d.prototype.DV=1<<B;d.prototype.FV=Math.pow(2,52);d.prototype.F1=52-B;d.prototype.F2=2*B-52;var I=[];a=48;for(B=0;9>=B;++B)I[a++]=B;a=97;for(B=10;36>B;++B)I[a++]=B;a=65;for(B=10;36>B;++B)I[a++]=B;n.prototype.convert=
function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):a};n.prototype.revert=function(a){return a};n.prototype.reduce=function(a){a.divRemTo(this.m,null,a)};n.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};n.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};g.prototype.convert=function(a){var b=f();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),0>a.s&&0<b.compareTo(d.ZERO)&&this.m.subTo(b,b),b};g.prototype.revert=function(a){var b=f();return a.copyTo(b),
this.reduce(b),b};g.prototype.reduce=function(a){for(;a.t<=this.mt2;)a.data[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a.data[b],d=c*this.mpl+((c*this.mph+(a.data[b]>>15)*this.mpl&this.um)<<15)&a.DM;c=b+this.m.t;for(a.data[c]+=this.m.am(0,d,a,b,0,this.m.t);a.data[c]>=a.DV;)a.data[c]-=a.DV,a.data[++c]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};g.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};g.prototype.sqrTo=function(a,b){a.squareTo(b);
this.reduce(b)};d.prototype.copyTo=function(a){for(var b=this.t-1;0<=b;--b)a.data[b]=this.data[b];a.t=this.t;a.s=this.s};d.prototype.fromInt=function(a){this.t=1;this.s=0>a?-1:0;0<a?this.data[0]=a:-1>a?this.data[0]=a+this.DV:this.t=0};d.prototype.fromString=function(a,b){if(16==b)b=4;else if(8==b)b=3;else if(256==b)b=8;else if(2==b)b=1;else if(32==b)b=5;else{if(4!=b)return void this.fromRadix(a,b);b=2}this.s=this.t=0;for(var c=a.length,e=!1,g=0;0<=--c;){var h=8==b?255&a[c]:m(a,c);0>h?"-"==a.charAt(c)&&
(e=!0):(e=!1,0==g?this.data[this.t++]=h:g+b>this.DB?(this.data[this.t-1]|=(h&(1<<this.DB-g)-1)<<g,this.data[this.t++]=h>>this.DB-g):this.data[this.t-1]|=h<<g,(g+=b)>=this.DB&&(g-=this.DB))}8==b&&0!=(128&a[0])&&(this.s=-1,0<g&&(this.data[this.t-1]|=(1<<this.DB-g)-1<<g));this.clamp();e&&d.ZERO.subTo(this,this)};d.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this.data[this.t-1]==a;)--this.t};d.prototype.dlShiftTo=function(a,b){var c;for(c=this.t-1;0<=c;--c)b.data[c+a]=this.data[c];for(c=
a-1;0<=c;--c)b.data[c]=0;b.t=this.t+a;b.s=this.s};d.prototype.drShiftTo=function(a,b){for(var c=a;c<this.t;++c)b.data[c-a]=this.data[c];b.t=Math.max(this.t-a,0);b.s=this.s};d.prototype.lShiftTo=function(a,b){var c=a%this.DB,d=this.DB-c,e=(1<<d)-1,g=Math.floor(a/this.DB),h=this.s<<c&this.DM;for(a=this.t-1;0<=a;--a)b.data[a+g+1]=this.data[a]>>d|h,h=(this.data[a]&e)<<c;for(a=g-1;0<=a;--a)b.data[a]=0;b.data[g]=h;b.t=this.t+g+1;b.s=this.s;b.clamp()};d.prototype.rShiftTo=function(a,b){b.s=this.s;var c=
Math.floor(a/this.DB);if(c>=this.t)b.t=0;else{a%=this.DB;var d=this.DB-a,e=(1<<a)-1;b.data[0]=this.data[c]>>a;for(var g=c+1;g<this.t;++g)b.data[g-c-1]|=(this.data[g]&e)<<d,b.data[g-c]=this.data[g]>>a;0<a&&(b.data[this.t-c-1]|=(this.s&e)<<d);b.t=this.t-c;b.clamp()}};d.prototype.subTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this.data[c]-a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=
this.s;c<a.t;)d-=a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0;-1>d?b.data[c++]=this.DV+d:0<d&&(b.data[c++]=d);b.t=c;b.clamp()};d.prototype.multiplyTo=function(a,b){var c=this.abs(),e=a.abs(),g=c.t;for(b.t=g+e.t;0<=--g;)b.data[g]=0;for(g=0;g<e.t;++g)b.data[g+c.t]=c.am(0,e.data[g],b,g,0,c.t);b.s=0;b.clamp();this.s!=a.s&&d.ZERO.subTo(b,b)};d.prototype.squareTo=function(a){for(var b=this.abs(),c=a.t=2*b.t;0<=--c;)a.data[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b.data[c],a,2*c,0,1);(a.data[c+
b.t]+=b.am(c+1,2*b.data[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a.data[c+b.t]-=b.DV,a.data[c+b.t+1]=1)}0<a.t&&(a.data[a.t-1]+=b.am(c,b.data[c],a,2*c,0,1));a.s=0;a.clamp()};d.prototype.divRemTo=function(a,b,c){var e=a.abs();if(!(0>=e.t)){var g=this.abs();if(g.t<e.t)return null!=b&&b.fromInt(0),void(null!=c&&this.copyTo(c));null==c&&(c=f());var m=f(),k=this.s;a=a.s;var l=this.DB-h(e.data[e.t-1]);0<l?(e.lShiftTo(l,m),g.lShiftTo(l,c)):(e.copyTo(m),g.copyTo(c));e=m.t;g=m.data[e-1];if(0!=g){var n=g*(1<<this.F1)+
(1<e?m.data[e-2]>>this.F2:0),p=this.FV/n;n=(1<<this.F1)/n;var v=1<<this.F2,q=c.t,r=q-e,C=null==b?f():b;m.dlShiftTo(r,C);0<=c.compareTo(C)&&(c.data[c.t++]=1,c.subTo(C,c));d.ONE.dlShiftTo(e,C);for(C.subTo(m,m);m.t<e;)m.data[m.t++]=0;for(;0<=--r;){var u=c.data[--q]==g?this.DM:Math.floor(c.data[q]*p+(c.data[q-1]+v)*n);if((c.data[q]+=m.am(0,u,c,r,0,e))<u)for(m.dlShiftTo(r,C),c.subTo(C,c);c.data[q]<--u;)c.subTo(C,c)}null!=b&&(c.drShiftTo(e,b),k!=a&&d.ZERO.subTo(b,b));c.t=e;c.clamp();0<l&&c.rShiftTo(l,c);
0>k&&d.ZERO.subTo(c,c)}}};d.prototype.invDigit=function(){if(1>this.t)return 0;var a=this.data[0];if(0==(1&a))return 0;var b=3&a;return 0<(b=(b=(b=(b=b*(2-(15&a)*b)&15)*(2-(255&a)*b)&255)*(2-((65535&a)*b&65535))&65535)*(2-a*b%this.DV)%this.DV)?this.DV-b:-b};d.prototype.isEven=function(){return 0==(0<this.t?1&this.data[0]:this.s)};d.prototype.exp=function(a,b){if(4294967295<a||1>a)return d.ONE;var c=f(),e=f(),g=b.convert(this),m=h(a)-1;for(g.copyTo(c);0<=--m;)if(b.sqrTo(c,e),0<(a&1<<m))b.mulTo(e,g,
c);else{var k=c;c=e;e=k}return b.revert(c)};d.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else{if(4!=a)return this.toRadix(a);a=2}var b,c=(1<<a)-1,d=!1,e="",g=this.t,h=this.DB-g*this.DB%a;if(0<g--)for(h<this.DB&&0<(b=this.data[g]>>h)&&(d=!0,e=l(b));0<=g;)h<a?(b=(this.data[g]&(1<<h)-1)<<a-h,b|=this.data[--g]>>(h+=this.DB-a)):(b=this.data[g]>>(h-=a)&c,0>=h&&(h+=this.DB,--g)),0<b&&(d=!0),d&&(e+=l(b));
return d?e:"0"};d.prototype.negate=function(){var a=f();return d.ZERO.subTo(this,a),a};d.prototype.abs=function(){return 0>this.s?this.negate():this};d.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(0!=(b=c-a.t))return 0>this.s?-b:b;for(;0<=--c;)if(0!=(b=this.data[c]-a.data[c]))return b;return 0};d.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+h(this.data[this.t-1]^this.s&this.DM)};d.prototype.mod=function(a){var b=f();return this.abs().divRemTo(a,
null,b),0>this.s&&0<b.compareTo(d.ZERO)&&a.subTo(b,b),b};d.prototype.modPowInt=function(a,b){var c;return c=256>a||b.isEven()?new n(b):new g(b),this.exp(a,c)};d.ZERO=e(0);d.ONE=e(1);u.prototype.convert=A;u.prototype.revert=A;u.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c)};u.prototype.sqrTo=function(a,b){a.squareTo(b)};x.prototype.convert=function(a){if(0>a.s||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var b=f();return a.copyTo(b),this.reduce(b),b};x.prototype.revert=
function(a){return a};x.prototype.reduce=function(a){a.drShiftTo(this.m.t-1,this.r2);a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)};x.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};x.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};var D=[2,3,5,7,11,13,
17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],E=67108864/D[D.length-1];d.prototype.chunkSize=function(a){return Math.floor(Math.LN2*this.DB/Math.log(a))};d.prototype.toRadix=function(a){if(null==a&&(a=
10),0==this.signum()||2>a||36<a)return"0";var b=this.chunkSize(a);b=Math.pow(a,b);var c=e(b),d=f(),g=f(),h="";for(this.divRemTo(c,d,g);0<d.signum();)h=(b+g.intValue()).toString(a).substr(1)+h,d.divRemTo(c,d,g);return g.intValue().toString(a)+h};d.prototype.fromRadix=function(a,b){this.fromInt(0);null==b&&(b=10);for(var c=this.chunkSize(b),e=Math.pow(b,c),g=!1,h=0,f=0,k=0;k<a.length;++k){var l=m(a,k);0>l?"-"==a.charAt(k)&&0==this.signum()&&(g=!0):(f=b*f+l,++h>=c&&(this.dMultiply(e),this.dAddOffset(f,
0),h=0,f=0))}0<h&&(this.dMultiply(Math.pow(b,h)),this.dAddOffset(f,0));g&&d.ZERO.subTo(this,this)};d.prototype.fromNumber=function(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(d.ONE.shiftLeft(a-1),q,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(d.ONE.shiftLeft(a-1),this);else{c=[];var e=7&a;c.length=1+(a>>3);b.nextBytes(c);0<e?c[0]&=(1<<e)-1:c[0]=0;this.fromString(c,
256)}};d.prototype.bitwiseTo=function(a,b,c){var d,e=Math.min(a.t,this.t);for(d=0;d<e;++d)c.data[d]=b(this.data[d],a.data[d]);if(a.t<this.t){var g=a.s&this.DM;for(d=e;d<this.t;++d)c.data[d]=b(this.data[d],g);c.t=this.t}else{g=this.s&this.DM;for(d=e;d<a.t;++d)c.data[d]=b(g,a.data[d]);c.t=a.t}c.s=b(this.s,a.s);c.clamp()};d.prototype.changeBit=function(a,b){a=d.ONE.shiftLeft(a);return this.bitwiseTo(a,b,a),a};d.prototype.addTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this.data[c]+
a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a.data[c],b.data[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0;0<d?b.data[c++]=d:-1>d&&(b.data[c++]=this.DV+d);b.t=c;b.clamp()};d.prototype.dMultiply=function(a){this.data[this.t]=this.am(0,a-1,this,0,0,this.t);++this.t;this.clamp()};d.prototype.dAddOffset=function(a,b){if(0!=a){for(;this.t<=b;)this.data[this.t++]=0;for(this.data[b]+=
a;this.data[b]>=this.DV;)this.data[b]-=this.DV,++b>=this.t&&(this.data[this.t++]=0),++this.data[b]}};d.prototype.multiplyLowerTo=function(a,b,c){var d,e=Math.min(this.t+a.t,b);c.s=0;for(c.t=e;0<e;)c.data[--e]=0;for(d=c.t-this.t;e<d;++e)c.data[e+this.t]=this.am(0,a.data[e],c,e,0,this.t);for(d=Math.min(a.t,b);e<d;++e)this.am(0,a.data[e],c,e,0,b-e);c.clamp()};d.prototype.multiplyUpperTo=function(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;0<=--d;)c.data[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c.data[this.t+
d-b]=this.am(b-d,a.data[d],c,0,0,this.t+d-b);c.clamp();c.drShiftTo(1,c)};d.prototype.modInt=function(a){if(0>=a)return 0;var b=this.DV%a,c=0>this.s?a-1:0;if(0<this.t)if(0==b)c=this.data[0]%a;else for(var d=this.t-1;0<=d;--d)c=(b*c+this.data[d])%a;return c};d.prototype.millerRabin=function(a){var b=this.subtract(d.ONE),c=b.getLowestSetBit();if(0>=c)return!1;for(var e,g=b.shiftRight(c),h={nextBytes:function(a){for(var b=0;b<a.length;++b)a[b]=Math.floor(256*Math.random())}},f=0;f<a;++f){do e=new d(this.bitLength(),
h);while(0>=e.compareTo(d.ONE)||0<=e.compareTo(b));e=e.modPow(g,this);if(0!=e.compareTo(d.ONE)&&0!=e.compareTo(b)){for(var m=1;m++<c&&0!=e.compareTo(b);)if(0==(e=e.modPowInt(2,this)).compareTo(d.ONE))return!1;if(0!=e.compareTo(b))return!1}}return!0};d.prototype.clone=function(){var a=f();return this.copyTo(a),a};d.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&
(1<<32-this.DB)-1)<<this.DB|this.data[0]};d.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24};d.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16};d.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this.data[0]?0:1};d.prototype.toByteArray=function(){var a=this.t,b=[];b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(0<a--)for(d<this.DB&&(c=this.data[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);0<=a;)8>d?(c=(this.data[a]&
(1<<d)-1)<<8-d,c|=this.data[--a]>>(d+=this.DB-8)):(c=this.data[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(0<e||c!=this.s)&&(b[e++]=c);return b};d.prototype.equals=function(a){return 0==this.compareTo(a)};d.prototype.min=function(a){return 0>this.compareTo(a)?this:a};d.prototype.max=function(a){return 0<this.compareTo(a)?this:a};d.prototype.and=function(a){var b=f();return this.bitwiseTo(a,p,b),b};d.prototype.or=function(a){var b=f();return this.bitwiseTo(a,
q,b),b};d.prototype.xor=function(a){var b=f();return this.bitwiseTo(a,r,b),b};d.prototype.andNot=function(a){var b=f();return this.bitwiseTo(a,v,b),b};d.prototype.not=function(){for(var a=f(),b=0;b<this.t;++b)a.data[b]=this.DM&~this.data[b];return a.t=this.t,a.s=~this.s,a};d.prototype.shiftLeft=function(a){var b=f();return 0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b),b};d.prototype.shiftRight=function(a){var b=f();return 0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b),b};d.prototype.getLowestSetBit=function(){for(var a=
0;a<this.t;++a)if(0!=this.data[a]){var b=a*this.DB;var c=this.data[a];if(0==c)a=-1;else{var d=0;a=(0==(65535&c)&&(c>>=16,d+=16),0==(255&c)&&(c>>=8,d+=8),0==(15&c)&&(c>>=4,d+=4),0==(3&c)&&(c>>=2,d+=2),0==(1&c)&&++d,d)}return b+a}return 0>this.s?this.t*this.DB:-1};d.prototype.bitCount=function(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c){for(var d=this.data[c]^b,e=0;0!=d;)d&=d-1,++e;a+=e}return a};d.prototype.testBit=function(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this.data[b]&
1<<a%this.DB)};d.prototype.setBit=function(a){return this.changeBit(a,q)};d.prototype.clearBit=function(a){return this.changeBit(a,v)};d.prototype.flipBit=function(a){return this.changeBit(a,r)};d.prototype.add=function(a){var b=f();return this.addTo(a,b),b};d.prototype.subtract=function(a){var b=f();return this.subTo(a,b),b};d.prototype.multiply=function(a){var b=f();return this.multiplyTo(a,b),b};d.prototype.divide=function(a){var b=f();return this.divRemTo(a,b,null),b};d.prototype.remainder=function(a){var b=
f();return this.divRemTo(a,null,b),b};d.prototype.divideAndRemainder=function(a){var b=f(),c=f();return this.divRemTo(a,b,c),[b,c]};d.prototype.modPow=function(a,b){var c=a.bitLength(),d=e(1);if(0>=c)return d;var m=18>c?1:48>c?3:144>c?4:768>c?5:6;b=8>c?new n(b):b.isEven()?new x(b):new g(b);var k=[],l=3,p=m-1,v=(1<<m)-1;if(k[1]=b.convert(this),1<m)for(c=f(),b.sqrTo(k[1],c);l<=v;)k[l]=f(),b.mulTo(c,k[l-2],k[l]),l+=2;var q,r,u=a.t-1,C=!0,G=f();for(c=h(a.data[u])-1;0<=u;){c>=p?q=a.data[u]>>c-p&v:(q=(a.data[u]&
(1<<c+1)-1)<<p-c,0<u&&(q|=a.data[u-1]>>this.DB+c-p));for(l=m;0==(1&q);)q>>=1,--l;if(0>(c-=l)&&(c+=this.DB,--u),C)k[q].copyTo(d),C=!1;else{for(;1<l;)b.sqrTo(d,G),b.sqrTo(G,d),l-=2;0<l?b.sqrTo(d,G):(r=d,d=G,G=r);b.mulTo(G,k[q],d)}for(;0<=u&&0==(a.data[u]&1<<c);)b.sqrTo(d,G),r=d,d=G,G=r,0>--c&&(c=this.DB-1,--u)}return b.revert(d)};d.prototype.modInverse=function(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return d.ZERO;for(var c=a.clone(),g=this.clone(),h=e(1),f=e(0),m=e(0),k=e(1);0!=c.signum();){for(;c.isEven();)c.rShiftTo(1,
c),b?(h.isEven()&&f.isEven()||(h.addTo(this,h),f.subTo(a,f)),h.rShiftTo(1,h)):f.isEven()||f.subTo(a,f),f.rShiftTo(1,f);for(;g.isEven();)g.rShiftTo(1,g),b?(m.isEven()&&k.isEven()||(m.addTo(this,m),k.subTo(a,k)),m.rShiftTo(1,m)):k.isEven()||k.subTo(a,k),k.rShiftTo(1,k);0<=c.compareTo(g)?(c.subTo(g,c),b&&h.subTo(m,h),f.subTo(k,f)):(g.subTo(c,g),b&&m.subTo(h,m),k.subTo(f,k))}return 0!=g.compareTo(d.ONE)?d.ZERO:0<=k.compareTo(a)?k.subtract(a):0>k.signum()?(k.addTo(a,k),0>k.signum()?k.add(a):k):k};d.prototype.pow=
function(a){return this.exp(a,new u)};d.prototype.gcd=function(a){var b=0>this.s?this.negate():this.clone();a=0>a.s?a.negate():a.clone();if(0>b.compareTo(a)){var c=b;b=a;a=c}c=b.getLowestSetBit();var d=a.getLowestSetBit();if(0>d)return b;c<d&&(d=c);for(0<d&&(b.rShiftTo(d,b),a.rShiftTo(d,a));0<b.signum();)0<(c=b.getLowestSetBit())&&b.rShiftTo(c,b),0<(c=a.getLowestSetBit())&&a.rShiftTo(c,a),0<=b.compareTo(a)?(b.subTo(a,b),b.rShiftTo(1,b)):(a.subTo(b,a),a.rShiftTo(1,a));return 0<d&&a.lShiftTo(d,a),a};
d.prototype.isProbablePrime=function(a){var b,c=this.abs();if(1==c.t&&c.data[0]<=D[D.length-1]){for(b=0;b<D.length;++b)if(c.data[0]==D[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<D.length;){for(var d=D[b],e=b+1;e<D.length&&d<E;)d*=D[e++];for(d=c.modInt(d);b<e;)if(0==d%D[b++])return!1}return c.millerRabin(a)}},function(a,b,c){var d=c(0);c(1);a.exports=d.cipher=d.cipher||{};d.cipher.algorithms=d.cipher.algorithms||{};d.cipher.createCipher=function(a,b){var c=a;if("string"==typeof c&&(c=d.cipher.getAlgorithm(c))&&
(c=c()),!c)throw Error("Unsupported algorithm: "+a);return new d.cipher.BlockCipher({algorithm:c,key:b,decrypt:!1})};d.cipher.createDecipher=function(a,b){var c=a;if("string"==typeof c&&(c=d.cipher.getAlgorithm(c))&&(c=c()),!c)throw Error("Unsupported algorithm: "+a);return new d.cipher.BlockCipher({algorithm:c,key:b,decrypt:!0})};d.cipher.registerAlgorithm=function(a,b){a=a.toUpperCase();d.cipher.algorithms[a]=b};d.cipher.getAlgorithm=function(a){return(a=a.toUpperCase())in d.cipher.algorithms?d.cipher.algorithms[a]:
null};a=d.cipher.BlockCipher=function(a){this.algorithm=a.algorithm;this.mode=this.algorithm.mode;this.blockSize=this.mode.blockSize;this._finish=!1;this.output=this._input=null;this._op=a.decrypt?this.mode.decrypt:this.mode.encrypt;this._decrypt=a.decrypt;this.algorithm.initialize(a)};a.prototype.start=function(a){a=a||{};var b={},c;for(c in a)b[c]=a[c];b.decrypt=this._decrypt;this._finish=!1;this._input=d.util.createBuffer();this.output=a.output||d.util.createBuffer();this.mode.start(b)};a.prototype.update=
function(a){for(a&&this._input.putBuffer(a);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};a.prototype.finish=function(a){!a||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(b){return a(this.blockSize,b,!1)},this.mode.unpad=function(b){return a(this.blockSize,b,!0)});var b={};return b.decrypt=this._decrypt,b.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,b))&&(this._finish=
!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,b))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,b)))}},function(a,b,c){function d(a,b,c){for(var d,g,h,f,k,n,p,I=c.length();64<=I;){g=a.h0;h=a.h1;f=a.h2;k=a.h3;for(p=0;16>p;++p)b[p]=c.getInt32Le(),d=g+(k^h&(f^k))+e[p]+b[p],g=k,k=f,f=h,h+=d<<(n=m[p])|d>>>32-n;for(;32>p;++p)d=g+(f^k&(h^f))+e[p]+b[l[p]],g=k,k=f,f=h,h+=d<<(n=m[p])|d>>>32-n;for(;48>p;++p)d=g+(h^f^k)+e[p]+b[l[p]],g=k,k=f,f=h,h+=d<<(n=m[p])|
d>>>32-n;for(;64>p;++p)d=g+(f^(h|~k))+e[p]+b[l[p]],g=k,k=f,f=h,h+=d<<(n=m[p])|d>>>32-n;a.h0=a.h0+g|0;a.h1=a.h1+h|0;a.h2=a.h2+f|0;a.h3=a.h3+k|0;I-=64}}var f=c(0);c(4);c(1);a=a.exports=f.md5=f.md5||{};f.md.md5=f.md.algorithms.md5=a;a.create=function(){h||function(){k=String.fromCharCode(128);k+=f.util.fillString(String.fromCharCode(0),64);l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9];m=[7,12,
17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21];e=Array(64);for(var a=0;64>a;++a)e[a]=Math.floor(4294967296*Math.abs(Math.sin(a+1)));h=!0}();var a=null,b=f.util.createBuffer(),c=Array(16),q={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){q.messageLength=0;q.fullMessageLength=q.messageLength64=[];for(var c=
q.messageLengthSize/4,d=0;d<c;++d)q.fullMessageLength.push(0);return b=f.util.createBuffer(),a={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},q}};return q.start(),q.update=function(e,g){"utf8"===g&&(e=f.util.encodeUtf8(e));g=e.length;q.messageLength+=g;g=[g/4294967296>>>0,g>>>0];for(var h=q.fullMessageLength.length-1;0<=h;--h)q.fullMessageLength[h]+=g[1],g[1]=g[0]+(q.fullMessageLength[h]/4294967296>>>0),q.fullMessageLength[h]>>>=0,g[0]=g[1]/4294967296>>>0;return b.putBytes(e),d(a,c,b),(2048<
b.read||0===b.length())&&b.compact(),q},q.digest=function(){var e=f.util.createBuffer();e.putBytes(b.bytes());e.putBytes(k.substr(0,q.blockLength-(q.fullMessageLength[q.fullMessageLength.length-1]+q.messageLengthSize&q.blockLength-1)));for(var g,h=0,m=q.fullMessageLength.length-1;0<=m;--m)h=(g=8*q.fullMessageLength[m]+h)/4294967296>>>0,e.putInt32Le(g>>>0);g={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3};d(g,c,e);e=f.util.createBuffer();return e.putInt32Le(g.h0),e.putInt32Le(g.h1),e.putInt32Le(g.h2),e.putInt32Le(g.h3),
e},q};var k=null,l=null,m=null,e=null,h=!1},function(a,b,c){var d=c(0);c(8);c(4);c(1);var f;b=d.pkcs5=d.pkcs5||{};d.util.isNodejs&&!d.options.usePureJavaScript&&(f=c(16));a.exports=d.pbkdf2=b.pbkdf2=function(a,b,c,e,h,n){function g(){if(B>l)return n(null,x);u.start(null,null);u.update(b);u.update(d.util.int32ToBytes(B));I=A=u.digest().getBytes();D=2;m()}function m(){if(D<=c)return u.start(null,null),u.update(A),E=u.digest().getBytes(),I=d.util.xorBytes(I,E,k),A=E,++D,d.util.setImmediate(m);x+=B<l?
I:I.substr(0,v);++B;g()}if("function"==typeof h&&(n=h,h=null),d.util.isNodejs&&!d.options.usePureJavaScript&&f.pbkdf2&&(null===h||"object"!=typeof h)&&(4<f.pbkdf2Sync.length||!h||"sha1"===h))return"string"!=typeof h&&(h="sha1"),a=Buffer.from(a,"binary"),b=Buffer.from(b,"binary"),n?4===f.pbkdf2Sync.length?f.pbkdf2(a,b,c,e,function(a,b){if(a)return n(a);n(null,b.toString("binary"))}):f.pbkdf2(a,b,c,e,h,function(a,b){if(a)return n(a);n(null,b.toString("binary"))}):4===f.pbkdf2Sync.length?f.pbkdf2Sync(a,
b,c,e).toString("binary"):f.pbkdf2Sync(a,b,c,e,h).toString("binary");if(null==h&&(h="sha1"),"string"==typeof h){if(!(h in d.md.algorithms))throw Error("Unknown hash algorithm: "+h);h=d.md[h].create()}var k=h.digestLength;if(e>4294967295*k){a=Error("Derived key is too long.");if(n)return n(a);throw a;}var l=Math.ceil(e/k),v=e-(l-1)*k,u=d.hmac.create();u.start(h,a);var A,x="";if(!n){for(var B=1;B<=l;++B){u.start(null,null);u.update(b);u.update(d.util.int32ToBytes(B));var I=A=u.digest().getBytes();for(var D=
2;D<=c;++D){u.start(null,null);u.update(A);var E=u.digest().getBytes();I=d.util.xorBytes(I,E,k);A=E}x+=B<l?I:I.substr(0,v)}return x}B=1;g()}},function(a,b){},function(a,b,c){function d(a,b){"string"==typeof b&&(b={shortName:b});for(var c,d=null,e=0;null===d&&e<a.attributes.length;++e)c=a.attributes[e],(b.type&&b.type===c.type||b.name&&b.name===c.name||b.shortName&&b.shortName===c.shortName)&&(d=c);return d}function f(a){var b,c=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);a=a.attributes;for(var d=
0;d<a.length;++d){var e=(b=a[d]).value,h=g.Type.PRINTABLESTRING;"valueTagClass"in b&&(h=b.valueTagClass)===g.Type.UTF8&&(e=n.util.encodeUtf8(e));b=g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.type).getBytes()),g.create(g.Class.UNIVERSAL,h,!1,e)])]);c.value.push(b)}return c}function k(a){for(var b,c=0;c<a.length;++c){if(void 0===(b=a[c]).name&&(b.type&&b.type in p.oids?b.name=p.oids[b.type]:b.shortName&&
b.shortName in r&&(b.name=p.oids[r[b.shortName]])),void 0===b.type){if(!(b.name&&b.name in p.oids))throw(e=Error("Attribute type not specified.")).attribute=b,e;b.type=p.oids[b.name]}if(void 0===b.shortName&&b.name&&b.name in r&&(b.shortName=r[b.name]),b.type===q.extensionRequest&&(b.valueConstructed=!0,b.valueTagClass=g.Type.SEQUENCE,!b.value&&b.extensions)){b.value=[];for(var d=0;d<b.extensions.length;++d)b.value.push(p.certificateExtensionToAsn1(l(b.extensions[d])))}var e;if(void 0===b.value)throw(e=
Error("Attribute value not specified.")).attribute=b,e;}}function l(a,b){if(b=b||{},void 0===a.name&&a.id&&a.id in p.oids&&(a.name=p.oids[a.id]),void 0===a.id){if(!(a.name&&a.name in p.oids))throw(k=Error("Extension ID not specified.")).extension=a,k;a.id=p.oids[a.name]}if(void 0!==a.value)return a;if("keyUsage"===a.name){var c=b=0,d=0;a.digitalSignature&&(c|=128,b=7);a.nonRepudiation&&(c|=64,b=6);a.keyEncipherment&&(c|=32,b=5);a.dataEncipherment&&(c|=16,b=4);a.keyAgreement&&(c|=8,b=3);a.keyCertSign&&
(c|=4,b=2);a.cRLSign&&(c|=2,b=1);a.encipherOnly&&(c|=1,b=0);a.decipherOnly&&(d|=128,b=7);b=String.fromCharCode(b);0!==d?b+=String.fromCharCode(c)+String.fromCharCode(d):0!==c&&(b+=String.fromCharCode(c));a.value=g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,b)}else if("basicConstraints"===a.name)a.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),a.cA&&a.value.value.push(g.create(g.Class.UNIVERSAL,g.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in a&&a.value.value.push(g.create(g.Class.UNIVERSAL,
g.Type.INTEGER,!1,g.integerToDer(a.pathLenConstraint).getBytes()));else if("extKeyUsage"===a.name)for(d in a.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),c=a.value.value,a)!0===a[d]&&(d in q?c.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(q[d]).getBytes())):-1!==d.indexOf(".")&&c.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(d).getBytes())));else if("nsCertType"===a.name)c=b=0,a.client&&(c|=128,b=7),a.server&&(c|=64,b=6),a.email&&(c|=32,b=5),a.objsign&&(c|=16,b=4),
a.reserved&&(c|=8,b=3),a.sslCA&&(c|=4,b=2),a.emailCA&&(c|=2,b=1),a.objCA&&(c|=1,b=0),b=String.fromCharCode(b),0!==c&&(b+=String.fromCharCode(c)),a.value=g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,b);else if("subjectAltName"===a.name||"issuerAltName"===a.name)for(a.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),d=0;d<a.altNames.length;++d){b=(e=a.altNames[d]).value;if(7===e.type&&e.ip){if(null===(b=n.util.bytesFromIP(e.ip)))throw(k=Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=
a,k;}else 8===e.type&&(b=e.oid?g.oidToDer(g.oidToDer(e.oid)):g.oidToDer(b));a.value.value.push(g.create(g.Class.CONTEXT_SPECIFIC,e.type,!1,b))}else if("nsComment"===a.name&&b.cert){if(!/^[\x00-\x7F]*$/.test(a.comment)||1>a.comment.length||128<a.comment.length)throw Error('Invalid "nsComment" content.');a.value=g.create(g.Class.UNIVERSAL,g.Type.IA5STRING,!1,a.comment)}else if("subjectKeyIdentifier"===a.name&&b.cert)c=b.cert.generateSubjectKeyIdentifier(),a.subjectKeyIdentifier=c.toHex(),a.value=g.create(g.Class.UNIVERSAL,
g.Type.OCTETSTRING,!1,c.getBytes());else if("authorityKeyIdentifier"===a.name&&b.cert)a.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),c=a.value.value,a.keyIdentifier&&(d=!0===a.keyIdentifier?b.cert.generateSubjectKeyIdentifier().getBytes():a.keyIdentifier,c.push(g.create(g.Class.CONTEXT_SPECIFIC,0,!1,d))),a.authorityCertIssuer&&(d=[g.create(g.Class.CONTEXT_SPECIFIC,4,!0,[f(!0===a.authorityCertIssuer?b.cert.issuer:a.authorityCertIssuer)])],c.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,d))),
a.serialNumber&&(b=n.util.hexToBytes(!0===a.serialNumber?b.cert.serialNumber:a.serialNumber),c.push(g.create(g.Class.CONTEXT_SPECIFIC,2,!1,b)));else if("cRLDistributionPoints"===a.name){a.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);c=a.value.value;var e,h=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),m=g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[]);for(d=0;d<a.altNames.length;++d){b=(e=a.altNames[d]).value;if(7===e.type&&e.ip){if(null===(b=n.util.bytesFromIP(e.ip)))throw(k=Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=
a,k;}else 8===e.type&&(b=e.oid?g.oidToDer(g.oidToDer(e.oid)):g.oidToDer(b));m.value.push(g.create(g.Class.CONTEXT_SPECIFIC,e.type,!1,b))}h.value.push(g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[m]));c.push(h)}var k;if(void 0===a.value)throw(k=Error("Extension value not specified.")).extension=a,k;return a}function m(a,b){switch(a){case q["RSASSA-PSS"]:return a=[],void 0!==b.hash.algorithmOid&&a.push(g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,
g.Type.OID,!1,g.oidToDer(b.hash.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")])])),void 0!==b.mgf.algorithmOid&&a.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.mgf.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.mgf.hash.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")])])])),
void 0!==b.saltLength&&a.push(g.create(g.Class.CONTEXT_SPECIFIC,2,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(b.saltLength).getBytes())])),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,a);default:return g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")}}function e(a){var b=g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===a.attributes.length)return b;a=a.attributes;for(var c=0;c<a.length;++c){var d=a[c],e=d.value,h=g.Type.UTF8;"valueTagClass"in d&&(h=d.valueTagClass);h===g.Type.UTF8&&
(e=n.util.encodeUtf8(e));var f=!1;"valueConstructed"in d&&(f=d.valueConstructed);d=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(d.type).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[g.create(g.Class.UNIVERSAL,h,f,e)])]);b.value.push(d)}return b}function h(a){return a>=D&&a<E?g.create(g.Class.UNIVERSAL,g.Type.UTCTIME,!1,g.dateToUtcTime(a)):g.create(g.Class.UNIVERSAL,g.Type.GENERALIZEDTIME,!1,g.dateToGeneralizedTime(a))}var n=c(0);c(5);c(3);
c(10);c(4);c(37);c(6);c(7);c(18);c(11);c(1);var g=n.asn1,p=a.exports=n.pki=n.pki||{},q=p.oids,r={};r.CN=q.commonName;r.commonName="CN";r.C=q.countryName;r.countryName="C";r.L=q.localityName;r.localityName="L";r.ST=q.stateOrProvinceName;r.stateOrProvinceName="ST";r.O=q.organizationName;r.organizationName="O";r.OU=q.organizationalUnitName;r.organizationalUnitName="OU";r.E=q.emailAddress;r.emailAddress="E";a=n.pki.rsa.publicKeyValidator;var v={name:"Certificate",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,
constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,
constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:g.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:g.Class.UNIVERSAL,
type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},
{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},a,{name:"Certificate.TBSCertificate.issuerUniqueID",
tagClass:g.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:g.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},
{name:"Certificate.TBSCertificate.extensions",tagClass:g.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:g.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},
{name:"Certificate.signatureValue",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},u={name:"rsapss",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:g.Class.UNIVERSAL,type:g.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",
tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:g.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:g.Class.UNIVERSAL,type:g.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",
tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:g.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:g.Class.UNIVERSAL,type:g.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:g.Class.CONTEXT_SPECIFIC,
type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:g.Class.UNIVERSAL,type:g.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},A={name:"CertificationRequest",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[{name:"CertificationRequestInfo",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,
capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},a,{name:"CertificationRequestInfo.attributes",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",
tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:g.Class.UNIVERSAL,type:g.Type.SET,constructed:!0}]}]}]},{name:"CertificationRequest.signatureAlgorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:g.Class.UNIVERSAL,
optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};p.RDNAttributesAsArray=function(a,b){for(var c,d,e,h=[],f=0;f<a.value.length;++f){c=a.value[f];for(var m=0;m<c.value.length;++m)e={},d=c.value[m],e.type=g.derToOid(d.value[0].value),e.value=d.value[1].value,e.valueTagClass=d.value[1].type,e.type in q&&(e.name=q[e.type],e.name in r&&(e.shortName=r[e.name])),b&&
(b.update(e.type),b.update(e.value)),h.push(e)}return h};p.CRIAttributesAsArray=function(a){for(var b=[],c=0;c<a.length;++c){var d=a[c],e=g.derToOid(d.value[0].value);d=d.value[1].value;for(var h=0;h<d.length;++h){var f={};if(f.type=e,f.value=d[h].value,f.valueTagClass=d[h].type,f.type in q&&(f.name=q[f.type],f.name in r&&(f.shortName=r[f.name])),f.type===q.extensionRequest){f.extensions=[];for(var m=0;m<f.value.length;++m)f.extensions.push(p.certificateExtensionFromAsn1(f.value[m]))}b.push(f)}}return b};
var x=function(a,b,c){var d={};if(a!==q["RSASSA-PSS"])return d;c&&(d={hash:{algorithmOid:q.sha1},mgf:{algorithmOid:q.mgf1,hash:{algorithmOid:q.sha1}},saltLength:20});c={};a=[];if(!g.validate(b,u,c,a))throw b=Error("Cannot read RSASSA-PSS parameter block."),b.errors=a,b;return void 0!==c.hashOid&&(d.hash=d.hash||{},d.hash.algorithmOid=g.derToOid(c.hashOid)),void 0!==c.maskGenOid&&(d.mgf=d.mgf||{},d.mgf.algorithmOid=g.derToOid(c.maskGenOid),d.mgf.hash=d.mgf.hash||{},d.mgf.hash.algorithmOid=g.derToOid(c.maskGenHashOid)),
void 0!==c.saltLength&&(d.saltLength=c.saltLength.charCodeAt(0)),d},B=function(a){switch(q[a.signatureOid]){case "sha1WithRSAEncryption":case "sha1WithRSASignature":return n.md.sha1.create();case "md5WithRSAEncryption":return n.md.md5.create();case "sha256WithRSAEncryption":return n.md.sha256.create();case "sha384WithRSAEncryption":return n.md.sha384.create();case "sha512WithRSAEncryption":return n.md.sha512.create();case "RSASSA-PSS":return n.md.sha256.create();default:var b=Error("Could not compute "+
a.type+" digest. Unknown signature OID.");throw b.signatureOid=a.signatureOid,b;}},I=function(a){var b=a.certificate;switch(b.signatureOid){case q["RSASSA-PSS"]:var c,d,e;if(void 0===(c=q[b.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[c])throw(e=Error("Unsupported MGF hash function.")).oid=b.signatureParameters.mgf.hash.algorithmOid,e.name=c,e;if(void 0===(d=q[b.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[d])throw(e=Error("Unsupported MGF function.")).oid=b.signatureParameters.mgf.algorithmOid,
e.name=d,e;if(d=n.mgf[d].create(n.md[c].create()),void 0===(c=q[b.signatureParameters.hash.algorithmOid])||void 0===n.md[c])throw(e=Error("Unsupported RSASSA-PSS hash function.")).oid=b.signatureParameters.hash.algorithmOid,e.name=c,e;var g=n.pss.create(n.md[c].create(),d,b.signatureParameters.saltLength)}return b.publicKey.verify(a.md.digest().getBytes(),a.signature,g)};p.certificateFromPem=function(a,b,c){a=n.pem.decode(a)[0];if("CERTIFICATE"!==a.type&&"X509 CERTIFICATE"!==a.type&&"TRUSTED CERTIFICATE"!==
a.type)throw b=Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".'),b.headerType=a.type,b;if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert certificate from PEM; PEM is encrypted.");c=g.fromDer(a.body,c);return p.certificateFromAsn1(c,b)};p.certificateToPem=function(a,b){a={type:"CERTIFICATE",body:g.toDer(p.certificateToAsn1(a)).getBytes()};return n.pem.encode(a,{maxline:b})};p.publicKeyFromPem=
function(a){a=n.pem.decode(a)[0];if("PUBLIC KEY"!==a.type&&"RSA PUBLIC KEY"!==a.type){var b=Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw b.headerType=a.type,b;}if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert public key from PEM; PEM is encrypted.");a=g.fromDer(a.body);return p.publicKeyFromAsn1(a)};p.publicKeyToPem=function(a,b){a={type:"PUBLIC KEY",body:g.toDer(p.publicKeyToAsn1(a)).getBytes()};return n.pem.encode(a,
{maxline:b})};p.publicKeyToRSAPublicKeyPem=function(a,b){a={type:"RSA PUBLIC KEY",body:g.toDer(p.publicKeyToRSAPublicKey(a)).getBytes()};return n.pem.encode(a,{maxline:b})};p.getPublicKeyFingerprint=function(a,b){var c=(b=b||{}).md||n.md.sha1.create();switch(b.type||"RSAPublicKey"){case "RSAPublicKey":a=g.toDer(p.publicKeyToRSAPublicKey(a)).getBytes();break;case "SubjectPublicKeyInfo":a=g.toDer(p.publicKeyToAsn1(a)).getBytes();break;default:throw Error('Unknown fingerprint type "'+b.type+'".');}c.start();
c.update(a);c=c.digest();if("hex"===b.encoding)return c=c.toHex(),b.delimiter?c.match(/.{2}/g).join(b.delimiter):c;if("binary"===b.encoding)return c.getBytes();if(b.encoding)throw Error('Unknown encoding "'+b.encoding+'".');return c};p.certificationRequestFromPem=function(a,b,c){a=n.pem.decode(a)[0];if("CERTIFICATE REQUEST"!==a.type)throw b=Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".'),b.headerType=a.type,b;if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert certification request from PEM; PEM is encrypted.");
c=g.fromDer(a.body,c);return p.certificationRequestFromAsn1(c,b)};p.certificationRequestToPem=function(a,b){a={type:"CERTIFICATE REQUEST",body:g.toDer(p.certificationRequestToAsn1(a)).getBytes()};return n.pem.encode(a,{maxline:b})};p.createCertificate=function(){var a={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return a.siginfo.algorithmOid=null,a.validity={},a.validity.notBefore=new Date,a.validity.notAfter=new Date,a.issuer={},a.issuer.getField=function(b){return d(a.issuer,
b)},a.issuer.addField=function(b){k([b]);a.issuer.attributes.push(b)},a.issuer.attributes=[],a.issuer.hash=null,a.subject={},a.subject.getField=function(b){return d(a.subject,b)},a.subject.addField=function(b){k([b]);a.subject.attributes.push(b)},a.subject.attributes=[],a.subject.hash=null,a.extensions=[],a.publicKey=null,a.md=null,a.setSubject=function(b,c){k(b);a.subject.attributes=b;delete a.subject.uniqueId;c&&(a.subject.uniqueId=c);a.subject.hash=null},a.setIssuer=function(b,c){k(b);a.issuer.attributes=
b;delete a.issuer.uniqueId;c&&(a.issuer.uniqueId=c);a.issuer.hash=null},a.setExtensions=function(b){for(var c=0;c<b.length;++c)l(b[c],{cert:a});a.extensions=b},a.getExtension=function(b){"string"==typeof b&&(b={name:b});for(var c,d=null,e=0;null===d&&e<a.extensions.length;++e)c=a.extensions[e],(b.id&&c.id===b.id||b.name&&c.name===b.name)&&(d=c);return d},a.sign=function(b,c){a.md=c||n.md.sha1.create();c=q[a.md.algorithm+"WithRSAEncryption"];if(!c)throw b=Error("Could not compute certificate digest. Unknown message digest algorithm OID."),
b.algorithm=a.md.algorithm,b;a.signatureOid=a.siginfo.algorithmOid=c;a.tbsCertificate=p.getTBSCertificate(a);c=g.toDer(a.tbsCertificate);a.md.update(c.getBytes());a.signature=b.sign(a.md)},a.verify=function(b){var c=!1;if(!a.issued(b))throw b=b.issuer,c=Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject."),c.expectedIssuer=a.subject.attributes,c.actualIssuer=b.attributes,c;var d=b.md;if(null===d){d=B({signatureOid:b.signatureOid,
type:"certificate"});var e=b.tbsCertificate||p.getTBSCertificate(b);e=g.toDer(e);d.update(e.getBytes())}return null!==d&&(c=I({certificate:a,md:d,signature:b.signature})),c},a.isIssuer=function(b){var c=!1,d=a.issuer;b=b.subject;if(d.hash&&b.hash)c=d.hash===b.hash;else if(d.attributes.length===b.attributes.length){c=!0;for(var e=0;c&&e<d.attributes.length;++e){var g=d.attributes[e];var h=b.attributes[e];g.type===h.type&&g.value===h.value||(c=!1)}}return c},a.issued=function(b){return b.isIssuer(a)},
a.generateSubjectKeyIdentifier=function(){return p.getPublicKeyFingerprint(a.publicKey,{type:"RSAPublicKey"})},a.verifySubjectKeyIdentifier=function(){for(var b=q.subjectKeyIdentifier,c=0;c<a.extensions.length;++c){var d=a.extensions[c];if(d.id===b)return b=a.generateSubjectKeyIdentifier().getBytes(),n.util.hexToBytes(d.subjectKeyIdentifier)===b}return!1},a};p.certificateFromAsn1=function(a,b){var c={},e=[];if(!g.validate(a,v,c,e))throw c=Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate."),
c.errors=e,c;if(g.derToOid(c.publicKeyOid)!==p.oids.rsaEncryption)throw Error("Cannot read public key. OID is not RSA.");var h=p.createCertificate();h.version=c.certVersion?c.certVersion.charCodeAt(0):0;e=n.util.createBuffer(c.certSerialNumber);h.serialNumber=e.toHex();h.signatureOid=n.asn1.derToOid(c.certSignatureOid);h.signatureParameters=x(h.signatureOid,c.certSignatureParams,!0);h.siginfo.algorithmOid=n.asn1.derToOid(c.certinfoSignatureOid);h.siginfo.parameters=x(h.siginfo.algorithmOid,c.certinfoSignatureParams,
!1);h.signature=c.certSignature;e=[];if(void 0!==c.certValidity1UTCTime&&e.push(g.utcTimeToDate(c.certValidity1UTCTime)),void 0!==c.certValidity2GeneralizedTime&&e.push(g.generalizedTimeToDate(c.certValidity2GeneralizedTime)),void 0!==c.certValidity3UTCTime&&e.push(g.utcTimeToDate(c.certValidity3UTCTime)),void 0!==c.certValidity4GeneralizedTime&&e.push(g.generalizedTimeToDate(c.certValidity4GeneralizedTime)),2<e.length)throw Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");
if(2>e.length)throw Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(h.validity.notBefore=e[0],h.validity.notAfter=e[1],h.tbsCertificate=c.tbsCertificate,b)h.md=B({signatureOid:h.signatureOid,type:"certificate"}),b=g.toDer(h.tbsCertificate),h.md.update(b.getBytes());b=n.md.sha1.create();e=g.toDer(c.certIssuer);b.update(e.getBytes());h.issuer.getField=function(a){return d(h.issuer,a)};h.issuer.addField=function(a){k([a]);h.issuer.attributes.push(a)};
h.issuer.attributes=p.RDNAttributesAsArray(c.certIssuer);c.certIssuerUniqueId&&(h.issuer.uniqueId=c.certIssuerUniqueId);h.issuer.hash=b.digest().toHex();b=n.md.sha1.create();e=g.toDer(c.certSubject);return b.update(e.getBytes()),h.subject.getField=function(a){return d(h.subject,a)},h.subject.addField=function(a){k([a]);h.subject.attributes.push(a)},h.subject.attributes=p.RDNAttributesAsArray(c.certSubject),c.certSubjectUniqueId&&(h.subject.uniqueId=c.certSubjectUniqueId),h.subject.hash=b.digest().toHex(),
c.certExtensions?h.extensions=p.certificateExtensionsFromAsn1(c.certExtensions):h.extensions=[],h.publicKey=p.publicKeyFromAsn1(c.subjectPublicKeyInfo),h};p.certificateExtensionsFromAsn1=function(a){for(var b=[],c=0;c<a.value.length;++c)for(var d=a.value[c],e=0;e<d.value.length;++e)b.push(p.certificateExtensionFromAsn1(d.value[e]));return b};p.certificateExtensionFromAsn1=function(a){var b={};if(b.id=g.derToOid(a.value[0].value),b.critical=!1,a.value[1].type===g.Type.BOOLEAN?(b.critical=0!==a.value[1].value.charCodeAt(0),
b.value=a.value[2].value):b.value=a.value[1].value,b.id in q)if(b.name=q[b.id],"keyUsage"===b.name){var c=0;a=0;1<(d=g.fromDer(b.value)).value.length&&(c=d.value.charCodeAt(1),a=2<d.value.length?d.value.charCodeAt(2):0);b.digitalSignature=128==(128&c);b.nonRepudiation=64==(64&c);b.keyEncipherment=32==(32&c);b.dataEncipherment=16==(16&c);b.keyAgreement=8==(8&c);b.keyCertSign=4==(4&c);b.cRLSign=2==(2&c);b.encipherOnly=1==(1&c);b.decipherOnly=128==(128&a)}else if("basicConstraints"===b.name)0<(d=g.fromDer(b.value)).value.length&&
d.value[0].type===g.Type.BOOLEAN?b.cA=0!==d.value[0].value.charCodeAt(0):b.cA=!1,c=null,0<d.value.length&&d.value[0].type===g.Type.INTEGER?c=d.value[0].value:1<d.value.length&&(c=d.value[1].value),null!==c&&(b.pathLenConstraint=g.derToInteger(c));else if("extKeyUsage"===b.name){var d=g.fromDer(b.value);for(c=0;c<d.value.length;++c)a=g.derToOid(d.value[c].value),a in q?b[q[a]]=!0:b[a]=!0}else if("nsCertType"===b.name)c=0,1<(d=g.fromDer(b.value)).value.length&&(c=d.value.charCodeAt(1)),b.client=128==
(128&c),b.server=64==(64&c),b.email=32==(32&c),b.objsign=16==(16&c),b.reserved=8==(8&c),b.sslCA=4==(4&c),b.emailCA=2==(2&c),b.objCA=1==(1&c);else if("subjectAltName"===b.name||"issuerAltName"===b.name)for(b.altNames=[],d=g.fromDer(b.value),a=0;a<d.value.length;++a){var e={type:(c=d.value[a]).type,value:c.value};switch(b.altNames.push(e),c.type){case 7:e.ip=n.util.bytesToIP(c.value);break;case 8:e.oid=g.derToOid(c.value)}}else"subjectKeyIdentifier"===b.name&&(d=g.fromDer(b.value),b.subjectKeyIdentifier=
n.util.bytesToHex(d.value));return b};p.certificationRequestFromAsn1=function(a,b){var c={},e=[];if(!g.validate(a,A,c,e))throw c=Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest."),c.errors=e,c;if(g.derToOid(c.publicKeyOid)!==p.oids.rsaEncryption)throw Error("Cannot read public key. OID is not RSA.");var h=p.createCertificationRequest();if(h.version=c.csrVersion?c.csrVersion.charCodeAt(0):0,h.signatureOid=n.asn1.derToOid(c.csrSignatureOid),h.signatureParameters=
x(h.signatureOid,c.csrSignatureParams,!0),h.siginfo.algorithmOid=n.asn1.derToOid(c.csrSignatureOid),h.siginfo.parameters=x(h.siginfo.algorithmOid,c.csrSignatureParams,!1),h.signature=c.csrSignature,h.certificationRequestInfo=c.certificationRequestInfo,b)h.md=B({signatureOid:h.signatureOid,type:"certification request"}),e=g.toDer(h.certificationRequestInfo),h.md.update(e.getBytes());e=n.md.sha1.create();return h.subject.getField=function(a){return d(h.subject,a)},h.subject.addField=function(a){k([a]);
h.subject.attributes.push(a)},h.subject.attributes=p.RDNAttributesAsArray(c.certificationRequestInfoSubject,e),h.subject.hash=e.digest().toHex(),h.publicKey=p.publicKeyFromAsn1(c.subjectPublicKeyInfo),h.getAttribute=function(a){return d(h,a)},h.addAttribute=function(a){k([a]);h.attributes.push(a)},h.attributes=p.CRIAttributesAsArray(c.certificationRequestInfoAttributes||[]),h};p.createCertificationRequest=function(){var a={version:0,signatureOid:null,signature:null,siginfo:{}};return a.siginfo.algorithmOid=
null,a.subject={},a.subject.getField=function(b){return d(a.subject,b)},a.subject.addField=function(b){k([b]);a.subject.attributes.push(b)},a.subject.attributes=[],a.subject.hash=null,a.publicKey=null,a.attributes=[],a.getAttribute=function(b){return d(a,b)},a.addAttribute=function(b){k([b]);a.attributes.push(b)},a.md=null,a.setSubject=function(b){k(b);a.subject.attributes=b;a.subject.hash=null},a.setAttributes=function(b){k(b);a.attributes=b},a.sign=function(b,c){a.md=c||n.md.sha1.create();c=q[a.md.algorithm+
"WithRSAEncryption"];if(!c)throw b=Error("Could not compute certification request digest. Unknown message digest algorithm OID."),b.algorithm=a.md.algorithm,b;a.signatureOid=a.siginfo.algorithmOid=c;a.certificationRequestInfo=p.getCertificationRequestInfo(a);c=g.toDer(a.certificationRequestInfo);a.md.update(c.getBytes());a.signature=b.sign(a.md)},a.verify=function(){var b=!1,c=a.md;if(null===c){c=B({signatureOid:a.signatureOid,type:"certification request"});var d=a.certificationRequestInfo||p.getCertificationRequestInfo(a);
d=g.toDer(d);c.update(d.getBytes())}return null!==c&&(b=I({certificate:a,md:c,signature:a.signature})),b},a};var D=new Date("1950-01-01T00:00:00Z"),E=new Date("2050-01-01T00:00:00Z");p.getTBSCertificate=function(a){var b=h(a.validity.notBefore),c=h(a.validity.notAfter);b=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(a.version).getBytes())]),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,n.util.hexToBytes(a.serialNumber)),
g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.siginfo.algorithmOid).getBytes()),m(a.siginfo.algorithmOid,a.siginfo.parameters)]),f(a.issuer),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[b,c]),f(a.subject),p.publicKeyToAsn1(a.publicKey)]);return a.issuer.uniqueId&&b.value.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,[g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+a.issuer.uniqueId)])),a.subject.uniqueId&&b.value.push(g.create(g.Class.CONTEXT_SPECIFIC,
2,!0,[g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+a.subject.uniqueId)])),0<a.extensions.length&&b.value.push(p.certificateExtensionsToAsn1(a.extensions)),b};p.getCertificationRequestInfo=function(a){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(a.version).getBytes()),f(a.subject),p.publicKeyToAsn1(a.publicKey),e(a)])};p.distinguishedNameToAsn1=function(a){return f(a)};p.certificateToAsn1=function(a){var b=
a.tbsCertificate||p.getTBSCertificate(a);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[b,g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.signatureOid).getBytes()),m(a.signatureOid,a.signatureParameters)]),g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])};p.certificateExtensionsToAsn1=function(a){var b=g.create(g.Class.CONTEXT_SPECIFIC,3,!0,[]),c=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);b.value.push(c);
for(var d=0;d<a.length;++d)c.value.push(p.certificateExtensionToAsn1(a[d]));return b};p.certificateExtensionToAsn1=function(a){var b=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);b.value.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.id).getBytes()));a.critical&&b.value.push(g.create(g.Class.UNIVERSAL,g.Type.BOOLEAN,!1,String.fromCharCode(255)));var c=a.value;return"string"!=typeof a.value&&(c=g.toDer(c).getBytes()),b.value.push(g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,c)),
b};p.certificationRequestToAsn1=function(a){var b=a.certificationRequestInfo||p.getCertificationRequestInfo(a);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[b,g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.signatureOid).getBytes()),m(a.signatureOid,a.signatureParameters)]),g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])};p.createCaStore=function(a){function b(a){return c(a),d.certs[a.hash]||null}function c(a){if(!a.hash){var b=
n.md.sha1.create();a.attributes=p.RDNAttributesAsArray(f(a),b);a.hash=b.digest().toHex()}}var d={certs:{}};if(d.getIssuer=function(a){return b(a.issuer)},d.addCertificate=function(a){if("string"==typeof a&&(a=n.pki.certificateFromPem(a)),c(a.subject),!d.hasCertificate(a))if(a.subject.hash in d.certs){var b=d.certs[a.subject.hash];n.util.isArray(b)||(b=[b]);b.push(a);d.certs[a.subject.hash]=b}else d.certs[a.subject.hash]=a},d.hasCertificate=function(a){"string"==typeof a&&(a=n.pki.certificateFromPem(a));
var c=b(a.subject);if(!c)return!1;n.util.isArray(c)||(c=[c]);a=g.toDer(p.certificateToAsn1(a)).getBytes();for(var d=0;d<c.length;++d)if(a===g.toDer(p.certificateToAsn1(c[d])).getBytes())return!0;return!1},d.listAllCertificates=function(){var a=[],b;for(b in d.certs)if(d.certs.hasOwnProperty(b)){var c=d.certs[b];if(n.util.isArray(c))for(var e=0;e<c.length;++e)a.push(c[e]);else a.push(c)}return a},d.removeCertificate=function(a){var e;if("string"==typeof a&&(a=n.pki.certificateFromPem(a)),c(a.subject),
!d.hasCertificate(a))return null;var h=b(a.subject);if(!n.util.isArray(h))return e=d.certs[a.subject.hash],delete d.certs[a.subject.hash],e;for(var f=g.toDer(p.certificateToAsn1(a)).getBytes(),m=0;m<h.length;++m)f===g.toDer(p.certificateToAsn1(h[m])).getBytes()&&(e=h[m],h.splice(m,1));return 0===h.length&&delete d.certs[a.subject.hash],e},a)for(var e=0;e<a.length;++e)d.addCertificate(a[e]);return d};p.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",
certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};p.verifyCertificateChain=function(a,b,c){"function"==typeof c&&(c={verify:c});c=c||{};var d=(b=b.slice(0)).slice(0),e=c.validityCheckDate;void 0===e&&(e=new Date);var g=!0,h=null,f=0;do{var m=b.shift(),k=null,l=!1;if(e&&(e<m.validity.notBefore||e>m.validity.notAfter)&&(h={message:"Certificate is not valid yet or has expired.",
error:p.certificateError.certificate_expired,notBefore:m.validity.notBefore,notAfter:m.validity.notAfter,now:e}),null===h){if(null===(k=b[0]||a.getIssuer(m))&&m.isIssuer(m)&&(l=!0,k=m),k){var q=k;n.util.isArray(q)||(q=[q]);for(var v=!1;!v&&0<q.length;){k=q.shift();try{v=k.verify(m)}catch(H){}}v||(h={message:"Certificate signature is invalid.",error:p.certificateError.bad_certificate})}null!==h||k&&!l||a.hasCertificate(m)||(h={message:"Certificate is not trusted.",error:p.certificateError.unknown_ca})}if(null===
h&&k&&!m.isIssuer(k)&&(h={message:"Certificate issuer is invalid.",error:p.certificateError.bad_certificate}),null===h)for(q={keyUsage:!0,basicConstraints:!0},v=0;null===h&&v<m.extensions.length;++v){var r=m.extensions[v];!r.critical||r.name in q||(h={message:"Certificate has an unsupported critical extension.",error:p.certificateError.unsupported_certificate})}null!==h||g&&(0!==b.length||k&&!l)||(g=m.getExtension("basicConstraints"),m=m.getExtension("keyUsage"),(null!==m&&(m.keyCertSign&&null!==
g||(h={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:p.certificateError.bad_certificate})),null!==h||null===g||g.cA||(h={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:p.certificateError.bad_certificate}),null===h&&null!==m&&"pathLenConstraint"in g)&&f-1>g.pathLenConstraint&&(h={message:"Certificate basicConstraints pathLenConstraint violated.",
error:p.certificateError.bad_certificate}));m=null===h||h.error;g=c.verify?c.verify(m,f,d):m;if(!0!==g)throw!0===m&&(h={message:"The application rejected the certificate.",error:p.certificateError.bad_certificate}),(g||0===g)&&("object"!=typeof g||n.util.isArray(g)?"string"==typeof g&&(h.error=g):(g.message&&(h.message=g.message),g.error&&(h.error=g.error))),h;h=null;g=!1;++f}while(0<b.length);return!0}},function(a,b,c){var d=c(0);c(2);c(1);(a.exports=d.pss=d.pss||{}).create=function(a){3===arguments.length&&
(a={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var b=a.md,c=a.mgf,f=b.digestLength,e=a.salt||null;if("string"==typeof e&&(e=d.util.createBuffer(e)),"saltLength"in a)var h=a.saltLength;else{if(null===e)throw Error("Salt length not specified or specific salt not given.");h=e.length()}if(null!==e&&e.length()!==h)throw Error("Given salt length does not match length of given salt.");var n=a.prng||d.random;return{encode:function(a,m){--m;var g=Math.ceil(m/8);a=a.digest().getBytes();if(g<
f+h+2)throw Error("Message is too long to encrypt.");var k=null===e?n.getBytesSync(h):e.bytes();var l=new d.util.ByteBuffer;l.fillWithByte(0,8);l.putBytes(a);l.putBytes(k);b.start();b.update(l.getBytes());a=b.digest().getBytes();l=new d.util.ByteBuffer;l.fillWithByte(0,g-h-f-2);l.putByte(1);l.putBytes(k);var p=l.getBytes(),A=g-f-1,x=c.generate(a,A);k="";for(l=0;l<A;l++)k+=String.fromCharCode(p.charCodeAt(l)^x.charCodeAt(l));m=65280>>8*g-m&255;return String.fromCharCode(k.charCodeAt(0)&~m)+k.substr(1)+
a+String.fromCharCode(188)},verify:function(a,e,m){var g=m-1;m=Math.ceil(g/8);if(e=e.substr(-m),m<f+h+2)throw Error("Inconsistent parameters to PSS signature verification.");if(188!==e.charCodeAt(m-1))throw Error("Encoded message does not end in 0xBC.");var k=m-f-1,l=e.substr(0,k);e=e.substr(k,f);var n=65280>>8*m-g&255;if(0!=(l.charCodeAt(0)&n))throw Error("Bits beyond keysize not zero as expected.");var p=c.generate(e,k),q="";for(g=0;g<k;g++)q+=String.fromCharCode(l.charCodeAt(g)^p.charCodeAt(g));
q=String.fromCharCode(q.charCodeAt(0)&~n)+q.substr(1);m=m-f-h-2;for(g=0;g<m;g++)if(0!==q.charCodeAt(g))throw Error("Leftmost octets not zero as expected");if(1!==q.charCodeAt(m))throw Error("Inconsistent PSS signature, 0x01 marker not found");m=q.substr(-h);k=new d.util.ByteBuffer;return k.fillWithByte(0,8),k.putBytes(a),k.putBytes(m),b.start(),b.update(k.getBytes()),e===b.digest().getBytes()}}}},function(a,b,c){function d(a,b){if("string"==typeof a&&(a=l.util.createBuffer(a)),l.util.isArray(a)&&
4<a.length){var c=a;a=l.util.createBuffer();for(var d=0;d<c.length;++d)a.putByte(c[d])}if(a.length()<b)throw Error("Invalid IV length; got "+a.length()+" bytes and expected "+b+" bytes.");if(!l.util.isArray(a)){c=[];b/=4;for(d=0;d<b;++d)c.push(a.getInt32());a=c}return a}function f(a){a[a.length-1]=a[a.length-1]+1&4294967295}function k(a){return[a/4294967296|0,4294967295&a]}var l=c(0);c(1);l.cipher=l.cipher||{};a=a.exports=l.cipher.modes=l.cipher.modes||{};a.ecb=function(a){a=a||{};this.name="ECB";
this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints)};a.ecb.prototype.start=function(a){};a.ecb.prototype.encrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=a.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c])};a.ecb.prototype.decrypt=function(a,b,c){if(a.length()<this.blockSize&&
!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=a.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c])};a.ecb.prototype.pad=function(a,b){b=a.length()===this.blockSize?this.blockSize:this.blockSize-a.length();return a.fillWithByte(b,b),!0};a.ecb.prototype.unpad=function(a,b){if(0<b.overflow)return!1;b=a.length();b=a.at(b-1);return!(b>this.blockSize<<2)&&(a.truncate(b),!0)};a.cbc=function(a){a=a||{};this.name="CBC";
this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints)};a.cbc.prototype.start=function(a){if(null===a.iv){if(!this._prev)throw Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=d(a.iv,this.blockSize);this._prev=this._iv.slice(0)}};a.cbc.prototype.encrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=
0;c<this._ints;++c)this._inBlock[c]=this._prev[c]^a.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c]);this._prev=this._outBlock};a.cbc.prototype.decrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=a.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._prev[c]^this._outBlock[c]);this._prev=this._inBlock.slice(0)};
a.cbc.prototype.pad=function(a,b){b=a.length()===this.blockSize?this.blockSize:this.blockSize-a.length();return a.fillWithByte(b,b),!0};a.cbc.prototype.unpad=function(a,b){if(0<b.overflow)return!1;b=a.length();b=a.at(b-1);return!(b>this.blockSize<<2)&&(a.truncate(b),!0)};a.cfb=function(a){a=a||{};this.name="CFB";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;this._inBlock=null;this._outBlock=Array(this._ints);this._partialBlock=Array(this._ints);this._partialOutput=
l.util.createBuffer();this._partialBytes=0};a.cfb.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=d(a.iv,this.blockSize);this._inBlock=this._iv.slice(0);this._partialBytes=0};a.cfb.prototype.encrypt=function(a,b,c){var d=a.length();if(0===d)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&d>=this.blockSize)for(var e=0;e<this._ints;++e)this._inBlock[e]=a.getInt32()^this._outBlock[e],b.putInt32(this._inBlock[e]);else{var h=
(this.blockSize-d)%this.blockSize;0<h&&(h=this.blockSize-h);this._partialOutput.clear();for(e=0;e<this._ints;++e)this._partialBlock[e]=a.getInt32()^this._outBlock[e],this._partialOutput.putInt32(this._partialBlock[e]);if(0<h)a.read-=this.blockSize;else for(e=0;e<this._ints;++e)this._inBlock[e]=this._partialBlock[e];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<h&&!c)return b.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;b.putBytes(this._partialOutput.getBytes(d-
this._partialBytes));this._partialBytes=0}};a.cfb.prototype.decrypt=function(a,b,c){var d=a.length();if(0===d)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&d>=this.blockSize)for(var e=0;e<this._ints;++e)this._inBlock[e]=a.getInt32(),b.putInt32(this._inBlock[e]^this._outBlock[e]);else{var h=(this.blockSize-d)%this.blockSize;0<h&&(h=this.blockSize-h);this._partialOutput.clear();for(e=0;e<this._ints;++e)this._partialBlock[e]=a.getInt32(),this._partialOutput.putInt32(this._partialBlock[e]^
this._outBlock[e]);if(0<h)a.read-=this.blockSize;else for(e=0;e<this._ints;++e)this._inBlock[e]=this._partialBlock[e];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<h&&!c)return b.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;b.putBytes(this._partialOutput.getBytes(d-this._partialBytes));this._partialBytes=0}};a.ofb=function(a){a=a||{};this.name="OFB";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;
this._inBlock=null;this._outBlock=Array(this._ints);this._partialOutput=l.util.createBuffer();this._partialBytes=0};a.ofb.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=d(a.iv,this.blockSize);this._inBlock=this._iv.slice(0);this._partialBytes=0};a.ofb.prototype.encrypt=function(a,b,c){var d=a.length();if(0===a.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&d>=this.blockSize)for(var e=0;e<this._ints;++e)b.putInt32(a.getInt32()^
this._outBlock[e]),this._inBlock[e]=this._outBlock[e];else{var h=(this.blockSize-d)%this.blockSize;0<h&&(h=this.blockSize-h);this._partialOutput.clear();for(e=0;e<this._ints;++e)this._partialOutput.putInt32(a.getInt32()^this._outBlock[e]);if(0<h)a.read-=this.blockSize;else for(e=0;e<this._ints;++e)this._inBlock[e]=this._outBlock[e];if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<h&&!c)return b.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=
h,!0;b.putBytes(this._partialOutput.getBytes(d-this._partialBytes));this._partialBytes=0}};a.ofb.prototype.decrypt=a.ofb.prototype.encrypt;a.ctr=function(a){a=a||{};this.name="CTR";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;this._inBlock=null;this._outBlock=Array(this._ints);this._partialOutput=l.util.createBuffer();this._partialBytes=0};a.ctr.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=d(a.iv,this.blockSize);this._inBlock=
this._iv.slice(0);this._partialBytes=0};a.ctr.prototype.encrypt=function(a,b,c){var d=a.length();if(0===d)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&d>=this.blockSize)for(var e=0;e<this._ints;++e)b.putInt32(a.getInt32()^this._outBlock[e]);else{var h=(this.blockSize-d)%this.blockSize;0<h&&(h=this.blockSize-h);this._partialOutput.clear();for(e=0;e<this._ints;++e)this._partialOutput.putInt32(a.getInt32()^this._outBlock[e]);if(0<h&&(a.read-=this.blockSize),0<
this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<h&&!c)return b.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;b.putBytes(this._partialOutput.getBytes(d-this._partialBytes));this._partialBytes=0}f(this._inBlock)};a.ctr.prototype.decrypt=a.ctr.prototype.encrypt;a.gcm=function(a){a=a||{};this.name="GCM";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints);
this._partialOutput=l.util.createBuffer();this._partialBytes=0;this._R=3774873600};a.gcm.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");var b,c=l.util.createBuffer(a.iv);if(this._cipherLength=0,b="additionalData"in a?l.util.createBuffer(a.additionalData):l.util.createBuffer(),this._tagLength="tagLength"in a?a.tagLength:128,this._tag=null,a.decrypt&&(this._tag=l.util.createBuffer(a.tag).getBytes(),this._tag.length!==this._tagLength/8))throw Error("Authentication tag does not match tag length.");
this._hashBlock=Array(this._ints);this.tag=null;this._hashSubkey=Array(this._ints);this.cipher.encrypt([0,0,0,0],this._hashSubkey);this.componentBits=4;this._m=this.generateHashTable(this._hashSubkey,this.componentBits);a=c.length();if(12===a)this._j0=[c.getInt32(),c.getInt32(),c.getInt32(),1];else{for(this._j0=[0,0,0,0];0<c.length();)this._j0=this.ghash(this._hashSubkey,this._j0,[c.getInt32(),c.getInt32(),c.getInt32(),c.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(k(8*
a)))}this._inBlock=this._j0.slice(0);f(this._inBlock);this._partialBytes=0;b=l.util.createBuffer(b);this._aDataLength=k(8*b.length());(c=b.length()%this.blockSize)&&b.fillWithByte(0,this.blockSize-c);for(this._s=[0,0,0,0];0<b.length();)this._s=this.ghash(this._hashSubkey,this._s,[b.getInt32(),b.getInt32(),b.getInt32(),b.getInt32()])};a.gcm.prototype.encrypt=function(a,b,c){var d=a.length();if(0===d)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&d>=this.blockSize){for(var e=
0;e<this._ints;++e)b.putInt32(this._outBlock[e]^=a.getInt32());this._cipherLength+=this.blockSize}else{var h=(this.blockSize-d)%this.blockSize;0<h&&(h=this.blockSize-h);this._partialOutput.clear();for(e=0;e<this._ints;++e)this._partialOutput.putInt32(a.getInt32()^this._outBlock[e]);if(0>=h||c){c?(e=d%this.blockSize,this._cipherLength+=e,this._partialOutput.truncate(this.blockSize-e)):this._cipherLength+=this.blockSize;for(e=0;e<this._ints;++e)this._outBlock[e]=this._partialOutput.getInt32();this._partialOutput.read-=
this.blockSize}if(0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes),0<h&&!c)return a.read-=this.blockSize,b.putBytes(this._partialOutput.getBytes(h-this._partialBytes)),this._partialBytes=h,!0;b.putBytes(this._partialOutput.getBytes(d-this._partialBytes));this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock);f(this._inBlock)};a.gcm.prototype.decrypt=function(a,b,c){var d=a.length();if(d<this.blockSize&&!(c&&0<d))return!0;this.cipher.encrypt(this._inBlock,
this._outBlock);f(this._inBlock);this._hashBlock[0]=a.getInt32();this._hashBlock[1]=a.getInt32();this._hashBlock[2]=a.getInt32();this._hashBlock[3]=a.getInt32();this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(a=0;a<this._ints;++a)b.putInt32(this._outBlock[a]^this._hashBlock[a]);d<this.blockSize?this._cipherLength+=d%this.blockSize:this._cipherLength+=this.blockSize};a.gcm.prototype.afterFinish=function(a,b){var c=!0;b.decrypt&&b.overflow&&a.truncate(this.blockSize-b.overflow);this.tag=
l.util.createBuffer();a=this._aDataLength.concat(k(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,a);a=[];this.cipher.encrypt(this._j0,a);for(var d=0;d<this._ints;++d)this.tag.putInt32(this._s[d]^a[d]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),b.decrypt&&this.tag.bytes()!==this._tag&&(c=!1),c};a.gcm.prototype.multiply=function(a,b){var c=[0,0,0,0];b=b.slice(0);for(var d=0;128>d;++d)a[d/32|0]&1<<31-d%32&&(c[0]^=b[0],c[1]^=b[1],c[2]^=b[2],c[3]^=b[3]),this.pow(b,
b);return c};a.gcm.prototype.pow=function(a,b){for(var c=1&a[3],d=3;0<d;--d)b[d]=a[d]>>>1|(1&a[d-1])<<31;b[0]=a[0]>>>1;c&&(b[0]^=this._R)};a.gcm.prototype.tableMultiply=function(a){for(var b=[0,0,0,0],c=0;32>c;++c){var d=this._m[c][a[c/8|0]>>>4*(7-c%8)&15];b[0]^=d[0];b[1]^=d[1];b[2]^=d[2];b[3]^=d[3]}return b};a.gcm.prototype.ghash=function(a,b,c){return b[0]^=c[0],b[1]^=c[1],b[2]^=c[2],b[3]^=c[3],this.tableMultiply(b)};a.gcm.prototype.generateHashTable=function(a,b){var c=8/b,d=4*c;c*=16;for(var e=
Array(c),f=0;f<c;++f){var m=[0,0,0,0];m[f/d|0]=1<<b-1<<(d-1-f%d)*b;e[f]=this.generateSubHashTable(this.multiply(m,a),b)}return e};a.gcm.prototype.generateSubHashTable=function(a,b){b=1<<b;var c=b>>>1,d=Array(b);d[c]=a.slice(0);for(var e=c>>>1;0<e;)this.pow(d[2*e],d[e]=[]),e>>=1;for(e=2;e<c;){for(var f=1;f<e;++f){var m=d[e],k=d[f];d[e+f]=[m[0]^k[0],m[1]^k[1],m[2]^k[2],m[3]^k[3]]}e*=2}d[0]=[0,0,0,0];for(e=c+1;e<b;++e)f=d[e^c],d[e]=[a[0]^f[0],a[1]^f[1],a[2]^f[2],a[3]^f[3]];return d}},function(a,b,c){var d=
c(0);c(3);c(8);c(14);c(7);c(21);c(2);c(9);c(1);var f=function(a,b,c,e){var g=d.util.createBuffer(),h=a.length>>1,f=h+(1&a.length),m=a.substr(0,f);f=a.substr(h,f);a=d.util.createBuffer();h=d.hmac.create();c=b+c;var k=Math.ceil(e/16);b=Math.ceil(e/20);h.start("MD5",m);m=d.util.createBuffer();a.putBytes(c);for(var l=0;l<k;++l)h.start(null,null),h.update(a.getBytes()),a.putBuffer(h.digest()),h.start(null,null),h.update(a.bytes()+c),m.putBuffer(h.digest());h.start("SHA1",f);f=d.util.createBuffer();a.clear();
a.putBytes(c);for(l=0;l<b;++l)h.start(null,null),h.update(a.getBytes()),a.putBuffer(h.digest()),h.start(null,null),h.update(a.bytes()+c),f.putBuffer(h.digest());return g.putBytes(d.util.xorBytes(m.getBytes(),f.getBytes(),e)),g},k=function(a,b,c){c=!1;try{var e=a.deflate(b.fragment.getBytes());b.fragment=d.util.createBuffer(e);b.length=e.length;c=!0}catch(H){}return c},l=function(a,b,c){c=!1;try{var e=a.inflate(b.fragment.getBytes());b.fragment=d.util.createBuffer(e);b.length=e.length;c=!0}catch(H){}return c},
m=function(a,b){var c=0;switch(b){case 1:c=a.getByte();break;case 2:c=a.getInt16();break;case 3:c=a.getInt24();break;case 4:c=a.getInt32()}return d.util.createBuffer(a.getBytes(c))},e=function(a,b,c){a.putInt(c.length(),b<<3);a.putBuffer(c)},h={Versions:{TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}}};h.SupportedVersions=[h.Versions.TLS_1_1,h.Versions.TLS_1_0];h.Version=h.SupportedVersions[0];h.MaxFragment=15360;h.ConnectionEnd={server:0,client:1};h.PRFAlgorithm={tls_prf_sha256:0};
h.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};h.CipherType={stream:0,block:1,aead:2};h.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};h.CompressionMethod={none:0,deflate:1};h.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24};h.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,
finished:20};h.Alert={};h.Alert.Level={warning:1,fatal:2};h.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,
user_canceled:90,no_renegotiation:100};h.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};h.CipherSuites={};h.getCipherSuite=function(a){var b=null,c;for(c in h.CipherSuites){var d=h.CipherSuites[c];if(d.id[0]===a.charCodeAt(0)&&d.id[1]===a.charCodeAt(1)){b=d;break}}return b};h.handleUnexpected=function(a,b){!a.open&&a.entity===h.ConnectionEnd.client||a.error(a,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.unexpected_message}})};
h.handleHelloRequest=function(a,b,c){!a.handshaking&&0<a.handshakes&&(h.queue(a,h.createAlert(a,{level:h.Alert.Level.warning,description:h.Alert.Description.no_renegotiation})),h.flush(a));a.process()};h.parseHelloMessage=function(a,b,c){var e=null,g=a.entity===h.ConnectionEnd.client;if(38>c)a.error(a,{message:g?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});
else{b=b.fragment;var f=b.length();if(e={version:{major:b.getByte(),minor:b.getByte()},random:d.util.createBuffer(b.getBytes(32)),session_id:m(b,1),extensions:[]},g?(e.cipher_suite=b.getBytes(2),e.compression_method=b.getByte()):(e.cipher_suites=m(b,2),e.compression_methods=m(b,1)),0<c-(f-b.length())){for(c=m(b,2);0<c.length();)e.extensions.push({type:[c.getByte(),c.getByte()],data:m(c,2)});if(!g)for(c=0;c<e.extensions.length;++c)if(b=e.extensions[c],0===b.type[0]&&0===b.type[1])for(b=m(b.data,2);0<
b.length()&&0===b.getByte();)a.session.extensions.server_name.serverNameList.push(m(b,2).getBytes())}if(a.session.version&&(e.version.major!==a.session.version.major||e.version.minor!==a.session.version.minor))return a.error(a,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.protocol_version}});if(g)a.session.cipherSuite=h.getCipherSuite(e.cipher_suite);else for(c=d.util.createBuffer(e.cipher_suites.bytes());0<
c.length()&&(a.session.cipherSuite=h.getCipherSuite(c.getBytes(2)),null===a.session.cipherSuite););if(null===a.session.cipherSuite)return a.error(a,{message:"No cipher suites in common.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.handshake_failure},cipherSuite:d.util.bytesToHex(e.cipher_suite)});a.session.compressionMethod=g?e.compression_method:h.CompressionMethod.none}return e};h.createSecurityParameters=function(a,b){var c=a.entity===h.ConnectionEnd.client,d=b.random.bytes();
b=c?a.session.sp.client_random:d;c=c?d:h.createRandom().getBytes();a.session.sp={entity:a.entity,prf_algorithm:h.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:a.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:b,server_random:c}};h.handleServerHello=function(a,b,c){b=h.parseHelloMessage(a,
b,c);if(!a.fail){if(!(b.version.minor<=a.version.minor))return a.error(a,{message:"Incompatible TLS version.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.protocol_version}});a.version.minor=b.version.minor;a.session.version=a.version;c=b.session_id.bytes();0<c.length&&c===a.session.id?(a.expect=r,a.session.resuming=!0,a.session.sp.server_random=b.random.bytes()):(a.expect=n,a.session.resuming=!1,h.createSecurityParameters(a,b));a.session.id=c;a.process()}};h.handleClientHello=
function(a,b,c){b=h.parseHelloMessage(a,b,c);if(!a.fail){var e=b.session_id.bytes();c=null;if(a.sessionCache&&(null===(c=a.sessionCache.getSession(e))?e="":(c.version.major!==b.version.major||c.version.minor>b.version.minor)&&(c=null,e="")),0===e.length&&(e=d.random.getBytes(32)),a.session.id=e,a.session.clientHelloVersion=b.version,a.session.sp={},c)a.version=a.session.version=c.version,a.session.sp=c.sp;else{var g;for(e=1;e<h.SupportedVersions.length&&!((g=h.SupportedVersions[e]).minor<=b.version.minor);++e);
a.version={major:g.major,minor:g.minor};a.session.version=a.version}null!==c?(a.expect=D,a.session.resuming=!0,a.session.sp.client_random=b.random.bytes()):(a.expect=!1!==a.verifyClient?x:B,a.session.resuming=!1,h.createSecurityParameters(a,b));a.open=!0;h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createServerHello(a)}));a.session.resuming?(h.queue(a,h.createRecord(a,{type:h.ContentType.change_cipher_spec,data:h.createChangeCipherSpec()})),a.state.pending=h.createConnectionState(a),
a.state.current.write=a.state.pending.write,h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createFinished(a)}))):(h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createCertificate(a)})),a.fail||(h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createServerKeyExchange(a)})),!1!==a.verifyClient&&h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createCertificateRequest(a)})),h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createServerHelloDone(a)}))));
h.flush(a);a.process()}};h.handleCertificate=function(a,b,c){if(3>c)return a.error(a,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});c=m(b.fragment,3);b=[];try{for(;0<c.length();){var e=m(c,3);var f=d.asn1.fromDer(e);e=d.pki.certificateFromAsn1(f,!0);b.push(e)}}catch(R){return a.error(a,{message:"Could not parse certificate list.",cause:R,send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.bad_certificate}})}e=
a.entity===h.ConnectionEnd.client;!e&&!0!==a.verifyClient||0!==b.length?0===b.length?a.expect=e?g:B:(e?a.session.serverCertificate=b[0]:a.session.clientCertificate=b[0],h.verifyCertificateChain(a,b)&&(a.expect=e?g:B)):a.error(a,{message:e?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});a.process()};h.handleServerKeyExchange=function(a,b,c){if(0<c)return a.error(a,{message:"Invalid key parameters. Only RSA is supported.",
send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.unsupported_certificate}});a.expect=p;a.process()};h.handleClientKeyExchange=function(a,b,c){if(48>c)return a.error(a,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.unsupported_certificate}});b=m(b.fragment,2).getBytes();c=null;if(a.getPrivateKey)try{c=a.getPrivateKey(a,a.session.serverCertificate),c=d.pki.privateKeyFromPem(c)}catch(R){a.error(a,
{message:"Could not get private key.",cause:R,send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}})}if(null===c)return a.error(a,{message:"No private key set.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}});try{var e=a.session.sp;e.pre_master_secret=c.decrypt(b);var g=a.session.clientHelloVersion;if(g.major!==e.pre_master_secret.charCodeAt(0)||g.minor!==e.pre_master_secret.charCodeAt(1))throw Error("TLS version rollback attack detected.");
}catch(R){e.pre_master_secret=d.random.getBytes(48)}a.expect=D;null!==a.session.clientCertificate&&(a.expect=I);a.process()};h.handleCertificateRequest=function(a,b,c){if(3>c)return a.error(a,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});b=b.fragment;b={certificate_types:m(b,1),certificate_authorities:m(b,2)};a.session.certificateRequest=b;a.expect=q;a.process()};h.handleCertificateVerify=function(a,
b,c){if(2>c)return a.error(a,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});c=b.fragment;c.read-=4;b=c.bytes();c.read+=4;c=m(c,2).getBytes();var e=d.util.createBuffer();e.putBuffer(a.session.md5.digest());e.putBuffer(a.session.sha1.digest());e=e.getBytes();try{if(!a.session.clientCertificate.publicKey.verify(e,c,"NONE"))throw Error("CertificateVerify signature does not match.");a.session.md5.update(b);
a.session.sha1.update(b)}catch(H){return a.error(a,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.handshake_failure}})}a.expect=D;a.process()};h.handleServerHelloDone=function(a,b,c){if(0<c)return a.error(a,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.record_overflow}});if(null===a.serverCertificate){c={message:"No server certificate provided. Not enough security.",
send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.insufficient_security}};var e=a.verify(a,c.alert.description,0,[]);if(!0!==e)return(e||0===e)&&("object"!=typeof e||d.util.isArray(e)?"number"==typeof e&&(c.alert.description=e):(e.message&&(c.message=e.message),e.alert&&(c.alert.description=e.alert))),a.error(a,c)}null!==a.session.certificateRequest&&(b=h.createRecord(a,{type:h.ContentType.handshake,data:h.createCertificate(a)}),h.queue(a,b));b=h.createRecord(a,{type:h.ContentType.handshake,
data:h.createClientKeyExchange(a)});h.queue(a,b);a.expect=A;b=function(a,b){null!==a.session.certificateRequest&&null!==a.session.clientCertificate&&h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createCertificateVerify(a,b)}));h.queue(a,h.createRecord(a,{type:h.ContentType.change_cipher_spec,data:h.createChangeCipherSpec()}));a.state.pending=h.createConnectionState(a);a.state.current.write=a.state.pending.write;h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createFinished(a)}));
a.expect=r;h.flush(a);a.process()};if(null===a.session.certificateRequest||null===a.session.clientCertificate)return b(a,null);h.getClientSignature(a,b)};h.handleChangeCipherSpec=function(a,b){if(1!==b.fragment.getByte())return a.error(a,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.illegal_parameter}});b=a.entity===h.ConnectionEnd.client;(a.session.resuming&&b||!a.session.resuming&&!b)&&(a.state.pending=h.createConnectionState(a));
a.state.current.read=a.state.pending.read;(!a.session.resuming&&b||a.session.resuming&&!b)&&(a.state.pending=null);a.expect=b?v:E;a.process()};h.handleFinished=function(a,b,c){c=b.fragment;c.read-=4;var e=c.bytes();c.read+=4;b=b.fragment.getBytes();(c=d.util.createBuffer()).putBuffer(a.session.md5.digest());c.putBuffer(a.session.sha1.digest());var g=a.entity===h.ConnectionEnd.client;if(f(a.session.sp.master_secret,g?"server finished":"client finished",c.getBytes(),12).getBytes()!==b)return a.error(a,
{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.decrypt_error}});a.session.md5.update(e);a.session.sha1.update(e);(a.session.resuming&&g||!a.session.resuming&&!g)&&(h.queue(a,h.createRecord(a,{type:h.ContentType.change_cipher_spec,data:h.createChangeCipherSpec()})),a.state.current.write=a.state.pending.write,a.state.pending=null,h.queue(a,h.createRecord(a,{type:h.ContentType.handshake,data:h.createFinished(a)})));a.expect=
g?u:C;a.handshaking=!1;++a.handshakes;a.peerCertificate=g?a.session.serverCertificate:a.session.clientCertificate;h.flush(a);a.isConnected=!0;a.connected(a);a.process()};h.handleAlert=function(a,b){b=b.fragment;var c={level:b.getByte(),description:b.getByte()};switch(c.description){case h.Alert.Description.close_notify:b="Connection closed.";break;case h.Alert.Description.unexpected_message:b="Unexpected message.";break;case h.Alert.Description.bad_record_mac:b="Bad record MAC.";break;case h.Alert.Description.decryption_failed:b=
"Decryption failed.";break;case h.Alert.Description.record_overflow:b="Record overflow.";break;case h.Alert.Description.decompression_failure:b="Decompression failed.";break;case h.Alert.Description.handshake_failure:b="Handshake failure.";break;case h.Alert.Description.bad_certificate:b="Bad certificate.";break;case h.Alert.Description.unsupported_certificate:b="Unsupported certificate.";break;case h.Alert.Description.certificate_revoked:b="Certificate revoked.";break;case h.Alert.Description.certificate_expired:b=
"Certificate expired.";break;case h.Alert.Description.certificate_unknown:b="Certificate unknown.";break;case h.Alert.Description.illegal_parameter:b="Illegal parameter.";break;case h.Alert.Description.unknown_ca:b="Unknown certificate authority.";break;case h.Alert.Description.access_denied:b="Access denied.";break;case h.Alert.Description.decode_error:b="Decode error.";break;case h.Alert.Description.decrypt_error:b="Decrypt error.";break;case h.Alert.Description.export_restriction:b="Export restriction.";
break;case h.Alert.Description.protocol_version:b="Unsupported protocol version.";break;case h.Alert.Description.insufficient_security:b="Insufficient security.";break;case h.Alert.Description.internal_error:b="Internal error.";break;case h.Alert.Description.user_canceled:b="User canceled.";break;case h.Alert.Description.no_renegotiation:b="Renegotiation not supported.";break;default:b="Unknown error."}if(c.description===h.Alert.Description.close_notify)return a.close();a.error(a,{message:b,send:!1,
origin:a.entity===h.ConnectionEnd.client?"server":"client",alert:c});a.process()};h.handleHandshake=function(a,b){var c=b.fragment,e=c.getByte(),g=c.getInt24();if(g>c.length())return a.fragmented=b,b.fragment=d.util.createBuffer(),c.read-=4,a.process();a.fragmented=null;c.read-=4;var f=c.bytes(g+4);c.read+=4;e in y[a.entity][a.expect]?(a.entity!==h.ConnectionEnd.server||a.open||a.fail||(a.handshaking=!0,a.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,
serverCertificate:null,clientCertificate:null,md5:d.md.md5.create(),sha1:d.md.sha1.create()}),e!==h.HandshakeType.hello_request&&e!==h.HandshakeType.certificate_verify&&e!==h.HandshakeType.finished&&(a.session.md5.update(f),a.session.sha1.update(f)),y[a.entity][a.expect][e](a,b,g)):h.handleUnexpected(a,b)};h.handleApplicationData=function(a,b){a.data.putBuffer(b.fragment);a.dataReady(a);a.process()};h.handleHeartbeat=function(a,b){var c=b.fragment;b=c.getByte();var e=c.getInt16();c=c.getBytes(e);
if(b===h.HeartbeatMessageType.heartbeat_request){if(a.handshaking||e>c.length)return a.process();h.queue(a,h.createRecord(a,{type:h.ContentType.heartbeat,data:h.createHeartbeat(h.HeartbeatMessageType.heartbeat_response,c)}));h.flush(a)}else if(b===h.HeartbeatMessageType.heartbeat_response){if(c!==a.expectedHeartbeatPayload)return a.process();a.heartbeatReceived&&a.heartbeatReceived(a,d.util.createBuffer(c))}a.process()};var n=1,g=2,p=3,q=4,r=5,v=6,u=7,A=8,x=1,B=2,I=3,D=4,E=5,C=6;b=h.handleUnexpected;
c=h.handleChangeCipherSpec;var G=h.handleAlert,L=h.handleHandshake,K=h.handleApplicationData,J=h.handleHeartbeat,M=[];M[h.ConnectionEnd.client]=[[b,G,L,b,J],[b,G,L,b,J],[b,G,L,b,J],[b,G,L,b,J],[b,G,L,b,J],[c,G,b,b,J],[b,G,L,b,J],[b,G,L,K,J],[b,G,L,b,J]];M[h.ConnectionEnd.server]=[[b,G,L,b,J],[b,G,L,b,J],[b,G,L,b,J],[b,G,L,b,J],[c,G,b,b,J],[b,G,L,b,J],[b,G,L,K,J],[b,G,L,b,J]];c=h.handleHelloRequest;G=h.handleCertificate;L=h.handleServerKeyExchange;K=h.handleCertificateRequest;J=h.handleServerHelloDone;
var w=h.handleFinished,y=[];y[h.ConnectionEnd.client]=[[b,b,h.handleServerHello,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,G,L,K,J,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,L,K,J,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,b,K,J,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,b,b,J,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,w],[c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]];y[h.ConnectionEnd.server]=[[b,h.handleClientHello,
b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,G,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,h.handleClientKeyExchange,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,h.handleCertificateVerify,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,w],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]];h.generateKeys=function(a,b){var c=b.client_random+b.server_random;a.session.resuming||(b.master_secret=f(b.pre_master_secret,
"master secret",c,48).bytes(),b.pre_master_secret=null);c=b.server_random+b.client_random;var d=2*b.mac_key_length+2*b.enc_key_length;(a=a.version.major===h.Versions.TLS_1_0.major&&a.version.minor===h.Versions.TLS_1_0.minor)&&(d+=2*b.fixed_iv_length);c=f(b.master_secret,"key expansion",c,d);d={client_write_MAC_key:c.getBytes(b.mac_key_length),server_write_MAC_key:c.getBytes(b.mac_key_length),client_write_key:c.getBytes(b.enc_key_length),server_write_key:c.getBytes(b.enc_key_length)};return a&&(d.client_write_IV=
c.getBytes(b.fixed_iv_length),d.server_write_IV=c.getBytes(b.fixed_iv_length)),d};h.createConnectionState=function(a){var b=a.entity===h.ConnectionEnd.client,c=function(){var a={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(a){return!0},compressionState:null,compressFunction:function(a){return!0},updateSequenceNumber:function(){4294967295===a.sequenceNumber[1]?(a.sequenceNumber[1]=0,++a.sequenceNumber[0]):++a.sequenceNumber[1]}};return a},d=
{read:c(),write:c()};if(d.read.update=function(a,b){return d.read.cipherFunction(b,d.read)?d.read.compressFunction(a,b,d.read)||a.error(a,{message:"Could not decompress record.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.decompression_failure}}):a.error(a,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.bad_record_mac}}),!a.fail},d.write.update=function(a,b){return d.write.compressFunction(a,b,d.write)?
d.write.cipherFunction(b,d.write)||a.error(a,{message:"Could not encrypt record.",send:!1,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}}):a.error(a,{message:"Could not compress record.",send:!1,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}}),!a.fail},a.session)switch(c=a.session.sp,a.session.cipherSuite.initSecurityParameters(c),c.keys=h.generateKeys(a,c),d.read.macKey=b?c.keys.server_write_MAC_key:c.keys.client_write_MAC_key,d.write.macKey=
b?c.keys.client_write_MAC_key:c.keys.server_write_MAC_key,a.session.cipherSuite.initConnectionState(d,a,c),c.compression_algorithm){case h.CompressionMethod.none:break;case h.CompressionMethod.deflate:d.read.compressFunction=l;d.write.compressFunction=k;break;default:throw Error("Unsupported compression algorithm.");}return d};h.createRandom=function(){var a=new Date;a=+a+6E4*a.getTimezoneOffset();var b=d.util.createBuffer();return b.putInt32(a),b.putBytes(d.random.getBytes(28)),b};h.createRecord=
function(a,b){return b.data?{type:b.type,version:{major:a.version.major,minor:a.version.minor},length:b.data.length(),fragment:b.data}:null};h.createAlert=function(a,b){var c=d.util.createBuffer();return c.putByte(b.level),c.putByte(b.description),h.createRecord(a,{type:h.ContentType.alert,data:c})};h.createClientHello=function(a){a.session.clientHelloVersion={major:a.version.major,minor:a.version.minor};for(var b=d.util.createBuffer(),c=0;c<a.cipherSuites.length;++c){var g=a.cipherSuites[c];b.putByte(g.id[0]);
b.putByte(g.id[1])}var f=b.length();c=d.util.createBuffer();c.putByte(h.CompressionMethod.none);var m=c.length();g=d.util.createBuffer();if(a.virtualHost){var k=d.util.createBuffer();k.putByte(0);k.putByte(0);var l=d.util.createBuffer();l.putByte(0);e(l,2,d.util.createBuffer(a.virtualHost));var n=d.util.createBuffer();e(n,2,l);e(k,2,n);g.putBuffer(k)}k=g.length();0<k&&(k+=2);l=a.session.id;f=l.length+1+2+4+28+2+f+1+m+k;m=d.util.createBuffer();return m.putByte(h.HandshakeType.client_hello),m.putInt24(f),
m.putByte(a.version.major),m.putByte(a.version.minor),m.putBytes(a.session.sp.client_random),e(m,1,d.util.createBuffer(l)),e(m,2,b),e(m,1,c),0<k&&e(m,2,g),m};h.createServerHello=function(a){var b=a.session.id,c=b.length+1+2+4+28+2+1,g=d.util.createBuffer();return g.putByte(h.HandshakeType.server_hello),g.putInt24(c),g.putByte(a.version.major),g.putByte(a.version.minor),g.putBytes(a.session.sp.server_random),e(g,1,d.util.createBuffer(b)),g.putByte(a.session.cipherSuite.id[0]),g.putByte(a.session.cipherSuite.id[1]),
g.putByte(a.session.compressionMethod),g};h.createCertificate=function(a){var b,c=a.entity===h.ConnectionEnd.client,g=null;a.getCertificate&&(b=c?a.session.certificateRequest:a.session.extensions.server_name.serverNameList,g=a.getCertificate(a,b));b=d.util.createBuffer();if(null!==g)try{d.util.isArray(g)||(g=[g]);for(var f=null,m=0;m<g.length;++m){var k=d.pem.decode(g[m])[0];if("CERTIFICATE"!==k.type&&"X509 CERTIFICATE"!==k.type&&"TRUSTED CERTIFICATE"!==k.type){var l=Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');
throw l.headerType=k.type,l;}if(k.procType&&"ENCRYPTED"===k.procType.type)throw Error("Could not convert certificate from PEM; PEM is encrypted.");var n=d.util.createBuffer(k.body);null===f&&(f=d.asn1.fromDer(n.bytes(),!1));var p=d.util.createBuffer();e(p,3,n);b.putBuffer(p)}g=d.pki.certificateFromAsn1(f);c?a.session.clientCertificate=g:a.session.serverCertificate=g}catch(X){return a.error(a,{message:"Could not send certificate list.",cause:X,send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.bad_certificate}})}a=
3+b.length();c=d.util.createBuffer();return c.putByte(h.HandshakeType.certificate),c.putInt24(a),e(c,3,b),c};h.createClientKeyExchange=function(a){var b=d.util.createBuffer();b.putByte(a.session.clientHelloVersion.major);b.putByte(a.session.clientHelloVersion.minor);b.putBytes(d.random.getBytes(46));var c=a.session.sp;c.pre_master_secret=b.getBytes();a=(b=a.session.serverCertificate.publicKey.encrypt(c.pre_master_secret)).length+2;c=d.util.createBuffer();return c.putByte(h.HandshakeType.client_key_exchange),
c.putInt24(a),c.putInt16(b.length),c.putBytes(b),c};h.createServerKeyExchange=function(a){return d.util.createBuffer()};h.getClientSignature=function(a,b){var c=d.util.createBuffer();c.putBuffer(a.session.md5.digest());c.putBuffer(a.session.sha1.digest());c=c.getBytes();a.getSignature=a.getSignature||function(a,b,c){var e=null;if(a.getPrivateKey)try{e=a.getPrivateKey(a,a.session.clientCertificate),e=d.pki.privateKeyFromPem(e)}catch(S){a.error(a,{message:"Could not get private key.",cause:S,send:!0,
alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}})}null===e?a.error(a,{message:"No private key set.",send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.internal_error}}):b=e.sign(b,null);c(a,b)};a.getSignature(a,c,b)};h.createCertificateVerify=function(a,b){a=b.length+2;var c=d.util.createBuffer();return c.putByte(h.HandshakeType.certificate_verify),c.putInt24(a),c.putInt16(b.length),c.putBytes(b),c};h.createCertificateRequest=function(a){var b=
d.util.createBuffer();b.putByte(1);var c=d.util.createBuffer();for(f in a.caStore.certs){var g=d.pki.distinguishedNameToAsn1(a.caStore.certs[f].subject);g=d.asn1.toDer(g);c.putInt16(g.length());c.putBuffer(g)}a=1+b.length()+2+c.length();var f=d.util.createBuffer();return f.putByte(h.HandshakeType.certificate_request),f.putInt24(a),e(f,1,b),e(f,2,c),f};h.createServerHelloDone=function(a){a=d.util.createBuffer();return a.putByte(h.HandshakeType.server_hello_done),a.putInt24(0),a};h.createChangeCipherSpec=
function(){var a=d.util.createBuffer();return a.putByte(1),a};h.createFinished=function(a){var b=d.util.createBuffer();b.putBuffer(a.session.md5.digest());b.putBuffer(a.session.sha1.digest());b=f(a.session.sp.master_secret,a.entity===h.ConnectionEnd.client?"client finished":"server finished",b.getBytes(),12);a=d.util.createBuffer();return a.putByte(h.HandshakeType.finished),a.putInt24(b.length()),a.putBuffer(b),a};h.createHeartbeat=function(a,b,c){void 0===c&&(c=b.length);var e=d.util.createBuffer();
e.putByte(a);e.putInt16(c);e.putBytes(b);a=e.length();return e.putBytes(d.random.getBytes(Math.max(16,a-c-3))),e};h.queue=function(a,b){if(b&&(0!==b.fragment.length()||b.type!==h.ContentType.handshake&&b.type!==h.ContentType.alert&&b.type!==h.ContentType.change_cipher_spec)){if(b.type===h.ContentType.handshake){var c=b.fragment.bytes();a.session.md5.update(c);a.session.sha1.update(c)}if(b.fragment.length()<=h.MaxFragment)c=[b];else{c=[];for(var e=b.fragment.bytes();e.length>h.MaxFragment;)c.push(h.createRecord(a,
{type:b.type,data:d.util.createBuffer(e.slice(0,h.MaxFragment))})),e=e.slice(h.MaxFragment);0<e.length&&c.push(h.createRecord(a,{type:b.type,data:d.util.createBuffer(e)}))}for(b=0;b<c.length&&!a.fail;++b)e=c[b],a.state.current.write.update(a,e)&&a.records.push(e)}};h.flush=function(a){for(var b=0;b<a.records.length;++b){var c=a.records[b];a.tlsData.putByte(c.type);a.tlsData.putByte(c.version.major);a.tlsData.putByte(c.version.minor);a.tlsData.putInt16(c.fragment.length());a.tlsData.putBuffer(a.records[b].fragment)}return a.records=
[],a.tlsDataReady(a)};var F=function(a){switch(a){case !0:return!0;case d.pki.certificateError.bad_certificate:return h.Alert.Description.bad_certificate;case d.pki.certificateError.unsupported_certificate:return h.Alert.Description.unsupported_certificate;case d.pki.certificateError.certificate_revoked:return h.Alert.Description.certificate_revoked;case d.pki.certificateError.certificate_expired:return h.Alert.Description.certificate_expired;case d.pki.certificateError.certificate_unknown:return h.Alert.Description.certificate_unknown;
case d.pki.certificateError.unknown_ca:return h.Alert.Description.unknown_ca;default:return h.Alert.Description.bad_certificate}},P;for(P in h.verifyCertificateChain=function(a,b){try{var c={},e;for(e in a.verifyOptions)c[e]=a.verifyOptions[e];c.verify=function(b,c,e){F(b);c=a.verify(a,b,c,e);if(!0!==c){if("object"==typeof c&&!d.util.isArray(c))throw b=Error("The application rejected the certificate."),b.send=!0,b.alert={level:h.Alert.Level.fatal,description:h.Alert.Description.bad_certificate},c.message&&
(b.message=c.message),c.alert&&(b.alert.description=c.alert),b;c!==b&&(c=function(a){switch(a){case !0:return!0;case h.Alert.Description.bad_certificate:return d.pki.certificateError.bad_certificate;case h.Alert.Description.unsupported_certificate:return d.pki.certificateError.unsupported_certificate;case h.Alert.Description.certificate_revoked:return d.pki.certificateError.certificate_revoked;case h.Alert.Description.certificate_expired:return d.pki.certificateError.certificate_expired;case h.Alert.Description.certificate_unknown:return d.pki.certificateError.certificate_unknown;
case h.Alert.Description.unknown_ca:return d.pki.certificateError.unknown_ca;default:return d.pki.certificateError.bad_certificate}}(c))}return c};d.pki.verifyCertificateChain(a.caStore,b,c)}catch(H){b=H,("object"!=typeof b||d.util.isArray(b))&&(b={send:!0,alert:{level:h.Alert.Level.fatal,description:F(H)}}),"send"in b||(b.send=!0),"alert"in b||(b.alert={level:h.Alert.Level.fatal,description:F(b.error)}),a.error(a,b)}return!a.fail},h.createSessionCache=function(a,b){var c=null;if(a&&a.getSession&&
a.setSession&&a.order)c=a;else{for(var e in(c={}).cache=a||{},c.capacity=Math.max(b||100,1),c.order=[],a)c.order.length<=b?c.order.push(e):delete a[e];c.getSession=function(a){var b=null,e=null;if(a?e=d.util.bytesToHex(a):0<c.order.length&&(e=c.order[0]),null!==e&&e in c.cache)for(var g in b=c.cache[e],delete c.cache[e],c.order)if(c.order[g]===e){c.order.splice(g,1);break}return b};c.setSession=function(a,b){if(c.order.length===c.capacity){var e=c.order.shift();delete c.cache[e]}e=d.util.bytesToHex(a);
c.order.push(e);c.cache[e]=b}}return c},h.createConnection=function(a){var b=null;b=a.caStore?d.util.isArray(a.caStore)?d.pki.createCaStore(a.caStore):a.caStore:d.pki.createCaStore();var c=a.cipherSuites||null;if(null===c)for(var e in c=[],h.CipherSuites)c.push(h.CipherSuites[e]);e=a.server?h.ConnectionEnd.server:h.ConnectionEnd.client;var g=a.sessionCache?h.createSessionCache(a.sessionCache):null,f={version:{major:h.Version.major,minor:h.Version.minor},entity:e,sessionId:a.sessionId,caStore:b,sessionCache:g,
cipherSuites:c,connected:a.connected,virtualHost:a.virtualHost||null,verifyClient:a.verifyClient||!1,verify:a.verify||function(a,b,c,d){return b},verifyOptions:a.verifyOptions||{},getCertificate:a.getCertificate||null,getPrivateKey:a.getPrivateKey||null,getSignature:a.getSignature||null,input:d.util.createBuffer(),tlsData:d.util.createBuffer(),data:d.util.createBuffer(),tlsDataReady:a.tlsDataReady,dataReady:a.dataReady,heartbeatReceived:a.heartbeatReceived,closed:a.closed,error:function(b,c){c.origin=
c.origin||(b.entity===h.ConnectionEnd.client?"client":"server");c.send&&(h.queue(b,h.createAlert(b,c.alert)),h.flush(b));var d=!1!==c.fatal;d&&(b.fail=!0);a.error(b,c);d&&b.close(!1)},deflate:a.deflate||null,inflate:a.inflate||null,reset:function(a){f.version={major:h.Version.major,minor:h.Version.minor};f.record=null;f.session=null;f.peerCertificate=null;f.state={pending:null,current:null};f.expect=(f.entity,h.ConnectionEnd.client,0);f.fragmented=null;f.records=[];f.open=!1;f.handshakes=0;f.handshaking=
!1;f.isConnected=!1;f.fail=!(a||void 0===a);f.input.clear();f.tlsData.clear();f.data.clear();f.state.current=h.createConnectionState(f)}};f.reset();return f.handshake=function(a){if(f.entity!==h.ConnectionEnd.client)f.error(f,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(f.handshaking)f.error(f,{message:"Handshake already in progress.",fatal:!1});else{f.fail&&!f.open&&0===f.handshakes&&(f.fail=!1);f.handshaking=!0;var b=null;0<(a=a||"").length&&(f.sessionCache&&(b=f.sessionCache.getSession(a)),
null===b&&(a=""));0===a.length&&f.sessionCache&&null!==(b=f.sessionCache.getSession())&&(a=b.id);f.session={id:a,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:d.md.md5.create(),sha1:d.md.sha1.create()};b&&(f.version=b.version,f.session.sp=b.sp);f.session.sp.client_random=h.createRandom().getBytes();f.open=!0;h.queue(f,h.createRecord(f,{type:h.ContentType.handshake,data:h.createClientHello(f)}));h.flush(f)}},f.process=
function(a){var b=0;return a&&f.input.putBytes(a),f.fail||(null!==f.record&&f.record.ready&&f.record.fragment.isEmpty()&&(f.record=null),null===f.record&&(b=function(a){var b=0,c=a.input,e=c.length();5>e?b=5-e:(a.record={type:c.getByte(),version:{major:c.getByte(),minor:c.getByte()},length:c.getInt16(),fragment:d.util.createBuffer(),ready:!1},(c=a.record.version.major===a.version.major)&&a.session&&a.session.version&&(c=a.record.version.minor===a.version.minor),c||a.error(a,{message:"Incompatible TLS version.",
send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.protocol_version}}));return b}(f)),f.fail||null===f.record||f.record.ready||(b=function(a){var b=0,c=a.input,d=c.length();d<a.record.length?b=a.record.length-d:(a.record.fragment.putBytes(c.getBytes(a.record.length)),c.compact(),a.state.current.read.update(a,a.record)&&(null!==a.fragmented&&(a.fragmented.type===a.record.type?(a.fragmented.fragment.putBuffer(a.record.fragment),a.record=a.fragmented):a.error(a,{message:"Invalid fragmented record.",
send:!0,alert:{level:h.Alert.Level.fatal,description:h.Alert.Description.unexpected_message}})),a.record.ready=!0));return b}(f)),!f.fail&&null!==f.record&&f.record.ready&&function(a,b){var c=b.type-h.ContentType.change_cipher_spec,d=M[a.entity][a.expect];c in d?d[c](a,b):h.handleUnexpected(a,b)}(f,f.record)),b},f.prepare=function(a){return h.queue(f,h.createRecord(f,{type:h.ContentType.application_data,data:d.util.createBuffer(a)})),h.flush(f)},f.prepareHeartbeatRequest=function(a,b){return a instanceof
d.util.ByteBuffer&&(a=a.bytes()),void 0===b&&(b=a.length),f.expectedHeartbeatPayload=a,h.queue(f,h.createRecord(f,{type:h.ContentType.heartbeat,data:h.createHeartbeat(h.HeartbeatMessageType.heartbeat_request,a,b)})),h.flush(f)},f.close=function(a){if(!f.fail&&f.sessionCache&&f.session){var b={id:f.session.id,version:f.session.version,sp:f.session.sp};b.sp.keys=null;f.sessionCache.setSession(b.id,b)}f.open&&(f.open=!1,f.input.clear(),(f.isConnected||f.handshaking)&&(f.isConnected=f.handshaking=!1,
h.queue(f,h.createAlert(f,{level:h.Alert.Level.warning,description:h.Alert.Description.close_notify})),h.flush(f)),f.closed(f));f.reset(a)},f},a.exports=d.tls=d.tls||{},h)"function"!=typeof h[P]&&(d.tls[P]=h[P]);d.tls.prf_tls1=f;d.tls.hmac_sha1=function(a,b,c){var e=d.hmac.create();e.start("SHA1",a);a=d.util.createBuffer();return a.putInt32(b[0]),a.putInt32(b[1]),a.putByte(c.type),a.putByte(c.version.major),a.putByte(c.version.minor),a.putInt16(c.length),a.putBytes(c.fragment.bytes()),e.update(a.getBytes()),
e.digest().getBytes()};d.tls.createSessionCache=h.createSessionCache;d.tls.createConnection=h.createConnection},function(a,b,c){var d=c(0);c(3);c(6);c(22);c(7);c(15);c(28);c(18);c(11);c(1);c(17);var f=d.asn1,k=a.exports=d.pki=d.pki||{};k.pemToDer=function(a){a=d.pem.decode(a)[0];if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert PEM to DER; PEM is encrypted.");return d.util.createBuffer(a.body)};k.privateKeyFromPem=function(a){a=d.pem.decode(a)[0];if("PRIVATE KEY"!==a.type&&
"RSA PRIVATE KEY"!==a.type){var b=Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw b.headerType=a.type,b;}if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert private key from PEM; PEM is encrypted.");a=f.fromDer(a.body);return k.privateKeyFromAsn1(a)};k.privateKeyToPem=function(a,b){a={type:"RSA PRIVATE KEY",body:f.toDer(k.privateKeyToAsn1(a)).getBytes()};return d.pem.encode(a,{maxline:b})};k.privateKeyInfoToPem=
function(a,b){a={type:"PRIVATE KEY",body:f.toDer(a).getBytes()};return d.pem.encode(a,{maxline:b})}},function(a,b,c){function d(a,b){return a.start().update(b).digest().getBytes()}function f(a){var b;if(a){if(!(b=h.oids[e.derToOid(a)]))throw b=Error("Unsupported PRF OID."),b.oid=a,b.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],b;}else b="hmacWithSHA1";return k(b)}function k(a){var b=l.md;switch(a){case "hmacWithSHA224":b=l.md.sha512;case "hmacWithSHA1":case "hmacWithSHA256":case "hmacWithSHA384":case "hmacWithSHA512":a=
a.substr(8).toLowerCase();break;default:throw b=Error("Unsupported PRF algorithm."),b.algorithm=a,b.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],b;}if(!(b&&a in b))throw Error("Unknown hash algorithm: "+a);return b[a].create()}var l=c(0);if(c(5),c(3),c(10),c(4),c(6),c(15),c(7),c(2),c(25),c(11),c(1),void 0===m)var m=l.jsbn.BigInteger;var e=l.asn1,h=l.pki=l.pki||{};a.exports=h.pbe=l.pbe=l.pbe||{};var n=h.oids,g={name:"EncryptedPrivateKeyInfo",tagClass:e.Class.UNIVERSAL,
type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,
constructed:!1,capture:"encryptedData"}]},p={name:"PBES2Algorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",
tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",
tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},q={name:"pkcs-12PbeParams",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,
constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"iterations"}]};h.encryptPrivateKeyInfo=function(a,b,c){(c=c||{}).saltSize=c.saltSize||8;c.count=c.count||2048;c.algorithm=c.algorithm||"aes128";c.prfAlgorithm=c.prfAlgorithm||"sha1";var d;var g=l.random.getBytesSync(c.saltSize);var f=c.count,m=e.integerToDer(f);
if(0===c.algorithm.indexOf("aes")||"des"===c.algorithm){switch(c.algorithm){case "aes128":var p=d=16;var q=n["aes128-CBC"];var v=l.aes.createEncryptionCipher;break;case "aes192":d=24;p=16;q=n["aes192-CBC"];v=l.aes.createEncryptionCipher;break;case "aes256":d=32;p=16;q=n["aes256-CBC"];v=l.aes.createEncryptionCipher;break;case "des":p=d=8;q=n.desCBC;v=l.des.createEncryptionCipher;break;default:throw(q=Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=c.algorithm,q;}c="hmacWith"+
c.prfAlgorithm.toUpperCase();var r=k(c);r=l.pkcs5.pbkdf2(b,g,f,d,r);b=l.random.getBytesSync(p);(f=v(r)).start(b);f.update(e.toDer(a));f.finish();a=f.output.getBytes();g=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,g),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,m.getBytes())]);"hmacWithSHA1"!==c&&g.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,l.util.hexToBytes(d.toString(16))),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,
e.Type.OID,!1,e.oidToDer(h.oids[c]).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));g=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n.pkcs5PBES2).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n.pkcs5PBKDF2).getBytes()),g]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(q).getBytes()),
e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,b)])])])}else{if("3des"!==c.algorithm)throw(q=Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=c.algorithm,q;d=24;q=new l.util.ByteBuffer(g);r=h.pbe.generatePkcs12Key(b,q,1,f,d);b=h.pbe.generatePkcs12Key(b,q,2,f,d);(f=l.des.createEncryptionCipher(r)).start(b);f.update(e.toDer(a));f.finish();a=f.output.getBytes();g=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(n["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),
e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,g),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,m.getBytes())])])}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[g,e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,a)])};h.decryptPrivateKeyInfo=function(a,b){var c=null,d={},f=[];if(!e.validate(a,g,d,f))throw c=Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo."),c.errors=f,c;f=e.derToOid(d.encryptionOid);
b=h.pbe.getCipher(f,d.encryptionParams,b);d=l.util.createBuffer(d.encryptedData);return b.update(d),b.finish()&&(c=e.fromDer(b.output)),c};h.encryptedPrivateKeyToPem=function(a,b){a={type:"ENCRYPTED PRIVATE KEY",body:e.toDer(a).getBytes()};return l.pem.encode(a,{maxline:b})};h.encryptedPrivateKeyFromPem=function(a){a=l.pem.decode(a)[0];if("ENCRYPTED PRIVATE KEY"!==a.type){var b=Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw b.headerType=
a.type,b;}if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return e.fromDer(a.body)};h.encryptRsaPrivateKey=function(a,b,c){if(!(c=c||{}).legacy)return a=h.wrapRsaPrivateKey(h.privateKeyToAsn1(a)),a=h.encryptPrivateKeyInfo(a,b,c),h.encryptedPrivateKeyToPem(a);switch(c.algorithm){case "aes128":c="AES-128-CBC";var d=16;var g=l.random.getBytesSync(16);var f=l.aes.createEncryptionCipher;break;case "aes192":c="AES-192-CBC";
d=24;g=l.random.getBytesSync(16);f=l.aes.createEncryptionCipher;break;case "aes256":c="AES-256-CBC";d=32;g=l.random.getBytesSync(16);f=l.aes.createEncryptionCipher;break;case "3des":c="DES-EDE3-CBC";d=24;g=l.random.getBytesSync(8);f=l.des.createEncryptionCipher;break;case "des":c="DES-CBC";d=8;g=l.random.getBytesSync(8);f=l.des.createEncryptionCipher;break;default:throw a=Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+c.algorithm+'".'),a.algorithm=c.algorithm,a;}b=f(l.pbe.opensslDeriveBytes(b,
g.substr(0,8),d));b.start(g);b.update(e.toDer(h.privateKeyToAsn1(a)));b.finish();a={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:c,parameters:l.util.bytesToHex(g).toUpperCase()},body:b.output.getBytes()};return l.pem.encode(a)};h.decryptRsaPrivateKey=function(a,b){var c=null;a=l.pem.decode(a)[0];if("ENCRYPTED PRIVATE KEY"!==a.type&&"PRIVATE KEY"!==a.type&&"RSA PRIVATE KEY"!==a.type)throw(f=Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=
f,f;if(a.procType&&"ENCRYPTED"===a.procType.type){switch(a.dekInfo.algorithm){case "DES-CBC":var d=8;var g=l.des.createDecryptionCipher;break;case "DES-EDE3-CBC":d=24;g=l.des.createDecryptionCipher;break;case "AES-128-CBC":d=16;g=l.aes.createDecryptionCipher;break;case "AES-192-CBC":d=24;g=l.aes.createDecryptionCipher;break;case "AES-256-CBC":d=32;g=l.aes.createDecryptionCipher;break;case "RC2-40-CBC":d=5;g=function(a){return l.rc2.createDecryptionCipher(a,40)};break;case "RC2-64-CBC":d=8;g=function(a){return l.rc2.createDecryptionCipher(a,
64)};break;case "RC2-128-CBC":d=16;g=function(a){return l.rc2.createDecryptionCipher(a,128)};break;default:var f;throw(f=Error('Could not decrypt private key; unsupported encryption algorithm "'+a.dekInfo.algorithm+'".')).algorithm=a.dekInfo.algorithm,f;}f=l.util.hexToBytes(a.dekInfo.parameters);d=g(l.pbe.opensslDeriveBytes(b,f.substr(0,8),d));if(d.start(f),d.update(l.util.createBuffer(a.body)),!d.finish())return c;c=d.output.getBytes()}else c=a.body;return null!==(c="ENCRYPTED PRIVATE KEY"===a.type?
h.decryptPrivateKeyInfo(e.fromDer(c),b):e.fromDer(c))&&(c=h.privateKeyFromAsn1(c)),c};h.pbe.generatePkcs12Key=function(a,b,c,d,e,g){var h,f;if(null==g){if(!("sha1"in l.md))throw Error('"sha1" hash algorithm unavailable.');g=l.md.sha1.create()}var m=g.digestLength,k=g.blockLength,n=new l.util.ByteBuffer,p=new l.util.ByteBuffer;if(null!=a){for(f=0;f<a.length;f++)p.putInt16(a.charCodeAt(f));p.putInt16(0)}a=p.length();var q=b.length(),v=new l.util.ByteBuffer;v.fillWithByte(c,k);var r=k*Math.ceil(q/k);
c=new l.util.ByteBuffer;for(f=0;f<r;f++)c.putByte(b.at(f%q));r=k*Math.ceil(a/k);b=new l.util.ByteBuffer;for(f=0;f<r;f++)b.putByte(p.at(f%a));p=c;p.putBuffer(b);b=Math.ceil(e/m);for(c=1;c<=b;c++){r=new l.util.ByteBuffer;r.putBytes(v.bytes());r.putBytes(p.bytes());for(f=0;f<d;f++)g.start(),g.update(r.getBytes()),r=g.digest();var u=new l.util.ByteBuffer;for(f=0;f<k;f++)u.putByte(r.at(f%m));var A=Math.ceil(q/k)+Math.ceil(a/k),x=new l.util.ByteBuffer;for(h=0;h<A;h++){var B=new l.util.ByteBuffer(p.getBytes(k)),
Q=511;for(f=u.length()-1;0<=f;f--)Q>>=8,Q+=u.at(f)+B.at(f),B.setAt(f,255&Q);x.putBuffer(B)}p=x;n.putBuffer(r)}return n.truncate(n.length()-e),n};h.pbe.getCipher=function(a,b,c){switch(a){case h.oids.pkcs5PBES2:return h.pbe.getCipherForPBES2(a,b,c);case h.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case h.oids["pbewithSHAAnd40BitRC2-CBC"]:return h.pbe.getCipherForPKCS12PBE(a,b,c);default:throw b=Error("Cannot read encrypted PBE data block. Unsupported OID."),b.oid=a,b.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC",
"pbewithSHAAnd40BitRC2-CBC"],b;}};h.pbe.getCipherForPBES2=function(a,b,c){var d,g={};a=[];if(!e.validate(b,p,g,a))throw(d=Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,d;if((a=e.derToOid(g.kdfOid))!==h.oids.pkcs5PBKDF2)throw(d=Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=a,d.supportedOids=["pkcs5PBKDF2"],d;if((a=e.derToOid(g.encOid))!==h.oids["aes128-CBC"]&&a!==h.oids["aes192-CBC"]&&
a!==h.oids["aes256-CBC"]&&a!==h.oids["des-EDE3-CBC"]&&a!==h.oids.desCBC)throw(d=Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=a,d.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],d;b=g.kdfSalt;d=l.util.createBuffer(g.kdfIterationCount);switch(d=d.getInt(d.length()<<3),h.oids[a]){case "aes128-CBC":var k=16;var m=l.aes.createDecryptionCipher;break;case "aes192-CBC":k=24;m=l.aes.createDecryptionCipher;break;case "aes256-CBC":k=32;m=
l.aes.createDecryptionCipher;break;case "des-EDE3-CBC":k=24;m=l.des.createDecryptionCipher;break;case "desCBC":k=8,m=l.des.createDecryptionCipher}a=f(g.prfOid);c=l.pkcs5.pbkdf2(c,b,d,k,a);g=g.encIv;m=m(c);return m.start(g),m};h.pbe.getCipherForPKCS12PBE=function(a,b,c){var d={},g=[];if(!e.validate(b,q,d,g))throw(m=Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=g,m;b=l.util.createBuffer(d.salt);g=l.util.createBuffer(d.iterations);
switch(g=g.getInt(g.length()<<3),a){case h.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:var k=24;a=8;m=l.des.startDecrypting;break;case h.oids["pbewithSHAAnd40BitRC2-CBC"]:k=5;a=8;m=function(a,b){a=l.rc2.createDecryptionCipher(a,40);return a.start(b,null),a};break;default:var m;throw(m=Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=a,m;}d=f(d.prfOid);k=h.pbe.generatePkcs12Key(c,b,1,g,k,d);return d.start(),m(k,h.pbe.generatePkcs12Key(c,b,2,g,a,d))};h.pbe.opensslDeriveBytes=function(a,
b,c,e){if(null==e){if(!("md5"in l.md))throw Error('"md5" hash algorithm unavailable.');e=l.md.md5.create()}null===b&&(b="");for(var g=[d(e,a+b)],h=16,f=1;h<c;++f,h+=16)g.push(d(e,g[f-1]+a+b));return g.join("").substr(0,c)}},function(a,b,c){function d(a,b,c){for(var d,e,h,f,k,l,n,x,B,I,D,E,C=c.length();64<=C;){for(f=0;16>f;++f)b[f]=c.getInt32();for(;64>f;++f)d=((d=b[f-2])>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,e=((e=b[f-15])>>>7|e<<25)^(e>>>18|e<<14)^e>>>3,b[f]=d+b[f-7]+e+b[f-16]|0;k=a.h0;l=a.h1;n=a.h2;
x=a.h3;B=a.h4;I=a.h5;D=a.h6;E=a.h7;for(f=0;64>f;++f)e=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),h=k&l|n&(k^l),d=E+((B>>>6|B<<26)^(B>>>11|B<<21)^(B>>>25|B<<7))+(D^B&(I^D))+m[f]+b[f],E=D,D=I,I=B,B=x+d>>>0,x=n,n=l,l=k,k=d+(e+=h)>>>0;a.h0=a.h0+k|0;a.h1=a.h1+l|0;a.h2=a.h2+n|0;a.h3=a.h3+x|0;a.h4=a.h4+B|0;a.h5=a.h5+I|0;a.h6=a.h6+D|0;a.h7=a.h7+E|0;C-=64}}var f=c(0);c(4);c(1);a=a.exports=f.sha256=f.sha256||{};f.md.sha256=f.md.algorithms.sha256=a;a.create=function(){l||(k=String.fromCharCode(128),k+=f.util.fillString(String.fromCharCode(0),
64),m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,
4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],l=!0);var a=null,b=f.util.createBuffer(),c=Array(64),g={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){g.messageLength=0;g.fullMessageLength=g.messageLength64=[];for(var c=g.messageLengthSize/4,d=0;d<c;++d)g.fullMessageLength.push(0);
return b=f.util.createBuffer(),a={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},g}};return g.start(),g.update=function(e,h){"utf8"===h&&(e=f.util.encodeUtf8(e));h=e.length;g.messageLength+=h;h=[h/4294967296>>>0,h>>>0];for(var k=g.fullMessageLength.length-1;0<=k;--k)g.fullMessageLength[k]+=h[1],h[1]=h[0]+(g.fullMessageLength[k]/4294967296>>>0),g.fullMessageLength[k]>>>=0,h[0]=h[1]/4294967296>>>0;return b.putBytes(e),d(a,c,b),(2048<b.read||
0===b.length())&&b.compact(),g},g.digest=function(){var e=f.util.createBuffer();e.putBytes(b.bytes());var h;e.putBytes(k.substr(0,g.blockLength-(g.fullMessageLength[g.fullMessageLength.length-1]+g.messageLengthSize&g.blockLength-1)));for(var m=8*g.fullMessageLength[0],l=0;l<g.fullMessageLength.length-1;++l)m+=(h=8*g.fullMessageLength[l+1])/4294967296>>>0,e.putInt32(m>>>0),m=h>>>0;e.putInt32(m);h={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3,h4:a.h4,h5:a.h5,h6:a.h6,h7:a.h7};d(h,c,e);e=f.util.createBuffer();return e.putInt32(h.h0),
e.putInt32(h.h1),e.putInt32(h.h2),e.putInt32(h.h3),e.putInt32(h.h4),e.putInt32(h.h5),e.putInt32(h.h6),e.putInt32(h.h7),e},g};var k=null,l=!1,m=null},function(a,b,c){var d=c(0);c(1);var f=null;!d.util.isNodejs||d.options.usePureJavaScript||process.versions["node-webkit"]||(f=c(16));(a.exports=d.prng=d.prng||{}).create=function(a){function b(){e.reseeds=4294967295===e.reseeds?0:e.reseeds+1;var a=e.plugin.md.create();a.update(e.keyBytes);for(var b=1,c=0;32>c;++c)0==e.reseeds%b&&(a.update(e.pools[c].digest().getBytes()),
e.pools[c].start()),b<<=1;e.keyBytes=a.digest().getBytes();a.start();a.update(e.keyBytes);a=a.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes);e.seed=e.plugin.formatSeed(a);e.generated=0}function c(a){var b=null,c=d.util.globalScope,e=c.crypto||c.msCrypto;e&&e.getRandomValues&&(b=function(a){return e.getRandomValues(a)});c=d.util.createBuffer();if(b)for(;c.length()<a;){var g=Math.max(1,Math.min(a-c.length(),65536)/4),h=new Uint32Array(Math.floor(g));try{for(b(h),g=0;g<h.length;++g)c.putInt32(h[g])}catch(A){if(!("undefined"!=
typeof QuotaExceededError&&A instanceof QuotaExceededError))throw A;}}if(c.length()<a)for(b=Math.floor(65536*Math.random());c.length()<a;)for(g=16807*(65535&b),g+=(32767&(b=16807*(b>>16)))<<16,b=4294967295&(g=(2147483647&(g+=b>>15))+(g>>31)),g=0;3>g;++g)h=b>>>(g<<3),h^=Math.floor(256*Math.random()),c.putByte(255&h);return c.getBytes(a)}var e={plugin:a,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""};a=a.md;for(var h=Array(32),k=0;32>k;++k)h[k]=a.create();return e.pools=h,e.pool=0,e.generate=
function(a,c){if(!c)return e.generateSync(a);var g=e.plugin.cipher,h=e.plugin.increment,f=e.plugin.formatKey,k=e.plugin.formatSeed,m=d.util.createBuffer();e.key=null;(function I(l){if(l)return c(l);if(m.length()>=a)return c(null,m.getBytes(a));1048575<e.generated&&(e.key=null);if(null===e.key)return d.util.nextTick(function(){!function(a){if(32<=e.pools[0].messageLength)return b(),a();e.seedFile(32-e.pools[0].messageLength<<5,function(c,d){if(c)return a(c);e.collect(d);b();a()})}(I)});l=g(e.key,e.seed);
e.generated+=l.length;m.putBytes(l);e.key=f(g(e.key,h(e.seed)));e.seed=k(g(e.key,e.seed));d.util.setImmediate(I)})()},e.generateSync=function(a){var c=e.plugin.cipher,g=e.plugin.increment,h=e.plugin.formatKey,f=e.plugin.formatSeed;e.key=null;for(var k=d.util.createBuffer();k.length()<a;){1048575<e.generated&&(e.key=null);null===e.key&&(32<=e.pools[0].messageLength||e.collect(e.seedFileSync(32-e.pools[0].messageLength<<5)),b());var m=c(e.key,e.seed);e.generated+=m.length;k.putBytes(m);e.key=h(c(e.key,
g(e.seed)));e.seed=f(c(e.key,e.seed))}return k.getBytes(a)},f?(e.seedFile=function(a,b){f.randomBytes(a,function(a,c){if(a)return b(a);b(null,c.toString())})},e.seedFileSync=function(a){return f.randomBytes(a).toString()}):(e.seedFile=function(a,b){try{b(null,c(a))}catch(q){b(q)}},e.seedFileSync=c),e.collect=function(a){for(var b=a.length,c=0;c<b;++c)e.pools[e.pool].update(a.substr(c,1)),e.pool=31===e.pool?0:e.pool+1},e.collectInt=function(a,b){for(var c="",d=0;d<b;d+=8)c+=String.fromCharCode(a>>
d&255);e.collect(c)},e.registerWorker=function(a){a===self?e.seedFile=function(a,b){self.addEventListener("message",function u(a){a=a.data;a.forge&&a.forge.prng&&(self.removeEventListener("message",u),b(a.forge.prng.err,a.forge.prng.bytes))});self.postMessage({forge:{prng:{needed:a}}})}:a.addEventListener("message",function(b){b=b.data;b.forge&&b.forge.prng&&e.seedFile(b.forge.prng.needed,function(b,c){a.postMessage({forge:{prng:{err:b,bytes:c}}})})})},e}},function(a,b,c){var d=c(0);c(1);var f=[217,
120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,
77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],k=[1,2,3,5];a.exports=d.rc2=d.rc2||{};d.rc2.expandKey=function(a,b){"string"==typeof a&&(a=d.util.createBuffer(a));
b=b||128;var c=a;a=a.length();var e=b;b=Math.ceil(e/8);var g=255>>(7&e);for(e=a;128>e;e++)c.putByte(f[c.at(e-1)+c.at(e-a)&255]);c.setAt(128-b,f[c.at(128-b)&g]);for(e=127-b;0<=e;e--)c.setAt(e,f[c.at(e+1)^c.at(e+b)]);return c};var l=function(a,b,c){var e,g,h,f,m=!1,l=null,u=null,A=null,x=[];a=d.rc2.expandKey(a,b);for(h=0;64>h;h++)x.push(a.getInt16Le());c?(e=function(a){for(h=0;4>h;h++){a[h]+=x[f]+(a[(h+3)%4]&a[(h+2)%4])+(~a[(h+3)%4]&a[(h+1)%4]);var b=a[h],c=k[h];a[h]=b<<c&65535|(65535&b)>>16-c;f++}},
g=function(a){for(h=0;4>h;h++)a[h]+=x[63&a[(h+3)%4]]}):(e=function(a){for(h=3;0<=h;h--){var b=a[h],c=k[h];a[h]=(65535&b)>>c|b<<16-c&65535;a[h]-=x[f]+(a[(h+3)%4]&a[(h+2)%4])+(~a[(h+3)%4]&a[(h+1)%4]);f--}},g=function(a){for(h=3;0<=h;h--)a[h]-=x[63&a[(h+3)%4]]});var B=null;return B={start:function(a,b){a&&"string"==typeof a&&(a=d.util.createBuffer(a));m=!1;l=d.util.createBuffer();u=b||new d.util.createBuffer;A=a;B.output=u},update:function(a){for(m||l.putBuffer(a);8<=l.length();){a=[[5,e],[1,g],[6,e],
[1,g],[5,e]];var b=[];for(h=0;4>h;h++){var d=l.getInt16Le();null!==A&&(c?d^=A.getInt16Le():A.putInt16Le(d));b.push(65535&d)}f=c?0:63;for(d=0;d<a.length;d++)for(var k=0;k<a[d][0];k++)a[d][1](b);for(h=0;4>h;h++)null!==A&&(c?A.putInt16Le(b[h]):b[h]^=A.getInt16Le()),u.putInt16Le(b[h])}},finish:function(a){var b=!0;if(c)if(a)b=a(8,l,!c);else{var d=8===l.length()?8:8-l.length();l.fillWithByte(d,d)}if(b&&(m=!0,B.update()),!c&&(b=0===l.length()))a?b=a(8,u,!c):(a=u.length(),d=u.at(a-1),d>a?b=!1:u.truncate(d));
return b}}};d.rc2.startEncrypting=function(a,b,c){a=d.rc2.createEncryptionCipher(a,128);return a.start(b,c),a};d.rc2.createEncryptionCipher=function(a,b){return l(a,b,!0)};d.rc2.startDecrypting=function(a,b,c){a=d.rc2.createDecryptionCipher(a,128);return a.start(b,c),a};d.rc2.createDecryptionCipher=function(a,b){return l(a,b,!1)}},function(a,b,c){function d(a,b,c){c||(c=f.md.sha1.create());for(var d="",h=Math.ceil(b/c.digestLength),k=0;k<h;++k){var g=String.fromCharCode(k>>24&255,k>>16&255,k>>8&255,
255&k);c.start();c.update(a+g);d+=c.digest().getBytes()}return d.substring(0,b)}var f=c(0);c(1);c(2);c(9);a=a.exports=f.pkcs1=f.pkcs1||{};a.encode_rsa_oaep=function(a,b,c,e,h){var k,g,m,l;"string"==typeof c?(k=c,g=e||void 0,m=h||void 0):c&&(k=c.label||void 0,g=c.seed||void 0,m=c.md||void 0,c.mgf1&&c.mgf1.md&&(l=c.mgf1.md));m?m.start():m=f.md.sha1.create();l||(l=m);a=Math.ceil(a.n.bitLength()/8);e=a-2*m.digestLength-2;if(b.length>e)throw(r=Error("RSAES-OAEP input message length is too long.")).length=
b.length,r.maxLength=e,r;k||(k="");m.update(k,"raw");k=m.digest();c="";e-=b.length;for(h=0;h<e;h++)c+="\x00";b=k.getBytes()+c+"\u0001"+b;if(g){if(g.length!==m.digestLength){var r;throw(r=Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=g.length,r.digestLength=m.digestLength,r;}}else g=f.random.getBytes(m.digestLength);r=d(g,a-m.digestLength-1,l);r=f.util.xorBytes(b,r,b.length);m=d(r,m.digestLength,l);return"\x00"+f.util.xorBytes(g,m,g.length)+r};a.decode_rsa_oaep=
function(a,b,c,e){var h,k,g;"string"==typeof c?(h=c,k=e||void 0):c&&(h=c.label||void 0,k=c.md||void 0,c.mgf1&&c.mgf1.md&&(g=c.mgf1.md));a=Math.ceil(a.n.bitLength()/8);if(b.length!==a)throw(m=Error("RSAES-OAEP encoded message length is invalid.")).length=b.length,m.expectedLength=a,m;if(void 0===k?k=f.md.sha1.create():k.start(),g||(g=k),a<2*k.digestLength+2)throw Error("RSAES-OAEP key is too short for the hash function.");h||(h="");k.update(h,"raw");h=k.digest().getBytes();m=b.charAt(0);c=b.substring(1,
k.digestLength+1);b=b.substring(1+k.digestLength);e=d(b,k.digestLength,g);c=f.util.xorBytes(c,e,c.length);g=d(c,a-k.digestLength-1,g);g=f.util.xorBytes(b,g,b.length);b=g.substring(0,k.digestLength);var m="\x00"!==m;for(a=0;a<k.digestLength;++a)m|=h.charAt(a)!==b.charAt(a);h=1;for(k=b=k.digestLength;k<g.length;k++)a=g.charCodeAt(k),c=1&a^1,m|=a&(h?65534:0),b+=h&=c;if(m||1!==g.charCodeAt(b))throw Error("Invalid RSAES-OAEP padding.");return g.substring(b+1)}},function(a,b,c){var d=c(0);c(1);c(12);c(2);
(function(){function b(a,b,h,f){var g=c(a,b),k=function(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}(g.bitLength());"millerRabinTests"in h&&(k=h.millerRabinTests);var m=10;"maxBlockTime"in h&&(m=h.maxBlockTime);(function K(a,b,g,h,f,k,m){var l=+new Date;do{if(a.bitLength()>b&&(a=c(b,g)),a.isProbablePrime(f))return m(null,a);a.dAddOffset(e[h++%8],0)}while(0>k||+new Date-l<k);d.util.setImmediate(function(){K(a,b,g,h,f,k,m)})})(g,
a,b,0,k,m,f)}function c(a,b){b=new m(a,b);--a;return b.testBit(a)||b.bitwiseTo(m.ONE.shiftLeft(a),n,b),b.dAddOffset(31-b.mod(h).byteValue(),0),b}if(d.prime)a.exports=d.prime;else{var l=a.exports=d.prime=d.prime||{},m=d.jsbn.BigInteger,e=[6,4,2,4,2,4,6,2],h=new m(null);h.fromInt(30);var n=function(a,b){return a|b};l.generateProbablePrime=function(a,e,h){"function"==typeof e&&(h=e,e={});var g=(e=e||{}).algorithm||"PRIMEINC";"string"==typeof g&&(g={name:g});g.options=g.options||{};var f=e.prng||d.random;
e={nextBytes:function(a){for(var b=f.getBytesSync(a.length),c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}};if("PRIMEINC"===g.name)return function(a,e,g,h){return"workers"in g?function(a,e,g,h){function f(){function b(b){if(!f){0;var g=b.data;if(g.found){for(b=0;b<d.length;++b)d[b].terminate();return f=!0,h(null,new m(g.prime,16))}k.bitLength()>a&&(k=c(a,e));g=k.toString(16);b.target.postMessage({hex:g,workLoad:n});k.dAddOffset(q,0)}}l=Math.max(1,l);for(var d=[],g=0;g<l;++g)d[g]=new Worker(p);for(g=0;g<
l;++g)d[g].addEventListener("message",b);var f=!1}if("undefined"==typeof Worker)return b(a,e,g,h);var k=c(a,e),l=g.workers,n=g.workLoad||100,q=30*n/8,p=g.workerScript||"forge/prime.worker.js";if(-1===l)return d.util.estimateCores(function(a,b){a&&(b=2);l=b-1;f()});f()}(a,e,g,h):b(a,e,g,h)}(a,e,g.options,h);throw Error("Invalid prime generation algorithm: "+g.name);}}})()},function(a,b,c){function d(a,b,c,d){for(var e=[],g=0;g<a.length;g++)for(var h=0;h<a[g].safeBags.length;h++){var f=a[g].safeBags[h];
void 0!==d&&f.type!==d||(null!==b?void 0!==f.attributes[b]&&0<=f.attributes[b].indexOf(c)&&e.push(f):e.push(f))}return e}function f(a){if(a.composed||a.constructed){for(var b=m.util.createBuffer(),c=0;c<a.value.length;++c)b.putBytes(a.value[c].value);a.composed=a.constructed=!1;a.value=b.getBytes()}return a}function k(a,b,c){if(!b&&0===a.length)return[];if((a=e.fromDer(a,b)).tagClass!==e.Class.UNIVERSAL||a.type!==e.Type.SEQUENCE||!0!==a.constructed)throw Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");
for(var d=[],g=0;g<a.value.length;g++){var f={},k=[];if(!e.validate(a.value[g],q,f,k))throw(u=Error("Cannot read SafeBag.")).errors=k,u;var m={type:e.derToOid(f.bagId),attributes:l(f.bagAttributes)};d.push(m);var n=f.bagValue.value[0];switch(m.type){case h.oids.pkcs8ShroudedKeyBag:if(null===(n=h.decryptPrivateKeyInfo(n,c)))throw Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case h.oids.keyBag:try{m.key=h.privateKeyFromAsn1(n)}catch(M){m.key=null,m.asn1=n}continue;case h.oids.certBag:var p=
v;var r=function(){if(e.derToOid(f.certId)!==h.oids.x509Certificate){var a=Error("Unsupported certificate type, only X.509 supported.");throw a.oid=e.derToOid(f.certId),a;}a=e.fromDer(f.cert,b);try{m.cert=h.certificateFromAsn1(a,!0)}catch(w){m.cert=null,m.asn1=a}};break;default:var u;throw(u=Error("Unsupported PKCS#12 SafeBag type.")).oid=m.type,u;}if(void 0!==p&&!e.validate(n,p,f,k))throw(u=Error("Cannot read PKCS#12 "+p.name)).errors=k,u;r()}return d}function l(a){var b={};if(void 0!==a)for(var c=
0;c<a.length;++c){var d={},g=[];if(!e.validate(a[c],r,d,g))throw a=Error("Cannot read PKCS#12 BagAttribute."),a.errors=g,a;g=e.derToOid(d.oid);if(void 0!==h.oids[g]){b[h.oids[g]]=[];for(var f=0;f<d.values.length;++f)b[h.oids[g]].push(d.values[f].value)}}return b}var m=c(0);c(3);c(8);c(6);c(29);c(22);c(2);c(11);c(9);c(1);c(17);var e=m.asn1,h=m.pki,n=a.exports=m.pkcs12=m.pkcs12||{},g={name:"ContentInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",
tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:e.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},p={name:"PFX",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"version"},g,{name:"PFX.macData",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",
tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:e.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,
constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},q={name:"SafeBag",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:e.Class.CONTEXT_SPECIFIC,
constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},r={name:"Attribute",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:e.Class.UNIVERSAL,type:e.Type.SET,constructed:!0,capture:"values"}]},v={name:"CertBag",tagClass:e.Class.UNIVERSAL,
type:e.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:e.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:e.Class.UNIVERSAL,type:e.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};n.pkcs12FromAsn1=function(a,b,c){"string"==typeof b?(c=b,b=!0):void 0===b&&(b=!0);var l={};if(!e.validate(a,p,l,[]))throw(q=Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=
q,q;var q,v={version:l.version.charCodeAt(0),safeContents:[],getBags:function(a){var b,c={};return"localKeyId"in a?b=a.localKeyId:"localKeyIdHex"in a&&(b=m.util.hexToBytes(a.localKeyIdHex)),void 0===b&&!("friendlyName"in a)&&"bagType"in a&&(c[a.bagType]=d(v.safeContents,null,null,a.bagType)),void 0!==b&&(c.localKeyId=d(v.safeContents,"localKeyId",b,a.bagType)),"friendlyName"in a&&(c.friendlyName=d(v.safeContents,"friendlyName",a.friendlyName,a.bagType)),c},getBagsByFriendlyName:function(a,b){return d(v.safeContents,
"friendlyName",a,b)},getBagsByLocalKeyId:function(a,b){return d(v.safeContents,"localKeyId",a,b)}};if(3!==l.version.charCodeAt(0))throw(q=Error("PKCS#12 PFX of version other than 3 not supported.")).version=l.version.charCodeAt(0),q;if(e.derToOid(l.contentType)!==h.oids.data)throw(q=Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=e.derToOid(l.contentType),q;a=l.content.value[0];if(a.tagClass!==e.Class.UNIVERSAL||a.type!==e.Type.OCTETSTRING)throw Error("PKCS#12 authSafe content data is not an OCTET STRING.");
if(a=f(a),l.mac){q=null;var r=0,u=e.derToOid(l.macAlgorithm);switch(u){case h.oids.sha1:q=m.md.sha1.create();r=20;break;case h.oids.sha256:q=m.md.sha256.create();r=32;break;case h.oids.sha384:q=m.md.sha384.create();r=48;break;case h.oids.sha512:q=m.md.sha512.create();r=64;break;case h.oids.md5:q=m.md.md5.create(),r=16}if(null===q)throw Error("PKCS#12 uses unsupported MAC algorithm: "+u);u=new m.util.ByteBuffer(l.macSalt);var A="macIterations"in l?parseInt(m.util.bytesToHex(l.macIterations),16):1;
r=n.generateKey(c,u,3,A,r,q);u=m.hmac.create();if(u.start(q,r),u.update(a.value),u.getMac().getBytes()!==l.macDigest)throw Error("PKCS#12 MAC could not be verified. Invalid password?");}return function(a,b,c,d){if((b=e.fromDer(b,c)).tagClass!==e.Class.UNIVERSAL||b.type!==e.Type.SEQUENCE||!0!==b.constructed)throw Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var l=0;l<b.value.length;l++){var n={},q=[];if(!e.validate(b.value[l],g,n,q))throw(D=Error("Cannot read ContentInfo.")).errors=
q,D;q={encrypted:!1};var p=n.content.value[0];switch(e.derToOid(n.contentType)){case h.oids.data:if(p.tagClass!==e.Class.UNIVERSAL||p.type!==e.Type.OCTETSTRING)throw Error("PKCS#12 SafeContents Data is not an OCTET STRING.");n=f(p).value;break;case h.oids.encryptedData:var v=void 0,r=d;n={};var u=[];if(!e.validate(p,m.pkcs7.asn1.encryptedDataValidator,n,u))throw(v=Error("Cannot read EncryptedContentInfo.")).errors=u,v;p=e.derToOid(n.contentType);if(p!==h.oids.data)throw(v=Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=
p,v;p=e.derToOid(n.encAlgorithm);p=h.pbe.getCipher(p,n.encParameter,r);n=f(n.encryptedContentAsn1);n=m.util.createBuffer(n.value);if(p.update(n),!p.finish())throw Error("Failed to decrypt PKCS#12 SafeContents.");n=p.output.getBytes();q.encrypted=!0;break;default:var D;throw(D=Error("Unsupported PKCS#12 contentType.")).contentType=e.derToOid(n.contentType),D;}q.safeBags=k(n,c,d);a.safeContents.push(q)}}(v,a.value,b,c),v};n.toPkcs12Asn1=function(a,b,c,d){(d=d||{}).saltSize=d.saltSize||8;d.count=d.count||
2048;d.algorithm=d.algorithm||d.encAlgorithm||"aes128";"useMac"in d||(d.useMac=!0);"localKeyId"in d||(d.localKeyId=null);"generateLocalKeyId"in d||(d.generateLocalKeyId=!0);var g,f=d.localKeyId;if(null!==f)f=m.util.hexToBytes(f);else if(d.generateLocalKeyId)if(b){var k=m.util.isArray(b)?b[0]:b;"string"==typeof k&&(k=h.certificateFromPem(k));(f=m.md.sha1.create()).update(e.toDer(h.certificateToAsn1(k)).getBytes());f=f.digest().getBytes()}else f=m.random.getBytes(20);k=[];null!==f&&k.push(e.create(e.Class.UNIVERSAL,
e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.localKeyId).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,f)])]));"friendlyName"in d&&k.push(e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.friendlyName).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SET,!0,[e.create(e.Class.UNIVERSAL,e.Type.BMPSTRING,!1,d.friendlyName)])]));0<k.length&&(g=e.create(e.Class.UNIVERSAL,
e.Type.SET,!0,k));f=[];k=[];null!==b&&(k=m.util.isArray(b)?b:[b]);for(var l=[],q=0;q<k.length;++q){"string"==typeof(b=k[q])&&(b=h.certificateFromPem(b));var p=0===q?g:void 0,v=h.certificateToAsn1(b);p=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.certBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.x509Certificate).getBytes()),
e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(v).getBytes())])])]),p]);l.push(p)}0<l.length&&(b=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,l),b=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(b).getBytes())])]),f.push(b));null!==a&&(a=h.wrapRsaPrivateKey(h.privateKeyToAsn1(a)),
a=null===c?e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.keyBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[a]),g]):e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.pkcs8ShroudedKeyBag).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[h.encryptPrivateKeyInfo(a,c,d)]),g]),a=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[a]),a=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,
[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(a).getBytes())])]),f.push(a));g=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,f);if(d.useMac){f=m.md.sha1.create();var r=new m.util.ByteBuffer(m.random.getBytes(d.saltSize));d=d.count;c=(a=n.generateKey(c,r,3,d,20),m.hmac.create());c.start(f,a);c.update(e.toDer(g).getBytes());c=c.getMac();r=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,
!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.sha1).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,c.getBytes())]),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,r.getBytes()),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,e.integerToDer(d).getBytes())])}return e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,
e.Type.INTEGER,!1,e.integerToDer(3).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(h.oids.data).getBytes()),e.create(e.Class.CONTEXT_SPECIFIC,0,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,e.toDer(g).getBytes())])]),r])};n.generateKey=m.pbe.generatePkcs12Key},function(a,b,c){b=c(0);c(3);c(1);c=b.asn1;a=a.exports=b.pkcs7asn1=b.pkcs7asn1||{};b.pkcs7=b.pkcs7||{};b.pkcs7.asn1=a;b={name:"ContentInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,
constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};a.contentInfoValidator=b;var d={name:"EncryptedContentInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"contentType"},
{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:c.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",
captureAsn1:"encryptedContentAsn1"}]};a.envelopedDataValidator={name:"EnvelopedData",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:c.Class.UNIVERSAL,type:c.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(d)};a.encryptedDataValidator={name:"EncryptedData",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,
value:[{name:"EncryptedData.Version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"version"}].concat(d)};a.signedDataValidator={name:"SignedData",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:c.Class.UNIVERSAL,type:c.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},b,{name:"SignedData.Certificates",
tagClass:c.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:c.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:c.Class.UNIVERSAL,type:c.Type.SET,capture:"signerInfos",optional:!0,value:[{name:"SignerInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",
tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:c.Class.UNIVERSAL,
type:c.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:c.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",
tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:c.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]}]}]};a.recipientInfoValidator={name:"RecipientInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",
tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",
tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:c.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},function(a,b,c){var d=c(0);c(1);d.mgf=d.mgf||{};(a.exports=d.mgf.mgf1=d.mgf1=d.mgf1||{}).create=function(a){return{generate:function(b,c){for(var f=new d.util.ByteBuffer,
e=Math.ceil(c/a.digestLength),h=0;h<e;h++){var k=new d.util.ByteBuffer;k.putInt32(h);a.start();a.update(b+k.getBytes());f.putBuffer(a.digest())}return f.truncate(f.length()-c),f.getBytes()}}}},function(a,b,c){function d(a,b,c){for(var d,g,h,f,k,m,l,n,p,E,C,G,L,K,J,M,w,y,F,P,Q,U,O,N,H,R,V,S=c.length();128<=S;){for(O=0;16>O;++O)b[O][0]=c.getInt32()>>>0,b[O][1]=c.getInt32()>>>0;for(;80>O;++O)d=(((N=(R=b[O-2])[0])>>>19|(H=R[1])<<13)^(H>>>29|N<<3)^N>>>6)>>>0,g=((N<<13|H>>>19)^(H<<3|N>>>29)^(N<<26|H>>>
6))>>>0,h=(((N=(V=b[O-15])[0])>>>1|(H=V[1])<<31)^(N>>>8|H<<24)^N>>>7)>>>0,f=((N<<31|H>>>1)^(N<<24|H>>>8)^(N<<25|H>>>7))>>>0,l=b[O-7],n=b[O-16],H=g+l[1]+f+n[1],b[O][0]=d+l[0]+h+n[0]+(H/4294967296>>>0)>>>0,b[O][1]=H>>>0;l=a[0][0];n=a[0][1];p=a[1][0];E=a[1][1];C=a[2][0];G=a[2][1];L=a[3][0];K=a[3][1];J=a[4][0];M=a[4][1];w=a[5][0];y=a[5][1];F=a[6][0];P=a[6][1];Q=a[7][0];U=a[7][1];for(O=0;80>O;++O)d=((J>>>14|M<<18)^(J>>>18|M<<14)^(M>>>9|J<<23))>>>0,g=(F^J&(w^F))>>>0,h=((l>>>28|n<<4)^(n>>>2|l<<30)^(n>>>
7|l<<25))>>>0,f=((l<<4|n>>>28)^(n<<30|l>>>2)^(n<<25|l>>>7))>>>0,k=(l&p|C&(l^p))>>>0,m=(n&E|G&(n^E))>>>0,H=U+(((J<<18|M>>>14)^(J<<14|M>>>18)^(M<<23|J>>>9))>>>0)+((P^M&(y^P))>>>0)+e[O][1]+b[O][1],d=Q+d+g+e[O][0]+b[O][0]+(H/4294967296>>>0)>>>0,g=H>>>0,h=h+k+((H=f+m)/4294967296>>>0)>>>0,f=H>>>0,Q=F,U=P,F=w,P=y,w=J,y=M,J=L+d+((H=K+g)/4294967296>>>0)>>>0,M=H>>>0,L=C,K=G,C=p,G=E,p=l,E=n,l=d+h+((H=g+f)/4294967296>>>0)>>>0,n=H>>>0;H=a[0][1]+n;a[0][0]=a[0][0]+l+(H/4294967296>>>0)>>>0;a[0][1]=H>>>0;H=a[1][1]+
E;a[1][0]=a[1][0]+p+(H/4294967296>>>0)>>>0;a[1][1]=H>>>0;H=a[2][1]+G;a[2][0]=a[2][0]+C+(H/4294967296>>>0)>>>0;a[2][1]=H>>>0;H=a[3][1]+K;a[3][0]=a[3][0]+L+(H/4294967296>>>0)>>>0;a[3][1]=H>>>0;H=a[4][1]+M;a[4][0]=a[4][0]+J+(H/4294967296>>>0)>>>0;a[4][1]=H>>>0;H=a[5][1]+y;a[5][0]=a[5][0]+w+(H/4294967296>>>0)>>>0;a[5][1]=H>>>0;H=a[6][1]+P;a[6][0]=a[6][0]+F+(H/4294967296>>>0)>>>0;a[6][1]=H>>>0;H=a[7][1]+U;a[7][0]=a[7][0]+Q+(H/4294967296>>>0)>>>0;a[7][1]=H>>>0;S-=128}}var f=c(0);c(4);c(1);var k=a.exports=
f.sha512=f.sha512||{};f.md.sha512=f.md.algorithms.sha512=k;a=f.sha384=f.sha512.sha384=f.sha512.sha384||{};a.create=function(){return k.create("SHA-384")};f.md.sha384=f.md.algorithms.sha384=a;f.sha512.sha256=f.sha512.sha256||{create:function(){return k.create("SHA-512/256")}};f.md["sha512/256"]=f.md.algorithms["sha512/256"]=f.sha512.sha256;f.sha512.sha224=f.sha512.sha224||{create:function(){return k.create("SHA-512/224")}};f.md["sha512/224"]=f.md.algorithms["sha512/224"]=f.sha512.sha224;k.create=function(a){if(m||
(l=String.fromCharCode(128),l+=f.util.fillString(String.fromCharCode(0),128),e=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],
[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,
344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],
[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(h={})["SHA-512"]=[[1779033703,4089235720],[3144134277,
2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],h["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],h["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,
1401305490],[721525244,746961066],[246885852,2177182882]],h["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],m=!0),void 0===a&&(a="SHA-512"),!(a in h))throw Error("Invalid SHA-512 algorithm: "+a);for(var b=h[a],c=null,k=f.util.createBuffer(),n=Array(80),v=0;80>v;++v)n[v]=Array(2);v=64;switch(a){case "SHA-384":v=48;break;case "SHA-512/256":v=32;break;
case "SHA-512/224":v=28}var u={algorithm:a.replace("-","").toLowerCase(),blockLength:128,digestLength:v,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){u.messageLength=0;u.fullMessageLength=u.messageLength128=[];for(var a=u.messageLengthSize/4,d=0;d<a;++d)u.fullMessageLength.push(0);k=f.util.createBuffer();c=Array(b.length);for(d=0;d<b.length;++d)c[d]=b[d].slice(0);return u}};return u.start(),u.update=function(a,b){"utf8"===b&&(a=f.util.encodeUtf8(a));b=a.length;u.messageLength+=
b;b=[b/4294967296>>>0,b>>>0];for(var e=u.fullMessageLength.length-1;0<=e;--e)u.fullMessageLength[e]+=b[1],b[1]=b[0]+(u.fullMessageLength[e]/4294967296>>>0),u.fullMessageLength[e]>>>=0,b[0]=b[1]/4294967296>>>0;return k.putBytes(a),d(c,n,k),(2048<k.read||0===k.length())&&k.compact(),u},u.digest=function(){var b=f.util.createBuffer();b.putBytes(k.bytes());var e;b.putBytes(l.substr(0,u.blockLength-(u.fullMessageLength[u.fullMessageLength.length-1]+u.messageLengthSize&u.blockLength-1)));for(var g=8*u.fullMessageLength[0],
h=0;h<u.fullMessageLength.length-1;++h)g+=(e=8*u.fullMessageLength[h+1])/4294967296>>>0,b.putInt32(g>>>0),g=e>>>0;b.putInt32(g);e=Array(c.length);for(h=0;h<c.length;++h)e[h]=c[h].slice(0);d(e,n,b);g=f.util.createBuffer();b="SHA-512"===a?e.length:"SHA-384"===a?e.length-2:e.length-4;for(h=0;h<b;++h)g.putInt32(e[h][0]),h===b-1&&"SHA-512/224"===a||g.putInt32(e[h][1]);return g},u};var l=null,m=!1,e=null,h=null},function(a,b,c){a.exports=c(33)},function(a,b,c){a.exports=c(0);c(5);c(36);c(3);c(13);c(10);
c(38);c(8);c(40);c(41);c(42);c(30);c(15);c(7);c(26);c(28);c(43);c(21);c(27);c(24);c(18);c(2);c(25);c(44);c(20);c(1)},function(a,b){b=function(){return this}();try{b=b||(new Function("return this"))()}catch(c){"object"==typeof window&&(b=window)}a.exports=b},function(a,b){b={};a.exports=b;var c={};b.encode=function(a,b,c){if("string"!=typeof b)throw new TypeError('"alphabet" must be a string.');if(void 0!==c&&"number"!=typeof c)throw new TypeError('"maxline" must be a number.');var d="";if(a instanceof
Uint8Array){var f,e=b.length,h=b.charAt(0),k=[0];for(f=0;f<a.length;++f){for(var g=0,p=a[f];g<k.length;++g)p+=k[g]<<8,k[g]=p%e,p=p/e|0;for(;0<p;)k.push(p%e),p=p/e|0}for(f=0;0===a[f]&&f<a.length-1;++f)d+=h;for(f=k.length-1;0<=f;--f)d+=b[k[f]]}else{h=b.length;f=b.charAt(0);e=[0];for(d=0;d<a.length();++d){k=0;for(g=a.at(d);k<e.length;++k)g+=e[k]<<8,e[k]=g%h,g=g/h|0;for(;0<g;)e.push(g%h),g=g/h|0}h="";for(d=0;0===a.at(d)&&d<a.length()-1;++d)h+=f;for(d=e.length-1;0<=d;--d)h+=b[e[d]];d=h}c&&(d=d.match(new RegExp(".{1,"+
c+"}","g")).join("\r\n"));return d};b.decode=function(a,b){if("string"!=typeof a)throw new TypeError('"input" must be a string.');if("string"!=typeof b)throw new TypeError('"alphabet" must be a string.');var d=c[b];if(!d){d=c[b]=[];for(var f=0;f<b.length;++f)d[b.charCodeAt(f)]=f}a=a.replace(/\s/g,"");var m=b.length;b=b.charAt(0);var e=[0];for(f=0;f<a.length;f++){var h=d[a.charCodeAt(f)];if(void 0===h)return;for(var n=0;n<e.length;++n)h+=e[n]*m,e[n]=255&h,h>>=8;for(;0<h;)e.push(255&h),h>>=8}for(d=
0;a[d]===b&&d<a.length-1;++d)e.push(0);return"undefined"!=typeof Buffer?Buffer.from(e.reverse()):new Uint8Array(e.reverse())}},function(a,b,c){function d(a,b,c){b=b.entity===e.tls.ConnectionEnd.client;a.read.cipherState={init:!1,cipher:e.cipher.createDecipher("AES-CBC",b?c.keys.server_write_key:c.keys.client_write_key),iv:b?c.keys.server_write_IV:c.keys.client_write_IV};a.write.cipherState={init:!1,cipher:e.cipher.createCipher("AES-CBC",b?c.keys.client_write_key:c.keys.server_write_key),iv:b?c.keys.client_write_IV:
c.keys.server_write_IV};a.read.cipherFunction=m;a.write.cipherFunction=f;a.read.macLength=a.write.macLength=c.mac_length;a.read.macFunction=a.write.macFunction=h.hmac_sha1}function f(a,b){var c=!1;var d=b.macFunction(b.macKey,b.sequenceNumber,a);a.fragment.putBytes(d);b.updateSequenceNumber();d=a.version.minor===h.Versions.TLS_1_0.minor?b.cipherState.init?null:b.cipherState.iv:e.random.getBytesSync(16);b.cipherState.init=!0;b=b.cipherState.cipher;return b.start({iv:d}),a.version.minor>=h.Versions.TLS_1_1.minor&&
b.output.putBytes(d),b.update(a.fragment),b.finish(k)&&(a.fragment=b.output,a.length=a.fragment.length(),c=!0),c}function k(a,b,c){c||(a-=b.length()%a,b.fillWithByte(a-1,a));return!0}function l(a,b,c){a=!0;if(c){c=b.length();for(var d=b.last(),e=c-1-d;e<c-1;++e)a=a&&b.at(e)==d;a&&b.truncate(d+1)}return a}function m(a,b){var c=a.version.minor===h.Versions.TLS_1_0.minor?b.cipherState.init?null:b.cipherState.iv:a.fragment.getBytes(16);b.cipherState.init=!0;var d=b.cipherState.cipher;d.start({iv:c});
d.update(a.fragment);c=d.finish(l);var g=b.macLength,f=e.random.getBytesSync(g),k=d.output.length();k>=g?(a.fragment=d.output.getBytes(k-g),f=d.output.getBytes(g)):a.fragment=d.output.getBytes();a.fragment=e.util.createBuffer(a.fragment);a.length=a.fragment.length();a=b.macFunction(b.macKey,b.sequenceNumber,a);b.updateSequenceNumber();b=b.macKey;d=e.hmac.create();return(d.start("SHA1",b),d.update(f),f=d.digest().getBytes(),d.start(null,null),d.update(a),a=d.digest().getBytes(),f===a)&&c}var e=c(0);
c(5);c(20);var h=a.exports=e.tls;h.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(a){a.bulk_cipher_algorithm=h.BulkCipherAlgorithm.aes;a.cipher_type=h.CipherType.block;a.enc_key_length=16;a.block_length=16;a.fixed_iv_length=16;a.record_iv_length=16;a.mac_algorithm=h.MACAlgorithm.hmac_sha1;a.mac_length=20;a.mac_key_length=20},initConnectionState:d};h.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",
initSecurityParameters:function(a){a.bulk_cipher_algorithm=h.BulkCipherAlgorithm.aes;a.cipher_type=h.CipherType.block;a.enc_key_length=32;a.block_length=16;a.fixed_iv_length=16;a.record_iv_length=16;a.mac_algorithm=h.MACAlgorithm.hmac_sha1;a.mac_length=20;a.mac_key_length=20},initConnectionState:d}},function(a,b,c){b=c(0);c(30);a.exports=b.mgf=b.mgf||{};b.mgf.mgf1=b.mgf1},function(a,b,c){function d(a){var b=a.message;if(b instanceof Uint8Array||b instanceof M)return b;var c=a.encoding;if(void 0===
b){if(!a.md)throw new TypeError('"options.message" or "options.md" not specified.');b=a.md.digest().getBytes();c="binary"}if("string"==typeof b&&!c)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"==typeof b){if("undefined"!=typeof Buffer)return Buffer.from(b,c);b=new J(b,c)}else if(!(b instanceof J))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');a=new M(b.length());
for(c=0;c<a.length;++c)a[c]=b.at(c);return a}function f(a,b){var c=C.md.sha512.create();a=new J(a);c.update(a.getBytes(b),"binary");b=c.digest().getBytes();if("undefined"!=typeof Buffer)return Buffer.from(b,"binary");c=new M(w.constants.HASH_BYTE_LENGTH);for(a=0;64>a;++a)c[a]=b.charCodeAt(a);return c}function k(a,b){var c,d;for(c=63;32<=c;--c){var e=0;var g=c-32;for(d=c-12;g<d;++g)b[g]+=e-16*b[c]*N[g-(c-32)],e=b[g]+128>>8,b[g]-=256*e;b[g]+=e;b[c]=0}for(g=e=0;32>g;++g)b[g]+=e-(b[31]>>4)*N[g],e=b[g]>>
8,b[g]&=255;for(g=0;32>g;++g)b[g]-=e*N[g];for(c=0;32>c;++c)b[c+1]+=b[c]>>8,a[c]=255&b[c]}function l(a){for(var b=new Float64Array(64),c=0;64>c;++c)b[c]=a[c],a[c]=0;k(a,b)}function m(a,b){var c=x(),d=x(),e=x(),g=x(),h=x(),f=x(),k=x(),m=x(),l=x();I(c,a[1],a[0]);I(l,b[1],b[0]);E(c,c,l);B(d,a[0],a[1]);B(l,b[0],b[1]);E(d,d,l);E(e,a[3],b[3]);E(e,e,Q);E(g,a[2],b[2]);B(g,g,g);I(h,d,c);I(f,g,e);B(k,g,e);B(m,d,c);E(a[0],h,f);E(a[1],m,k);E(a[2],k,f);E(a[3],h,m)}function e(a,b){var c=x(),d=x(),e=x(),g=b[2],f,
k=x();for(f=0;16>f;++f)k[f]=g[f];for(f=253;0<=f;--f)D(k,k),2!==f&&4!==f&&E(k,k,g);for(f=0;16>f;++f)e[f]=k[f];!0;E(c,b[0],e);E(d,b[1],e);h(a,d);a[31]^=p(c)<<7}function h(a,b){var c,d=x(),e=x();for(c=0;16>c;++c)e[c]=b[c];u(e);u(e);u(e);for(b=0;2>b;++b){d[0]=e[0]-65517;for(c=1;15>c;++c)d[c]=e[c]-65535-(d[c-1]>>16&1),d[c-1]&=65535;d[15]=e[15]-32767-(d[14]>>16&1);c=d[15]>>16&1;d[14]&=65535;A(e,d,1-c)}for(c=0;16>c;c++)a[2*c]=255&e[c],a[2*c+1]=e[c]>>8}function n(a,b){var c=new M(32),d=new M(32);return h(c,
a),h(d,b),g(c,0,d,0)}function g(a,b,c,d){var e,g=0;for(e=0;32>e;++e)g|=a[b+e]^c[d+e];return(1&g-1>>>8)-1}function p(a){var b=new M(32);return h(b,a),1&b[0]}function q(a,b,c){var d,e;v(a[0],y);v(a[1],F);v(a[2],F);v(a[3],y);for(e=255;0<=e;--e){for(var g=a,h=b,f=d=c[e/8|0]>>(7&e)&1,k=0;4>k;++k)A(g[k],h[k],f);m(b,a);m(a,a);g=a;h=b;for(f=0;4>f;++f)A(g[f],h[f],d)}}function r(a,b){var c=[x(),x(),x(),x()];v(c[0],U);v(c[1],O);v(c[2],F);E(c[3],U,O);q(a,c,b)}function v(a,b){var c;for(c=0;16>c;c++)a[c]=0|b[c]}
function u(a){var b,c=1;for(b=0;16>b;++b){var d=a[b]+c+65535;c=Math.floor(d/65536);a[b]=d-65536*c}a[0]+=c-1+37*(c-1)}function A(a,b,c){for(var d=~(c-1),e=0;16>e;++e)c=d&(a[e]^b[e]),a[e]^=c,b[e]^=c}function x(a){var b,c=new Float64Array(16);if(a)for(b=0;b<a.length;++b)c[b]=a[b];return c}function B(a,b,c){for(var d=0;16>d;++d)a[d]=b[d]+c[d]}function I(a,b,c){for(var d=0;16>d;++d)a[d]=b[d]-c[d]}function D(a,b){E(a,b,b)}function E(a,b,c){var d=c[0],e=c[1],g=c[2],h=c[3],f=c[4],k=c[5],m=c[6],l=c[7],n=c[8],
q=c[9],p=c[10],v=c[11],r=c[12],u=c[13],D=c[14],I=c[15];var A=(c=b[0])*d;var x=c*g;var B=c*h;var E=c*f;var F=c*k;var C=c*m;var y=c*l;var w=c*n;var G=c*q;var L=c*p;var M=c*v;var P=c*r;var J=c*u;var K=c*D;var H=c*I;var Q=c*e+(c=b[1])*d;B+=c*g;E+=c*h;F+=c*f;C+=c*k;y+=c*m;w+=c*l;G+=c*n;L+=c*q;M+=c*p;P+=c*v;J+=c*r;K+=c*u;H+=c*D;var S=c*I;x=x+c*e+(c=b[2])*d;E+=c*g;F+=c*h;C+=c*f;y+=c*k;w+=c*m;G+=c*l;L+=c*n;M+=c*q;P+=c*p;J+=c*v;K+=c*r;H+=c*u;S+=c*D;var N=c*I;B=B+c*e+(c=b[3])*d;F+=c*g;C+=c*h;y+=c*f;w+=c*k;
G+=c*m;L+=c*l;M+=c*n;P+=c*q;J+=c*p;K+=c*v;H+=c*r;S+=c*u;N+=c*D;var V=c*I;E=E+c*e+(c=b[4])*d;C+=c*g;y+=c*h;w+=c*f;G+=c*k;L+=c*m;M+=c*l;P+=c*n;J+=c*q;K+=c*p;H+=c*v;S+=c*r;N+=c*u;V+=c*D;var R=c*I;F=F+c*e+(c=b[5])*d;y+=c*g;w+=c*h;G+=c*f;L+=c*k;M+=c*m;P+=c*l;J+=c*n;K+=c*q;H+=c*p;S+=c*v;N+=c*r;V+=c*u;R+=c*D;var U=c*I;C=C+c*e+(c=b[6])*d;w+=c*g;G+=c*h;L+=c*f;M+=c*k;P+=c*m;J+=c*l;K+=c*n;H+=c*q;S+=c*p;N+=c*v;V+=c*r;R+=c*u;U+=c*D;var O=c*I;y=y+c*e+(c=b[7])*d;G+=c*g;L+=c*h;M+=c*f;P+=c*k;J+=c*m;K+=c*l;H+=c*n;
S+=c*q;N+=c*p;V+=c*v;R+=c*r;U+=c*u;O+=c*D;var fa=c*I;w=w+c*e+(c=b[8])*d;L+=c*g;M+=c*h;P+=c*f;J+=c*k;K+=c*m;H+=c*l;S+=c*n;N+=c*q;V+=c*p;R+=c*v;U+=c*r;O+=c*u;fa+=c*D;var ia=c*I;G=G+c*e+(c=b[9])*d;M+=c*g;P+=c*h;J+=c*f;K+=c*k;H+=c*m;S+=c*l;N+=c*n;V+=c*q;R+=c*p;U+=c*v;O+=c*r;fa+=c*u;ia+=c*D;var ja=c*I;L=L+c*e+(c=b[10])*d;P+=c*g;J+=c*h;K+=c*f;H+=c*k;S+=c*m;N+=c*l;V+=c*n;R+=c*q;U+=c*p;O+=c*v;fa+=c*r;ia+=c*u;ja+=c*D;var oa=c*I;M=M+c*e+(c=b[11])*d;J+=c*g;K+=c*h;H+=c*f;S+=c*k;N+=c*m;V+=c*l;R+=c*n;U+=c*q;O+=
c*p;fa+=c*v;ia+=c*r;ja+=c*u;oa+=c*D;var ra=c*I;P=P+c*e+(c=b[12])*d;K+=c*g;H+=c*h;S+=c*f;N+=c*k;V+=c*m;R+=c*l;U+=c*n;O+=c*q;fa+=c*p;ia+=c*v;ja+=c*r;oa+=c*u;ra+=c*D;var wa=c*I;J=J+c*e+(c=b[13])*d;H+=c*g;S+=c*h;N+=c*f;V+=c*k;R+=c*m;U+=c*l;O+=c*n;fa+=c*q;ia+=c*p;ja+=c*v;oa+=c*r;ra+=c*u;wa+=c*D;var ya=c*I;K=K+c*e+(c=b[14])*d;S+=c*g;N+=c*h;V+=c*f;R+=c*k;U+=c*m;O+=c*l;fa+=c*n;ia+=c*q;ja+=c*p;oa+=c*v;ra+=c*r;wa+=c*u;ya+=c*D;var Ba=c*I;H=H+c*e+(c=b[15])*d;Q+=38*(N+c*g);x+=38*(V+c*h);B+=38*(R+c*f);E+=38*(U+
c*k);F+=38*(O+c*m);C+=38*(fa+c*l);y+=38*(ia+c*n);w+=38*(ja+c*q);G+=38*(oa+c*p);L+=38*(ra+c*v);M+=38*(wa+c*r);P+=38*(ya+c*u);J+=38*(Ba+c*D);K+=38*c*I;A=(c=(A+=38*(S+c*e))+1+65535)-65536*(b=Math.floor(c/65536));Q=(c=Q+b+65535)-65536*(b=Math.floor(c/65536));x=(c=x+b+65535)-65536*(b=Math.floor(c/65536));B=(c=B+b+65535)-65536*(b=Math.floor(c/65536));E=(c=E+b+65535)-65536*(b=Math.floor(c/65536));F=(c=F+b+65535)-65536*(b=Math.floor(c/65536));C=(c=C+b+65535)-65536*(b=Math.floor(c/65536));y=(c=y+b+65535)-
65536*(b=Math.floor(c/65536));w=(c=w+b+65535)-65536*(b=Math.floor(c/65536));G=(c=G+b+65535)-65536*(b=Math.floor(c/65536));L=(c=L+b+65535)-65536*(b=Math.floor(c/65536));M=(c=M+b+65535)-65536*(b=Math.floor(c/65536));P=(c=P+b+65535)-65536*(b=Math.floor(c/65536));J=(c=J+b+65535)-65536*(b=Math.floor(c/65536));K=(c=K+b+65535)-65536*(b=Math.floor(c/65536));H=(c=H+b+65535)-65536*(b=Math.floor(c/65536));A=(c=(A+=b-1+37*(b-1))+1+65535)-65536*(b=Math.floor(c/65536));Q=(c=Q+b+65535)-65536*(b=Math.floor(c/65536));
x=(c=x+b+65535)-65536*(b=Math.floor(c/65536));B=(c=B+b+65535)-65536*(b=Math.floor(c/65536));E=(c=E+b+65535)-65536*(b=Math.floor(c/65536));F=(c=F+b+65535)-65536*(b=Math.floor(c/65536));C=(c=C+b+65535)-65536*(b=Math.floor(c/65536));y=(c=y+b+65535)-65536*(b=Math.floor(c/65536));w=(c=w+b+65535)-65536*(b=Math.floor(c/65536));G=(c=G+b+65535)-65536*(b=Math.floor(c/65536));L=(c=L+b+65535)-65536*(b=Math.floor(c/65536));M=(c=M+b+65535)-65536*(b=Math.floor(c/65536));P=(c=P+b+65535)-65536*(b=Math.floor(c/65536));
J=(c=J+b+65535)-65536*(b=Math.floor(c/65536));K=(c=K+b+65535)-65536*(b=Math.floor(c/65536));H=(c=H+b+65535)-65536*(b=Math.floor(c/65536));a[0]=A+(b-1+37*(b-1));a[1]=Q;a[2]=x;a[3]=B;a[4]=E;a[5]=F;a[6]=C;a[7]=y;a[8]=w;a[9]=G;a[10]=L;a[11]=M;a[12]=P;a[13]=J;a[14]=K;a[15]=H}var C=c(0);c(12);c(2);c(31);c(1);b=c(39);var G=b.publicKeyValidator,L=b.privateKeyValidator;if(void 0===K)var K=C.jsbn.BigInteger;var J=C.util.ByteBuffer,M="undefined"==typeof Buffer?Uint8Array:Buffer;C.pki=C.pki||{};a.exports=C.pki.ed25519=
C.ed25519=C.ed25519||{};var w=C.ed25519;w.constants={};w.constants.PUBLIC_KEY_BYTE_LENGTH=32;w.constants.PRIVATE_KEY_BYTE_LENGTH=64;w.constants.SEED_BYTE_LENGTH=32;w.constants.SIGN_BYTE_LENGTH=64;w.constants.HASH_BYTE_LENGTH=64;w.generateKeyPair=function(a){var b=(a||{}).seed;if(void 0===b)b=C.random.getBytesSync(w.constants.SEED_BYTE_LENGTH);else if("string"==typeof b){if(b.length!==w.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+w.constants.SEED_BYTE_LENGTH+" bytes in length.");
}else if(!(b instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');b=d({message:b,encoding:"binary"});a=new M(w.constants.PUBLIC_KEY_BYTE_LENGTH);for(var c=new M(w.constants.PRIVATE_KEY_BYTE_LENGTH),g=0;32>g;++g)c[g]=b[g];b=[x(),x(),x(),x()];g=f(c,32);g[0]&=248;g[31]&=127;g[31]|=64;r(b,g);e(a,b);for(b=0;32>b;++b)c[b+32]=a[b];return{publicKey:a,privateKey:c}};w.privateKeyFromAsn1=function(a){var b={},c=[];if(!C.asn1.validate(a,L,b,c))throw b=
Error("Invalid Key."),b.errors=c,b;c=C.asn1.derToOid(b.privateKeyOid);a=C.oids.EdDSA25519;if(c!==a)throw Error('Invalid OID "'+c+'"; OID must be "'+a+'".');return{privateKeyBytes:d({message:C.asn1.fromDer(b.privateKey).value,encoding:"binary"})}};w.publicKeyFromAsn1=function(a){var b={},c=[];if(!C.asn1.validate(a,G,b,c))throw b=Error("Invalid Key."),b.errors=c,b;c=C.asn1.derToOid(b.publicKeyOid);a=C.oids.EdDSA25519;if(c!==a)throw Error('Invalid OID "'+c+'"; OID must be "'+a+'".');b=b.ed25519PublicKey;
if(b.length!==w.constants.PUBLIC_KEY_BYTE_LENGTH)throw Error("Key length is invalid.");return d({message:b,encoding:"binary"})};w.publicKeyFromPrivateKey=function(a){a=d({message:(a||{}).privateKey,encoding:"binary"});if(a.length!==w.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+w.constants.PRIVATE_KEY_BYTE_LENGTH);for(var b=new M(w.constants.PUBLIC_KEY_BYTE_LENGTH),c=0;c<b.length;++c)b[c]=a[32+c];return b};w.sign=function(a){var b=d(a=a||
{}),c=d({message:a.privateKey,encoding:"binary"});if(c.length===w.constants.SEED_BYTE_LENGTH)c=w.generateKeyPair({seed:c}).privateKey;else if(c.length!==w.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+w.constants.SEED_BYTE_LENGTH+" or "+w.constants.PRIVATE_KEY_BYTE_LENGTH);a=new M(w.constants.SIGN_BYTE_LENGTH+b.length);var g=b.length,h=c,m=new Float64Array(64),n=[x(),x(),x(),x()],q=f(h,32);q[0]&=248;q[31]&=127;q[31]|=64;for(c=0;c<g;++c)a[64+
c]=b[c];for(c=0;32>c;++c)a[32+c]=q[32+c];b=f(a.subarray(32),g+32);l(b);r(n,b);e(a,n);for(c=32;64>c;++c)a[c]=h[c];g=f(a,g+64);l(g);for(c=32;64>c;++c)m[c]=0;for(c=0;32>c;++c)m[c]=b[c];for(c=0;32>c;++c)for(b=0;32>b;b++)m[c+b]+=g[c]*q[b];k(a.subarray(32),m);!0;c=new M(w.constants.SIGN_BYTE_LENGTH);for(m=0;m<c.length;++m)c[m]=a[m];return c};w.verify=function(a){var b=d(a=a||{});if(void 0===a.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');
var c=d({message:a.signature,encoding:"binary"});if(c.length!==w.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+w.constants.SIGN_BYTE_LENGTH);a=d({message:a.publicKey,encoding:"binary"});if(a.length!==w.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+w.constants.PUBLIC_KEY_BYTE_LENGTH);var h,k=new M(w.constants.SIGN_BYTE_LENGTH+b.length),u=new M(w.constants.SIGN_BYTE_LENGTH+b.length);for(h=0;h<
w.constants.SIGN_BYTE_LENGTH;++h)k[h]=c[h];for(h=0;h<b.length;++h)k[h+w.constants.SIGN_BYTE_LENGTH]=b[h];return 0<=function(a,b,c,d){var h,k=new M(32),u=[x(),x(),x(),x()],A=[x(),x(),x(),x()];if((-1,64>c)||function(a,b){var c=x(),d=x(),e=x(),g=x(),h=x(),f=x(),k=x();v(a[2],F);(function(a,b){var c;for(c=0;16>c;++c)a[c]=b[2*c]+(b[2*c+1]<<8);a[15]&=32767})(a[1],b);D(e,a[1]);E(g,e,P);I(e,e,a[2]);B(g,a[2],g);D(h,g);D(f,h);E(k,f,h);E(c,k,e);E(c,c,g);(function(a,b){var c,d=x();for(c=0;16>c;++c)d[c]=b[c];for(c=
250;0<=c;--c)D(d,d),1!==c&&E(d,d,b);for(c=0;16>c;++c)a[c]=d[c]})(c,c);E(c,c,e);E(c,c,g);E(c,c,g);E(a[0],c,g);D(d,a[0]);E(d,d,g);n(d,e)&&E(a[0],a[0],H);if(D(d,a[0]),E(d,d,g),n(d,e))return-1;p(a[0])===b[31]>>7&&I(a[0],y,a[0]);return E(a[3],a[0],a[1]),0}(A,d))return-1;for(h=0;h<c;++h)a[h]=b[h];for(h=0;32>h;++h)a[h+32]=d[h];d=f(a,c);if(l(d),q(u,A,d),r(A,b.subarray(32)),m(u,A),e(k,u),c-=64,g(b,0,k,0)){for(h=0;h<c;++h)a[h]=0;return-1}for(h=0;h<c;++h)a[h]=b[h+64];return c}(u,k,k.length,a)};var y=x(),F=x([1]),
P=x([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),Q=x([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),U=x([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=x([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,16]),H=x([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])},function(a,b,c){a=c(0);c(3);c=a.asn1;b.privateKeyValidator={name:"PrivateKeyInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",
tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]};b.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",
tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]}},function(a,b,c){function d(a,b,c,d){a.generate=function(a,e){for(var g=new f.util.ByteBuffer,h=Math.ceil(e/d)+c,k=new f.util.ByteBuffer,m=c;m<h;++m){k.putInt32(m);b.start();b.update(a+k.getBytes());var l=b.digest();g.putBytes(l.getBytes(d))}return g.truncate(g.length()-e),g.getBytes()}}var f=c(0);
c(1);c(2);c(12);a.exports=f.kem=f.kem||{};var k=f.jsbn.BigInteger;f.kem.rsa={};f.kem.rsa.create=function(a,b){var c=(b=b||{}).prng||f.random;return{encrypt:function(b,d){var e=Math.ceil(b.n.bitLength()/8);do var h=(new k(f.util.bytesToHex(c.getBytesSync(e)),16)).mod(b.n);while(0>=h.compareTo(k.ONE));e-=(h=f.util.hexToBytes(h.toString(16))).length;return 0<e&&(h=f.util.fillString(String.fromCharCode(0),e)+h),{encapsulation:b.encrypt(h,"NONE"),key:a.generate(h,d)}},decrypt:function(b,c,d){b=b.decrypt(c,
"NONE");return a.generate(b,d)}}};f.kem.kdf1=function(a,b){d(this,a,0,b||a.digestLength)};f.kem.kdf2=function(a,b){d(this,a,1,b||a.digestLength)}},function(a,b,c){var d=c(0);c(1);a.exports=d.log=d.log||{};d.log.levels="none error warning info debug verbose max".split(" ");var f={},k=[];a=null;d.log.LEVEL_LOCKED=2;d.log.NO_LEVEL_CHECK=4;d.log.INTERPOLATE=8;for(b=0;b<d.log.levels.length;++b)c=d.log.levels[b],f[c]={index:b,name:c.toUpperCase()};d.log.logMessage=function(a){for(var b=f[a.level].index,
c=0;c<k.length;++c){var m=k[c];m.flags&d.log.NO_LEVEL_CHECK?m.f(a):b<=f[m.level].index&&m.f(m,a)}};d.log.prepareStandard=function(a){"standard"in a||(a.standard=f[a.level].name+" ["+a.category+"] "+a.message)};d.log.prepareFull=function(a){if(!("full"in a)){var b=[a.message];b=b.concat([]);a.full=d.util.format.apply(this,b)}};d.log.prepareStandardFull=function(a){"standardFull"in a||(d.log.prepareStandard(a),a.standardFull=a.standard)};c=["error","warning","info","debug","verbose"];for(b=0;b<c.length;++b)!function(a){d.log[a]=
function(b,c){var e=Array.prototype.slice.call(arguments).slice(2);d.log.logMessage({timestamp:new Date,level:a,category:b,message:c,arguments:e})}}(c[b]);if(d.log.makeLogger=function(a){a={flags:0,f:a};return d.log.setLevel(a,"none"),a},d.log.setLevel=function(a,b){var c=!1;if(a&&!(a.flags&d.log.LEVEL_LOCKED))for(var e=0;e<d.log.levels.length;++e)if(b==d.log.levels[e]){a.level=b;c=!0;break}return c},d.log.lock=function(a,b){void 0===b||b?a.flags|=d.log.LEVEL_LOCKED:a.flags&=~d.log.LEVEL_LOCKED},
d.log.addLogger=function(a){k.push(a)},"undefined"!=typeof console&&"log"in console){if(console.error&&console.warn&&console.info&&console.debug){var l={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug};a=function(a,b){d.log.prepareStandard(b);a=l[b.level];var c=[b.standard];c=c.concat(b.arguments.slice());a.apply(console,c)}}else a=function(a,b){d.log.prepareStandardFull(b);console.log(b.standardFull)};a=d.log.makeLogger(a);d.log.setLevel(a,"debug");
d.log.addLogger(a)}else console={log:function(){}};null!==a&&"undefined"!=typeof window&&window.location&&(b=(new URL(window.location.href)).searchParams,(b.has("console.level")&&d.log.setLevel(a,b.get("console.level").slice(-1)[0]),b.has("console.lock"))&&"true"==b.get("console.lock").slice(-1)[0]&&d.log.lock(a));d.log.consoleLogger=a},function(a,b,c){a.exports=c(4);c(14);c(9);c(23);c(31)},function(a,b,c){function d(a){var b={},c=[];if(!n.validate(a,g.asn1.recipientInfoValidator,b,c))throw a=Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo."),
a.errors=c,a;return{version:b.version.charCodeAt(0),issuer:h.pki.RDNAttributesAsArray(b.issuer),serialNumber:h.util.createBuffer(b.serial).toHex(),encryptedContent:{algorithm:n.derToOid(b.encAlgorithm),parameter:b.encParameter?b.encParameter.value:void 0,content:b.encKey}}}function f(a){for(var b,c=[],d=0;d<a.length;++d)c.push((b=a[d],n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(b.version).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,
!0,[h.pki.distinguishedNameToAsn1({attributes:b.issuer}),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,h.util.hexToBytes(b.serialNumber))]),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(b.encryptedContent.algorithm).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,b.encryptedContent.content)])));return c}function k(a){var b=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,
n.Type.INTEGER,!1,n.integerToDer(a.version).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[h.pki.distinguishedNameToAsn1({attributes:a.issuer}),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,h.util.hexToBytes(a.serialNumber))]),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(a.digestAlgorithm).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")])]);if(a.authenticatedAttributesAsn1&&b.value.push(a.authenticatedAttributesAsn1),b.value.push(n.create(n.Class.UNIVERSAL,
n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(a.signatureAlgorithm).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")])),b.value.push(n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,a.signature)),0<a.unauthenticatedAttributes.length){for(var c=n.create(n.Class.CONTEXT_SPECIFIC,1,!0,[]),d=0;d<a.unauthenticatedAttributes.length;++d)c.values.push(l(a.unauthenticatedAttributes[d]));b.value.push(c)}return b}function l(a){if(a.type===h.pki.oids.contentType)var b=n.create(n.Class.UNIVERSAL,
n.Type.OID,!1,n.oidToDer(a.value).getBytes());else if(a.type===h.pki.oids.messageDigest)b=n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,a.value.bytes());else if(a.type===h.pki.oids.signingTime){b=new Date("1950-01-01T00:00:00Z");var c=new Date("2050-01-01T00:00:00Z"),d=a.value;if("string"==typeof d){var e=Date.parse(d);d=isNaN(e)?13===d.length?n.utcTimeToDate(d):n.generalizedTimeToDate(d):new Date(e)}b=d>=b&&d<c?n.create(n.Class.UNIVERSAL,n.Type.UTCTIME,!1,n.dateToUtcTime(d)):n.create(n.Class.UNIVERSAL,
n.Type.GENERALIZEDTIME,!1,n.dateToGeneralizedTime(d))}return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(a.type).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SET,!0,[b])])}function m(a,b,c){var d={};if(!n.validate(b,c,d,[]))throw a=Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message."),a.errors=a,a;if(n.derToOid(d.contentType)!==h.pki.oids.data)throw Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");
if(d.encryptedContent){b="";if(h.util.isArray(d.encryptedContent))for(c=0;c<d.encryptedContent.length;++c){if(d.encryptedContent[c].type!==n.Type.OCTETSTRING)throw Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");b+=d.encryptedContent[c].value}else b=d.encryptedContent;a.encryptedContent={algorithm:n.derToOid(d.encAlgorithm),parameter:h.util.createBuffer(d.encParameter.value),content:h.util.createBuffer(b)}}if(d.content){b="";if(h.util.isArray(d.content))for(c=
0;c<d.content.length;++c){if(d.content[c].type!==n.Type.OCTETSTRING)throw Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");b+=d.content[c].value}else b=d.content;a.content=h.util.createBuffer(b)}return a.version=d.version.charCodeAt(0),a.rawCapture=d,d}function e(a){if(void 0===a.encryptedContent.key)throw Error("Symmetric key not available.");if(void 0===a.content){switch(a.encryptedContent.algorithm){case h.pki.oids["aes128-CBC"]:case h.pki.oids["aes192-CBC"]:case h.pki.oids["aes256-CBC"]:var b=
h.aes.createDecryptionCipher(a.encryptedContent.key);break;case h.pki.oids.desCBC:case h.pki.oids["des-EDE3-CBC"]:b=h.des.createDecryptionCipher(a.encryptedContent.key);break;default:throw Error("Unsupported symmetric cipher, OID "+a.encryptedContent.algorithm);}if(b.start(a.encryptedContent.parameter),b.update(a.encryptedContent.content),!b.finish())throw Error("Symmetric decryption failed.");a.content=b.output}}var h=c(0);c(5);c(3);c(10);c(6);c(7);c(29);c(2);c(1);c(17);var n=h.asn1,g=a.exports=
h.pkcs7=h.pkcs7||{};g.messageFromPem=function(a){a=h.pem.decode(a)[0];if("PKCS7"!==a.type){var b=Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw b.headerType=a.type,b;}if(a.procType&&"ENCRYPTED"===a.procType.type)throw Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");a=n.fromDer(a.body);return g.messageFromAsn1(a)};g.messageToPem=function(a,b){a={type:"PKCS7",body:n.toDer(a.toAsn1()).getBytes()};return h.pem.encode(a,{maxline:b})};g.messageFromAsn1=
function(a){var b={},c=[];if(!n.validate(a,g.asn1.contentInfoValidator,b,c))throw b=Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo."),b.errors=c,b;c=n.derToOid(b.contentType);switch(c){case h.pki.oids.envelopedData:c=g.createEnvelopedData();break;case h.pki.oids.encryptedData:c=g.createEncryptedData();break;case h.pki.oids.signedData:c=g.createSignedData();break;default:throw Error("Cannot read PKCS#7 message. ContentType with OID "+c+" is not (yet) supported.");}return c.fromAsn1(b.content.value[0]),
c};g.createSignedData=function(){var a=null;return a={type:h.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(b){if(m(a,b,g.asn1.signedDataValidator),a.certificates=[],a.crls=[],a.digestAlgorithmIdentifiers=[],a.contentInfo=null,a.signerInfos=[],a.rawCapture.certificates){b=a.rawCapture.certificates.value;for(var c=0;c<b.length;++c)a.certificates.push(h.pki.certificateFromAsn1(b[c]))}},toAsn1:function(){a.contentInfo||
a.sign();for(var b=[],c=0;c<a.certificates.length;++c)b.push(h.pki.certificateToAsn1(a.certificates[c]));c=[];var d=n.create(n.Class.CONTEXT_SPECIFIC,0,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(a.version).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SET,!0,a.digestAlgorithmIdentifiers),a.contentInfo])]);return 0<b.length&&d.value[0].value.push(n.create(n.Class.CONTEXT_SPECIFIC,0,!0,b)),0<c.length&&d.value[0].value.push(n.create(n.Class.CONTEXT_SPECIFIC,
1,!0,c)),d.value[0].value.push(n.create(n.Class.UNIVERSAL,n.Type.SET,!0,a.signerInfos)),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(a.type).getBytes()),d])},addSigner:function(b){var c=b.issuer,d=b.serialNumber;b.certificate&&(d=b.certificate,"string"==typeof d&&(d=h.pki.certificateFromPem(d)),c=d.issuer.attributes,d=d.serialNumber);var e=b.key;if(!e)throw Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof e&&(e=
h.pki.privateKeyFromPem(e));var g=b.digestAlgorithm||h.pki.oids.sha1;switch(g){case h.pki.oids.sha1:case h.pki.oids.sha256:case h.pki.oids.sha384:case h.pki.oids.sha512:case h.pki.oids.md5:break;default:throw Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+g);}b=b.authenticatedAttributes||[];if(0<b.length){for(var f=!1,k=!1,m=0;m<b.length;++m){var l=b[m];if(f||l.type!==h.pki.oids.contentType){if(!k&&l.type===h.pki.oids.messageDigest&&(k=!0,f))break}else if(f=!0,k)break}if(!f||
!k)throw Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.");}a.signers.push({key:e,version:1,issuer:c,serialNumber:d,digestAlgorithm:g,signatureAlgorithm:h.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:b,unauthenticatedAttributes:[]})},sign:function(b){var c;(b=b||{},"object"!=typeof a.content||null===a.contentInfo)&&(a.contentInfo=n.create(n.Class.UNIVERSAL,
n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(h.pki.oids.data).getBytes())]),"content"in a&&(a.content instanceof h.util.ByteBuffer?c=a.content.bytes():"string"==typeof a.content&&(c=h.util.encodeUtf8(a.content)),b.detached?a.detachedContent=n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,c):a.contentInfo.value.push(n.create(n.Class.CONTEXT_SPECIFIC,0,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,c)]))));0!==a.signers.length&&function(b){var c=a.detachedContent?a.detachedContent:
(c=a.contentInfo.value[1]).value[0];if(!c)throw Error("Could not sign PKCS#7 message; there is no content to sign.");var d=n.derToOid(a.contentInfo.value[0].value),e=n.toDer(c);for(g in e.getByte(),n.getBerValueLength(e),e=e.getBytes(),b)b[g].start().update(e);var g=new Date;for(c=0;c<a.signers.length;++c){var f=a.signers[c];if(0===f.authenticatedAttributes.length){if(d!==h.pki.oids.data)throw Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.");
}else{f.authenticatedAttributesAsn1=n.create(n.Class.CONTEXT_SPECIFIC,0,!0,[]);e=n.create(n.Class.UNIVERSAL,n.Type.SET,!0,[]);for(var m=0;m<f.authenticatedAttributes.length;++m){var q=f.authenticatedAttributes[m];q.type===h.pki.oids.messageDigest?q.value=b[f.digestAlgorithm].digest():q.type===h.pki.oids.signingTime&&(q.value||(q.value=g));e.value.push(l(q));f.authenticatedAttributesAsn1.value.push(l(q))}e=n.toDer(e).getBytes();f.md.start().update(e)}f.signature=f.key.sign(f.md,"RSASSA-PKCS1-V1_5")}b=
a;d=a.signers;g=[];for(c=0;c<d.length;++c)g.push(k(d[c]));b.signerInfos=g}(function(){for(var b={},c=0;c<a.signers.length;++c){var d=a.signers[c];(e=d.digestAlgorithm)in b||(b[e]=h.md[h.pki.oids[e]].create());0===d.authenticatedAttributes.length?d.md=b[e]:d.md=h.md[h.pki.oids[e]].create()}for(var e in a.digestAlgorithmIdentifiers=[],b)a.digestAlgorithmIdentifiers.push(n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(e).getBytes()),n.create(n.Class.UNIVERSAL,
n.Type.NULL,!1,"")]));return b}())},verify:function(){throw Error("PKCS#7 signature verification not yet implemented.");},addCertificate:function(b){"string"==typeof b&&(b=h.pki.certificateFromPem(b));a.certificates.push(b)},addCertificateRevokationList:function(a){throw Error("PKCS#7 CRL support not yet implemented.");}}};g.createEncryptedData=function(){var a=null;return a={type:h.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:h.pki.oids["aes256-CBC"]},fromAsn1:function(b){m(a,b,g.asn1.encryptedDataValidator)},
decrypt:function(b){void 0!==b&&(a.encryptedContent.key=b);e(a)}}};g.createEnvelopedData=function(){var a=null;return a={type:h.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:h.pki.oids["aes256-CBC"]},fromAsn1:function(b){var c=m(a,b,g.asn1.envelopedDataValidator);b=a;c=c.recipientInfos.value;for(var e=[],h=0;h<c.length;++h)e.push(d(c[h]));b.recipients=e},toAsn1:function(){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(a.type).getBytes()),
n.create(n.Class.CONTEXT_SPECIFIC,0,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(a.version).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SET,!0,f(a.recipients)),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,(b=a.encryptedContent,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(h.pki.oids.data).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(b.algorithm).getBytes()),
b.parameter?n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,b.parameter.getBytes()):void 0]),n.create(n.Class.CONTEXT_SPECIFIC,0,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,b.content.getBytes())])]))])])]);var b},findRecipient:function(b){for(var c=b.issuer.attributes,d=0;d<a.recipients.length;++d){var e=a.recipients[d],g=e.issuer;if(e.serialNumber===b.serialNumber&&g.length===c.length){for(var h=!0,f=0;f<c.length;++f)if(g[f].type!==c[f].type||g[f].value!==c[f].value){h=!1;break}if(h)return e}}return null},
decrypt:function(b,c){if(void 0===a.encryptedContent.key&&void 0!==b&&void 0!==c)switch(b.encryptedContent.algorithm){case h.pki.oids.rsaEncryption:case h.pki.oids.desCBC:b=c.decrypt(b.encryptedContent.content);a.encryptedContent.key=h.util.createBuffer(b);break;default:throw Error("Unsupported asymmetric cipher, OID "+b.encryptedContent.algorithm);}e(a)},addRecipient:function(b){a.recipients.push({version:0,issuer:b.issuer.attributes,serialNumber:b.serialNumber,encryptedContent:{algorithm:h.pki.oids.rsaEncryption,
key:b.publicKey}})},encrypt:function(b,c){if(void 0===a.encryptedContent.content){var d;switch(c=c||a.encryptedContent.algorithm,b=b||a.encryptedContent.key,c){case h.pki.oids["aes128-CBC"]:var e=d=16;var g=h.aes.createEncryptionCipher;break;case h.pki.oids["aes192-CBC"]:d=24;e=16;g=h.aes.createEncryptionCipher;break;case h.pki.oids["aes256-CBC"]:d=32;e=16;g=h.aes.createEncryptionCipher;break;case h.pki.oids["des-EDE3-CBC"]:d=24;e=8;g=h.des.createEncryptionCipher;break;default:throw Error("Unsupported symmetric cipher, OID "+
c);}if(void 0===b)b=h.util.createBuffer(h.random.getBytes(d));else if(b.length()!=d)throw Error("Symmetric key has wrong length; got "+b.length()+" bytes, expected "+d+".");a.encryptedContent.algorithm=c;a.encryptedContent.key=b;a.encryptedContent.parameter=h.util.createBuffer(h.random.getBytes(e));b=g(b);if(b.start(a.encryptedContent.parameter.copy()),b.update(a.content),!b.finish())throw Error("Symmetric encryption failed.");a.encryptedContent.content=b.output}for(b=0;b<a.recipients.length;++b)if(c=
a.recipients[b],void 0===c.encryptedContent.content)switch(c.encryptedContent.algorithm){case h.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(a.encryptedContent.key.data);break;default:throw Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm);}}}}},function(a,b,c){function d(a,b){b=b.toString(16);"8"<=b[0]&&(b="00"+b);b=l.util.hexToBytes(b);a.putInt32(b.length);a.putBytes(b)}function f(a,b){a.putInt32(b.length);a.putString(b)}function k(){for(var a=
l.md.sha1.create(),b=arguments.length,c=0;c<b;++c)a.update(arguments[c]);return a.digest()}var l=c(0);c(5);c(8);c(14);c(9);c(1);a=a.exports=l.ssh=l.ssh||{};a.privateKeyToPutty=function(a,b,c){var e=""===(b=b||"")?"none":"aes256-cbc";var g="PuTTY-User-Key-File-2: ssh-rsa\r\nEncryption: "+(e+"\r\nComment: ")+((c=c||"")+"\r\n");var h=l.util.createBuffer();f(h,"ssh-rsa");d(h,a.e);d(h,a.n);var m=l.util.encode64(h.bytes(),64);g+="Public-Lines: "+(Math.floor(m.length/66)+1)+"\r\n";g+=m;m=l.util.createBuffer();
if(d(m,a.d),d(m,a.p),d(m,a.q),d(m,a.qInv),b){a=m.length()+16-1;a-=a%16;var r=k(m.bytes());r.truncate(r.length()-a+m.length());m.putBuffer(r);a=l.util.createBuffer();a.putBuffer(k("\x00\x00\x00\x00",b));a.putBuffer(k("\x00\x00\x00\u0001",b));a=l.aes.createEncryptionCipher(a.truncate(8),"CBC");a.start(l.util.createBuffer().fillWithByte(0,16));a.update(m.copy());a.finish();a=a.output;a.truncate(16);a=l.util.encode64(a.bytes(),64)}else a=l.util.encode64(m.bytes(),64);g+="\r\nPrivate-Lines: "+(Math.floor(a.length/
66)+1)+"\r\n";g+=a;b=k("putty-private-key-file-mac-key",b);a=l.util.createBuffer();f(a,"ssh-rsa");f(a,e);f(a,c);a.putInt32(h.length());a.putBuffer(h);a.putInt32(m.length());a.putBuffer(m);c=l.hmac.create();return c.start("sha1",b),c.update(a.bytes()),g+("\r\nPrivate-MAC: "+c.digest().toHex()+"\r\n")};a.publicKeyToOpenSSH=function(a,b){b=b||"";var c=l.util.createBuffer();return f(c,"ssh-rsa"),d(c,a.e),d(c,a.n),"ssh-rsa "+l.util.encode64(c.bytes())+" "+b};a.privateKeyToOpenSSH=function(a,b){return b?
l.pki.encryptRsaPrivateKey(a,b,{legacy:!0,algorithm:"aes128"}):l.pki.privateKeyToPem(a)};a.getPublicKeyFingerprint=function(a,b){var c=(b=b||{}).md||l.md.md5.create(),e=l.util.createBuffer();f(e,"ssh-rsa");d(e,a.e);d(e,a.n);c.start();c.update(e.getBytes());a=c.digest();if("hex"===b.encoding)return a=a.toHex(),b.delimiter?a.match(/.{2}/g).join(b.delimiter):a;if("binary"===b.encoding)return a.getBytes();if(b.encoding)throw Error('Unknown encoding "'+b.encoding+'".');return a}}])});(function(a){(a.SEF=a.SEF||{}).context={BROWSER:"Chrome",browserObject:window.chrome}})(this);(function(){SEF.mv3_registration={};SEF.mv3_registration.onBeforeSendHeadersDetails=[[["requestHeaders","blocking","extraHeaders"],1],[["requestHeaders","extraHeaders"],1],[["requestHeaders","blocking"],3]];SEF.mv3_registration.onBeforeSendHeaders={};SEF.mv3_registration.onBeforeSendHeadersDetails.forEach(a=>{const [b,c]=a;SEF.mv3_registration.onBeforeSendHeaders[b]=[];for(let a=0;a<c;a++)chrome.webRequest.onBeforeSendHeaders.addListener(c=>SEF._initFuture.promise.then(()=>a>=SEF.mv3_registration.onBeforeSendHeaders[b].length?
{}:SEF.mv3_registration.onBeforeSendHeaders[b][a](c)),{urls:["<all_urls>"]},b)});SEF.mv3_registration.onHeadersReceivedDetails=[[["responseHeaders","blocking"],4]];SEF.mv3_registration.onHeadersReceived={};SEF.mv3_registration.onHeadersReceivedDetails.forEach(a=>{const [b,c]=a;SEF.mv3_registration.onHeadersReceived[b]=[];for(let a=0;a<c;a++)chrome.webRequest.onHeadersReceived.addListener(c=>SEF._initFuture.promise.then(()=>a>=SEF.mv3_registration.onHeadersReceived[b].length?{}:SEF.mv3_registration.onHeadersReceived[b][a](c)),
{urls:["<all_urls>"]},b)});SEF.mv3_registration.onCompleted=[];SEF.mv3_registration.nOnCompleted=2;for(let a=0;a<SEF.mv3_registration.nOnCompleted;a++)chrome.webRequest.onCompleted.addListener(b=>SEF._initFuture.promise.then(()=>a>=SEF.mv3_registration.onCompleted.length?{}:SEF.mv3_registration.onCompleted[a](b)),{urls:["<all_urls>"]});SEF.mv3_registration.onRemoved=[];SEF.mv3_registration.nOnRemoved=4;for(let a=0;a<SEF.mv3_registration.nOnRemoved;a++)chrome.tabs.onRemoved.addListener((b,c)=>SEF._initFuture.promise.then(()=>
a>=SEF.mv3_registration.onRemoved.length?{}:SEF.mv3_registration.onRemoved[a](b,c)))})(this);(function(a){(a.SEF=a.SEF||{}).symbols=Object.freeze({Initialize:Symbol("Initialize"),Self:Symbol("Self"),Category:Symbol("Category"),ModuleSequenceId:Symbol("SequenceId"),Module:Symbol("ModuleObject"),ModuleId:Symbol("ModuleId"),ModuleName:Symbol("ModuleName"),ModuleType:Symbol("ModuleType"),ModulePublicKey:Symbol("ModulePublicKey"),Listeners:Symbol("Listeners"),Pollers:Symbol("Pollers"),ConfigurationServer:Symbol("ConfigServer"),InitFuture:Symbol("InitFuture"),Return:Symbol("Return"),EventContext:Symbol("EventContext"),
Result:Symbol("Result"),Action:Symbol("Action"),ActionData:Symbol("ActionData"),CustomAction:Symbol("CustomAction"),CustomActionData:Symbol("CustomActionData"),Base:Symbol("Base"),Capture:Symbol("Capture"),Version:Symbol("Version"),Target:Symbol("Target"),ErrorInfo:Symbol("Error"),Incidents:Symbol("Incidents")});a.SEF.utils=a.SEF.utils||{}})(this);(function(a){Object.defineProperty(a.SEF=a.SEF||{},"version",{value:"1.0.170",writable:!1})})(this);(function(a){(a.SEF=a.SEF||{}).exceptions=function(){return{DatabaseNotSeededException:class extends Error{constructor(a){super(`Passcode required to seed database upon creation. <${a}>`)}},JWTInvalidPayloadException:class extends Error{constructor(){super("JWT payload is invalid")}},JWTPayloadHashMismatchException:class extends Error{constructor(){super("JWT payload hash mismatch")}},JWTVerificationException:class extends Error{constructor(){super("Unable to verify JWT payload using current key")}},
AbstractClassException:class extends Error{constructor(){super("Cannot instantiate an abstract class")}},ModuleParamMissingException:class extends Error{constructor(a){super(`Paramter missing: '${a}'`)}},RebindingProhibited:class extends Error{constructor(a,c=""){super(`Rebinding '${c}@${a}' is prohibited`)}},ObjectNotCallableException:class extends Error{constructor(a){super(`Object <${a}> is not callable`)}},InvalidModuleException:class extends Error{constructor(){super("Object is not a valid SEF Module")}},
ListenerInterfaceNotSupportedException:class extends Error{constructor(a){super(`Object <${a}> does not support listener interface`)}},EventNotSupportedException:class extends Error{constructor(a,c){super(`Event <${c}> is not supported on target <${a}>`)}},OperationNotPermitted:class extends Error{constructor(){super("Operation is not permitted in the current context")}},ContractExpiredError:class extends Error{constructor(a){super("expired");this.options=a}},ValidationError:class extends Error{},
StopIteration:class{constructor(a){this.value=a}}}}()})(this);(function(a){a.SEF=a.SEF||{};(a.SEF.utils=a.SEF.utils||{}).Logger=function(){function a(a,b){a in c.modules&&(c.modules[a].enabled=!!b)}class c{constructor(a){this.module=a;this.logs=[];this.minLogSize=3;this.maxLogSize=50;this.maxDuration=18E4}send(a,b){try{const c=Date.now();this.logs.length<=this.maxLogSize&&this.logs.push({ts:c,level:a,msg:b});(this.logs.length>=this.minLogSize||0<this.logs.length&&c-this.logs[0].ts>this.maxDuration)&&SEF.hasOwnProperty("bridge")&&(SEF.bridge.portManager.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"LOGGING",
[SEF.constants.teleKeys.LOGGING]:this.logs},SEF.config.Get("nativeMessasingAppId")),this.logs=[],this.minLogSize=0)}catch(k){}}debug(a,...b){c.DoLog(console.debug.bind(console),this.module,`[DBG] ${a}`,...b)}info(a,...b){c.DoLog(console.info.bind(console),this.module,`[INF] ${a}`,...b);this.send("INFO",`[${this.module}] ${a}`)}error(a,...b){c.DoLog(console.error.bind(console),this.module,`[ERR] ${a}`,...b);this.send("ERROR",`[${this.module}] ${a}`)}warn(a,...b){c.DoLog(console.warn.bind(console),
this.module,`[WRN] ${a}`,...b);this.send("WARN",`[${this.module}] ${a}`)}verbose(a,...b){c.DoLog(console.log.bind(console),this.module,`[VBS] ${a}`,...b)}}c.DoLog=(a,b,k,...l)=>{!0===c.modules[b].enabled&&(a(`[${(new Date).toLocaleString("en-US")}][${b}]${k}`,...l),c.externalHandlers.forEach(a=>{a(`[${b}] ${k}`)}))};c.modules={};c.externalHandlers=[];return class extends c{constructor(a){a=a.toUpperCase();super(a);c.modules.hasOwnProperty(a)||(c.modules[a]={enabled:!0,object:this});return c.modules[a].object}static EnableModules(b){b=
b.toUpperCase();a(b,!0)}static DisableModules(b){b=b.toUpperCase();a(b,!1)}static GetModules(){return Object.keys(c.modules)}static Status(){const a={};Object.keys(c.modules).forEach(b=>{a[b]=c.modules[b].enabled});return a}static SetupHandler(a){"function"===typeof a&&c.externalHandlers.push(a)}}}()})(this);(function(a){a=a.SEF=a.SEF||{};var b={NATIVE_MESSAGING_APP_CONNECT_RETRY_DEFAULT:3E4};b.NATIVE_MESSAGING_APP_ID=Object.freeze("com.broadcom.webextbridge");b.PULSE_FREQUENCY=180;b.SYNC_FREQUENCY=5;b.NATIVE_APP_IDS=Object.freeze(["com.symantec.xndc_oob"]);b.WEBCONF_RESPONSE_TIMEOUT=5E3;b.URL_MAX_LENGTH=2048;b.POLL_FREQUENCY=Object.freeze({MIN:4,MAX:86400});b.TRUSTED_DOMAINS=Object.freeze(["google-analytics.com","norton.com","symantec.com","nortoncdn.com","sp.cwfservice.net"]);b.HTTP_HEADER_NAME_SOURCE_ID=
Object.freeze("X-Device-ID");b.scanApproach=Object.freeze({INLINE_SCAN:"InlineScan",DELAY_LOAD:"DelayLoad",PEER_DOM:"PeerDOM",LAZY_SCAN:"LazyScan"});b.actionProfiles=Object.freeze({SECURE:"Secure",PRIORITY:"PriorityBased",CONSENSUS:"ConsensusBased"});b.consolPriorities=Object.freeze({HIGH:500,HIGH_MEDIUM:400,MEDIUM:300,MEDIUM_LOW:200,LOW:100});b.networkUsage=Object.freeze({NONE:"No Usage",LIMITED:"Limited Usage",UNLIMITED:"Unlimited Usage"});b.moduleStates=Object.freeze({ENABLED:"enabled",SILENT:"silent",
DISABLED:"disabled"});b.msgTypes=Object.freeze({CLOUD_CONFIG:"config",FEATURE_STATES:"featureStates",NDC_CONTENT:"ndcContent",POLICIES:"policies",MESSAGE:"message",BROADCAST:"broadcast",EXIT:"exit",EXCLUSIONS:"exclusions",MESSAGE_KEY:"messagekey"});b.teleKeys=Object.freeze({MESSAGE_TYPE:"type",PRODUCT_ID:"ext_id",PRODUCT_NAME:"ext_name",PRODUCT_VERSION:"ext_version",BROWSER:"browser",BROWSER_VERSION:"browser_version",URL:"url",SOURCE:"source",SILENT:"silent",EXCLUDED:"excluded",ACTION:"action",TIME:"act_time",
CATEGORY_IDS:"category_ids",THREAT_LEVEL:"threat_level",SIG_ID:"signature_id",SIG_NAME:"signature_name",PAYLOAD:"payload",LANGUAGE:"lang",LOGGING:"logging",SUBMIT_ONLY:"submit_only"});b.telePayloadKeys=Object.freeze({NDC_DEF_VERSION:"ndc_def_version"});b.sigInfo=Object.freeze({WEBPULSE_BASED_SIG_ID:60501,WEBPULSE_BASED_SIG_NAME:"URL reputation: Browser navigation to known bad URL",WEBPULSE_BASED_THREAT_LEVEL:3,RULE_BASED_SIG_ID:60502,RULE_BASED_SIG_NAME:"URL BLOCKING: Browser navigation to known bad URL",
RULE_BASED_THREAT_LEVEL:3});b.SAFE_LANDING_PAGE=Object.freeze("notification.html");b.WebPulseDefaults=Object.freeze({MAX_LOOKUPS:1E4,ALL_URLS_THROTTLE:0});a.constants=b})(this);(function(a){(a.SEF=a.SEF||{}).common=function(){const {exceptions:a,utils:c,constants:d}=SEF,f=new c.Logger("COMMON"),{ContractExpiredError:k}=a,l={JSScope:class{constructor(a,...b){if("JSScope"===this.constructor.name)throw Error("Cannot instantiate this class");if(a&&"function"!=typeof a)throw Error("executor must be callable");this.args=b;a=a||function(){return null};const [c,d]=[(this[this.constructor.name]||function(){return null}).bind(this),(this[`~${this.constructor.name}`]||function(){return null}).bind(this)];
c();try{a.bind(this)()}catch(B){}finally{d()}}},hash:{MD5:a=>a?forge.md.md5.create().update(a).digest().toHex():null,SHA256:a=>a?forge.md.sha256.create().update(a).digest().toHex():null,SHA256Digest:a=>a?forge.md.sha256.create().update(a).digest():null}};class m extends Promise{constructor(a,b={}){if("function"!==typeof a)throw Error("executor is not callable");super((c,d)=>{try{a(c,d)}catch(B){d(B)}finally{b.expiry&&setTimeout(d,b.expiry,new k(b))}})}expires(a){"function"===typeof a&&this.catch(b=>
b instanceof k?a(b):b);return this}}d.msgType=Object.freeze({URL_REPUTATION:"webPulse",HTTP_HDR_SCANNER:"NDC",DOWNLOAD_EVENT:3,OTHER:4});class e{constructor(a,b=null,c={}){this.status=a;this.tabId=b;this.optional=c;this.recommendation=this.type=null}Set(a,b=null){b&&(this.recommendation=b);"number"==typeof a?(this.type=d.msgType.URL_REPUTATION,b="reputation"):Array.isArray(a)||a instanceof Uint32Array?(this.type=d.msgType.HTTP_HDR_SCANNER,a=Uint32Array.from(a),b="sigIds"):"string"==typeof a?(this.type=
d.msgType.DOWNLOAD_EVENT,b="filename"):(this.type=d.msgType.OTHER,b="payload");Object.defineProperty(this,b,{value:a,enumerable:!0,writable:!1});return this}SetOptional(a){for(const b of Object.keys(a))this.optional[b]=a[b];return this}SetTabId(a){this.tabId=a;return this}SetRecommendation(a){this.recommendation=a;return this}}class h{static get CACHE_LIMIT(){return 1E3}static get CACHE_TTL(){return 604800}constructor(a=h.CACHE_LIMIT,b=h.CACHE_TTL){if(!h.instance){if("number"!==typeof a||"number"!==
typeof b)throw Error("Paramter is not a number");this.maxEntries=a;this.ttl=b;const c=function(a){let b={length:0};return{Insert:(c,d,e=null)=>{if(!c)return f.error("[SEF.Web Error]: _cache::Insert: Null key"),!1;if(!(c in b)){if(b.length>=a.maxEntries)return f.error("[SEF.Web Error]: Cache capacity maxed out at "+`${a.maxEntries} entries`),!1;b.length++}b[c]=d;d=e?e:a.ttl?a.ttl:0;0<a.ttl&&setTimeout(()=>{c in b&&(delete b[c],b.length--)},1E3*d);return!0},Remove:a=>a&&a in b?(delete b[a],b.length--,
!0):!1,Size:()=>b.length,Clear:()=>{b={length:0}},Get:a=>a in b?b[a]:null}}(this);this.InsertVolatile=this.Insert=c.Insert;this.Remove=c.Remove;this.Clear=c.Clear;this.GetEx=c.Get;this.Get=a=>{a=c.Get(a);return a instanceof Promise||a instanceof m?null:a};this.Size=c.Size;Object.defineProperty(h,"instance",{value:this,writable:!1})}return h.instance}}class n{constructor(a){const b=new URL(a);b.directory=`${b.protocol}//${b.host}${b.pathname.substr(0,b.pathname.lastIndexOf("/"))}`;b.path=`${b.protocol}//${b.host}${b.pathname}`;
b.HostHash=()=>l.hash.SHA256(b.host);b.DirectoryHash=()=>l.hash.SHA256(b.directory);b.PathHash=()=>l.hash.SHA256(b.path);return b}}class g{static CreateUrlMatcher(a){let b,c,d,e,h,k,m;var l=(new RegExp(/(?:(?<schema>.*):\/\/)?(?:(?<authority>.*:.*)@)?(?:(?<domain>[^\/:]*))?(?::)?(?:(?<port>[0-9]*))?(?:\/)?(?:(?<path>[^\?#]*))?(?:\?)?(?:(?<query>[^#]*))?(?:#)?(?:(?<fragment>.*))?/,"i")).exec(a);[m,l,b,c,d,e,h,k]=l;if(m!==a)return f.error("Invalid url format."),null;a=new g(m,l,b,c,d,e,h,k);try{a.Compile()}catch(G){f.error("Create Url Matcher failed: ",
G),a=null}return a}constructor(a,b,c,d,e,g,h,f){this.url=a;this.schema=b;this.authority=c;this.domain=d;this.path=g;this.port=e;this.query=h;this.fragment=f;this.matcher=null}Compile(){let a="";a=this.schema?a+this.Format(this.schema.concat("://")):a+"(?:.*://)?";this.authority||(this.authority="(?:.*:.*@)?");a+=this.authority;if(!this.domain)throw Error("Empty domain.");a+=this.Format(this.domain);a=this.port?a+this.Format(":".concat(this.port.toString())):a+"(?::[0-9]*)?";this.path&&(a+=this.Format("/".concat(this.path)));
this.query&&(a+=this.Format("?".concat(this.query)));this.fragment&&(a+=this.Format("#".concat(this.fragment)));this.matcher=new RegExp("^".concat(a).concat(".*$"))}Format(a){return a.replace(/\./g,"\\.").replace(/\?/g,"\\?").replace(/\*/g,".*")}Equal(a){return this.schema===a.schema&&this.authority===a.authority&&this.domain===a.domain&&this.port===a.port&&this.path===a.path&&this.query===a.query&&this.fragment===a.fragment?!0:!1}Match(a){return this.matcher.exec(a)?this.url.length:0}}class p{static CreateIpv4RangeMatcherFromIpv4Range(a){let b=
null;try{const c=JSON.parse(a);if("number"!==typeof c[0]||"number"!==typeof c[1]||0>c[0]||4294967295<c[0]||0>c[1]||4294967295<c[1])return null;b=new p(a,c)}catch(A){f.error("Create Ipv4RangeMatcher failed: ",A),b=null}return b}static CreateIpv4RangeMatcherFromIpv4(a){let b=null;try{const c=parseInt(a,10);if(0>c||4294967295<c)return null;b=new p(a,[c,c])}catch(A){f.error("Create Ipv4RangeMatcher failed: ",A),b=null}return b}static Preprocess(a){return l.ValidateAndRetrieveIpv4Address(a)}static compareFn(a,
b){return a.range[0]===b.range[0]&&a.range[1]===b.range[1]?0:a.range[1]<b.range[0]?-1:a.range[0]>b.range[1]?1:null}static matchFn(a){return b=>a>=b.range[0]&&a<=b.range[1]?0:a<b.range[0]?1:-1}constructor(a,b){this.strIpv4Range=a;this.range=b;this.range[0]>this.range[1]&&([this.range[0],this.range[1]]=[this.range[1],this.range[0]])}Equal(a){return this.strIpv4Range===a.strIpv4Range&&this.ipv4Range===a.ipv4Range}}class q{constructor(a,b,c,e={}){if("function"!==typeof a)throw Error("Argument must be callable");
if("function"!==typeof b&&"number"!==typeof b)throw Error(`Invalid frequency type <${typeof b}> while creating PollingSchedule: ${b}`);if(c&&!Array.isArray(c))throw Error("Parameters must be Array or undefined");let g=b,h=!1,k=null,l=null;Object.defineProperty(this,"frequency",{get(){return"function"==typeof g?g():g},set(a){g="function"==typeof a||"number"==typeof a?a:g}});Object.defineProperty(this,"scheduled",{get(){return h},set(){return null}});Object.defineProperty(this,"lastRunAt",{get(){return l},
set(){return null}});Object.defineProperty(this,"poller",{value:a,writable:!1});Object.defineProperty(this,"params",{value:c,writable:!1});e.hasOwnProperty("name")&&Object.defineProperty(this,"name",{value:e.name,writable:!1});e.hasOwnProperty("description")&&Object.defineProperty(this,"description",{value:e.description,writable:!1});e.hasOwnProperty("delayedStart")&&Object.defineProperty(this,"delayedStart",{value:e.delayedStart,writable:!1});Object.defineProperty(this,"autoStart",{value:"boolean"===
typeof e.autoStart?e.autoStart:!0,writable:!1});this.Run=function(){if(!this.scheduled){var a=()=>{function b(b){b<d.POLL_FREQUENCY.MIN||b>d.POLL_FREQUENCY.MAX||(k=setTimeout(a,1E3*b),h=!0)}h=!1;k=null;try{const a=this.poller.apply(null,this.params);l=Date.now();a instanceof Promise||a instanceof m?a.then(()=>{b(this.frequency)}):b(this.frequency)}catch(L){f.error(`Poller error: ${L}`)}};!0===this.delayedStart?setTimeout(a,1E3*this.frequency):a()}};this.Stop=function(){h&&k&&(clearTimeout(k),h=!1)}}}
class r{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a;this.reject=b})}}l.Contract=m;l.GenericResult=e;l.Cache=h;l.ParsedUrl=n;l.UrlMatcher=g;l.Ipv4RangeMatcher=p;l.Poller=q;l.Future=r;l.JWTVerify=(a,b)=>{if(!a.hasOwnProperty("JWT"))throw f.error("[SEF.Web Error]: JWT::Invalid payload"),new SEF.exceptions.JWTInvalidPayloadException;if(!0!==KJUR.jws.JWS.verify(a.JWT,KEYUTIL.getKey(b),["RS256"]))throw f.error("[SEF.Web Error]: JWT verification failure"),new SEF.exceptions.JWTVerificationException;
if(KJUR.jws.JWS.readSafeJSONString(b64utoutf8(a.JWT.split(".")[1])).hash!==forge.md.sha256.create().update(JSON.stringify(a.payload)).digest().toHex())throw f.error("[SEF.Web Error]: Payload hash mismatch"),new SEF.exceptions.JWTPayloadHashMismatchException;};l.notify=a=>{setTimeout(a=>{try{SEF.config.Get("notificationCallback")(a)}catch(A){}},0,a)};l.perf={Start:()=>null,End:()=>null};l.isNil=a=>void 0===a||null===a;l.isntNil=a=>!l.isNil(a);l.trim=(a,b)=>a.length<=b?a:`${a.slice(0,b-8)}...${a.slice(-5)}`;
l.MakePrototype=a=>a?a:class{};l.url={isValid(a,b=null){if(!a)return!1;try{const c=new URL(a);if(0===c.hostname.length||0===c.protocol.length)return!1;if("function"===typeof b)return b(c)}catch(A){return!1}return!0},isValidHttp(a){return l.url.isValid(a,a=>"http:"===a.protocol||"https:"===a.protocol)},PIIClean(a){if(l.url.isValidHttp(a)){var b=a.indexOf("?");return a.substring(0,-1!==b?b:a.length)}return null},Clean(a){try{const b=new URL(a);return`${b.protocol}//${b.host}${b.pathname}`}catch(u){return null}}};
l.GetBrowserVersion=()=>{var a=navigator.userAgent;try{var b=a.match(/(?<name>chrome|safari|firefox(?=\/))\/?\s*(?<version>[\d.]+)/i)||[];if("Chrome"===b[1]){var c=a.match(/\bEdg\/(?<version>[\d.]+)/);if(null!==c)return{name:"Edge",version:c[1]}}b=b[2]?[b[1],b[2]]:[navigator.appName,navigator.appVersion];null!==(c=a.match(/version\/(?<version>[\d.]+)/i))&&b.splice(1,1,c[1]);return{name:b[0],version:b[1]}}catch(x){return f.error(`Failed to get browser version from user agent, ${a}, err is ${x}`),{name:"",
version:""}}};l.ValidateAndRetrieveIpv4Address=a=>{if(a=/^(?<subnet0>25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?<subnet1>25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?<subnet2>25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?<subnet3>25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.exec(a)){let b=new Uint32Array(1);a.forEach(a=>{b[0]=(b[0]<<8)+parseInt(a,10)});return b[0]}return null};return l}()})(this);(function(){(SEF.utils=SEF.utils||{}).Message=function(){function a(a,b,c,d){return a+(b^d)&255^b^~c&255^d}const b={},c=new SEF.utils.Logger("MSGUTIL"),d=SEF.context.browserObject.runtime.id.substr(0,13).split("");let f=!0;d.forEach((a,b,c)=>{c[b]=a.charCodeAt(0)});let k=!0;b.unwrap=function(a,b){a=a.match(/.{1,2}/g);let c="";for(let e=0;e<a.length;e++){var d=parseInt(a[e],16),f="And this is another random long piece".charCodeAt(e%37),g="(Message utility hexing string)".charCodeAt(e%31),k=b[e%b.length];
c+=String.fromCharCode((d^f^~g&255^k)-(f^k)&255)}return JSON.parse(c)};b.wrap=function(b,c){b=JSON.stringify(b);let d="";for(let e=0;e<b.length;e++){let h=Number(a(b.charCodeAt(e),"And this is another random long piece".charCodeAt(e%37),"(Message utility hexing string)".charCodeAt(e%31),c[e%c.length])).toString(16);1===h.length&&(h=`0${h}`);d+=h}return d};b.setKey=function(a){b.sessionKey=a;k=!1};b.resetKey=function(){b.sessionKey=d;k=!0};b.isDefaultKey=function(){return k};b.sessionKey=d;b.checkBridgeMessageEncryption=
function(a){"object"===typeof a&&null!==a?(f=!1,c.info("No bridge version received from native port, assume it is 1.0.0, dont encrypt messages.")):f=!0};b.haveMessageEncryption=function(){return f};return b}()})(this);(function(a){(function(){const b=new SEF.utils.Logger("POLYFILLS");class c{}class d{}SEF.eventing=SEF.eventing||{};Promise.allSettled=Promise.allSettled||function(a){return Promise.all(a.map(function(a){return Promise.resolve(a).then(this.onFulfilled).catch(this.onRejected)},{onFulfilled(a){return{status:"fulfilled",value:a}},onRejected(a){return{status:"rejected",reason:a}}}))};const f=class{constructor(a){this.listeners=new Set;this.id=a}addListener(a){if("function"!==typeof a)throw Error("listener to EventListenerType must be callable");
this.listeners.add(a)}removeListener(a){this.listeners.delete(a)}hasListener(a){return this.listeners.has(a)}emit(a){const c=[];this.listeners.forEach(d=>{try{c.push(d(a))}catch(e){b.error(`Error while calling listeners for <${this.id}>: ${e} ${e.stack}`)}});return c}};SEF.eventing.EventListenerType=f;if("edge"===SEF.context.BROWSER.toLowerCase()||"safari"===SEF.context.BROWSER.toLowerCase()){if(SEF.eventing.EventTarget=class extends c{constructor(){super();this.listeners=new Map}addEventListener(a,
b){if("string"!==typeof a)throw Error("'type' must be a string");if("function"!==typeof b)throw Error("listener must be callable");this.listeners.has(a)||this.listeners.set(a,new Set);this.listeners.get(a).add(b)}removeEventListener(a,b){this.listeners.has(a)&&this.listeners.get(a).delete(b)}dispatchEvent(a){if(!(a instanceof SEF.eventing.CustomEvent))throw Error("Parameter is not of type 'Event'");a instanceof d&&(a.eventPhase=2,a.target=this);let c=this.listeners.get(a.type);if(c){c=c.values();
let d;for(;!(d=c.next()).done;)try{if(!0===a.cancelImmediate)break;d.value(a)}catch(e){b.error(`[Polyfill::EventTarget] Error while dispatch: ${e}`)}}a instanceof d&&(a.eventPhase=0);return!a.defaultPrevented}},"safari"===SEF.context.BROWSER.toLowerCase()){SEF.eventing.CustomEvent=class extends d{static get NONE(){return 0}static get CAPTURING_PHASE(){return 1}static get AT_TARGET(){return 2}static get BUBBLING_PHASE(){return 3}constructor(a,b={detail:null,bubbles:!1,cancelable:!1,composed:!1}){super();
Object.defineProperties(this,{type:{value:a,writble:!1},bubbles:{value:b.bubbles,writble:!1},cancelable:{value:b.cancelable,writble:!1},composed:{value:b.composed,writble:!1},isTrusted:{value:!1,writble:!1}});this.detail=b.detail;this.defaultPrevented=this.cancelBubble=!1;this.eventPhase=0;this.target=null;this.timeStamp=(new Date).getTime()}stopPropagation(){this.cancelBubble=!0}preventDefault(){this.defaultPrevented=!0}stopImmediatePropagation(){this.cancelImmediate=!0}composedPath(){return null}};
class b{constructor(a){this.headers=a.headers;this.ok=a.ok;this.redirected=a.redirected;this.status=a.status;this.statusText=a.statusText;this.type=a.type;this.url=a.url;this.useFinalURL=a.useFinalURL;this.body=a.body;this.bodyUsed=!1}clone(){return Object.assign({},this)}error(){return Object.assign({},this)}arrayBuffer(){try{return Promise.resolve(this.body)}catch(m){return Promise.reject(m)}}json(){try{return Promise.resolve(JSON.parse(String.fromCharCode(this.body)))}catch(m){return Promise.reject(m)}}text(){try{return Promise.resolve(String.fromCharCode(this.body))}catch(m){return Promise.reject(m)}}}
a.fetch=function(...a){return new Promise((c,d)=>{_fetch(...a).then(a=>{c(new b(a))}).catch(a=>{d(a)})})};class c{constructor(a){this.name=a}}SEF.context.browserObject.tabs={captureTab(a,b){return new Promise((c,d)=>{a.captureTab(b).then(a=>{c(a)}).catch(d)})},connect(a,b){a.connect(b);return new c(b.name)},create(a){return new Promise((b,c)=>{_openTab(a).then(b).catch(c)})},reload(a,b){return new Promise((c,d)=>{a.reload(b).then(c).catch(d)})},remove(a){a=Array.isArray(a)?a:[a];return Promise.all(a.reduce((a,
b)=>{a.push(new Promise((a,c)=>{b.remove().then(a).catch(c)}));return a},[]))},sendMessage(a,b,c){return new Promsie((d,e)=>{a.sendMessage(b,c).then(d).catch(e)})},update(a,b){return new Promise((c,d)=>{a.update(b).then(c).catch(d)})}};SEF.context.browserObject.runtime={connect(){throw Error("Not supported");},onConnect:new f("runtime::onConnect"),onMessage:new f("runtine::onMessage"),getURL(){return""}};SEF.context.browserObject.webRequest={onAuthRequired:new f("onAuthRequired"),onBeforeRedirect:new f("onBeforeRedirect"),
onBeforeRequest:new f("onBeforeRequest"),onBeforeSendHeaders:new f("onBeforeSendHeaders"),onCompleted:new f("onCompleted"),onErrorOccurred:new f("onErrorOccurred"),onHeadersReceived:new f("onHeadersReceived"),onResponseStarted:new f("onResponseStarted"),onSendHeaders:new f("onSendHeaders")}}}else SEF.eventing.EventTarget=EventTarget})()})(this);(function(a){a.SEF=a.SEF||{};(function(){function a(a,b){return 2<chrome.runtime.getManifest().manifest_version&&a in SEF.mv3_registration?"onBeforeSendHeaders"===a||"onHeadersReceived"===a?([,b]=b,SEF.mv3_registration[a][b]):SEF.mv3_registration[a]:null}function c(a,b){const c=a[b];c&&"function"===typeof c&&(a[b]=(...a)=>{if(!SEF.config.Get("actionConsolidation"))return null;const b=c(...a);return b&&b instanceof q?(b.Consolidate(),a=b[SEF.symbols.EventContext],SEF.exclusions.IsTrustedHost(a.url)&&
(b.trustedHost=!0),SEF.exclusions.IsExcluded(a.url,a.tabId)&&(b.Allow(),b.exclusion=!0),b[SEF.symbols.Action]===SEF.eventing.Actions.DEFER?b[SEF.symbols.ActionData].then(()=>SEF.DispatchEvent(b)?b.DoAction():null):SEF.DispatchEvent(b)?b.DoAction():null):b})}function d(b){const c=b[h];c&&Object.entries(c.consolidators).forEach(([d,e])=>{let g=a(d,e);g?(e=g.indexOf(b[d]),-1<e&&g.splice(e,1),g.push(b[d])):(c.target[d].removeListener(b[d]),e&&Array.isArray(e)&&0<e.length?c.target[d].addListener(b[d],
...e):c.target[d].addListener(b[d]))})}function f(b){const c=b[h];c&&Object.entries(c.consolidators).forEach(([d,e])=>{(e=a(d,e))?(d=e.indexOf(b[d]),-1<d&&e.splice(d,1)):c.target[d].removeListener(b[d])})}const {exceptions:k,constants:l}=SEF;SEF.core=SEF.core||{};SEF.eventing=SEF.eventing||{};SEF.eventing.CustomEvent=SEF.eventing.CustomEvent||CustomEvent;var m=SEF.eventing.EventTarget||EventTarget;const e=Symbol("listener"),h=Symbol("setupInfo");SEF.eventing.EventTarget=class extends m{AddEventListener(...a){return super.addEventListener(...a)}RemoveEventListener(...a){return super.removeEventListener(...a)}DispatchEvent(a){return super.dispatchEvent(a)}DispatchEventAsync(a){setTimeout(a=>
{this.DispatchEvent(a)},0,a);return!0}dispatchEvent(a){return SEF.eventing.EventTarget.prototype.DispatchEvent.bind(this)(a)}};({utils:m}=SEF);const n=new m.Logger("EVENTING"),g=new SEF.eventing.EventTarget;SEF.eventing.Proxies=new WeakMap;m=new class{constructor(){this.map=new Map;return this.Dispatch.bind(this)}Dispatch(a){if(this.map.has(a.type)){const b=this.map.get(a.type);clearTimeout(b.id);a.next=b.event}this.map.set(a.type,{event:a,id:setTimeout(()=>{this.map.delete(a);SEF.DispatchEvent(a)},
0)})}};Object.defineProperties(SEF,{AddEventListener:{value:function(...a){return g.addEventListener(...a)},writable:!1},RemoveEventListener:{value:function(...a){return g.removeEventListener(...a)},writable:!1},DispatchEvent:{value:function(...a){return g.dispatchEvent(...a)},writable:!1},DispatchEventAsync:{value:function(...a){return new Promise((b,c)=>{setTimeout((...a)=>{try{b(g.dispatchEvent(...a))}catch(B){c(B)}},0,...a)})},writable:!1},ConsolidatedAsyncDispatch:{value:m,writable:!1}});SEF.eventing.Actions=
{DEFAULT:"Default",BLOCK:"Block",REDIRECT:"Redirect",ALLOW:"Allow",MODIFY:"ModifyHeaders",ISOLATE:"WebIsolatation",UPGRADE:"UpgradeToSecure",CUSTOM:"CustomAction",ASYNC:"Async",DEFER:"Deferred",ERROR:"Error"};class p{constructor(a){this.future=Promise.resolve(a)}}const q=class extends SEF.eventing.CustomEvent{constructor(a,b={},c={},d="done"){b.hasOwnProperty("detail")||(b.detail={});super(a,b);Object.defineProperty(this,SEF.symbols.EventContext,{value:Object.freeze({id:c.id,tabId:c.tabId,requestId:c.requestId,
frameId:c.frameId,url:c.url}),writable:!1});Object.defineProperty(this,SEF.symbols.CustomAction,{value:[],writable:!1});this.checkpoint=d;this.contextMap=q.contextMap}Process(){if(this.eventPhase!==SEF.eventing.CustomEvent.NONE)throw Error("Cannot process event at this phase");var a=this[SEF.symbols.EventContext];a=`${a.tabId}:${a.requestId}`;this.contextMap.has(a)||this.contextMap.set(a,{[SEF.eventing.WebRequestListener.checkpoint.REQUEST]:new Map,[SEF.eventing.WebRequestListener.checkpoint.RESPONSE]:new Map,
[SEF.eventing.WebRequestListener.checkpoint.DONE]:new Map});this.contextMap.get(a)[this.checkpoint].set(this.target||this[SEF.symbols.Target],this)}Consolidate(a=null){if(this.eventPhase!==SEF.eventing.CustomEvent.NONE)throw Error("Cannot consolidate this event in the current phase");const {checkpoint:b}=this;var c={[l.actionProfiles.SECURE]:a=>{const c={action:SEF.eventing.Actions.ALLOW},d={[`${b}Headers`]:[]},[e,g,h]=[[],[],[]];for(const f of a)switch(f[SEF.symbols.Action]){case SEF.eventing.Actions.BLOCK:case SEF.eventing.Actions.ISOLATE:case SEF.eventing.Actions.REDIRECT:return{action:f[SEF.symbols.Action],
actionData:f[SEF.symbols.ActionData]};case SEF.eventing.Actions.MODIFY:d[`${b}Headers`]=d[`${b}Headers`].concat(f[SEF.symbols.ActionData][`${b}Headers`]);c.action=SEF.eventing.Actions.MODIFY;g.push(f);break;case SEF.eventing.Actions.ASYNC:e.push(f[SEF.symbols.ActionData]);break;case SEF.eventing.Actions.DEFER:h.push(f[SEF.symbols.ActionData])}c.action=0<h.length?SEF.eventing.Actions.DEFER:0<e.length?SEF.eventing.Actions.ASYNC:c.action;c.actionData=0<h.length||0<e.length?Promise.allSettled([...h,...e,
...g]).then(a=>{a.filter(a=>"rejected"===a.status).forEach(a=>{n.error(`Consolidation<secure> Error: ${a}`)});this.Consolidate(a.filter(a=>"fulfilled"===a.status).map(a=>a.value));return this}):c.action===SEF.eventing.Actions.MODIFY?d:{cancel:!1};return c},[l.actionProfiles.PRIORITY]:a=>{const b={action:SEF.eventing.Actions.ALLOW,actionData:{cancel:!1}};let c=0;for(const d of a)({weight:a}=d.target||d[SEF.symbols.Target]),a>c&&(c=a,b.action=d[SEF.symbols.Action],b.actionData=d[SEF.symbols.ActionData]);
return b},[l.actionProfiles.CONSENSUS]:a=>{const [c,d]=[{},{action:SEF.eventing.Actions.ALLOW,actionData:{cancel:!1}}];let [e,g]=[[],[]],h=[];const [f,k,m,l]=[0,1,0,1],q={[`${b}Headers`]:[]};for(const b of a)c.hasOwnProperty(b[SEF.symbols.Action])?(c[b[SEF.symbols.Action]].votes++,c[b[SEF.symbols.Action]].data.push(b[SEF.symbols.ActionData])):c[b[SEF.symbols.Action]]={votes:1,data:[b[SEF.symbols.ActionData]]};h=Object.entries(c).sort((a,b)=>[SEF.eventing.Actions.DEFER,SEF.eventing.Actions.ASYNC].includes(a[m])?
1:b[l].votes-a[l].votes);d.action=h[f][m];c.hasOwnProperty(SEF.eventing.Actions.ASYNC)&&(g=c[SEF.eventing.Actions.ASYNC].data,2===h.length&&h[f][l].votes<h[k][l].votes||2<h.length&&h[f][l].votes-h[k][l].votes<c[SEF.eventing.Actions.ASYNC].votes)&&(d.action=SEF.eventing.Actions.ASYNC);c.hasOwnProperty(SEF.eventing.Actions.DEFER)&&(e=c[SEF.eventing.Actions.DEFER].data,d.action=SEF.eventing.Actions.DEFER);d.actionData=d.action===SEF.eventing.Actions.ASYNC||d.action===SEF.eventing.Actions.DEFER?Promise.allSettled([...e,
...g]).then(b=>{b.filter(a=>"rejected"===a.status).forEach(a=>{n.error(`Consolidation <consensus> Error: ${a}`)});this.Consolidate(a);return this}):d.action===SEF.eventing.Actions.MODIFY?c[SEF.eventing.Actions.MODIFY].data.reduce((a,c)=>{a[`${b}Headers`]=a[`${b}Headers`].concat(c[`${b}Headers`]);return a},q):h[f][l].data[0];return d}};this.actionProfile=SEF.config.Get("actionProfile");if(!a||!Array.isArray(a)){a=null;var d=this[SEF.symbols.EventContext];if(d=this.contextMap.get(`${d.tabId}:${d.requestId}`))this.recommendations=
d[b],a=[...this.recommendations.values()]}a&&(c=c[this.actionProfile](a),this[SEF.symbols.Action]=c.action,this[SEF.symbols.ActionData]=c.actionData,this[SEF.symbols.Incidents]=a.map(a=>a.detail.incidents||[]).flat())}GetAction(){return this[SEF.symbols.Action]}GetActionData(){return this[SEF.symbols.ActionData]}Error(a){this[SEF.symbols.Action]=SEF.eventing.Actions.ERROR;this[SEF.symbols.ActionData]=a}Defer(a){this[SEF.symbols.Return]=a;this[SEF.symbols.Action]=SEF.eventing.Actions.DEFER;this[SEF.symbols.ActionData]=
a.then(a=>{this[SEF.symbols.Return]=a;q.PrepareForDispatch(this);return this}).catch(a=>{this[SEF.symbols.Return]={error:a};q.PrepareForDispatch(this);return this});this.Process()}Async(a){this[SEF.symbols.Action]=SEF.eventing.Actions.ASYNC;this[SEF.symbols.ActionData]=a.then(a=>{this[SEF.symbols.Return]=a;q.PrepareForDispatch(this);return this}).catch(a=>{this[SEF.symbols.Return]={error:a};q.PrepareForDispatch(this);return this})}Block(a=!1){SEF.config.Get("returnSafeLandingPage")&&!0!==a?(this[SEF.symbols.Action]=
SEF.eventing.Actions.REDIRECT,a=`${SEF.context.browserObject.runtime.getURL(SEF.constants.SAFE_LANDING_PAGE)}?url=${this[SEF.symbols.EventContext].url}`,this[SEF.symbols.ActionData]={redirectUrl:a}):(this[SEF.symbols.Action]=SEF.eventing.Actions.BLOCK,this[SEF.symbols.ActionData]={cancel:!0})}Redirect(a){this[SEF.symbols.Action]=SEF.eventing.Actions.REDIRECT;SEF.config.Get("returnSafeLandingPage")&&(a=`${SEF.context.browserObject.runtime.getURL(l.SAFE_LANDING_PAGE)}?url=${this[SEF.symbols.EventContext].url}`);
this[SEF.symbols.ActionData]={redirectUrl:a}}Isolate(a){this[SEF.symbols.Action]=SEF.eventing.Actions.ISOLATE;this[SEF.symbols.ActionData]={isolationUrl:`${a}${this[SEF.symbols.EventContext].url}`}}Allow(){this[SEF.symbols.Action]=SEF.eventing.Actions.ALLOW;this[SEF.symbols.ActionData]={cancel:!1}}CustomAction(a,...b){"function"===typeof a&&this[SEF.symbols.CustomAction].push([a,b])}DoAction(){if(this.eventPhase!==SEF.eventing.CustomEvent.NONE)throw Error("Action not permitted during dispatch");var a=
{[SEF.eventing.Actions.BLOCK]:()=>this[SEF.symbols.ActionData],[SEF.eventing.Actions.ALLOW]:()=>this[SEF.symbols.ActionData],[SEF.eventing.Actions.UPGRADE]:()=>this[SEF.symbols.ActionData],[SEF.eventing.Actions.REDIRECT]:()=>{this[SEF.symbols.EventContext].hasOwnProperty("tabId")&&SEF.context.browserObject.tabs.update(this[SEF.symbols.EventContext].tabId,{url:this[SEF.symbols.ActionData].redirectUrl,active:!0});return{cancel:!0}},[SEF.eventing.Actions.APPLYCSP]:()=>this[SEF.symbols.ActionData],[SEF.eventing.Actions.MODIFY]:()=>
this[SEF.symbols.ActionData],[SEF.eventing.Actions.ASYNC]:()=>this[SEF.symbols.ActionData].then(a=>a.DoAction()),[SEF.eventing.Actions.ISOLATE]:()=>{SEF.context.browserObject.tabs.update(this[SEF.symbols.EventContext].tabId,{url:this[SEF.symbols.ActionData].isolationUrl,active:!0})},[SEF.eventing.Actions.ERROR]:()=>({cancel:!1}),[SEF.eventing.Actions.DEFAULT]:()=>this[SEF.symbols.ActionData],[SEF.eventing.Actions.DEFER]:()=>this[SEF.symbols.ActionData],undefined:()=>{}};0<this[SEF.symbols.CustomAction].length&&
this[SEF.symbols.CustomAction].forEach(([a,b])=>{try{a.bind(this)(...b)}catch(x){n.warn("Custom action failure: "+`<${this.type}>[${JSON.stringify(this[SEF.symbols.EventContext])}]: ${x}`)}});try{const b=this[SEF.symbols.Incidents];if(b)for(const a of b){a.payload=a.payload||{};a.excluded=!1;this.exclusion&&(a.action={cancel:!1},a.excluded=!0);try{SEF.utils.Telemetry.SendTelemetry(a)}catch(x){}}return a[this[SEF.symbols.Action]]()}catch(u){return a=(a=this.target||this[SEF.symbols.Target])?a[SEF.symbols.ModuleName]:
"Unknown",n.error(`DoAction error: target: '${a}' action: '${this[SEF.symbols.Action]}' `+`data: '${this[SEF.symbols.ActionData]}' error: ${u}`),{cancel:!1}}}static PrepareForDispatch(a){const b=a[SEF.symbols.Return];a[SEF.symbols.Action]=SEF.eventing.Actions.DEFAULT;a[SEF.symbols.ActionData]=b;try{if(b){if(b instanceof p)return a.Defer(b.future),b.future;b instanceof Promise||b instanceof SEF.common.Contract?a.Async(b):b.hasOwnProperty("silent")?a.Allow():b.hasOwnProperty("cancel")?!0===b.cancel?
b.hasOwnProperty("suppress")?a.Block(b.suppress):a.Block(!1):!1===b.cancel&&a.Allow():b.hasOwnProperty("requestHeaders")||b.hasOwnProperty("responseHeaders")?a.ModifyHeaders(b):b.hasOwnProperty("redirectUrl")?a.Redirect(b.redirectUrl):b.hasOwnProperty("upgradeToSecure")?b.upgradeToSecure?a.UpgradeToSecure():a.Allow():b.hasOwnProperty("authCredentials")?a.CustomAction(b):b.hasOwnProperty("isolationUrl")?a.Isolate(b.isolationUrl):b.hasOwnProperty("error")&&a.Error(b.error)}}catch(A){let c=a.target||
a[SEF.symbols.Target];c=c?c[SEF.symbols.ModuleName]:"Unknown";n.error(`Action processing error: type: <${a.type}> target: <${c}> `+`capture: <${a[SEF.symbols.Capture]}> result: '<${b}' error: <${A}>`)}return!0}};q.contextMap=new Map;class r extends q{Process(){}Consolidate(){}}m=class{constructor(a,b,c,d,...e){if(!(a instanceof SEF.core.ModuleBase))throw new k.InvalidModuleException;if(!b.hasOwnProperty(c))throw new k.EventNotSupportedException(b,c);if(void 0===b[c].addListener||null===b[c].addListener)throw new k.ListenerInterfaceNotSupportedException(c);
if("function"!==typeof d)throw new k.ObjectNotCallableException;this.propagation=this.cancelable=this.autoStart=!0;this.EventTypeImpl=q;this.eventTarget=a||g;Object.defineProperties(this,{target:{value:b,writable:!1},eventType:{value:c,writable:!1},listener:{value:a=>{if(SEF.exclusions.IsTrustedHost(a.url))return null;const b={type:c,detail:{},stopImmediatePropagation(){this._stopImmediate=!0},stopPropagation(){this._stopPropagation=!0},defer(a){return new p(a)}},e=d.bind(b)(a),g=new this.EventTypeImpl(b.type,
{detail:b.detail,cancelable:this.cancelable,bubbles:!0},a);if(!1===this.propagation||!0===b._stopPropagation)g.stopPropagation(),g.__cancelBubble=!0;!0===b._stopImmediate&&g.stopImmediatePropagation();g[SEF.symbols.Return]=e;g[SEF.symbols.Capture]=c;g[SEF.symbols.Target]=this.eventTarget;a=q.PrepareForDispatch(g);return a instanceof Promise||a instanceof SEF.common.Contract?a.then(()=>this.__doDispatch(g),()=>this.__doDispatch(g)):this.__doDispatch(g)},writable:!0},params:{value:e,writable:!1}});
this.isListening=!1;a[SEF.symbols.Listeners].set(d,this)}static [e](){return!0}__doDispatch(a){this.PreDispatch(a);return!1===a.cancelable?(this.eventTarget.DispatchEventAsync(a),a.DoAction()||a[SEF.symbols.Return]):this.eventTarget.DispatchEvent(a)?a.DoAction()||a[SEF.symbols.Return]:null}PreDispatch(){return this}NoAutoStart(){this.autoStart=!1;return this}Listen(b=null){let c=!1,d=a(this.eventType,this.params);d?0>d.indexOf(this.listener)&&(d.push(this.listener),c=!0):this.target[this.eventType].hasListener(this.listener)||
(this.target[this.eventType].addListener(this.listener,...this.params),c=!0);this.isListening=!0;b&&c&&SEF.ConsolidatedAsyncDispatch(new SEF.eventing.CustomEvent(b,{detail:{proto:this.constructor,self:this,target:this.target,event:this.eventType}}));return this}Stop(b=null){let c=!1,d=a(this.eventType,this.params);if(d){let a=d.indexOf(this.listener);-1<a&&(d.splice(a,1),c=!0)}else this.target[this.eventType].hasListener(this.listener)&&(this.target[this.eventType].removeListener(this.listener),c=
!0);this.isListening=!1;c&&b&&SEF.ConsolidatedAsyncDispatch(new SEF.eventing.CustomEvent(b,{detail:{proto:this.constructor,self:this,target:this.target,event:this.eventType}}));return this}IsListening(){return this.isListening}};Object.defineProperty(SEF,"Propagate",{value(a){a instanceof r?SEF.DispatchEvent(a):SEF.config.Get("actionConsolidation")&&(a.preventDefault(),a.Process())},writable:!1});SEF._initFuture=new SEF.common.Future;SEF._initFuture.promise=SEF._initFuture.promise.then(()=>{const a=
Object.values(SEF.eventing).filter(a=>a[e]?!0:!1);a.forEach(a=>{if(a.Setup){const b=a.Setup();b&&b.target&&b.consolidators&&(Object.keys(b.consolidators).forEach(b=>c(a,b)),a[h]=b,d(a),b.resetTrigger&&SEF.AddEventListener(b.resetTrigger,a=>{d(a.detail.proto)}))}});SEF.AddEventListener("ondisabled",()=>{a.forEach(f)});SEF.AddEventListener("onenabled",()=>{a.forEach(d)})});SEF.OnInitComplete=function(){return this._initFuture.promise};SEF.eventing.EventBase=q;SEF.eventing.UnconsolidatableEvent=r;SEF.eventing.ListenerBase=
m})()})(this);(function(){(function(){class a extends SEF.eventing.EventBase{constructor(b,d,f,k="done"){super(b,d,f);this instanceof a||Object.setPrototypeOf(this,a.prototype);this.checkpoint=k;this.contextMap=a.contextMap}static ClearContext(a){SEF.eventing.WebRequestEvent.contextMap.delete(`${a.tabId}:${a.requestId}`)}ApplyCSP(a){this.ModifyHeaders({[`${this.checkpoint}Headers`]:[{name:"Content-Security-Policy",value:a}]})}UpgradeToSecure(){this[SEF.symbols.Action]=SEF.eventing.Actions.UPGRADE;this[SEF.symbols.ActionData]=
{upgradeToSecure:!0}}ModifyHeaders(a){this[SEF.symbols.Action]=SEF.eventing.Actions.MODIFY;this[SEF.symbols.ActionData]=a;this.checkpoint=a.hasOwnProperty("requestHeaders")?SEF.eventing.WebRequestListener.checkpoint.REQUEST:a.hasOwnProperty("responseHeaders")?SEF.eventing.WebRequestListener.checkpoint.RESPONSE:SEF.eventing.WebRequestListener.checkpoint.DONE}}a.contextMap=new Map;class b extends SEF.eventing.ListenerBase{constructor(c,d,f,...k){super(c,SEF.context.browserObject.webRequest,d,f,...k);
this.EventTypeImpl=a;Object.defineProperty(this,"checkpoint",{value:{onBeforeRequest:b.checkpoint.REQUEST,onBeforeSendHeaders:b.checkpoint.REQUEST,onSendHeaders:b.checkpoint.RESPONSE,onBeforeRedirect:b.checkpoint.REQUEST,onAuthRequired:b.checkpoint.REQUEST,onHeadersReceived:b.checkpoint.RESPONSE,onResponseStarted:b.checkpoint.DONE,onCompleted:b.checkpoint.DONE}[d]||b.checkpoint.DONE,writable:!1})}PreDispatch(a){a.checkpoint=this.checkpoint}Listen(){return super.Listen("addWebRequestListener")}Stop(){return super.Stop("removeWebRequestListener")}static onBeforeSendHeaders(c){return new a(`web${b.checkpoint.REQUEST}`,
{cancelable:!0},c,b.checkpoint.REQUEST)}static onHeadersReceived(c){return new a(`web${b.checkpoint.RESPONSE}`,{cancelable:!0},c,b.checkpoint.RESPONSE)}static onErrorOccurred(b){a.ClearContext(b)}static onCompleted(b){a.ClearContext(b)}static Setup(){SEF.config.AddListener((a,b,f)=>{"actionConsolidation"===a&&!1===f&&SEF.eventing.WebRequestEvent.contextMap.clear()});return{target:SEF.context.browserObject.webRequest,consolidators:{onBeforeSendHeaders:[{urls:["<all_urls>"]},["requestHeaders","blocking"]],
onHeadersReceived:[{urls:["<all_urls>"]},["responseHeaders","blocking"]],onErrorOccurred:[{urls:["<all_urls>"]}],onCompleted:[{urls:["<all_urls>"]}]},resetTrigger:"addWebRequestListener"}}}b.checkpoint={REQUEST:"request",RESPONSE:"response",DONE:"done"};SEF.eventing.WebRequestEvent=a;SEF.eventing.WebRequestListener=b;SEF.eventing.Proxies.set(SEF.context.browserObject.webRequest,SEF.eventing.WebRequestListener)})()})(this);(function(){(function(){const {EventListenerType:a}=SEF.eventing;SEF.eventing.webContent={onScript:new a("onScript"),onPhoneNumber:new a("onPhoneNumber"),...!1};SEF.eventing.webPages={onVisibilityChange:new a("onVisibilityChange"),onMouseEvent:new a("onMouseEvent"),onKeyEvent:new a("onKeyEvent"),onMediaEvent:new a("onMediaEvent")};class b extends SEF.eventing.EventBase{constructor(a,c,k,l){super(a,c,k,l);this.contextMap=b.contextMap;this.port=k.port}Consolidate(...a){super.Consolidate(...a);a=this[SEF.symbols.EventContext];
b.contextMap.delete(`${a.tabId}:${a.requestId}`)}}b.contextMap=new Map;class c extends SEF.eventing.ListenerBase{constructor(a,c,k,...l){super(a,SEF.eventing.webContent,c,k,...l);this.EventTypeImpl=b}Listen(){return super.Listen("addWebContentListener")}static CreateRequestId(){return Infinity===++c.requestId?c.requestId=1:c.requestId}static onScript(a){return new b("webcontent",{cancelable:!0},a)}static onPhoneNumber(a){return new b("webcontent",{cancelable:!0},a)}static Setup(){SEF.bridge.portManager.OnConnect(a=>
{a.OnReceive(function(a){const b={tabId:this.port.sender.tab.id,frameId:this.port.sender.frameId||0,url:this.port.sender.url,requestId:`__webcontent__${c.CreateRequestId()}`,buffer:a.buffer,info:a.info,port:this};switch(a.type){case "script":SEF.eventing.webContent.onScript.emit(b);break;case "phonenumber":SEF.eventing.webContent.onPhoneNumber.emit(b);break;case "visibilitychange":SEF.eventing.webPages.onVisibilityChange.emit(b);break;case "mouseevent":SEF.eventing.webPages.onMouseEvent.emit(b);break;
case "keyevent":SEF.eventing.webPages.onKeyEvent.emit(b);break;case "mediaevent":SEF.eventing.webPages.onMediaEvent.emit(b)}})},"webcontent");return{target:SEF.eventing.webContent,consolidators:{onScript:[],onPhoneNumber:[],...!1},resetTrigger:"addWebContentListener"}}}c.requestId=0;SEF.eventing.WebContentListener=c;SEF.eventing.Proxies.set(SEF.eventing.webContent,SEF.eventing.WebContentListener)})()})(this);(function(){(function(){const {EventListenerType:a}=SEF.eventing;SEF.eventing.reputationResult={onReputationResult:new a("onReputationResult"),...!1};class b extends SEF.eventing.EventBase{constructor(a,c,k,l){super(a,c,k,l);this.contextMap=b.contextMap;this.port=k.port}Consolidate(...a){super.Consolidate(...a);a=this[SEF.symbols.EventContext];b.contextMap.delete(`${a.tabId}:${a.requestId}`)}}b.contextMap=new Map;class c extends SEF.eventing.ListenerBase{constructor(a,c,k,...l){super(a,SEF.eventing.reputationResult,
c,k,...l);this.EventTypeImpl=b}Listen(){return super.Listen("addReputationResultListener")}Stop(){return super.Stop("removeReputationResultListener")}static onReputationResult(a){return new b("reputationresult",{cancelable:!0},a)}static Setup(){return{target:SEF.eventing.reputationResult,consolidators:{onReputationResult:[],...!1},resetTrigger:"addReputationResultListener"}}}SEF.eventing.ReputationResultListener=c;SEF.eventing.Proxies.set(SEF.eventing.reputationResult,SEF.eventing.ReputationResultListener)})()})(this);(function(){function a(a){return{get(a,b){return SEF.eventing.Proxies.has(a)?{addListener(c,...d){return h.Add(this[SEF.symbols.Module],SEF.eventing.Proxies.get(a),b,c,...d)},removeListener(a){return h.Remove(this[SEF.symbols.Module],a)},hasListener(a){return h.Has(this[SEF.symbols.Module],a)},[SEF.symbols.Module]:this.module}:a[b]},module:a}}function b(a,...b){"function"!==typeof a||Object.isFrozen(a)||(a.bind=()=>{throw new SEF.exceptions.RebindingProhibited(...b);},a.call=()=>{throw new SEF.exceptions.RebindingProhibited(...b);
},a.apply=()=>{throw new SEF.exceptions.RebindingProhibited(...b);});return Object.freeze(a)}function c(a){if(null===a||void 0===a)throw Error("Cannot escalate null object");if(a[SEF.symbols.ModuleId]===this[SEF.symbols.ModuleId])throw Error("Cannot escalate self");if(!1===a instanceof SEF.core.ModuleBase)throw Error("Object must be a SEF.ModuleBase");if(!0!==a.Grant(this))throw new SEF.exceptions.OperationNotPermitted;return e.has(a)?Object.assign(Object.create(a),e.get(a),{[SEF.symbols.IsEscalated]:!0}):
a}const d=Symbol("Resolve"),f=Symbol("Reject"),k=Symbol("InitFuture");let l=0;const m=new SEF.utils.Logger("PROLOGUE"),e=new WeakMap;class h{static Add(a,b,c,d,...e){return new b(a,c,d,...e)}static Remove(a,b){a[SEF.symbols.Listeners].has(b)&&a[SEF.symbols.Listeners].get(b).Stop()}static Has(a,b){return a[SEF.symbols.Listeners].has(b)?a[SEF.symbols.Listeners].get(b).IsListening():!1}}SEF.core=SEF.core||{};SEF.utils=SEF.utils||{};class n extends SEF.eventing.EventTarget{constructor(a={}){try{super();
if(new.target===SEF.core.ModuleBase)throw new SEF.exceptions.AbstractClassException("Cannot instantiate SEF.ModuleBase");if(!a.name)throw new SEF.exceptions.ModuleParamMissingException("name");if(!a.version)throw new SEF.exceptions.ModuleParamMissingException("version");a.configurations&&(a.configAccessRoot=SEF.config.Add(this,a.name,a.configurations));a.protected&&e.set(this,a.protected);this[SEF.symbols.ErrorInfo]={};Object.defineProperties(this,{[SEF.symbols.ModuleName]:{writable:!1,value:a.name},
[SEF.symbols.Version]:{writable:!1,value:a.version},[SEF.symbols.ModuleType]:{writable:!1,value:a.type||"soft"},[SEF.symbols.ModulePublicKey]:{writable:!1,value:a.publicKey},[SEF.symbols.ModuleId]:{writable:!1,value:Symbol("ModuleId")},[SEF.symbols.ModuleSequenceId]:{writable:!1,value:l++},[SEF.symbols.Listeners]:{writable:!1,value:new Map},[SEF.symbols.Pollers]:{writable:!1,value:a.pollers&&Array.isArray(a.pollers)?a.pollers.reduce((a,b)=>{try{a.push(new SEF.common.Poller(...b))}catch(E){m.error(`Invalid poller configs. ${E}`)}return a},
[]):[]},[SEF.symbols.ConfigurationServer]:{writable:!0,value:a.configurationServer}});const g=new Promise((a,b)=>{this[d]=a;this[f]=b}),h="hard"===this[SEF.symbols.ModuleType]?null:a=>{let b=`[${this[SEF.symbols.ModuleName]}] Not initialized: ${a}`;m.error(b);SEF.utils.OpState.Malfunctioned(b);this[SEF.symbols.ErrorInfo].error=a;return{[SEF.symbols.Self]:this,error:a}};Object.defineProperty(this,k,{value:g.then(a=>{if(a instanceof Error||void 0===a||null===a||!1===a)throw a instanceof Error?a:Error("[SEF.core.Module] "+
`<${this[SEF.symbols.ModuleName]}> Initialize returned '${a}'.`);return{[SEF.symbols.Self]:this,result:a}}).catch(h),writable:!1});const n=this.Initialize.bind(this);this.Initialize=()=>this[k];let q=()=>null,p=(...a)=>{p=()=>{throw Error(`Multiple init attempts on ${this[SEF.symbols.ModuleName]}`);};try{q=c.bind(this),this[d](n(...a))}catch(D){m.error(`[${this[SEF.symbols.ModuleName]}] Error: ${D}`),this[f](D)}finally{q=()=>null}return this[k]};this.weight=200;Object.defineProperties(this,{Grant:{value:b(this.Grant,
"Grant","ModuleBase"),writable:!1},Escalate:{value:b((...a)=>q.bind(this)(...a),"Escalate","ModuleBase"),writable:!1},[SEF.symbols.Initialize]:{value:(...a)=>p(...a),writable:!1}});Promise.resolve().then(()=>{})}catch(v){throw m.error(`Error while constructing ${a.name} ${v}`),v;}}Grant(){return!1}StartListening(){this[SEF.symbols.Listeners].forEach(a=>a.Listen())}StopListening(){this[SEF.symbols.Listeners].forEach(a=>a.Stop())}StartPolling(){this[SEF.symbols.Pollers].forEach(a=>a.Run())}StopPolling(){this[SEF.symbols.Pollers].forEach(a=>
a.Stop())}Initialize(){return{}}OnInitComplete(){return this[k]}DispatchEvent(a){super.DispatchEvent(a);a.cancelBubble||a.__cancelBubble||SEF.Propagate(a);return!a.defaultPrevented}ApplyConfigs(a,b=null){if(this.hasOwnProperty("config")){SEF.common.JWTVerify(a,this[SEF.symbols.ModulePublicKey]);a=a.payload;var c=a=>{if(!a.hasOwnProperty("filters"))return!0;const b={"no-apply":(a,b)=>b.includes(this.config.Get(a)),apply:(a,b)=>!b.includes(this.config.Get(a))};for(const c of Object.keys(a.filters))if(this.config.Has(c))for(const d of Object.keys(b))if(a.filters[c].hasOwnProperty(d)){const e=
a.filters[c][d];if(Array.isArray(e)&&b[d](c,e))return!1}return!0},d=(a,c)=>b?b.ForceSet(a,c):this.config.hasOwnProperty("IsLocked")&&this.config.IsLocked(a)?null:this.config.Set(a,c);Array.isArray(a)&&a.forEach(a=>{try{c(a)&&a.hasOwnProperty("key")&&Object.keys(a).forEach(c=>{switch(c.toLowerCase()){case "key":case "filters":break;case "value":d(a.key,a[c]);break;case "lock":b&&(!0===a[c]?b.Lock(a.key):b.Unlock(a.key));break;case "hide":b&&(!0===a[c]?b.Hide(a.key):b.Unhide(a.key));break;case "notify":b&&
b.NotifyOnChange(a.key,!0===a[c]);break;default:m.warn(`Unexpected property <${c}> while applying configs`)}})}catch(B){m.error(`Error while applying configs on ${this[SEF.symbols.ModuleName]} : ${B}`)}})}}}class g extends n{constructor(a){super(a);if(SEF.hasOwnProperty(a.name))throw Error(`Module name conflict: ${a.name}`);SEF[a.name]=this}IsModuleDisabled(){return!this.hasOwnProperty("config")||this.hasOwnProperty("config")&&this.config.Get("state")===SEF.constants.moduleStates.DISABLED}IsModuleSilent(){return this.hasOwnProperty("config")&&
this.config.Get("state")===SEF.constants.moduleStates.SILENT}SetModuleState(a){if(!this.hasOwnProperty("config"))return m.error(`There is no config for module ${this[SEF.symbols.ModuleName]}`),!1;this.config.Set("state",a);return!0}}class p extends n{constructor(a){super(a);if(SEF.utils.hasOwnProperty(a.name))throw Error(`Utility name conflict: ${a.name}`);SEF.utils[a.name]=this}}class q extends g{constructor(b){super(b);this.webRequest=new Proxy(SEF.context.browserObject.webRequest,new a(this));
this.webContent=new Proxy(SEF.eventing.webContent,new a(this));this.reputationResult=new Proxy(SEF.eventing.reputationResult,new a(this))}}SEF.core.ModuleBase=n;SEF.core.Module=g;SEF.core.Utility=p;SEF.core.Plugin=q})(this);(function(){(function(){function a(a){if(!a)throw new SEF.exceptions.ValidationError("Invalid init configs");const b=["productName","productVersion","partnerKey"];if(b.reduce((b,c)=>{a.hasOwnProperty(c)&&b++;return b},0)!==b.length)throw new SEF.exceptions.ValidationError("Missing init configs");}const {utils:b}=SEF,c=new b.Logger("EPILOGUE"),{ModuleBase:d}=SEF.core;let f=!1;SEF.Initialize=function(b){SEF.Initialize=()=>SEF._initFuture;a(b);Promise.all(Object.values(SEF).filter(a=>a instanceof d).reduce((a,
c)=>{a.push(c[SEF.symbols.Initialize](b));return a},[])).then(()=>{SEF.Enable();SEF._initFuture.resolve({[SEF.symbols.Self]:SEF});c.info("Module initialization complete.")}).catch(a=>{SEF._initFuture.reject(a);c.error(`Module initialization failed: ${a}`)});return SEF._initFuture.promise};SEF.Enable=()=>{f||(Object.values(SEF).filter(a=>a instanceof d).forEach(a=>{a[SEF.symbols.ErrorInfo].error||(a[SEF.symbols.Listeners].forEach(a=>{!1!==a.autoStart&&a.Listen()}),a[SEF.symbols.Pollers].filter(a=>
a.autoStart).forEach(a=>a.Run()))}),f=!0,SEF.DispatchEvent(new SEF.eventing.CustomEvent("onenabled")))};SEF.Disable=()=>{f&&(Object.values(SEF).filter(a=>a instanceof d).forEach(a=>{a.StopListening();a.StopPolling()}),f=!1,SEF.DispatchEvent(new SEF.eventing.CustomEvent("ondisabled")))};SEF.IsEnabled=()=>f})()})(this);(function(){(function(){const {utils:a}=SEF,b=new a.Logger("STORAGE"),c={browser:null,CreateFlatPromise:()=>{const a={};a.promise=new Promise((b,c)=>{a.resolve=b;a.reject=c});return a},Fulfill:(a,b)=>{const d=c.browser?c.browser.runtime.lastError:"StorageIO.browser not initlaized";d?a.reject(d):a.resolve(b)}};class d{constructor(a){if(!a)throw Error("Invalid storage object");Object.defineProperty(this,"browser",{value:SEF.context.BROWSER,writable:!1});Object.defineProperty(this,"storage",{value:a,
writable:!1});Object.defineProperty(this,"isChrome",{get(){return"Chrome"===this.browser}});Object.defineProperty(this,"isEdge",{get(){return"Edge"===this.browser}});Object.defineProperty(this,"isFirefox",{get(){return"Firefox"===this.browser}});try{if(this.isChrome||this.isEdge)this.storage.getBytesInUse(null,a=>{});else if(!this.isFirefox)throw Error(`Sorage::ManagedStorage Error: Browser '${this.browser}' is not supported.`);}catch(l){throw Error(`Exception while querying storage: ${l}`);}}SafeInvoke(a,
b=[]){try{if(this.isChrome||this.isEdge){const d=c.CreateFlatPromise();b.push((a=null)=>{c.Fulfill(d,a)});a.bind(this.storage)(...b);return d.promise}return a.bind(this.storage)(...b)}catch(m){throw m;}}get(a=null){return this.SafeInvoke(this.storage.get,[a])}}class f extends d{set(a){return this.SafeInvoke(this.storage.set,[a])}clear(){return this.SafeInvoke(this.storage.clear)}remove(a){return this.SafeInvoke(this.storage.remove,[a])}getBytesInUse(a){return this.isFirefox?Promise.reject(Error("getBytesInUse is not supported on Firefox")):
this.SafeInvoke(this.storage.getBytesInUse,[a])}}return new class extends SEF.core.Module{constructor(){super({name:"storage",version:"1.0.0"});c.browser=SEF.context.browserObject;"Edge"!==SEF.context.BROWSER&&(this.managed=new d(c.browser.storage.managed));this.local=new f(c.browser.storage.local);this.sync=new f(c.browser.storage.sync)}Initialize(a){try{return!1===a.storage?Error("storage disabled"):{}}catch(l){throw b.error(`Error while initializing storage: ${l}`),l;}}}})()})(this);(function(){(function(){const {utils:a,common:b}=SEF;new a.Logger("DB");class c{constructor(a){this._fp=new b.Future;this._db=a;this._fp.result=[]}Select(...a){let b={};0===a.length?b=null:1!==a.length||a[0].startsWith("/")?a.forEach(a=>{let [c,d,e]=[b,null,null];if(!a.startsWith("/"))throw Error(`Invalid path <${a}>. Must start with a "/"`);a=a.split("/");a.shift();for(e of a)c.hasOwnProperty(e)||(c[e]={}),d=c,c=c[e];d[e]=-1}):[b]=a;Object.defineProperty(this,"keyOrValue",{value:b,writable:!1});
Object.defineProperty(this,"mode",{value:"readonly",writable:!1});return this}Insert(a){Object.defineProperties(this,{keyOrValue:{value:a,writable:!1},mode:{value:"readwrite",writable:!1},isUpdate:{value:!1,writable:!1}});return this}Update(a){Object.defineProperties(this,{keyOrValue:{value:a,writable:!1},mode:{value:"readwrite",writable:!1},isUpdate:{value:!0,writable:!1}});return this}Clear(a){Object.defineProperties(this,{stores:{value:a,writable:!1},mode:{value:"delete",writable:!1},clear:{value:!0,
writable:!1}});return this}Delete(...a){0<a.length&&Object.defineProperty(this,"keyMatcher",{value:new Set(a),writable:!1});Object.defineProperty(this,"mode",{value:"delete",writable:!1});return this}As(a){Object.defineProperty(this,"keyName",{value:a,writable:!1});return this}From(a){Object.defineProperty(this,"stores",{value:a,writable:!1});return this}Into(a){Object.defineProperty(this,"stores",{value:a,writable:!1});return this}Where(a){Object.defineProperty(this,"index",{value:a,writable:!1});
return this}By(a){Object.defineProperty(this,"index",{value:a,writable:!1});Object.defineProperty(this,"keyRange",{value:null,writable:!1});return this}WherePrimaryKey(){Object.defineProperty(this,"index",{value:null,writable:!1});return this}Equals(a){Object.defineProperty(this,"keyRange",{value:IDBKeyRange.only(a),writable:!1});return this}Between(a,b,c,d){Object.defineProperty(this,"keyRange",{value:IDBKeyRange.bound(a,b,c,d),writable:!1});return this}Are(...a){Object.defineProperty(this,"keyMatcher",
{value:new Set(a),writable:!1});return this}LessThan(a,b){Object.defineProperty(this,"keyRange",{value:IDBKeyRange.upperBound(a,b),writable:!1});return this}GreaterThan(a,b){Object.defineProperty(this,"keyRange",{value:IDBKeyRange.lowerBound(a,b),writable:!1});return this}Matches(a){Object.defineProperty(this,"keyMatcher",{value:new RegExp(a),writable:!1});return this}Order(a){Object.defineProperty(this,"direction",{value:a,writable:!1});return this}Run(a=""){function b(a,c,d=[]){for(const e of Object.keys(c))"object"===
typeof c[e]?d=b(a?a[e]:void 0,c[e],d):d.push(a?a[e]:void 0);return d}function c(a,b){return!a||(a instanceof RegExp?a.test(b.key):a.has(b.key))}this.transactionId=`${this instanceof f?"S":"U"}`+`${(new Date).getTime()}.${Math.floor(1E4*Math.random())}${a?`-${a}`:""}`;if(!this.mode)throw Error(`[TrxId: ${this.transactionId}]: Invalid query: mode is undefined`);a=this.stores?Array.isArray(this.stores)?this.stores:[this.stores]:this._db.objectStoreNames;if(0===a.length)return this._fp.resolve(this._fp.result),
this._fp.promise;const d=this._db.transaction(a,"readonly"===this.mode?"readonly":"readwrite");d.oncomplete=()=>{this._fp.resolve(this._fp.result)};d.onabort=a=>{this._fp.reject(a)};d.onerror=a=>{this._fp.reject(a)};try{for(let e=0;e<a.length;e++){const g=d.objectStore(a[e]);if("readwrite"===this.mode)this.isUpdate?"function"==typeof this.keyOrValue&&this.keyName?g.get(this.keyName).onsuccess=a=>{g.put(this.keyOrValue(a.target.result),this.keyName)}:g.put(this.keyOrValue,this.keyName):g.add(this.keyOrValue,
this.keyName);else if("readonly"===this.mode){const a=this.direction||"next";this.keyOrValue&&"string"==typeof this.keyOrValue&&!this.keyOrValue.startsWith("/")?g.openCursor(this.keyOrValue,a).onsuccess=a=>{if(a=a.target.result)this._fp.result.push({key:a.primaryKey,value:a.value,store:a.source.name}),a.continue()}:(this.index?g.index(this.index):g).openCursor(this.keyRange,a).onsuccess=a=>{if(a=a.target.result)c(this.keyMatcher,a)&&this._fp.result.push({key:a.primaryKey,value:this.keyOrValue?b(a.value,
this.keyOrValue):a.value,store:a.source.objectStore?a.source.objectStore.name:a.source.name}),a.continue()}}else if("delete"===this.mode)this.clear?g.clear():(this.index?g.index(this.index):g).openCursor(this.keyRange).onsuccess=a=>{if(a=a.target.result)c(this.keyMatcher,a)&&a.delete(),a.continue()};else throw Error(`Invalid query mode: <${this.mode}>`);}}catch(g){this._fp.reject(`[TrxId ${this.transactionId}] Failed: ${g}`),d.abort()}return this._fp.promise}}class d extends c{constructor(a){super(null);
this.future=a}Run(...a){return this.future.then(b=>{this._db=b;return super.Run(...a)})}}class f extends c{constructor(a,b,c){super(a);Object.defineProperty(this,"__encrypt",{value:a=>{const d=forge.cipher.createCipher("AES-CBC",forge.util.decode64(KJUR.crypto.Cipher.decrypt(b[1].datakey,KEYUTIL.getKey(b[0],c),"RSAOAEP")));d.start({iv:forge.util.decode64(b[1].iv)});d.update(forge.util.createBuffer(a));if(!d.finish())throw Error("cipher failure");return forge.util.encode64(d.output.getBytes())},writable:!1});
Object.defineProperty(this,"__decrypt",{value:a=>{if(!a||"string"!==typeof a)return a;const d=forge.cipher.createDecipher("AES-CBC",forge.util.decode64(KJUR.crypto.Cipher.decrypt(b[1].datakey,KEYUTIL.getKey(b[0],c),"RSAOAEP")));d.start({iv:forge.util.decode64(b[1].iv)});d.update(forge.util.createBuffer(forge.util.decode64(a)));if(!d.finish())return a;a=d.output.getBytes();try{a=JSON.parse(a)}finally{return a}},writable:!1})}Select(...a){return super.Select(...a.map(a=>this.__encrypt(a)))}Insert(a){return super.Insert(this.__encrypt(JSON.stringify(a)))}Update(a){return super.Update(this.__encrypt(JSON.stringify(a)))}Delete(...a){return super.Delete(...a.map(a=>
this.__encrypt(a)))}As(a){return super.As(this.__encrypt("string"===typeof a?a:JSON.stringify(a)))}Where(){throw Error("Not supported");}Equals(){throw Error("Not supported");}Between(){throw Error("Not supported");}Are(...a){return super.Are(...a.map(a=>this.__encrypt(a)))}LessThan(){throw Error("Not supported");}GreaterThan(){throw Error("Not supported");}Matches(){throw Error("Not supported");}Order(){throw Error("Not supported");}Run(a){this.passcode="";return super.Run(a).then(a=>{"readonly"===
this.mode&&(a=a.map(a=>{a.key=this.__decrypt(a.key);a.value=this.__decrypt(a.value);return a}));return a})}}class k{constructor(a){if(!window.indexedDB)throw Error("IndexedDB not supported");if(!a||"string"!==typeof a)throw Error("Must specify a database name");this.name=a;this.database=null}Open(a={},...c){if(this.database)throw Error("Cannot reopen an active database connection");const d=new b.Future,e=a.version?window.indexedDB.open(this.name,a.version):window.indexedDB.open(this.name);e.onsuccess=
a=>{this.database=a.target.result;this.database.onversionchange=a=>{this.Close();this.Open({},...c)};d.resolve(this)};e.onerror=a=>{d.reject(a.target.error)};e.onupgradeneeded=b=>{const c=b.target.result,{objectStoreNames:d}=c,g={create:a=>{if(a.hasOwnProperty("name")&&!d.contains(a.name)){var b=c.createObjectStore(a.name,a.options);a.hasOwnProperty("indices")&&a.indices.hasOwnProperty("create")&&Array.isArray(a.indices.create)&&a.indices.create.forEach(a=>{b.createIndex(a.name,a.keyPath,a.params)})}},
delete:a=>{d.contains(a)&&c.deleteObjectStore(a)},modify:a=>{const b={create:(a,b)=>{a.createIndex(b.name,b.keyPath,b.params)},delete:(a,b)=>{a.deleteIndex(b)}};a.hasOwnProperty("name")&&d.contains(a.name)&&a.hasOwnProperty("indices")&&["create","delete"].forEach(c=>{if(Array.isArray(a.indices[c])){const d=e.transaction.objectStore(a.name);a.indices[c].forEach(a=>{b[c](d,a)})}})}};["delete","create","modify"].forEach(b=>{Array.isArray(a[b])&&a[b].forEach(a=>g[b](a))})};return d.promise}Close(){this.database&&
(this.database.close(),this.database=null)}Upgrade(a){if(!this.database)throw Error("Database not ready");if(!a||!a.version||this.Version()>=a.version)throw Error(`Schema is invalid or the DB is already at higher version (v${this.Version()})`);this.Close();return this._wait=this.Open(a)}Query(){if(!this.database)throw Error("Database not ready");return new c(this.database)}Delete(){if(!this.database)throw Error("Database not ready");return window.indexedDB.deleteDatabase(this.database.name)}Version(){if(!this.database)throw Error("Database not ready");
return this.database.version}static Query(a){return a instanceof Promise?new d(a):new c(a)}}class l extends k{constructor(a){if(new.target!==l)throw Error("Cannot extend SecureDB");super(a);Object.defineProperty(this,"isSecure",{value:!0,writable:!1})}Open(a={},b,c="default"){const d=()=>{if(!b)throw new SEF.exceptions.DatabaseNotSeededException(this.name);return super.Query().Insert(this._keys=Object.values(KEYUTIL.generateKeypair("RSA",1024)).map(a=>a.isPrivate?KEYUTIL.getPEM(a,"PKCS8PRV",b):{datakey:KJUR.crypto.Cipher.encrypt(forge.util.encode64(forge.random.getBytesSync(32)),
a,"RSAOAEP"),iv:forge.util.encode64(forge.random.getBytesSync(16))})).Into(l.keyStore).As(c).Run("SEED").finally(()=>{const a=[];for(let b=0;b<this.database.objectStoreNames.length;b++)this.database.objectStoreNames[b]!==l.keyStore&&a.push(this.database.objectStoreNames[b]);return super.Query().Clear(a).Run("SCLR")})};a.hasOwnProperty("create")&&Array.isArray(a.create)||(a.create=[]);a.create.push({name:l.keyStore,options:{autoIncrement:!0}});return super.Open(a).then(a=>super.Query().Select(c).From(l.keyStore).Run("SDEF").then(b=>
{b&&void 0!==b[0]&&(this._keys=b[0].value);return this._keys?a:d().then(()=>a)}))}ChangePasscode(a,b,c="default"){if(!this.database)throw Error("Database not ready");return super.Query().Update(c=>{c[0]=KEYUTIL.getPEM(KEYUTIL.getKey(c[0],a),"PKCS8PRV",b);return this._keys=c}).Into(l.keyStore).As(c).Run()}Query(a){if(!this.database)throw Error("Database not ready");return new f(this.database,this._keys,a)}}l.keyStore="__keystore";return new class extends SEF.core.Module{constructor(){super({name:"db",
version:"1.0"});this.DB=k;this.SecureDB=l}Initialize(){if(!window.indexedDB)throw Error(`[${this[SEF.symbols.ModuleName]}]: IndexedDB is not supported on this implementation.`);return{}}}})()})(this);(function(){(function(){const {utils:a,db:b,storage:c}=SEF,d=new a.Logger("CACHE"),f=new WeakMap;SEF.utils.Logger.DisableModules("CACHE");class k{constructor(a,e,h=null){if(!k.instance){var g=function(){k.prototype.Get=(a,b,c)=>l.bind(v(b,c))(a);k.prototype.Has=(a,b,c)=>f.bind(v(b,c))(a);k.prototype.Set=(a,b,c,d)=>p.bind(v(c,d))(a,b);k.prototype.Remove=(a,b,c)=>q.bind(v(b,c))(a);k.prototype.Clear=(a,b)=>n.bind(v(a,b))();k.prototype.SetVolatile=(a,b,c,d)=>p.bind(v(c,d))(a,b,!0);k.prototype.Flush=function(a){return m.bind(v())(a)};
k.prototype.Stage=function(a,b){try{return this.staged[a]=D(b,2),p.bind(v())(a,b,!0)}catch(Q){return{cache:!1,error:Q}}}},f=function(a){return C.bind(this)(this.map.has,[a])},l=function(a){function b(a){a.return&&a.return.hasOwnProperty("_0")&&(a.return=a.return._0);return a}a=C.bind(this)(this.map.get,[a]);return a instanceof Promise?a.then(a=>b(a)):b(a)},m=function(a=""){if(!this.storage)return{return:0,storage:Promise.reject(Error("storage undefined"))};const b={storage:Promise.resolve(null)},
c={};for(const b of Object.keys(this.staged).filter(b=>b.startsWith(a)))c[b]=this.staged[b],delete this.staged[b];b.return=Object.keys(c).length;0<b.return&&(b.storage=this.storage.set(c).then(()=>{Object.keys(c).forEach(a=>{K(this.map.get(a),2)})}));return b},n=function(){const a=C.bind(this)(this.map.clear);this.staged={};a.storage=this.storage?E.bind(this)(this.storage.clear):Promise.reject(Error("storage undefined"));return a},q=function(a){const b=this.map.get(a),c=this.map.has(a)&&G(b,2),d=
C.bind(this)(this.map.delete,[a]);d.storage=G(b,1)?Promise.resolve("Volatile"):this.storage?E.bind(this)(this.storage.remove,[a]):Promise.reject(Error("storage undefined"));this.staged.hasOwnProperty(a)&&(delete this.staged[a],d.staged=!0);d.return=c;return d},p=function(a,b,c=!1,d={}){var e=this.map.has(a),g=(e?this.map.get(a)._f:0)|(c?0:8);b=D(b,g);c?K(b,1):L(b,1);d.set&&K(b,d.set);d.unset&&L(b,d.unset);e=!e||2!==(g&2);d=!c&&e;c&&e||K(b,2);({size:e}=this.map);g=C.bind(this)(this.map.set,[a,b]);
L(b,8);g.return=c?1===this.map.size-e?!0:!1:d;g.storage=c?Promise.resolve(null):this.storage?E.bind(this)(this.storage.set,[{[a]:b}]):Promise.reject(Error("storage undefined"));g.storage.then(()=>{this.map.has(a)&&L(this.map.get(a),8)}).catch(b=>{this.map.has(a)&&K(this.map.get(a),4)});return g},D=function(a,b=0){return{_0:a,_f:0|b,_t:(new Date).getTime()}},E=function(b,c=[]){try{if(!this.storage)throw Error("storage is undefined");const d=b.bind(this.storage)(...c);d.then(()=>{}).catch(d=>{const e=
`Store failure: ${b.name}(${JSON.stringify(c)}). (${d.message})`;a.push(e);J.bind(this)(d)});return d}catch(Q){return J.bind(this)(Q),Promise.reject(Q)}},C=function(a,b=[]){const c={cache:!0};try{c.return=a.bind(this.map)(...b)}catch(U){c.cache=!1,c.error=U}return c},G=function(a,b){return a?(a._f&b)===b:!1},L=function(a,b){"object"==typeof a&&(a._f&=~b)},K=function(a,b){"object"==typeof a&&(a._f|=b)},J=function(a){setTimeout(a=>{try{for(const b of this.onError.entries())b[0](a)}catch(Q){d.error(`notifyError handler error: ${Q}`)}},
0,a)};const a=[];this.onSuccess=new Set;this.onError=new Set;this.staged={};this.quotaExceeded=!1;Object.defineProperty(this,"syncErrors",{get(){return a},set(){return null}});const r={set(a){return Promise.all(Object.entries(a).reduce((a,b)=>{a.push(this.database.Query(this.getPasscode()).Update(b[1]).Into(this.store).As(b[0]).Run("CI"));return a},[]))},remove(a){return Array.isArray(a)?this.database.Query(this.getPasscode()).Delete(...a).From(this.store).Run("CI"):this.database.Query(this.getPasscode()).Delete(a).From(this.store).Run("CI")},
clear(){return this.database.Query(this.getPasscode()).Clear(this.store).Run("CI")},bind(a,b,c){if(a)return r.database=a,r.store=b,r.getPasscode=()=>{r.getPasscode=()=>null;return c},r}},v=(a,b)=>{const c=this.dbmaps[b?"sefsm.sdb":"sefsm.db"][a];b&&c.setPasscode(b);return a?{map:c,storage:r.bind(b?this.securedb:this.db,a,b),staged:{}}:this};k.prototype.GetCacheMapByContext=function(a,b,c){return"db"===a?this.dbmaps?this.dbmaps[c?"sefsm.sdb":"sefsm.db"][b]:void 0:this.map};this._initFutureUpg=this._initFutureRoot=
this._initFuture=Promise.all([c.OnInitComplete(),b.OnInitComplete()]).then(([a,b])=>{if(a[SEF.symbols.Self]||b[SEF.symbols.Self])a[SEF.symbols.Self]?b[SEF.symbols.Self]||d.warn("IndexedDB init has failed. All IDB backed stores will fallback to "+`'volatile storage only'. error: ${a.error}`):d.warn("Storage init has failed. All storage backed stores will fallback to "+`'volatile storage only'. error: ${a.error}`);else throw Error(`Null Storage: storeErr: [${a.error}], DBErr: [${b.error}]`);var c=[];
a[SEF.symbols.Self]&&(this.storage=k.syncStore?a[SEF.symbols.Self].sync:a[SEF.symbols.Self].local,c.push(this.storage.get().then(a=>{this.map=new Map(this._process(a));p.bind(this)("__SyncManagerInit0__",(new Date).getTime());q.bind(this)("__SyncManagerInit0__");return{storage:!0}}).catch(a=>({storage:!1}))));if(b[SEF.symbols.Self]){this.db=new b[SEF.symbols.Self].DB("sefsm.db");this.securedb=new b[SEF.symbols.Self].SecureDB("sefsm.sdb");const g={["sefsm.db"]:{},["sefsm.sdb"]:{}};a=[this.db,this.securedb].reduce((a,
b)=>{a.push(b.Open({},h,e).then(a=>a.Query().Select().Where("_t").Run("DB").then(a=>a).catch(b=>{d.error(`Query by index failed: ${b}. Attempting non indexed query`);return a.Query().Select().Run("DB2")}).then(b=>{for(const b of a.database.objectStoreNames)g[a.name][b]=a.isSecure?new SecureDBMapFacade(a,b):new Map;b.forEach(b=>{g[a.name][b.store].set(b.key,b.value)});return{[a.name]:!0}})).catch(a=>({[b.name]:!1})));return a},[]);Promise.all(a).finally(()=>{this.dbmaps=g});c=c.concat(a)}c=Promise.all(c).then(a=>
{g.bind(this)();return a.reduce((a,b)=>Object.assign(a,b),{self:this})});c.catch(a=>{d.error(`Storage fulfillments failed: ${a}`)});return c}).catch(a=>{d.error(`Backing store failure (${a}). Falling back to 'volatile storage only' mode.`);g.bind(this)();return{self:this,error:a}}).finally(()=>{this.map=this.map||new Map;this.dbmaps=this.dbmaps||{["sefsm.db"]:{},["sefsm.sdb"]:{}}});k.prototype.Get=function(a,b,c){return this._initFuture.then(()=>l.bind(v(b,c))(a))};k.prototype.Has=function(a,b,c){return this._initFuture.then(()=>
f.bind(v(b,c))(a))};k.prototype.Set=function(a,b,c,d){return this._initFuture.then(()=>p.bind(v(c,d))(a,b))};k.prototype.SetVolatile=function(a,b,c,d){return this._initFuture.then(()=>p.bind(v(c,d))(a,b,!0))};k.prototype.Remove=function(a,b,c){return this._initFuture.then(()=>q.bind(v(b,c))(a))};k.prototype.Clear=function(a,b){return this._initFuture.then(()=>n.bind(v(a,b))())};k.prototype.Flush=function(a){return this._initFuture.then(()=>m.bind(v())(a))};k.prototype.Stage=function(a,b){const c=
this._initFuture.then(()=>p.bind(v())(a,b,!0));this.staged[a]=D(b,2);return c};Object.defineProperty(k,"instance",{value:this,writable:!1});Object.defineProperty(k.instance,"storeCreationRequestQueue",{value:[],writable:!1})}if("db"===a){const a=(a,b)=>{const c=b?"sefsm.sdb":"sefsm.db",{instance:d}=k;let e=d._initFutureRoot;d.dbmaps[c].hasOwnProperty(a)||(d.dbmaps[c][a]=b?new SecureDBMapFacade:new Map,d.storeCreationRequestQueue.push({isSecure:b,name:a}),e=d._initFutureRoot.then(a=>{if(0<d.storeCreationRequestQueue.length){const [b,
c]=[{create:[]},{create:[]}];d.storeCreationRequestQueue.forEach(a=>{(a.isSecure?c:b).create.push({name:a.name,indices:{create:[{name:"_t",keyPath:"_t"},{name:"_f",keyPath:"_f"}]}})});d.storeCreationRequestQueue.length=0;d._initFutureUpg=Promise.all([{schema:b,db:d.db},{schema:c,db:d.securedb}].reduce((a,b)=>{0<b.schema.create.length&&b.db&&(b.schema.version=b.db.Version()+1,a.push(b.db.Upgrade(b.schema)));return a},[])).then(()=>a)}return d._initFutureUpg}));return e};k.instance._initFuture=k.instance.dbmaps?
a(e,null!==h):k.instance._initFutureRoot.then(()=>a(e,null!==h))}return k.instance}OnInitComplete(){return this._initFuture}SyncErrors(){return this.syncErrors}AddStorageNotifiers(a,b){"function"===typeof a&&this.onSuccess.add(a);"function"===typeof b&&this.onError.add(b)}RemoveStorageNotifiers(a,b){a&&this.onSuccess.delete(a);b&&this.onError.delete(b)}_process(a){return Object.keys(a).sort((b,c)=>a[b].hasOwnProperty("_t")&&a[c].hasOwnProperty("_t")?a[b]._t-a[c]._t:-1).map(b=>[b,a[b]])}}k.syncStore=
!1;class l extends k{constructor(a,b,c,d=null){if(!a||!c||!b)throw Error("Invalid params to NamespacedSyncManager constructor");super(b,c,d);if(!l._initFuture){l.properties={};const b=super.OnInitComplete().then(()=>{var b=this.map.keys();for(let c of b){const [d,e,g,h]=c.split(".",4);d===a&&e&&g&&h&&({properties:b}=l,b.hasOwnProperty(e)||(b[e]={}),b[e].hasOwnProperty(g)||(b[e][g]={size:0,staged:0,__size:0}),b[e][g].size++,b[e][g].__size++)}return{self:this}});l.Clear=()=>{const a=super.Clear();Object.keys(l.properties).forEach(a=>
{Object.keys(l.properties[a]).forEach(b=>{l.properties[a][b].size=0;l.properties[a][b].__size=0;l.properties[a][b].staged=0})});return a};l.Flush=()=>{function a(a){const {properties:b}=l;if(a.return&&0<a.return)for(const a of Object.keys(b))for(const c of Object.keys(b[a]))0<b[a][c].staged&&(b[a][c].size+=b[a][c].staged,b[a][c].staged=0)}const b=super.Flush();b instanceof Promise?b.then(b=>{a(b)}):a(b);return b};Object.defineProperty(l,"_initFuture",{value:b,writable:!1})}l.properties.hasOwnProperty(b)||
(l.properties[b]={});l.properties[b].hasOwnProperty(c)||(l.properties[b][c]={size:0,staged:0,__size:0});const e=Object.create(this);e.isIDBBacked="db"===b;e.prefix=e.isIDBBacked?"":`${a}.${b}.${c}.`;e.dbStoreName=e.isIDBBacked?c:null;e.basename=a;e.storetype=b;e.storename=c;f.set(e,d);super.OnInitComplete().then(()=>{e.cacheMap=this.GetCacheMapByContext(e.storetype,e.storename,f.get(e));e.cacheMapIterator=e.cacheMap.entries();Object.defineProperty(e,"NextByInsertionOrder",{value(){let a;if(0<this.Size())for(let b=
0;b<this.cacheMap.size;b++)if((a=this.cacheMapIterator.next()).done&&(a=(this.cacheMapIterator=this.cacheMap.entries()).next()),a.value&&a.value[0].startsWith(this.prefix))return a.value[0].replace(this.prefix,"");return null}});Object.defineProperty(e,"BuildOrderedList",{value(a){return 0<this.Size()?[...this.cacheMap.entries()].filter(a=>a[0].startsWith(this.prefix)).sort((b,c)=>a([b[0].replace(this.prefix,""),b[1]._0._1],[c[0].replace(this.prefix,""),c[1]._0._1])).map(a=>a[0].replace(this.prefix,
"")):[]}})});return e}*Keys(){const a=this.GetCacheMapByContext(this.storetype,this.storename,f.get(this)).entries();let b;for(;!(b=a.next()).done;)b.value&&b.value[0].startsWith(this.prefix)&&(yield b.value[0])}GetCurrentStore(){return l.properties[this.storetype][this.storename]}Has(a){return super.Has(this.prefix+a,this.dbStoreName,f.get(this))}Get(a){function b(a){a.return&&a.return.hasOwnProperty("_1")&&(a.return=a.return._1);return a}a=super.Get(this.prefix+a,this.dbStoreName,f.get(this));return a instanceof
Promise?a.then(a=>b(a)):b(a)}SetVolatile(a,b){b={_1:b};return super.SetVolatile(this.prefix+a,b,this.dbStoreName,f.get(this))}Flush(){function a(a){a.storage.catch(()=>null);const b=this.GetCurrentStore();a.return&&0<a.return&&(a.storage.then(()=>{b.__size+=a.return}).catch(()=>null),b.size+=b.staged,b.staged=0)}if(this.isIDBBacked)throw Error("Not supported on IDB backed stores");const b=super.Flush(this.prefix);b instanceof Promise?b.then(b=>{a.bind(this)(b)}):a.bind(this)(b);return b}Set(a,b){function c(a){const b=
this.GetCurrentStore();a.storage.catch(()=>null);!0===a.cache&&!0===a.return&&(b.size++,a.storage.then(()=>{b.__size++}).catch(()=>null))}b={_1:b};a=super.Set(this.prefix+a,b,this.dbStoreName,f.get(this));this.isIDBBacked||(a instanceof Promise?a.then(a=>{c.bind(this)(a)}):c.bind(this)(a));return a}Stage(a,b){function c(a){a.storage.then(()=>null);!0===a.cache&&!0===a.return&&d[this.storetype][this.storename].staged++}if(this.isIDBBacked)throw Error("Not supported on IDB backed stores");const {properties:d}=
l;b={_1:b};a=super.Stage(this.prefix+a,b);a instanceof Promise?a.then(a=>{c.bind(this)(a)}):c.bind(this)(a);return a}Remove(a){function b(a){const b=this.GetCurrentStore();a.storage.catch(()=>null);!0===a.cache&&(!0===a.return&&(b.size--,a.storage.then(()=>{b.__size--})),!0===a.staged&&b.staged--)}a=super.Remove(this.prefix+a,this.dbStoreName,f.get(this));this.isIDBBacked||(a instanceof Promise?a.then(a=>{b.bind(this)(a)}):b.bind(this)(a));return a}Clear(){if(!this.cacheMap)return!1;if(this.isIDBBacked)super.Clear(this.dbStoreName,
f.get(this));else{const a=this.GetCurrentStore();for(const b of this.cacheMap.keys()){if(!b.startsWith(this.prefix))continue;const c=super.Remove(b);!0===c.cache&&(!0===c.return&&(a.size--,c.storage.then(()=>{a.__size--})),!0===c.staged&&a.staged--);c.storage.catch(()=>null)}}return!0}Size(){const {properties:a}=l;return!this.isIDBBacked&&a.hasOwnProperty(this.storetype)&&a[this.storetype].hasOwnProperty(this.storename)?a[this.storetype][this.storename].size:this.cacheMap?this.cacheMap.size:null}static OnInitComplete(){return l._initFuture}OnInitComplete(){return Promise.all([l.OnInitComplete(),
super.OnInitComplete()])}}class m{constructor(a,b,c=!0){if("function"!==typeof b)throw Error("comparator must be callable");this.rebuildOnWrap=c;Object.defineProperty(this,"name",{value:a,writable:!1});Object.defineProperty(this,"comparator",{value:b,writable:!1})}rebuild(){this.__iterable=this.store.BuildOrderedList(this.comparator);return this.__iterator=this.__iterable[Symbol.iterator]()}bind(a){if(!(a instanceof l))throw Error("Must be a NamespacedSyncManager object to bind");this.close();this.store=
a;return this}next(){let a;this.__iterator||this.rebuild();a=this.__iterator.next();a.done&&(a=(this.rebuildOnWrap?this.rebuild():this.__iterator=this.__iterable[Symbol.iterator]()).next());return a.value}close(){this.store=this.__iterable=this.__iterator=null}}class e{constructor(a){Object.defineProperty(this,"Create",{value:a,writable:!1})}}class h{constructor(a,b,c="cache",d=null){this.store=new l("SEFWeb",c,a,d);this.storeName=a;this.storeType=c;this.maxEntries=b;let g=null;Object.defineProperty(this,
"policy",{get(){return g},set(a){if(null!==a&&!(a instanceof e))throw Error(`Invalid policy <${typeof a}>`);g&&g.close();g=a?a.Create(this.store):null}});this._initFuture=l.OnInitComplete().then(()=>({self:this}))}__NotifyPolicy(a,...b){if(this.policy&&this.policy.onActivity)try{this.policy.onActivity(a,...b)}catch(q){}}OnInitComplete(){return Promise.all([this._initFuture,this.store.OnInitComplete()]).then(()=>({self:this}))}Keys(){return this.store.Keys()}Size(){return this.store.Size()}Insert(a,
b,c=null){function d(){try{const a=this.policy.next();return void 0===a||!1===h.prototype.Remove.bind(this)(a)?!1:!0}catch(v){return!1}}if(!this.store.Has(a).return){const a=h.prototype.Size.bind(this)();if(this.maxEntries&&a===this.maxEntries&&this.policy){if(!d.bind(this)())return!1}else if(this.store.quotaExceeded){if(!this.policy)return!1;d.bind(this)()}else if(this.maxEntries&&a>=this.maxEntries)return!1}b=this.store.Set(a,{_v:b,_x:c?(new Date).getTime()+1E3*c:null});h.prototype.__NotifyPolicy.bind(this)("insert",
a,null);return b instanceof Promise?b:b.cache}InsertVolatile(a,b,c=null){a=this.store.SetVolatile(a,{_v:b,_x:c?(new Date).getTime()+1E3*c:null});return a instanceof Promise?a:a.cache}Remove(a){const b=this.store.Remove(a);h.prototype.__NotifyPolicy.bind(this)("remove",a);return b instanceof Promise?null:b.cache?b.return:!1}Get(a){a=h.prototype.GetEx.bind(this)(a);return a instanceof Promise?null:a}GetEx(a){function b(b){return!0===b.cache&&b.return?b.return._x&&b.return._x<(new Date).getTime()?(h.prototype.Remove.bind(this)(a),
null):b.return._v:null}const c=this.store.Get(a);h.prototype.__NotifyPolicy.bind(this)("get",a);return c instanceof Promise?c.then(a=>b.bind(this)(a)):b.bind(this)(c)}Clear(){h.prototype.__NotifyPolicy.bind(this)("clear");return this.store.Clear()}Has(a){return null===h.prototype.Get.bind(this)(a)?!1:!0}}const n={None:new e(()=>null),FIFO:new e(a=>{const b=new m("FIFO",()=>null);b.next=function(){return this.store.NextByInsertionOrder()};return a?b.bind(a):b}),ImminentExpiry:new e(a=>{const b=new m("OIE",
(a,b)=>a[1].hasOwnProperty("_x")&&b[1].hasOwnProperty("_x")?a[1]._x-b[1]._x:-1);return a?b.bind(a):b}),LeastRecentlyUsed:new e(a=>{let b=new m("LRU",()=>0);b.rebuild=function(){this.__iterable=new Set(this.store.BuildOrderedList(this.comparator))};b.next=function(){this.__iterable||this.rebuild();return this.__iterable.values().next().value};b.onActivity=function(a,...b){if(this.__iterable)switch(a){case "get":case "insert":this.__iterable.delete(b[0]);this.__iterable.add(b[0]);break;case "remove":this.__iterable.delete(b[0]);
break;case "clear":this.__iterable=null}};a&&(b=b.bind(a),b.rebuild());return b}),LeastFrequentlyUsed:new e(()=>null)};h.Policy=Object.freeze(n);return new class extends SEF.core.Module{constructor(){super({name:"cache",version:"1.0"});this.Cache=h;this.NamespacedSyncManager=l;this.SyncManager=k}}})()})(this);(function(){(function(){const {exceptions:a,utils:b,constants:c,common:d}=SEF,{isNil:f,isntNil:k,Contract:l}=d,m=new b.Logger("CONFIG"),e=new WeakMap,h=new WeakMap,n=new WeakMap,{StopIteration:g}=a,p=new Map([["SEF",new SEF.cache.Cache("Config.SEF",null,"db")]]);class q{constructor(a,b=null,c,d={},e="SEF"){if(f(a))throw Error("Cannot create a PropertyValue with null value");if(c&&!Array.isArray(c))throw Error(`Invalid accessor type <${typeof accessor}>. Must be an array`);let h=a;a=typeof h;this._accessors=
c?c:[];this._locked=d.hasOwnProperty("locked")?d.locked:!1;this._hidden=d.hasOwnProperty("hidden")?d.hidden:!1;this._notify=d.hasOwnProperty("notify")?d.notify:!0;Object.defineProperty(this,"label",{value:b,writable:!1});Object.defineProperty(this,"type",{value:a,writable:!1});Object.defineProperty(this,"parent",{value:e,writable:!1});Object.defineProperty(this,"value",{get(){let a=h;try{return this._accessors.forEach(c=>{a=c.get.bind(this)(a,b)}),k(a)?a:h}catch(J){return J instanceof g?k(J.value)?
J.value:h:h}},set(a){if(this._locked)throw Error(`Cannot modify a locked PropertyValue <${this.label}>`);let c=a;try{this._accessors.forEach(a=>{c=a.set.bind(this)(c,b)}),k(c)&&(h=c)}catch(M){M instanceof g&&k(M.value)&&(h=M.value)}}})}AddAccessor(a,b,c=[]){return this._accessors&&q.Accessors.hasOwnProperty(a)?(a=q.Accessors[a],this._accessors.splice(b,0,"function"==typeof a?a(...c):a),!0):!1}DropAccessor(a){if(this._accessors){const b=this._accessors.findIndex(b=>b.__id__===a);if(0<=b)return this._accessors.splice(b,
1),!0}return!1}Lock(){return this._locked=!0}Unlock(){this._locked=!1;return!this._locked}Hide(){return this._hidden=!0}Unhide(){this._hidden=!1;return!this._hidden}SetNotify(a){this._notify="boolean"==typeof a&&!0===a?!0:!1;return this._notify===a}static CreateAccessor(a,b=null,c={get(){return null},set(){return null}}){Object.defineProperty(q.Accessors,a,{value:"function"==typeof b?(...d)=>Object.assign(Object.create(c),b(...d),{__id__:a}):Object.assign(Object.create(c),b,{__id__:a}),enumerable:!0});
return a}}q.Accessors={};q.CreateAccessor("persist",{get(a,b){return p.get(this.parent).Get(b).value},set(a,b){p.get(this.parent).Insert(b,{value:a,lock:this._locked,hide:this._hide,notify:this._notify});return a}});q.CreateAccessor("asyncAndPersistent",{get(a,b){b=p.get(this.parent).GetEx(b);return b instanceof Promise?b.then(b=>b&&null!==b.value?b.value:a):b.value}},q.Accessors.persist);q.CreateAccessor("validate",a=>({get(a){return a},set(b){if(!Object.values(a).includes(b))throw new g(null);return b},
args(){return a}}));q.CreateAccessor("firefox",{get(a){return"Firefox"===SEF.context.BROWSER?a:!1},set(a){return a}});q.CreateAccessor("bounded",(a,b)=>({get(a){return a},set(c){if(c<a||c>b)throw g(null);return c},args(){return[a,b]}}));var r=class extends d.JSScope{OverrideLock(){(this.isLockedSetting=this.args[0]._locked)&&this.args[0].Unlock()}["~OverrideLock"](){this.isLockedSetting&&this.args[0].Lock()}};const v=a=>class extends d.MakePrototype(a){constructor(a,...b){super(...b);n.has(a)||n.set(a,
new Set);Object.defineProperty(this,"module",{value:a,writable:!1});Object.defineProperty(this,"listeners",{get(){return n.get(a)},set(){return null}})}Get(a){if(e.get(this.module).hasOwnProperty(a))return e.get(this.module)[a].value;m.error(`[SEF.Web Error]: Config::Get: Cannot 'Get' non existing property: ${a}`);return null}Set(a,b){if(e.get(this.module).hasOwnProperty(a)){if(typeof b===e.get(this.module)[a].type){if("number"==typeof b&&isNaN(b))return m.error("[SEF.Web Error]: Config::Set: Cannot set property to NaN"),
!1;const c=e.get(this.module)[a].value;e.get(this.module)[a].value=b;this.listeners.forEach(d=>{setTimeout((b,c)=>{const e=this.Set;try{this.Set=()=>{throw Error("Action is prohibited in this context");},d(a,b,c)}finally{this.Set=e}},0,c,b)});return!0}m.error(`[SEF.Web Error]: config::Set: Unexpected type <${typeof b}> for property `+`'${a}' of type <${typeof e.get(this.module)[a].value}>`)}else m.error(`[SEF.Web Error]: config::Set: Property does not exist: ${a}`);return!1}Keys(){return Object.keys(e.get(this.module)).filter(a=>
!1===e.get(this.module)[a]._hidden)}Has(a){return e.get(this.module).hasOwnProperty(a)}IsLocked(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a]._locked:null}IsHidden(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a]._hidden:null}IsNotifying(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a]._notify:null}AddListener(a){return"function"==typeof a?(this.listeners.add(a),!0):!1}RemoveListener(a){return this.listeners.delete(a)}HasListener(a){return this.listeners.has(a)}Reset(){p.get(this.module[SEF.symbols.ModuleName]).Clear()}},
u=v();class A extends u{AddAccessor(a,b,c,d=[]){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].AddAccessor(b,c,d):!1}DropAccessor(a,b){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].DropAccessor(b):!1}Lock(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].Lock():null}Unlock(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].Unlock():null}Hide(a){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].Hide():null}Unhide(a){return e.get(this.module).hasOwnProperty(a)?
e.get(this.module)[a].Unhide():null}NotifyOnChange(a,b){return e.get(this.module).hasOwnProperty(a)?e.get(this.module)[a].SetNotify(b):null}GetPropertyInfo(a){return(a=e.get(this.module)[a])?{accessors:a._accessors.map(a=>({id:a.__id__,args:a.hasOwnProperty("args")?a.args():void 0})),locked:a._locked,hidden:a._hidden,notify:a._notify,type:a._type}:null}ForceSet(a,b){if(!e.get(this.module).hasOwnProperty(a))return!1;let c=null;new r(()=>{c=this.Set(a,b)},e.get(this.module)[a]);return c}}var x=q.Accessors;
x={allowTelemetry:new q(!0,"allowTelemetry",[x.persist]),returnSafeLandingPage:new q(!0,"returnSafeLandingPage",[x.persist]),actionConsolidation:new q(!0,"actionConsolidation",[x.persist]),productName:new q("None",null),productVersion:new q("0.0.0.0",null),machineID:new q("00000000-0000-0000-0000-000000000000",null),sourceID:new q("",null),partnerKey:new q("",null),watchdogFrequency:new q(c.POLL_FREQUENCY.MAX,"watchdogFrequency",[x.bounded(c.POLL_FREQUENCY.MIN-1,c.POLL_FREQUENCY.MAX),x.persist]),
actionProfile:new q(c.actionProfiles.SECURE,"actionProfile",[x.validate(c.actionProfiles),x.persist]),networkUsage:new q(c.networkUsage.UNLIMITED,"networkUsage",[x.validate(c.networkUsage),x.persist]),nativeConnectRetry:new q(c.NATIVE_MESSAGING_APP_CONNECT_RETRY_DEFAULT,"nativeConnectRetry",[x.persist]),nativeMessasingAppId:new q(c.NATIVE_MESSAGING_APP_ID,"nativeMessasingAppId",[x.persist]),pulseFrequency:new q(c.PULSE_FREQUENCY,"pulseFrequency",[x.persist]),syncFrequency:new q(c.SYNC_FREQUENCY,"syncFrequency",
[x.persist]),httpHeaderNameSourceId:new q(c.HTTP_HEADER_NAME_SOURCE_ID,"httpHeaderNameSourceId",[x.persist]),...!1};const B={[SEF.symbols.ModuleName]:"SEF"};e.set(B,x);h.set(SEF,new A(B));return new (class extends v(SEF.core.Module){constructor(a,...b){super(a,...b);this.Accessors=q.Accessors}CreateAccessor(a,...b){q.CreateAccessor(a,...b);return this.Accessors[a]}Initialize(a={}){return Object.keys(a).every(b=>this.Has(b)?this.Set(b,a[b]):!0)?{}:Error("Invalid configurations")}Grant(a){return"config"===
this[SEF.symbols.ModuleName]&&a[SEF.symbols.ModuleId]===SEF.policyOrchestrator[SEF.symbols.ModuleId]}Add(a,b,c){if(!c||!Array.isArray(c)||p.has(a))return null;p.set(b,new SEF.cache.Cache(`Config.${b}`,null,"db"));e.set(a,c.reduce((c,d)=>{c[d.key]=new q(d.value,d.key,d.accessors?d.accessors.reduce((b,c)=>{c="string"===typeof c?c:c.hasOwnProperty("__id__")?c.__id__:q.CreateAccessor(`${a[SEF.symbols.ModuleName]}::${d.key}`,c);this.Accessors.hasOwnProperty(c)&&b.push(this.Accessors[c]);return b},[]):
[],d.options,b);return c},{}));Object.defineProperty(a,"config",{value:new u(a),writable:!1});c=new A(a);h.set(a,c);return c}})(B,{name:"config",type:"hard",protected:{GetConfigAccessRoot(a){return h.get(a)}},pollers:[[function(){Object.values(SEF).filter(a=>a instanceof SEF.core.ModuleBase).forEach(a=>{a[SEF.symbols.ConfigurationServer]&&a[SEF.symbols.ModulePublicKey]&&(new l((b,c)=>{fetch(a[SEF.symbols.ConfigurationServer],{method:"GET"}).then(b=>{if(b.ok)return b.json();throw Error("Error while fetching remote configs. ModuleName: "+
`${a[SEF.symbols.ModuleName]}. ConfigurationServer: `+`${a[SEF.symbols.ConfigurationServer]}. Response: ${b.status}`);}).then(c=>{d.JWTVerify(c,a[SEF.symbols.ModulePublicKey]);b(c)}).catch(c)},{expiry:c.WEBCONF_RESPONSE_TIMEOUT})).then(b=>{a.ApplyConfigs(b,h.get(a))}).catch(b=>{m.error(`[RemoteConfigsError][${a[SEF.symbols.ModuleName]}]: ${b}`)})})},()=>SEF.config.Get("watchdogFrequency"),null,{name:"watchdog",delayedStart:!1}]],version:"1.0.0"})})()})(this);(function(){(function(){const {common:a,utils:b,constants:c}=SEF,d=new b.Logger("BRIDGE"),{Future:f}=a;class k{constructor(a,b=3){this.port=a;this.id=a.sender?`${a.sender.tab.id}:${a.sender.frameId}`:a.name;this.name=a.name;this.type=b;this.receivers=new Set;this.groups=new Set([this]);this.port.onDisconnect.addListener(()=>{this.receivers.clear();this.port.onMessage.removeListener(this._Receive);this.disconnected=!0})}_Receive(a){function b(a,b){try{a.bind(this)(b)}catch(p){d.error(`Port receiver ${this.id}, error: ${p}, message: ${b}`)}}
this.groups.forEach(c=>{c.receivers.forEach(c=>{b.bind(this)(c,a)})})}_RemoveListenerIfNoSubscribers(){0===this.receivers.size&&1===this.groups.size&&this.port.onMessage.removeListener(this._Receive)}_AddListenerOnFirstSubscriber(){0===this.receivers.size&&1===this.groups.size&&this.port.onMessage.addListener(this._Receive.bind(this))}Send(a){a[c.teleKeys.PRODUCT_ID]=SEF.context.browserObject.runtime.id;a[c.teleKeys.PRODUCT_NAME]=SEF.config.Get("productName");a[c.teleKeys.PRODUCT_VERSION]=SEF.config.Get("productVersion");
a[c.teleKeys.BROWSER]=SEF.context.BROWSER;a[c.teleKeys.TIME]=Date.now();if(0===this.type&&b.Message.haveMessageEncryption()&&"EHLO"!==a[c.teleKeys.MESSAGE_TYPE]&&"ERROR"!==a[c.teleKeys.MESSAGE_TYPE]&&"CONFIG"!==a[c.teleKeys.MESSAGE_TYPE]){if(b.Message.isDefaultKey())return;a=b.Message.wrap(a,b.Message.sessionKey)}this.port.postMessage(a)}Disconnect(){this.port.disconnect()}OnReceive(a){if("function"!=typeof a)throw Error("Receiver must be callable");this._AddListenerOnFirstSubscriber();this.receivers.add(a)}RemoveReceiver(a){this.receivers.delete(a);
this._RemoveListenerIfNoSubscribers()}AssociateToGroup(a){if(!(a instanceof l))throw Error("group must be of type PortGroup");this._AddListenerOnFirstSubscriber();this.groups.add(a);a.ports.set(this.id,this)}DisassociateFromGroup(a){if(!(a instanceof l))throw Error("group must be of type PortGroup");this.groups.delete(a);a.ports.delete(this.id);this._RemoveListenerIfNoSubscribers()}}class l{constructor(a){this.name=a;this.ports=new Map;this.receivers=new Set;this.waiting=new Map}When(a,b){if(this.ports.has(a))return Promise.resolve(this.ports.get(a));
let c=this.waiting.get(a);c||(c=new f,this.waiting.set(a,c),c.promise.finally(()=>{this.waiting.delete(a)}));b&&"number"===typeof b&&setTimeout(()=>{c.reject(Error(`[bridge] Send() timeout [id: ${a}]`))},1E3*b);return c.promise}AddPort(a){let b=a;a instanceof k||(b=new k(a));b._AddListenerOnFirstSubscriber();b.groups.add(this);this.ports.set(b.id,a);this.waiting.has(b.id)&&this.waiting.get(b.id).resolve(a)}RemovePort(a){let b=a;a instanceof k||(b=a.sender?this.ports.get(`${a.sender.tab.id}:${a.sender.frameId}`):
a.name?this.ports.get(a.name):null);b&&(this.ports.delete(b.id),b.groups.delete(this),b._RemoveListenerIfNoSubscribers())}Send(a,b=null){if(b){const c=this.ports.get(b);c?c.Send(a):this.When(b,5).then(b=>{b.Send(a)})}else this.ports.forEach(b=>b.Send(a))}OnReceive(a,b=null){if("function"!=typeof a)throw Error("Receiver must be callable");b?(b=this.ports.get(b))&&b.OnReceive(a):this.receivers.add(a)}Disconnect(a=null){a?(a=this.ports.get(a))&&a.Disconnect():this.ports.forEach(a=>{a.Disconnect()})}RemoveReceiver(a,
b=null){b?(b=this.ports.get(b))&&b.RemoveReceiver(a):this.receivers.delete(a)}}class m{Initialize(a){this.portGroups=new Map;this.connectHandlers=new Map([[null,[]]]);this.nativeConnectedHandlers=new Map;this.nativeDisconnectedHandlers=new Map;this.reConnection=!1;const {runtime:c}=SEF.context.browserObject;let e=0;const g=(a,f)=>{try{const h=c.connectNative(a);h.name||(h.name=a);const m=new k(h,0);this.portGroups.has(a)||this.portGroups.set(a,new l(m.name));this.portGroups.get(a).AddPort(m);const n=
b=>{if(b.has(a)){b=b.get(a);try{b()}catch(x){d.error(`Handler error: ${x}`)}}};m.port.onMessage.addListener(a=>{e+=1;1===e&&n(this.nativeConnectedHandlers)});m.port.onDisconnect.addListener(b=>{n(this.nativeDisconnectedHandlers);e=0;c.lastError&&(d.error(`A runtime error occured on native port <${a}>: `+`${c.lastError.message}`),f.reject(c.lastError.message));b&&b.error&&(d.error(`A port error occured on native port (${b.name})<${a}>: ${b.error}`),f.reject(b.error));this.portGroups.has(b.name)?this.portGroups.get(b.name).RemovePort(m):
this.portGroups.has(a)&&this.portGroups.get(a).RemovePort(m);this.reConnection=!0;setTimeout(g,SEF.config.Get("nativeConnectRetry"),a,f)});this.reConnection&&m.id===SEF.config.Get("nativeMessasingAppId")&&(m.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"EHLO"}),b.Message.resetKey(),m.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"CONFIG",[SEF.constants.telePayloadKeys.NDC_DEF_VERSION]:SEF.context.ndcDefVer}),this.reConnection=!1)}catch(r){f.reject(r),d.error(`Failed to establish a connection with app <${a}>. Error: ${r}`)}};
c.connectNative&&a.forEach((a,b)=>{g(b,a)});c.onConnect.addListener(a=>{const b=new k(a,1);b.port.sender?(this.portGroups.has(b.name)||this.portGroups.set(b.name,new l(b.name)),this.portGroups.get(b.name).AddPort(b),b.port.onDisconnect.addListener(a=>{this.portGroups.get(a.name).RemovePort(a)})):d.warn(`A content port <${b.name}> does not have sender info.`);let c=[];[null,b.name,b.id,`${b.name}:${b.id}`].forEach(a=>{c=c.concat(this.connectHandlers.get(a)||[])});c.forEach(a=>{try{a(b)}catch(u){d.error(`Port connect handler <@${b.name}#${b.id}> error: ${u}`)}})})}OnNativeConnected(a,
b){this.nativeConnectedHandlers.set(b,a)}OnNativeDisconnected(a,b){this.nativeDisconnectedHandlers.set(b,a)}OnConnect(a,b=null,c=null){this.connectHandlers.set(b?c?`${b}:${c}`:`${b}`:c?`${c}`:null,a)}Send(a,b=null,c=null){this._ForAllOrSpecificGroup(b,(a,...b)=>{a.Send(...b)},a,c)}OnReceive(a,b=null,c=null){this.portGroups.has(b)||this.portGroups.set(b,new l(b));this._ForAllOrSpecificGroup(b,(a,...b)=>{a.OnReceive(...b)},a,c)}RemoveReceiver(a,b=null,c=null){this._ForAllOrSpecificGroup(b,(a,...b)=>
{a.RemoveReceiver(...b)},a,c)}_ForAllOrSpecificGroup(a,b,...c){a?(a=this.portGroups.get(a))&&b(a,...c):this.portGroups.forEach(a=>{b(a,...c)})}}return new class extends SEF.core.Module{constructor(){super({name:"bridge",version:"1.0"});this.nativeAppIds=new Map;this.portManager=new m}ConnectNative(a){if(!this.nativeAppIds.has(a)){const b=new f;this.nativeAppIds.set(a,b)}return this.nativeAppIds.get(a).promise}Initialize(){try{return this.portManager.Initialize(this.nativeAppIds),{}}catch(e){throw d.error(`Error while initialising bridge: ${e}`),
e;}}}})()})(this);(function(){function a(a,b,d=null){try{const c={cookie:a};if(d)c.error=`[REMOTE]: ${d instanceof Error?d.message:d}`;else{if(b instanceof Promise){b.then(a=>{c.result=a}).catch(a=>{c.error=a}).finally(()=>{this.Send(c)});return}c.result=b}this.Send(c)}catch(n){c.error(`Error while responding to agent: ${n}`)}}const {utils:b}=SEF,c=new b.Logger("AGENT"),{bridge:d,common:f}=SEF,k=new WeakMap;class l{constructor(a,b){if(!k.has(a))throw Error("No port mapping was found. ProxyMap may be corrupt!");this.id=
l.CreateId();k.get(a).set(this.id,b)}static CreateId(){return Infinity===++l.id?l.id=1:l.id}}l.id=0;return new class extends SEF.core.Module{constructor(){super({name:"agent",version:"1.0"})}AddBanner(a,b,c,f=!1){d.portManager.Send({command:"banner",params:c,append:f},"agent",`${a}:${b}`)}Initialize(){return d.OnInitComplete().then(()=>{d.portManager.OnConnect(b=>{k.set(b,new Map);b.OnReceive(function(d){for(const a of["invoke","params","chain","cookie"])if(!d.hasOwnProperty(a)){c.warn(`Dropping malformed request from agent ${JSON.stringify(d)}`);
return}try{{var e=d.chain;const a={object:d.objectId?k.get(b).get(d.objectId):SEF,this:null};if(f.isNil(a.object))throw Error(`No object mapping was found for objectId: ${d.objectId}`);for(const b of e)if(a.this=a.object,a.object=a.object[b],f.isNil(a.object))throw Error(`Property chain is invalid at <${b}>`);var m=a}switch(d.invoke){case "call":a.bind(this)(d.cookie,"function"===typeof m.object?m.object.apply(m.this,d.params):m.object);break;case "new":a.bind(this)(d.cookie,(new l(b,new m.object(...d.params))).id);
break;case "set":m.object[d.params[0]]=d.params[1];a.bind(this)(d.cookie);break;default:a.bind(this)(d.cookie,null,`Request<${d.invoke}> is not supported`)}}catch(g){a.bind(this)(d.cookie,null,g)}})},"agent");return!0})}}})(this);(function(){(function(){const {constants:a}=SEF;class b extends SEF.core.Module{constructor(){super({name:"exclusions",version:"1.0",configurations:[{key:"exclusionLimit",value:1E3,accessors:["persist"]}]});this.excludedDomains=new Map}IsTrustedHost(b){try{let c=(new URL(b)).hostname;const f=c.split("."),k=f.length;2<k&&(c=`${f[k-2]}.${f[k-1]}`,2===f[k-2].length&&2===f[k-1].length&&(c=`${f[k-3]}.${c}`));return a.TRUSTED_DOMAINS.includes(c)}catch(d){return logger.error(`IsTrustedHost(${b}): ${d}`),
!1}}Add(a,b=null,f=null){if(this.excludedDomains.size>=this.config.Get("exclusionLimit"))throw Error("Exclusion list capacity full!");try{let c=(new URL(a)).hostname;c.startsWith("www.")||(c=`www.${c}`);this.excludedDomains.has(c)&&clearTimeout(this.excludedDomains.get(c).timeoutId);this.excludedDomains.set(c,{tabId:b,timeoutId:f?setTimeout(()=>{this.excludedDomains.delete(c)},1E3*f):null})}catch(k){throw Error(`Exception while adding exclusion (host: ${host}) (error: ${k})`);}}GetAll(){return[...this.excludedDomains.entries()]}IsExcluded(a,
b=null){try{let c=(new URL(a)).hostname;c.startsWith("www.")||(c=`www.${c}`);a=null;return(a=this.excludedDomains.get(c))?!a.tabId||a.tabId===b:!1}catch(f){return!1}}Remove(a){try{let b="";try{b=(new URL(a)).hostname}catch(f){b=a}b.startsWith("www.")||(b=`www.${b}`);if(this.excludedDomains.has(b))return clearTimeout(this.excludedDomains.get(b).timeoutId),this.excludedDomains.delete(b),!0}catch(d){}return!1}Size(){return this.excludedDomains.size}Clear(){this.excludedDomains.clear()}Initialize(){return{}}}
return new b})()})(this);(function(){(function(){function a(){b.portManager.Send({[c.teleKeys.MESSAGE_TYPE]:"HEARTBEAT"},SEF.config.Get("nativeMessasingAppId"))}const {bridge:b,constants:c}=SEF;new SEF.utils.Logger("HEARTBEAT");return new class extends SEF.core.Module{constructor(){super({name:"heartbeat",version:"1.0",pollers:[[a,()=>SEF.config.Get("pulseFrequency"),null,{name:"heartbeatPulse",delayedStart:!1,autoStart:!0}]]})}Initialize(){SEF.OnInitComplete().then(()=>{this[SEF.symbols.Pollers][0].Run()});return!0}}})()})(this);(function(){(function(){function a(c,d=SEF){SEF.policyOrchestrator.config.Get("allowSync")&&Object.entries(c).forEach(([c,g])=>{if(g instanceof m)if(d&&d.config){const a=b.GetConfigAccessRoot(d);a&&(g.lock?a.Lock(c):a.Unlock(c),g.hide?a.Hide(c):a.Unhide(c),a.NotifyOnChange(c,g.notify),g.enforce&&a.ForceSet(c,g.value))}else d&&d instanceof SEF.utils.Configs&&c&&d.Set(c,g.value);else g instanceof h&&d instanceof SEF.core.ModuleBase&&d.hasOwnProperty(c)?d[c]=g.value:g instanceof e||"object"!==typeof g||
(c="SEF"===c?SEF:d.hasOwnProperty(c)?d[c]:null)&&a(g,c)})}let b=null;const {constants:c,bridge:d,utils:f}=SEF,k=new SEF.utils.Logger("POLICY"),l=Symbol("Meta");class m{constructor(a){this.lock="boolean"===typeof a.lock?a.lock:!1;this.hide="boolean"===typeof a.hide?a.hide:!1;this.notify="boolean"===typeof a.notify?a.notify:!1;this.enforce="boolean"===typeof a.enforce?a.enforce:!0;this.value=a.value}}class e{constructor(a){this.value=a.value}}class h{constructor(a){this.value=a.value}}return new class extends SEF.core.Module{constructor(){let a=
{name:"policyOrchestrator",version:"1.0",configurations:[{key:"allowSync",value:!0,accessors:["persist"],options:{locked:!0}},{key:"nativeAppAvailable",value:!0,accessors:["persist"]}]};super(a);this.initOptions=a;const b=()=>{this.initOptions.configAccessRoot.ForceSet("nativeAppAvailable",!0)},c=()=>{this.initOptions.configAccessRoot.ForceSet("nativeAppAvailable",!1)};this.nativeAppId=SEF.config.Get("nativeMessasingAppId");b();d.ConnectNative(this.nativeAppId).catch(a=>{k.warn(`Failed to connect to native app (${a}).`);
d.portManager.OnNativeConnected(b,this.nativeAppId);d.portManager.OnNativeDisconnected(c,this.nativeAppId)});this.initstate=!1}Initialize(){function e(b){try{if(b.type!==c.msgTypes.NDC_CONTENT&&(f.Message.checkBridgeMessageEncryption(b),f.Message.haveMessageEncryption()&&(b=f.Message.unwrap(b,f.Message.sessionKey))),void 0!==b.payload&&void 0!==b.type)if(b.type===c.msgTypes.FEATURE_STATES)k.info("Received feature states from bridge"),Object.keys(b.payload).forEach(a=>{let d=b.payload[a].state.toLowerCase();
if(Object.values(c.moduleStates).includes(d)){a=a.split("@");var {0:e,1:g}=a;"plugin"===e&&SEF.hasOwnProperty(g)?(k.info(`- Plugin ${g} is ${d}`),SEF[g].SetModuleState(d)):"function"===e&&"reputationLookup"===g?(k.info(`- Function reputation lookup is ${d}`),{reputationLookup:["webPulse","callInsight","webInsight"]}[g].forEach(a=>{SEF.hasOwnProperty(a)&&(k.info(`--- Engine ${a} is ${d}`),SEF[a].SetModuleState(d))})):"function"===e&&"webPulseBasedConviction"===g&&SEF.hasOwnProperty("webPulse")?(k.info(`-- Function webpulse based conviction is ${d}`),
SEF.webPulse.config.Set("webPulseBasedConviction",d===c.moduleStates.ENABLED)):"function"===e&&"submitOnlyEvents"===g&&(k.info(`-- Function submit only events is ${d}`),SEF.scanner.config.Set("submitOnlyEvents",d===c.moduleStates.ENABLED))}else k.warn(`- Feature ${a}'s state "${d}" is unrecognized, skip it`)}),k.info("Feature states are loaded");else if(b.type===c.msgTypes.POLICIES)k.info("Received policies from bridge"),Object.keys(SEF).forEach(a=>{SEF[a]instanceof SEF.core.Plugin&&Object.keys(SEF[a]).forEach(b=>
{SEF[a][b]instanceof SEF.utils.Configs&&SEF[a][b].Clear()})}),Object.keys(b.payload).forEach(c=>{SEF.config.Get("productName")===c&&a(SEF.policyOrchestrator.Parse(b.payload[c]))}),k.info("Policies are loaded");else if(b.type===c.msgTypes.BROADCAST)b.payload.sourceId&&SEF.config.Set("sourceID",b.payload.sourceId),SEF.hasOwnProperty("webPulse")&&(b.payload.webpulseLicense&&SEF.webPulse.config.Set("webPulse-URI-License",b.payload.webpulseLicense),b.payload.webPulseMaxLookups&&SEF.webPulse.config.Set("webPulseMaxLookups",
b.payload.webPulseMaxLookups),b.payload.webPulseAllUrlsThrottle&&SEF.webPulse.config.Set("webPulseAllUrlsThrottle",b.payload.webPulseAllUrlsThrottle),b.payload.webPulseMaxLookups||SEF.webPulse.config.Set("webPulseMaxLookups",c.WebPulseDefaults.MAX_LOOKUPS),b.payload.webPulseAllUrlsThrottle||SEF.webPulse.config.Set("webPulseAllUrlsThrottle",c.WebPulseDefaults.ALL_URLS_THROTTLE));else if(b.type===c.msgTypes.EXIT)d.portManager.Send({},SEF.config.Get("nativeMessasingAppId"));else if(b.type===c.msgTypes.EXCLUSIONS){SEF.exclusions.Clear();
for(var e of b.payload)k.info(`Add exclusion ${e}`),SEF.exclusions.Add(e)}else b.type===c.msgTypes.NDC_CONTENT?(void 0===this.ndcContent&&(this.ndcContent=""),this.ndcContent+=atob(b.payload),!1===b.more&&SEF.hasOwnProperty("NDC")&&(k.info(`Received a complete ndc content, ${b.version}`),SEF.NDC.UpdateContent(this.ndcContent,b.version),this.ndcContent="")):b.type===c.msgTypes.MESSAGE_KEY&&(k.info(`Received key, ${b.payload}`),f.Message.setKey(b.payload))}catch(q){e=`Exception while processing configs: ${q}`,
k.error(`${e}, message: ${b}`),SEF.utils.OpState.Malfunctioned(e)}}b=this.Escalate(SEF.config);this.config.AddListener((a,b,c)=>{"nativeAppAvailable"===a&&(!1===b&&!0===c?d.portManager.OnReceive(e,this.nativeAppId):!0===b&&!1===c&&d.portManager.RemoveReceiver(e,this.nativeAppId))});SEF.OnInitComplete().then(()=>{this.config.Get("nativeAppAvailable")&&(k.info("Started."),d.portManager.OnReceive(e,this.nativeAppId),this.initstate=!0)});return!0}Parse(a){return a.reduce((a,b)=>{let c=a;"meta"===b.type?
(a[l]||(a[l]={}),a[l][b.key]=new e(b.value)):"property"===b.type?(a.hasOwnProperty(b.module)||(a[b.module]={}),a[b.module][b.key]=new h(b)):(b.module.split("@").forEach(a=>{c.hasOwnProperty(a)||(c[a]={});c=c[a]}),c[b.key]=new m(b));return a},{})}}})()})(this);(function(){const {utils:a}=SEF;let b;const c=SEF.db.OnInitComplete().then(a=>{if(a.error)throw a.error;b=new SEF.db.SecureDB("sefconfig.sdb");return a}),d=c.then(()=>b.Open({},"Z$W7X[DAMn9<W]pz"));class f{constructor(a,c={}){this.name=a;this.map=new Map(Object.entries(c));f._initFuture=f.MapStore(this.name);this._initFuture=f._initFuture.then(()=>b.Query("Z$W7X[DAMn9<W]pz").Select().From(this.name).Run("SC").then(a=>{a.forEach(a=>{this.map.set(a.key,a.value)})}))}Set(a,c){return f._initFuture.then(()=>
b.Query("Z$W7X[DAMn9<W]pz").Update(c).Into(this.name).As(a).Run("SC"))}Get(a){return f._initFuture.then(()=>b.Query("Z$W7X[DAMn9<W]pz").Select(a).From(this.name).Run("SC"))}Delete(a){return f._initFuture.then(()=>b.Query("Z$W7X[DAMn9<W]pz").Delete(a).From(this.name).Run("SC"))}Clear(){return f._initFuture.then(()=>b.Query("Z$W7X[DAMn9<W]pz").Clear(this.name).Run("SC"))}Purge(){return f._initFuture.then(()=>b.Upgrade({version:b.Version()+1,delete:[this.name]}))}static MapStore(a){return c.then(()=>
f._initFutureRoot.then(()=>{let c=f._initFutureRoot;b.database.objectStoreNames.contains(a)||(f.UpgradeQueue.push(a),c=f._initFutureRoot.then(()=>{0<f.UpgradeQueue.length&&(f._initFutureUpg=b.Upgrade(f.UpgradeQueue.reduce((a,b)=>{a.create.push({name:b});return a},{version:b.Version()+1,create:[]})),f.UpgradeQueue.length=0);return f._initFutureUpg}));return c}))}}f._initFuture=d;f._initFutureRoot=d;f._initFutureUpg=d;f.UpgradeQueue=[];class k extends f{constructor(a,b={}){super(a,b)}OnInitComplete(){return this._initFuture.then(()=>
({persistent:!0})).catch(a=>({persistent:!1,error:a}))}Keys(){return[...this.map.keys()]}Set(a,b){this.map.set(a,b);return super.Set(a,b)}Get(a){return this.map.get(a)}Delete(a){this.map.delete(a);return super.Delete(a)}Clear(){this.map.clear();return super.Clear()}Purge(){this.map=null;return super.Purge()}}a.Configs=k})(this);var Module;Module||(Module="undefined"!==typeof Module?Module:{});var moduleOverrides={},key;for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var arguments_=[],thisProgram="./this.program",quit_=function(a,b){throw b;},ENVIRONMENT_IS_WEB=!1,ENVIRONMENT_IS_WORKER=!1,ENVIRONMENT_IS_NODE=!1,ENVIRONMENT_IS_SHELL=!1;ENVIRONMENT_IS_WEB="object"===typeof window;ENVIRONMENT_IS_WORKER="function"===typeof importScripts;
ENVIRONMENT_IS_NODE="object"===typeof process&&"object"===typeof process.versions&&"string"===typeof process.versions.node;ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var scriptDirectory="";function locateFile(a){return Module.locateFile?Module.locateFile(a,scriptDirectory):scriptDirectory+a}var read_,readBinary,nodeFS,nodePath;
if(ENVIRONMENT_IS_NODE)scriptDirectory=ENVIRONMENT_IS_WORKER?require("path").dirname(scriptDirectory)+"/":__dirname+"/",read_=function(a,b){nodeFS||(nodeFS=require("fs"));nodePath||(nodePath=require("path"));a=nodePath.normalize(a);return nodeFS.readFileSync(a,b?null:"utf8")},readBinary=function(a){a=read_(a,!0);a.buffer||(a=new Uint8Array(a));assert(a.buffer);return a},1<process.argv.length&&(thisProgram=process.argv[1].replace(/\\/g,"/")),arguments_=process.argv.slice(2),"undefined"!==typeof module&&
(module.exports=Module),process.on("uncaughtException",function(a){if(!(a instanceof ExitStatus))throw a;}),process.on("unhandledRejection",abort),quit_=function(a){process.exit(a)},Module.inspect=function(){return"[Emscripten Module object]"};else if(ENVIRONMENT_IS_SHELL)"undefined"!=typeof read&&(read_=function(a){return read(a)}),readBinary=function(a){if("function"===typeof readbuffer)return new Uint8Array(readbuffer(a));a=read(a,"binary");assert("object"===typeof a);return a},"undefined"!=typeof scriptArgs?
arguments_=scriptArgs:"undefined"!=typeof arguments&&(arguments_=arguments),"function"===typeof quit&&(quit_=function(a){quit(a)}),"undefined"!==typeof print&&("undefined"===typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!==typeof printErr?printErr:print);else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:"undefined"!==typeof document&&document.currentScript&&(scriptDirectory=document.currentScript.src),
scriptDirectory=0!==scriptDirectory.indexOf("blob:")?scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1):"",read_=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);return b.responseText},ENVIRONMENT_IS_WORKER&&(readBinary=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)});var out=Module.print||console.log.bind(console),err=Module.printErr||console.warn.bind(console);
for(key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=null;Module.arguments&&(arguments_=Module.arguments);Module.thisProgram&&(thisProgram=Module.thisProgram);Module.quit&&(quit_=Module.quit);
function convertJsFunctionToWasm(a,b){if("function"===typeof WebAssembly.Function){for(var c={i:"i32",j:"i64",f:"f32",d:"f64"},d={parameters:[],results:"v"==b[0]?[]:[c[b[0]]]},f=1;f<b.length;++f)d.parameters.push(c[b[f]]);return new WebAssembly.Function(d,a)}c=[1,0,1,96];d=b.slice(0,1);b=b.slice(1);var k={i:127,j:126,f:125,d:124};c.push(b.length);for(f=0;f<b.length;++f)c.push(k[b[f]]);"v"==d?c.push(0):c=c.concat([1,k[d]]);c[1]=c.length-2;f=new Uint8Array([0,97,115,109,1,0,0,0].concat(c,[2,7,1,1,101,
1,102,0,0,7,5,1,1,102,0,0]));f=new WebAssembly.Module(f);return(new WebAssembly.Instance(f,{e:{f:a}})).exports.f}var freeTableIndexes=[],functionsInTableMap;function getEmptyTableSlot(){if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(a){if(!(a instanceof RangeError))throw a;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.";}return wasmTable.length-1}
function addFunctionWasm(a,b){if(!functionsInTableMap){functionsInTableMap=new WeakMap;for(var c=0;c<wasmTable.length;c++){var d=wasmTable.get(c);d&&functionsInTableMap.set(d,c)}}if(functionsInTableMap.has(a))return functionsInTableMap.get(a);c=getEmptyTableSlot();try{wasmTable.set(c,a)}catch(f){if(!(f instanceof TypeError))throw f;b=convertJsFunctionToWasm(a,b);wasmTable.set(c,b)}functionsInTableMap.set(a,c);return c}function addFunction(a,b){return addFunctionWasm(a,b)}var wasmBinary;
Module.wasmBinary&&(wasmBinary=Module.wasmBinary);var noExitRuntime;Module.noExitRuntime&&(noExitRuntime=Module.noExitRuntime);"object"!==typeof WebAssembly&&abort("no native wasm support detected");var wasmMemory,ABORT=!1,EXITSTATUS=0;function assert(a,b){a||abort("Assertion failed: "+b)}var UTF8Decoder="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;
function UTF8ArrayToString(a,b,c){var d=b+c;for(c=b;a[c]&&!(c>=d);)++c;if(16<c-b&&a.subarray&&UTF8Decoder)return UTF8Decoder.decode(a.subarray(b,c));for(d="";b<c;){var f=a[b++];if(f&128){var k=a[b++]&63;if(192==(f&224))d+=String.fromCharCode((f&31)<<6|k);else{var l=a[b++]&63;f=224==(f&240)?(f&15)<<12|k<<6|l:(f&7)<<18|k<<12|l<<6|a[b++]&63;65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode(55296|f>>10,56320|f&1023))}}else d+=String.fromCharCode(f)}return d}
function UTF8ToString(a,b){return a?UTF8ArrayToString(HEAPU8,a,b):""}
function stringToUTF8Array(a,b,c,d){if(!(0<d))return 0;var f=c;d=c+d-1;for(var k=0;k<a.length;++k){var l=a.charCodeAt(k);if(55296<=l&&57343>=l){var m=a.charCodeAt(++k);l=65536+((l&1023)<<10)|m&1023}if(127>=l){if(c>=d)break;b[c++]=l}else{if(2047>=l){if(c+1>=d)break;b[c++]=192|l>>6}else{if(65535>=l){if(c+2>=d)break;b[c++]=224|l>>12}else{if(c+3>=d)break;b[c++]=240|l>>18;b[c++]=128|l>>12&63}b[c++]=128|l>>6&63}b[c++]=128|l&63}}b[c]=0;return c-f}
function stringToUTF8(a,b,c){return stringToUTF8Array(a,HEAPU8,b,c)}function lengthBytesUTF8(a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&(d=65536+((d&1023)<<10)|a.charCodeAt(++c)&1023);127>=d?++b:b=2047>=d?b+2:65535>=d?b+3:b+4}return b}function allocateUTF8(a){var b=lengthBytesUTF8(a)+1,c=_malloc(b);c&&stringToUTF8Array(a,HEAP8,c,b);return c}function writeArrayToMemory(a,b){HEAP8.set(a,b)}
function writeAsciiToMemory(a,b,c){for(var d=0;d<a.length;++d)HEAP8[b++>>0]=a.charCodeAt(d);c||(HEAP8[b>>0]=0)}var buffer,HEAP8,HEAPU8,HEAP32,HEAPU32,INITIAL_MEMORY=Module.INITIAL_MEMORY||67108864;if(wasmMemory=Module.wasmMemory?Module.wasmMemory:new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:INITIAL_MEMORY/65536}))buffer=wasmMemory.buffer;INITIAL_MEMORY=buffer.byteLength;
(function(a){buffer=a;Module.HEAP8=HEAP8=new Int8Array(a);Module.HEAP16=new Int16Array(a);Module.HEAP32=HEAP32=new Int32Array(a);Module.HEAPU8=HEAPU8=new Uint8Array(a);Module.HEAPU16=new Uint16Array(a);Module.HEAPU32=HEAPU32=new Uint32Array(a);Module.HEAPF32=new Float32Array(a);Module.HEAPF64=new Float64Array(a)})(buffer);var wasmTable,__ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATPOSTRUN__=[],runtimeInitialized=!1;
function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}
function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(a){__ATPRERUN__.unshift(a)}function addOnPostRun(a){__ATPOSTRUN__.unshift(a)}var runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;
function addRunDependency(a){runDependencies++;Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(a){runDependencies--;Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies);0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled&&(a=dependenciesFulfilled,dependenciesFulfilled=null,a()))}Module.preloadedImages={};Module.preloadedAudios={};
function abort(a){if(Module.onAbort)Module.onAbort(a);a+="";err(a);ABORT=!0;EXITSTATUS=1;throw new WebAssembly.RuntimeError("abort("+a+"). Build with -s ASSERTIONS=1 for more info.");}function hasPrefix(a,b){return String.prototype.startsWith?a.startsWith(b):0===a.indexOf(b)}function isDataURI(a){return hasPrefix(a,"data:application/octet-stream;base64,")}function isFileURI(a){return hasPrefix(a,"file://")}var wasmBinaryFile="ndcxapi.wasm";isDataURI(wasmBinaryFile)||(wasmBinaryFile=locateFile(wasmBinaryFile));
function getBinary(){try{if(wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(wasmBinaryFile);throw"both async and sync fetching of the wasm failed";}catch(a){abort(a)}}
function getBinaryPromise(){return wasmBinary||!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER||"function"!==typeof fetch||isFileURI(wasmBinaryFile)?Promise.resolve().then(getBinary):fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+wasmBinaryFile+"'";return a.arrayBuffer()}).catch(function(){return getBinary()})}
function callRuntimeCallbacks(a){for(;0<a.length;){var b=a.shift();if("function"==typeof b)b(Module);else{var c=b.func;"number"===typeof c?void 0===b.arg?wasmTable.get(c)():wasmTable.get(c)(b.arg):c(void 0===b.arg?null:b.arg)}}}var ExceptionInfoAttrs={DESTRUCTOR_OFFSET:0,REFCOUNT_OFFSET:4,TYPE_OFFSET:8,CAUGHT_OFFSET:12,RETHROWN_OFFSET:13,SIZE:16};
function ExceptionInfo(a){this.excPtr=a;this.ptr=a-ExceptionInfoAttrs.SIZE;this.set_type=function(a){HEAP32[this.ptr+ExceptionInfoAttrs.TYPE_OFFSET>>2]=a};this.get_type=function(){return HEAP32[this.ptr+ExceptionInfoAttrs.TYPE_OFFSET>>2]};this.set_destructor=function(a){HEAP32[this.ptr+ExceptionInfoAttrs.DESTRUCTOR_OFFSET>>2]=a};this.get_destructor=function(){return HEAP32[this.ptr+ExceptionInfoAttrs.DESTRUCTOR_OFFSET>>2]};this.set_refcount=function(a){HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>
2]=a};this.set_caught=function(a){HEAP8[this.ptr+ExceptionInfoAttrs.CAUGHT_OFFSET>>0]=a?1:0};this.get_caught=function(){return 0!=HEAP8[this.ptr+ExceptionInfoAttrs.CAUGHT_OFFSET>>0]};this.set_rethrown=function(a){HEAP8[this.ptr+ExceptionInfoAttrs.RETHROWN_OFFSET>>0]=a?1:0};this.get_rethrown=function(){return 0!=HEAP8[this.ptr+ExceptionInfoAttrs.RETHROWN_OFFSET>>0]};this.init=function(a,c){this.set_type(a);this.set_destructor(c);this.set_refcount(0);this.set_caught(!1);this.set_rethrown(!1)};this.add_ref=
function(){HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2]+=1};this.release_ref=function(){var a=HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2];HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2]=a-1;return 1===a}}var exceptionLast=0,uncaughtExceptionCount=0;function setErrNo(a){return HEAP32[___errno_location()>>2]=a}
var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(a,b){var c=SYSCALLS.buffers[a];0===b||10===b?((1===a?out:err)(UTF8ArrayToString(c,0)),c.length=0):c.push(b)},varargs:void 0,get:function(){SYSCALLS.varargs+=4;return HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(a){return UTF8ToString(a)},get64:function(a,b){return a}},_emscripten_get_now;_emscripten_get_now=ENVIRONMENT_IS_NODE?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:"undefined"!==typeof dateNow?dateNow:function(){return performance.now()};
function abortOnCannotGrowMemory(a){abort("OOM")}var ENV={};function getExecutableName(){return thisProgram||"./this.program"}
function getEnvStrings(){if(!getEnvStrings.strings){var a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:getExecutableName()},b;for(b in ENV)a[b]=ENV[b];var c=[];for(b in a)c.push(b+"="+a[b]);getEnvStrings.strings=c}return getEnvStrings.strings}
function _tzset(){function a(a){return(a=a.toTimeString().match(/\(([A-Za-z ]+)\)$/))?a[1]:"GMT"}if(!_tzset.called){_tzset.called=!0;var b=(new Date).getFullYear(),c=new Date(b,0,1),d=new Date(b,6,1);b=c.getTimezoneOffset();var f=d.getTimezoneOffset(),k=Math.max(b,f);HEAP32[__get_timezone()>>2]=60*k;HEAP32[__get_daylight()>>2]=Number(b!=f);c=a(c);d=a(d);c=allocateUTF8(c);d=allocateUTF8(d);f<b?(HEAP32[__get_tzname()>>2]=c,HEAP32[__get_tzname()+4>>2]=d):(HEAP32[__get_tzname()>>2]=d,HEAP32[__get_tzname()+
4>>2]=c)}}function __isLeapYear(a){return 0===a%4&&(0!==a%100||0===a%400)}function __arraySum(a,b){for(var c=0,d=0;d<=b;c+=a[d++]);return c}var __MONTH_DAYS_LEAP=[31,29,31,30,31,30,31,31,30,31,30,31],__MONTH_DAYS_REGULAR=[31,28,31,30,31,30,31,31,30,31,30,31];
function __addDays(a,b){for(a=new Date(a.getTime());0<b;){var c=__isLeapYear(a.getFullYear()),d=a.getMonth();c=(c?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR)[d];if(b>c-a.getDate())b-=c-a.getDate()+1,a.setDate(1),11>d?a.setMonth(d+1):(a.setMonth(0),a.setFullYear(a.getFullYear()+1));else{a.setDate(a.getDate()+b);break}}return a}
function _strftime(a,b,c,d){function f(a,b,c){for(a="number"===typeof a?a.toString():a||"";a.length<b;)a=c[0]+a;return a}function k(a,b){return f(a,b,"0")}function l(a,b){function c(a){return 0>a?-1:0<a?1:0}var d;0===(d=c(a.getFullYear()-b.getFullYear()))&&0===(d=c(a.getMonth()-b.getMonth()))&&(d=c(a.getDate()-b.getDate()));return d}function m(a){switch(a.getDay()){case 0:return new Date(a.getFullYear()-1,11,29);case 1:return a;case 2:return new Date(a.getFullYear(),0,3);case 3:return new Date(a.getFullYear(),
0,2);case 4:return new Date(a.getFullYear(),0,1);case 5:return new Date(a.getFullYear()-1,11,31);case 6:return new Date(a.getFullYear()-1,11,30)}}function e(a){a=__addDays(new Date(a.tm_year+1900,0,1),a.tm_yday);var b=new Date(a.getFullYear(),0,4),c=new Date(a.getFullYear()+1,0,4);b=m(b);c=m(c);return 0>=l(b,a)?0>=l(c,a)?a.getFullYear()+1:a.getFullYear():a.getFullYear()-1}var h=HEAP32[d+40>>2];d={tm_sec:HEAP32[d>>2],tm_min:HEAP32[d+4>>2],tm_hour:HEAP32[d+8>>2],tm_mday:HEAP32[d+12>>2],tm_mon:HEAP32[d+
16>>2],tm_year:HEAP32[d+20>>2],tm_wday:HEAP32[d+24>>2],tm_yday:HEAP32[d+28>>2],tm_isdst:HEAP32[d+32>>2],tm_gmtoff:HEAP32[d+36>>2],tm_zone:h?UTF8ToString(h):""};c=UTF8ToString(c);h={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U",
"%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var n in h)c=c.replace(new RegExp(n,"g"),h[n]);var g="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");h={"%a":function(a){return g[a.tm_wday].substring(0,3)},"%A":function(a){return g[a.tm_wday]},"%b":function(a){return p[a.tm_mon].substring(0,3)},"%B":function(a){return p[a.tm_mon]},"%C":function(a){return k((a.tm_year+1900)/100|
0,2)},"%d":function(a){return k(a.tm_mday,2)},"%e":function(a){return f(a.tm_mday,2," ")},"%g":function(a){return e(a).toString().substring(2)},"%G":function(a){return e(a)},"%H":function(a){return k(a.tm_hour,2)},"%I":function(a){a=a.tm_hour;0==a?a=12:12<a&&(a-=12);return k(a,2)},"%j":function(a){return k(a.tm_mday+__arraySum(__isLeapYear(a.tm_year+1900)?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,a.tm_mon-1),3)},"%m":function(a){return k(a.tm_mon+1,2)},"%M":function(a){return k(a.tm_min,2)},"%n":function(){return"\n"},
"%p":function(a){return 0<=a.tm_hour&&12>a.tm_hour?"AM":"PM"},"%S":function(a){return k(a.tm_sec,2)},"%t":function(){return"\t"},"%u":function(a){return a.tm_wday||7},"%U":function(a){var b=new Date(a.tm_year+1900,0,1),c=0===b.getDay()?b:__addDays(b,7-b.getDay());a=new Date(a.tm_year+1900,a.tm_mon,a.tm_mday);return 0>l(c,a)?(b=__arraySum(__isLeapYear(a.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,a.getMonth()-1)-31,c=31-c.getDate()+b+a.getDate(),k(Math.ceil(c/7),2)):0===l(c,b)?"01":"00"},
"%V":function(a){var b=new Date(a.tm_year+1901,0,4),c=m(new Date(a.tm_year+1900,0,4));b=m(b);var d=__addDays(new Date(a.tm_year+1900,0,1),a.tm_yday);if(0>l(d,c))return"53";if(0>=l(b,d))return"01";a=c.getFullYear()<a.tm_year+1900?a.tm_yday+32-c.getDate():a.tm_yday+1-c.getDate();return k(Math.ceil(a/7),2)},"%w":function(a){return a.tm_wday},"%W":function(a){var b=new Date(a.tm_year,0,1),c=1===b.getDay()?b:__addDays(b,0===b.getDay()?1:7-b.getDay()+1);a=new Date(a.tm_year+1900,a.tm_mon,a.tm_mday);return 0>
l(c,a)?(b=__arraySum(__isLeapYear(a.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,a.getMonth()-1)-31,c=31-c.getDate()+b+a.getDate(),k(Math.ceil(c/7),2)):0===l(c,b)?"01":"00"},"%y":function(a){return(a.tm_year+1900).toString().substring(2)},"%Y":function(a){return a.tm_year+1900},"%z":function(a){a=a.tm_gmtoff;var b=0<=a;a=Math.abs(a)/60;return(b?"+":"-")+String("0000"+(a/60*100+a%60)).slice(-4)},"%Z":function(a){return a.tm_zone},"%%":function(){return"%"}};for(n in h)0<=c.indexOf(n)&&(c=
c.replace(new RegExp(n,"g"),h[n](d)));n=intArrayFromString(c,!1);if(n.length>b)return 0;writeArrayToMemory(n,a);return n.length-1}function intArrayFromString(a,b,c){c=0<c?c:lengthBytesUTF8(a)+1;c=Array(c);a=stringToUTF8Array(a,c,0,c.length);b&&(c.length=a);return c}__ATINIT__.push({func:function(){___wasm_call_ctors()}});
var asmLibraryArg={c:function(a,b,c,d){abort("Assertion failed: "+UTF8ToString(a)+", at: "+[b?UTF8ToString(b):"unknown filename",c,d?UTF8ToString(d):"unknown function"])},e:function(a){return _malloc(a+ExceptionInfoAttrs.SIZE)+ExceptionInfoAttrs.SIZE},d:function(a,b,c){(new ExceptionInfo(a)).init(b,c);exceptionLast=a;uncaughtExceptionCount++;throw a;},k:function(a,b,c){SYSCALLS.varargs=c;return 0},g:function(){return 42},B:function(a,b,c){SYSCALLS.varargs=c;return 0},C:function(a,b,c){SYSCALLS.varargs=
c},z:function(a,b){},D:function(a){},m:function(a,b){},l:function(a){},f:function(){abort()},w:function(a,b){if(0===a)a=Date.now();else if(1===a||4===a)a=_emscripten_get_now();else return setErrNo(28),-1;HEAP32[b>>2]=a/1E3|0;HEAP32[b+4>>2]=a%1E3*1E6|0;return 0},r:function(a,b,c){HEAPU8.copyWithin(a,b,b+c)},s:function(a){abortOnCannotGrowMemory(a>>>0)},x:function(a,b){var c=0;getEnvStrings().forEach(function(d,f){var k=b+c;HEAP32[a+4*f>>2]=k;writeAsciiToMemory(d,k);c+=d.length+1});return 0},y:function(a,
b){var c=getEnvStrings();HEAP32[a>>2]=c.length;var d=0;c.forEach(function(a){d+=a.length+1});HEAP32[b>>2]=d;return 0},j:function(a){return 0},A:function(a,b,c,d){a=SYSCALLS.getStreamFromFD(a);b=SYSCALLS.doReadv(a,b,c);HEAP32[d>>2]=b;return 0},q:function(a,b,c,d,f){},i:function(a,b,c,d){for(var f=0,k=0;k<c;k++){for(var l=HEAP32[b+8*k>>2],m=HEAP32[b+(8*k+4)>>2],e=0;e<m;e++)SYSCALLS.printChar(a,HEAPU8[l+e]);f+=m}HEAP32[d>>2]=f;return 0},o:function(a){var b=Date.now();HEAP32[a>>2]=b/1E3|0;HEAP32[a+4>>
2]=b%1E3*1E3|0;return 0},n:function(a,b){_tzset();a=new Date(1E3*HEAP32[a>>2]);HEAP32[b>>2]=a.getSeconds();HEAP32[b+4>>2]=a.getMinutes();HEAP32[b+8>>2]=a.getHours();HEAP32[b+12>>2]=a.getDate();HEAP32[b+16>>2]=a.getMonth();HEAP32[b+20>>2]=a.getFullYear()-1900;HEAP32[b+24>>2]=a.getDay();var c=new Date(a.getFullYear(),0,1),d=(a.getTime()-c.getTime())/864E5|0;HEAP32[b+28>>2]=d;HEAP32[b+36>>2]=-(60*a.getTimezoneOffset());d=(new Date(a.getFullYear(),6,1)).getTimezoneOffset();c=c.getTimezoneOffset();a=(d!=
c&&a.getTimezoneOffset()==Math.min(c,d))|0;HEAP32[b+32>>2]=a;a=HEAP32[__get_tzname()+(a?4:0)>>2];HEAP32[b+40>>2]=a;return b},a:wasmMemory,h:function(){},u:function(){},t:function(){},p:_strftime,v:function(a,b,c,d){return _strftime(a,b,c,d)},b:function(a){var b=Date.now()/1E3|0;a&&(HEAP32[a>>2]=b);return b}},asm=function(){function a(a,b){Module.asm=a.exports;wasmTable=Module.asm.E;removeRunDependency("wasm-instantiate")}function b(b){a(b.instance)}function c(a){return getBinaryPromise().then(function(a){return WebAssembly.instantiate(a,
d)}).then(a,function(a){err("failed to asynchronously prepare wasm: "+a);abort(a)})}var d={a:asmLibraryArg};addRunDependency("wasm-instantiate");if(Module.instantiateWasm)try{return Module.instantiateWasm(d,a)}catch(f){return err("Module.instantiateWasm callback failed with error: "+f),!1}(function(){return wasmBinary||"function"!==typeof WebAssembly.instantiateStreaming||isDataURI(wasmBinaryFile)||isFileURI(wasmBinaryFile)||"function"!==typeof fetch?c(b):fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(a){return WebAssembly.instantiateStreaming(a,
d).then(b,function(a){err("wasm streaming compile failed: "+a);err("falling back to ArrayBuffer instantiation");return c(b)})})})();return{}}(),___wasm_call_ctors=Module.___wasm_call_ctors=function(){return(___wasm_call_ctors=Module.___wasm_call_ctors=Module.asm.F).apply(null,arguments)},_xapiSubmitBuffer=Module._xapiSubmitBuffer=function(){return(_xapiSubmitBuffer=Module._xapiSubmitBuffer=Module.asm.G).apply(null,arguments)},_xapiSubmitSingletonBuffer=Module._xapiSubmitSingletonBuffer=function(){return(_xapiSubmitSingletonBuffer=
Module._xapiSubmitSingletonBuffer=Module.asm.H).apply(null,arguments)},_xapiOnScanComplete=Module._xapiOnScanComplete=function(){return(_xapiOnScanComplete=Module._xapiOnScanComplete=Module.asm.I).apply(null,arguments)},_xapiScopedExecute=Module._xapiScopedExecute=function(){return(_xapiScopedExecute=Module._xapiScopedExecute=Module.asm.J).apply(null,arguments)},_xapiGenerate=Module._xapiGenerate=function(){return(_xapiGenerate=Module._xapiGenerate=Module.asm.K).apply(null,arguments)},_xapiSetLogLevel=
Module._xapiSetLogLevel=function(){return(_xapiSetLogLevel=Module._xapiSetLogLevel=Module.asm.L).apply(null,arguments)},_xapiRemoveTab=Module._xapiRemoveTab=function(){return(_xapiRemoveTab=Module._xapiRemoveTab=Module.asm.M).apply(null,arguments)},_xapiEndSession=Module._xapiEndSession=function(){return(_xapiEndSession=Module._xapiEndSession=Module.asm.N).apply(null,arguments)},_xapiUnregisterOnScanComplete=Module._xapiUnregisterOnScanComplete=function(){return(_xapiUnregisterOnScanComplete=Module._xapiUnregisterOnScanComplete=
Module.asm.O).apply(null,arguments)},_xapiGetMMD=Module._xapiGetMMD=function(){return(_xapiGetMMD=Module._xapiGetMMD=Module.asm.P).apply(null,arguments)},_xapiAddSignatureExclusions=Module._xapiAddSignatureExclusions=function(){return(_xapiAddSignatureExclusions=Module._xapiAddSignatureExclusions=Module.asm.Q).apply(null,arguments)},_xapiRemoveSignatureExclusions=Module._xapiRemoveSignatureExclusions=function(){return(_xapiRemoveSignatureExclusions=Module._xapiRemoveSignatureExclusions=Module.asm.R).apply(null,
arguments)},_xapiGetEngineVersion=Module._xapiGetEngineVersion=function(){return(_xapiGetEngineVersion=Module._xapiGetEngineVersion=Module.asm.S).apply(null,arguments)},_xapiUpdateContent=Module._xapiUpdateContent=function(){return(_xapiUpdateContent=Module._xapiUpdateContent=Module.asm.T).apply(null,arguments)},_xapiGetSignatureExclusions=Module._xapiGetSignatureExclusions=function(){return(_xapiGetSignatureExclusions=Module._xapiGetSignatureExclusions=Module.asm.U).apply(null,arguments)},_xapiGetMetadata=
Module._xapiGetMetadata=function(){return(_xapiGetMetadata=Module._xapiGetMetadata=Module.asm.V).apply(null,arguments)},_xapiGetMaxEventsPerAlert=Module._xapiGetMaxEventsPerAlert=function(){return(_xapiGetMaxEventsPerAlert=Module._xapiGetMaxEventsPerAlert=Module.asm.W).apply(null,arguments)},_malloc=Module._malloc=function(){return(_malloc=Module._malloc=Module.asm.X).apply(null,arguments)},_free=Module._free=function(){return(_free=Module._free=Module.asm.Y).apply(null,arguments)},___errno_location=
Module.___errno_location=function(){return(___errno_location=Module.___errno_location=Module.asm.Z).apply(null,arguments)},__get_tzname=Module.__get_tzname=function(){return(__get_tzname=Module.__get_tzname=Module.asm._).apply(null,arguments)},__get_daylight=Module.__get_daylight=function(){return(__get_daylight=Module.__get_daylight=Module.asm.$).apply(null,arguments)},__get_timezone=Module.__get_timezone=function(){return(__get_timezone=Module.__get_timezone=Module.asm.aa).apply(null,arguments)},
stackAlloc=Module.stackAlloc=function(){return(stackAlloc=Module.stackAlloc=Module.asm.ba).apply(null,arguments)};Module.intArrayFromString=intArrayFromString;Module.allocate=function(a,b){b=1==b?stackAlloc(a.length):_malloc(a.length);a.subarray||a.slice?HEAPU8.set(a,b):HEAPU8.set(new Uint8Array(a),b);return b};Module.stringToUTF8=stringToUTF8;Module.addFunction=addFunction;Module.ALLOC_NORMAL=0;Module.ALLOC_STACK=1;var calledRun;
function ExitStatus(a){this.name="ExitStatus";this.message="Program terminated with exit("+a+")";this.status=a}dependenciesFulfilled=function runCaller(){calledRun||run();calledRun||(dependenciesFulfilled=runCaller)};
function run(a){function b(){if(!calledRun&&(calledRun=!0,Module.calledRun=!0,!ABORT)){initRuntime();preMain();if(Module.onRuntimeInitialized)Module.onRuntimeInitialized();postRun()}}0<runDependencies||(preRun(),0<runDependencies||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1);b()},1)):b()))}Module.run=run;if(Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);0<Module.preInit.length;)Module.preInit.pop()();
noExitRuntime=!0;run();(function(){(function(){function a(a,b,c,d){let e=[];if(a instanceof Uint8Array){d=new TextDecoder(d);for(let g=0;g<b;g++)e.push(d.decode(a.subarray(g*c,(g+1)*c).filter(a=>0!==a)))}return e}function b(b,c){var d=[];let e;const f=n.heapManager.AllocateIntArray(new Uint32Array(b));switch(c){case g.enEventField.CIDS_ThreatLevel:case g.enEventField.ResponseAction:case g.enEventField.ResponseFlags:e=n.heapManager.AllocateIntArray(b.length);d=n.heapManager.MakeIntArray(e,b.length);c=_xapiGetMetadata(f,
b.length,c,e);c!==g.status.STATUS_OK&&l.error("Failed to get metadata. Status: %d",c);d=Array.from(d);break;case g.enEventField.Name:e=n.heapManager.AllocateUInt8Array(b.length*g.MAX_SIGNATURE_NAME_LENGTH),d=n.heapManager.MakeUInt8Array(e,b.length*g.MAX_SIGNATURE_NAME_LENGTH),c=_xapiGetMetadata(f,b.length,c,e,g.MAX_SIGNATURE_NAME_LENGTH),c!==g.status.STATUS_OK&&l.error("Failed to get metadata. Status: %d",c),d=a(d,b.length,g.MAX_SIGNATURE_NAME_LENGTH,"windows-1251")}return d}const {isNil:c}=SEF.common,
{common:d,db:f}=SEF;var {utils:k}=SEF;const l=new k.Logger("NDC I/F"),{Contract:m,GenericResult:e}=d;let h=()=>null;const n={},g={MAX_HEAP:1572864,CONTRACT_EXPIRY:1E3,MAX_SIGNATURE_NAME_LENGTH:256,status:{STATUS_OK:0,scanner:{ERR_WASM_NOT_INIT:-90042,ERR_NULL_PARAM:-90043,ERR_INVALID_PARAM:-90044,ERR_PARAM_EMPTY:-90045,ERR_CONTENT_UPDATE_FAILURE:-90046}},enEventField:{SigID:1,Name:2,ResponseAction:16,ResponseFlags:17,CIDS_ThreatLevel:27},enEventAction:{ALLOW:1,BLOCK:2,TERMINATE:3,SAFELANDINGPAGE:4},
enResponseFlags:{None:0,Log:1,Submit:2,NotifyUser:8}};k={};for(let a in g.enEventField)k[g.enEventField[a].toString()]=a;k=Object.freeze(k);const p=g.status.scanner;class q{constructor(a=g.MAX_HEAP,b=0,c=!0){if(!q.instance){this.maxHeap=a;this.current=0;this.allowDynamicAlloc=c;this.isHeapInit=!1;this.allocType=b;this.pool=void 0;try{this.pool=_malloc(this.maxHeap),this.isHeapInit=!0}catch(x){if(l.error(`Error: Exception while pre-allocating heap: ${x.message}`),this.allowDynamicAlloc)this.allocType=
1;else throw x;}Object.defineProperty(q,"instance",{value:this,writable:!1})}return q.instance}get GetMaxHeap(){return this.maxHeap}WrapIfNeeded(a){return a>this.maxHeap-this.current?(this.current=0,!0):!1}AllocateString(a){if(!this.isHeapInit&&!this.allowDynamicAlloc)throw l.error("Error: No heap is preallocated and dynamic allocation is not allowed"),Error("No heap is preallocated and dynamic allocation is not allowed");if(a.length>this.maxHeap)throw l.error(`Error: Buffer too large to handle: ${a.length}`),
Error("Buffer too large to handle");const b=a.length+1;let c;this.WrapIfNeeded(b);this.isHeapInit?(c=this.pool+this.current,stringToUTF8(a,c,a.length+1),this.current+=b+(4-b%4)):(a=intArrayFromString(a),c=_malloc(a));return c}AllocateIntArray(a){if(!this.isHeapInit&&!this.allowDynamicAlloc)throw l.error("Error: No heap is preallocated and dynamic allocation is not allowed"),Error("No heap is preallocated and dynamic allocation is not allowed");if("number"!=typeof a&&!(a instanceof Uint32Array))throw Error('Invalid param "arrayOrSize". Must be an Uint32Array or a number');
const b=a instanceof Uint32Array?a.byteLength:a*Uint32Array.BYTES_PER_ELEMENT;if(0===b||b>this.maxHeap)throw l.error(`Requested allocation size <${b}> is invalid or too large to handle`),Error(`Requested allocation size <${b}> is invalid or too large to handle`);this.WrapIfNeeded(b);let c;this.isHeapInit?(c=this.pool+this.current,this.current+=b):c=_malloc(b);c&&a instanceof Uint32Array&&HEAPU32.set(a,c>>2);return c}MakeIntArray(a,b){return new Uint32Array(HEAPU8.buffer,a,b)}AllocateUInt8Array(a){if(!this.isHeapInit&&
!this.allowDynamicAlloc)throw l.error("Error: No heap is preallocated and dynamic allocation is not allowed"),Error("No heap is preallocated and dynamic allocation is not allowed");if("number"!=typeof a&&!(a instanceof Uint8Array))throw Error('Invalid param "arrayOrSize". Must be an Uint8Array or a number');const b=a instanceof Uint8Array?a.byteLength:a*Uint8Array.BYTES_PER_ELEMENT;if(0===b||b>this.maxHeap)throw l.error(`Requested allocation size <${b}> is invalid or too large to handle`),Error(`Requested allocation size <${b}> is invalid or too large to handle`);
this.WrapIfNeeded(b);let c;this.isHeapInit?(c=this.pool+this.current,this.current+=b):c=_malloc(b);c&&a instanceof Uint8Array&&HEAPU8.set(a,c);return c}MakeUInt8Array(a,b){return new Uint8Array(HEAPU8.buffer,a,b)}SetForceDynamicAllocation(a){a?(this.isHeapInit=!1,this.allowDynamicAlloc=!0,this.allocType=1):this.isHeapInit=!0}}n.MakeContractId=function(a,b,c){return`${a.toString()}:${b}:${c.toString()}`};n.ScanBuffer=()=>(new e(p.ERR_WASM_NOT_INIT,null,{error:"ScannerInterface not initialized"})).Set(Error("ScannerInterface not initialized"));
n.ScanBufferAsync=()=>m.reject(Error("Scanner not initialized"));n.ScanBufferOOB=()=>m.reject(Error("Scanner not initialized"));n.removeTab=()=>p.ERR_WASM_NOT_INIT;n.EndSession=()=>p.ERR_WASM_NOT_INIT;const r={};n._initFuture=(new Promise((a,d)=>{(Module||{}).onRuntimeInitialized=()=>{try{n.heapManager=new q;n.scanContracts={};SEF.context=SEF.context||{};SEF.constants.versionInfo={};_xapiSetLogLevel(1);const k=_xapiGetMaxEventsPerAlert(),v=a=>{SEF.context.ndcDefVer=a;SEF.bridge.portManager.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"CONFIG",
[SEF.constants.telePayloadKeys.NDC_DEF_VERSION]:a},SEF.config.Get("nativeMessasingAppId"));l.info(`NDC content version is updated to ${a}`)};n.ScanBufferAsync=(a,b,d,f,h,p,q={forceSingleton:!1})=>c(a)||c(b)||c(d)||c(f)||c(h)||c(p)?m.reject(Error("One or more null parameter to ScanBufferAsync")):new m((c,g)=>{setTimeout(()=>{try{const g=n.heapManager.AllocateString(a),l=n.heapManager.AllocateString(f),m=n.heapManager.AllocateIntArray(k),r=n.heapManager.MakeIntArray(m,k),v=q.forceSingleton?_xapiSubmitSingletonBuffer(d,
l,h,p,g,m,0,q.contentId):_xapiSubmitBuffer(d,l,h,p,g,m);c((new e(v,d,{url:b,frameId:h})).Set(r))}catch(M){l.error(`ScanBufferAsync exception: [${d}:${f}] (${M})`),g(M)}},0)},{contractId:n.MakeContractId(d,f,p),expiry:g.CONTRACT_EXPIRY});n.ScanBuffer=function(a,b,d,g,f,h,m={forceSingleton:!1}){if(c(a)||c(b)||c(d)||c(g)||c(f)||c(h))return(new e(-1,d,{error:Error("One or more parameters is null")})).Set([]);try{const c=this.heapManager.AllocateString(a),l=this.heapManager.AllocateString(g),n=this.heapManager.AllocateIntArray(k),
p=this.heapManager.MakeIntArray(n,k),q=m.forceSingleton?_xapiSubmitSingletonBuffer(d,l,f,h,c,n,0,m.contentId):_xapiSubmitBuffer(d,l,f,h,c,n);return(new e(q,d,{url:b,frameId:f})).Set(p)}catch(K){return l.error(`ScanBuffer exception: [${d}:${g}] (${K})`),(new e(-1,d,{error:K})).Set([])}};n.ScanBufferOOB=function(a,b,d,e,f,k){if(c(a)||c(b)||c(d)||c(e)||c(f)||c(k))return m.reject(Error("One or more null parameter to ScanBufferOOB"));const p={postMessage:function(a){setTimeout(a=>{this.onMessage(`{"tabId":"${a.tabId}","requestId":"${a.requestId}",`+
`"direction":"${a.direction}","status":"0","sigIds":["12","34","67"]}`)},100,a)},onMessage:a=>{a=JSON.parse(a);h(a.tabId,a.requestId,a.direction,a.status,a.sigIds)}},q={tabId:d,requestId:e,frameId:f,direction:k,buffer:a},r=this.MakeContractId(d,e,k);a=new m((a,b)=>{try{n.scanContracts[r]=[a,b],p.postMessage(q)}catch(y){l.error(`Error: ScanBufferOOB: postMessage error: ${y}`),b(y)}},{contractId:r,expiry:g.CONTRACT_EXPIRY});a.then(()=>{delete n.scanContracts[r]},()=>{delete n.scanContracts[r]});return a};
n.GetSigName=function(a){return b(a,g.enEventField.Name)};n.GetResponseAction=function(a){return b(a,g.enEventField.ResponseAction)};n.GetResponseFlags=function(a){const c=b(a,g.enEventField.ResponseFlags),d=c.map(a=>({None:a===g.enResponseFlags.None,Log:0!==(a&g.enResponseFlags.Log),Submit:0!==(a&g.enResponseFlags.Submit),NotifyUser:0!==(a&g.enResponseFlags.NotifyUser)}));d.length!==a.length&&l.error(`Failed to fetch ResponseFlags from metadata: ${c}`);return d};n.GetThreatLevel=function(a){return b(a,
g.enEventField.CIDS_ThreatLevel)};n.removeTab=(a,b)=>_xapiRemoveTab(a);n.EndSession=(a,b)=>{if(c(a)||c(b))return p.ERR_NULL_PARAM;b=n.heapManager.AllocateString(b);return _xapiEndSession(a,b)};r.AddSignatureExclusions=function(a){if(!(a instanceof Set))return p.ERR_INVALID_PARAM;if(0===a.size)return p.ERR_PARAM_EMPTY;const b=this.heapManager.AllocateIntArray(new Uint32Array(a));return _xapiAddSignatureExclusions(a.size,b)};r.RemoveSignatureExclusions=function(a){if(!(a instanceof Set))return p.ERR_INVALID_PARAM;
if(0===a.size)return p.ERR_PARAM_EMPTY;const b=this.heapManager.AllocateIntArray(new Uint32Array(a));return _xapiRemoveSignatureExclusions(a.size,b)};r.GetSignatureExclusions=function(){const a=_xapiGetSignatureExclusions(0);if(0===a)return new Uint32Array;const b=this.heapManager.AllocateIntArray(a);_xapiGetSignatureExclusions(b);return Uint32Array.from(this.heapManager.MakeIntArray(b,a))};r.UpdateContent=function(a){if(!(a&&a instanceof Uint8Array))return _xapiUpdateContent(0,0);let b=p.ERR_CONTENT_UPDATE_FAILURE,
c=null;try{c=_malloc(a.length),HEAPU8.set(a,c),b=_xapiUpdateContent(c,a.length)}catch(E){l.error(`Exception while xapiUpdateContent: ${E}`)}finally{c&&_free(c)}return b};r.SetupLastKnownGoodContent=function(){return(new f.DB("ndccontent.db")).Open({create:[{name:"content"},{name:"engine"}]}).then(a=>{if(a)return a.Query().Select().From("content").WherePrimaryKey().Are("blob","version").Run("SI").then(a=>{let b={blob:void 0,version:void 0};a.forEach(a=>{switch(a.key){case "blob":b.blob=a.value;break;
case "version":b.version=a.value}});return b}).catch(a=>{l.error(`Content fetch from DB failed : ${a}`)});throw Error("DB object not initialized");}).catch(a=>{l.error(`DBError: ${a} (using factory content)`)}).then(a=>{let b=r.UpdateContent(a.blob);void 0===a.blob?l.info(`No previous updated content found, update using the embedded one, ret: ${b}`):b!==g.status.STATUS_OK?(l.error(`Update content fails, ret: ${b}`),b=r.UpdateContent(),l.info(`Update using the embedded one, ret: ${b}`)):(l.info("Update using last known good one succeeds"),
v(a.version));return b}).catch(a=>{l.error(`Exception while updating content: ${a}`);return p.ERR_CONTENT_UPDATE_FAILURE})};n.UpdateContent=(a,b)=>SEF.context.ndcDefVer===b?(l.info(`Skip NDC content update, ${b}`),g.status.STATUS_OK):(new f.DB("ndccontent.db")).Open().then(c=>{if(!c)throw Error("NDC DB object not initialized");for(var d=a.length,e=new Uint8Array(d),f=0;f<d;f++)e[f]=a.charCodeAt(f);l.info(`NDC content size: ${e.byteLength}`);if(0!==e.byteLength&&r.UpdateContent(e)===g.status.STATUS_OK)return c.Query().Update(e).Into("content").As("blob").Run().then(()=>
{c.Query().Update(b).Into("content").As("version").Run().then(()=>{v(b)})}).catch(a=>{l.error(`NDC content db transaction error: ${a}`)}),g.status.STATUS_OK;l.error("NDC content update failed (using last known good content)");return r.SetupLastKnownGoodContent()}).catch(a=>{l.error(`NDC content update failed (using embedded content): ${a}`);return r.UpdateContent()});h=(a,b,c,d,g)=>{g=Array.isArray(g)?g:n.heapManager.MakeIntArray(g,k);b="string"===typeof b?b:UTF8ToString(b);d=(new e(d,a,{url:null})).Set(g);
a=n.MakeContractId(a,b,c);if(a in n.scanContracts)n.scanContracts[a][0](d)};addFunction(h,"viiiii");SEF._JSScope=_xapiScopedExecute;r.SetupLastKnownGoodContent().then(b=>{var c=n.heapManager.AllocateIntArray(4);c=n.heapManager.MakeIntArray(c,4);SEF.constants.versionInfo.NDC_VERSION_INFO={MAJOR:c[0],MINOR:c[1],PATCH:c[2],BUILD:c[3]};l.info(`NDC engine version: ${JSON.stringify(SEF.constants.versionInfo.NDC_VERSION_INFO)}`);b===g.status.STATUS_OK?a(r):d(Error(`Content init failed: ${b}`))})}catch(A){d(Error(`ScannerInterface runtime init failed: ${A.message}`))}}})).then(a=>
a).catch(a=>a);n.OnInitComplete=function(){return this._initFuture};return new class extends SEF.core.Module{constructor(){super({name:"NDC",version:"1.0.0",configurations:[{key:"state",value:SEF.constants.moduleStates.ENABLED,accessors:["persist"]}]});this.constants=Object.freeze({enEventAction:g.enEventAction})}Initialize(){return n.OnInitComplete().then(()=>!0)}ScanBuffer(...a){return n.ScanBuffer(...a)}ScanBufferAsync(...a){return n.ScanBufferAsync(...a)}ScanBufferOOB(...a){return n.ScanBufferOOB(...a)}GetResponseAction(...a){return n.GetResponseAction(...a)}GetResponseFlags(...a){return n.GetResponseFlags(...a)}GetSigName(...a){return n.GetSigName(...a)}GetThreatLevel(...a){return n.GetThreatLevel(...a)}removeTab(...a){return n.removeTab(...a)}EndSession(...a){return n.EndSession(...a)}UpdateContent(...a){return n.UpdateContent(...a)}ApplyConfigs(){}}})()})(this);(function(){(function(){function a(b,c,d,m,e){if(d>m)return-1;const f=Math.floor((d+m)/2),k=e(b[f],c);return 0===k?f:null===k?-1:0<k?a(b,c,d,f-1,e):a(b,c,f+1,m,e)}function b(a,c,d,m,e){if(0===a.length||d>m)return 0;const f=Math.floor((d+m)/2),k=e(a[f],c);let g=void 0;f+1<a.length&&(g=e(a[f+1],c));return 0===k||null===k?-1:0>k&&(0<g||void 0===g)?f+1:0<k?b(a,c,d,f-1,e):b(a,c,f+1,m,e)}const c=(a,b)=>a-b;class d extends Array{constructor(a=c,b=c,...d){super(...d);this.compareFn=a;this.matchFn=b}push(...a){a.forEach(a=>
{const c=b(this,a,0,this.length-1,this.compareFn);-1!==c&&this.splice(c,0,a)},this);return this.length}indexOf(b){return a(this,b,0,this.length-1,this.compareFn)}find(b){b=a(this,void 0,0,this.length-1,b);if(-1!==b)return this[b]}}SEF.utils.SortedArray=d;SEF.utils.searchIndexToInsert=b;SEF.utils.binarySearch=a;SEF.constants.FAILRETURN1=-1;SEF.constants.FAILRETURN2=void 0})()})(this);(function(){(function(){const {config:a,constants:b,common:c,utils:d}=SEF,f=new d.Logger("WEBPULSE"),{isNil:k,Contract:l}=c,m=["DomC","DirC","FileC"],e=["host","directory"];class h extends SEF.cache.Cache{Insert(a,b,d){return a?super.Insert(c.hash.SHA256(a),b,d):!1}InsertVolatile(a,b,d){return a?super.InsertVolatile(c.hash.SHA256(a),b,d):!1}Remove(a){return a?super.Remove(c.hash.SHA256(a)):!1}GetEx(a,b="GET"){a=this.ConductCachingKey(a,b);return super.GetEx(a.PathHash())||super.GetEx(a.DirectoryHash())||
super.GetEx(a.HostHash())}Get(a,b="GET"){a=this.ConductCachingKey(a,b);return super.Get(a.PathHash())||super.Get(a.DirectoryHash())||super.Get(a.HostHash())}ConductCachingKey(a,b=""){let d={host:"",directory:"",path:"",HostHash:void 0,DirectoryHash:void 0,PathHash:void 0};a=new URL(a);if(a.host.startsWith("www.")){let b=a.host.indexOf("www.");d.host=a.host.substring(b+4)}else d.host=a.host;d.host=b.concat(":",d.host);b=a.pathname.substring(a.pathname.lastIndexOf("/"));0<=b.indexOf(".")||"/"===b?d.directory=
d.host.concat([a.pathname.substring(0,a.pathname.lastIndexOf("/"))]):d.directory=d.host.concat(a.pathname);d.directory=d.directory.concat("/*");d.path=d.host.concat(a.pathname);d.HostHash=()=>c.hash.SHA256(d.host);d.DirectoryHash=()=>c.hash.SHA256(d.directory);d.PathHash=()=>c.hash.SHA256(d.path);return d}}class n{constructor(){var a="[0,16777215] [167772160,184549375] [2130706432,2147483647] [2886729728,2887778303] [2851995648,2852061183] [3232235520,3232301055] [3758096384,4294967295]".split(" ");
this.sortedArray=new d.SortedArray(c.Ipv4RangeMatcher.compareFn);for(const b of a)a=c.Ipv4RangeMatcher.CreateIpv4RangeMatcherFromIpv4Range(b),null!==a&&this.sortedArray.push(a)}IsExcludedIpv4(a){if(!c.url.isValid(a))return!1;a=new c.ParsedUrl(a);a=c.Ipv4RangeMatcher.Preprocess(a.hostname);return null===a?!1:this.sortedArray.find(c.Ipv4RangeMatcher.matchFn(a))?!0:!1}}return new class extends SEF.core.Module{constructor(){super({name:"webPulse",version:"1.0.0",configurations:[{key:"state",value:b.moduleStates.ENABLED,
accessors:["persist"]},{key:"allowUrlParams",value:!0,accessors:["persist"]},{key:"webPulseBasedConviction",value:!0,accessors:["persist"]},{key:"webPulseAllUrlsThrottle",value:b.WebPulseDefaults.ALL_URLS_THROTTLE,accessors:["persist"]},{key:"webPulseMaxLookups",value:b.WebPulseDefaults.MAX_LOOKUPS,accessors:["persist"]},{key:"webPulseLookupCounter",value:0,accessors:["persist"]},{key:"webPulseLookupCounterDate",value:"-",accessors:["persist"]},{key:"webPulseUrl",value:"https://sp.cwfservice.net",
accessors:["persist"]},{key:"webPulse-URI-Type",value:"2",accessors:["persist"]},{key:"webPulse-URI-Mode",value:"R",accessors:["persist"]},{key:"webPulse-URI-Vendor",value:"-",accessors:["persist"]},{key:"webPulse-URI-License",value:"-",accessors:["persist"]},{key:"webPulse-URI-Cache-hits",value:"-",accessors:["persist"]},{key:"webPulse-URI-Method",value:"GET",accessors:["persist"]}]});this.cache=new h("Reputation",b.CACHE_LIMIT,"db");this.cache.policy=SEF.cache.Cache.Policy.FIFO;this.ipv4LookupExclusion=
new n}ResolveUrl(a){a=new URL(this.config.Get("allowUrlParams")?a:c.url.PIIClean(a));const b=a.protocol.substring(0,a.protocol.length-1);let d=80;"https"===b&&(d=443);""!==a.port&&({port:d}=a);const e=a.pathname.substring(1,a.pathname.length);return{scheme:b,host:a.hostname,port:d,path:e,query:a.search,fragment:a.hash}}GetResetDateAux(a,b=0){60*a.getHours()+a.getMinutes()>540+b&&a.setDate(a.getDate()+1);return[a.getFullYear(),a.getMonth()+1,a.getDate()].join("-")}GetResetDate(a=0){return this.GetResetDateAux(new Date,
a)}ExceededDailyQuota(){const a=this.config.Get("webPulseMaxLookups");if(0===a)return!1;var b=parseInt(this.GetVendorId().slice(0,2),16),c=Math.floor(b/255*480);b=this.config.Get("webPulseLookupCounterDate");c=this.GetResetDate(c);b!==c&&(this.config.Set("webPulseLookupCounterDate",c),this.config.Set("webPulseLookupCounter",0));b=this.config.Get("webPulseLookupCounter");if(b>=a)return!0;this.config.Set("webPulseLookupCounter",b+1);return!1}GetVendorId(){var a=SEF.config.Get("sourceID").toUpperCase();
var b=this.config.Get("webPulse-URI-Vendor");if(""===a||!/^[0-9A-F]{32}$/.test(a))if(/^[0-9A-F]{32}$/.test(b))a=b;else{a="";b=new Uint8Array(16);rng_get_bytes(b);b=new Uint32Array(b.buffer);for(let c=0;c<b.length;c++)a+=b[c].toString(16).padStart(8,"0");a=a.toUpperCase();this.config.Set("webPulse-URI-Vendor",a)}return a}AllUrlLookupsEnabled(){const a=parseInt(this.GetVendorId().slice(0,2),16);return this.config.Get("webPulseAllUrlsThrottle")/100*255>a}GetWebPulseRequestHeaders(a){const b={};if("undefined"!==
typeof a.headers){var {headers:c}=a;const d="user-agent content-length content-type referer x-requested-with origin accept-language".split(" ");let e;for(e=0;e<c.length;e++)d.includes(c[e].name.toLowerCase())&&(b["X-Orig-".concat(c[e].name)]=c[e].value),"cookie"===c[e].name.toLowerCase()&&(b["X-Orig-".concat(c[e].name)]=this.SummarizeCookies(c[e].value));b["X-Orig-Header-List"]=c.map(a=>a.name).join(",")}"initiator"in a&&(b["X-BC-Virtual-Referer"]=a.initiator);"url"in a&&({fragment:c}=this.ResolveUrl(a.url),
b["X-URL-Has-Frag"]=""!==c);"requestId"in a&&(b["X-BC-Request-ID"]=a.requestId);"type"in a&&(b["X-BC-Request-Type"]=a.type);b["X-BC-Incog"]=chrome.extension.inIncognitoContext;b["X-BC-User-Agent"]="SEF.Web";a=SEF.config.Get("sourceID").toUpperCase();this.GetVendorId()!==a&&(b["X-BC-User-Agent"]+="-Standalone");b["X-BC-User-Agent"]+=`/${SEF.config.Get("productVersion")}`;return b}SummarizeCookies(a){let b="";a.split("; ").forEach(a=>{let [c,...d]=a.split("=");d=d.join("=");""!==b&&(b+="; ");b+=`${c}=${d.length}`});
return b}FetchReputation(c,d,f={}){if(a.Get("networkUsage")===b.networkUsage.NONE)return Promise.reject(Error("Network usage is disabled"));try{const a=this.cache.ConductCachingKey(c,d),b=this.GetVendorId(),{scheme:g,host:h,port:l,path:n,query:p}=this.ResolveUrl(c),q=[this.config.Get("webPulseUrl"),this.config.Get("webPulse-URI-Type"),this.config.Get("webPulse-URI-Mode"),b,this.config.Get("webPulse-URI-License"),this.config.Get("webPulse-URI-Cache-hits"),d,g,h,l,n].join("/")+(""!==p?p:"");let E,C,
G=0;const L=Date.now(),K=fetch(q,{headers:f}).then(a=>{if(!a.ok)throw Error(`Reputation response KO: ${a.status}`);return a}).then(a=>{({status:E,url:C}=a);const b=a.headers.get("cache-control");!k(b)&&0<=b.toLowerCase().indexOf("max-age")&&(G=parseInt(b.substring(b.toLowerCase().indexOf("=")+1,b.length),10));return a.text()}).then(b=>{var c=txml.simplify(txml.parse(b)).Result;const d=[];let f;for(b=0;b<m.length;b++){var g=m[b];if(g in c){c=c[g];c instanceof Array||(c=[c]);for(g=0;g<c.length;g++)f=
b,c[g].match(/.{2}/g).forEach(a=>{d.push(parseInt(a,16))});break}}b={type:"webpulse",categories:d,cacheLevel:f};if(0<G)switch(f){case 0:case 1:this.cache.Insert(a[e[f]],b,G);this.cache.Remove(a.path);break;default:this.cache.InsertVolatile(a.path,b,G)}else this.cache.Remove(a.path);b.status=E;b.responsed_url=C;return b}).then(a=>{a.eventTabIdSet=new Set;a.queryTimeMs=Date.now()-L;return a});this.cache.InsertVolatile(a.path,K);K.catch(()=>{this.cache.Remove(a.path)});return K}catch(r){return Promise.reject(r)}}GetReputation(a,
b=!1){var d=null;d=null;c.url.isValidHttp(a.url)?this.ipv4LookupExclusion.IsExcludedIpv4(a.url)?d=Promise.reject(Error(`URL is excluded ipv4: ${a.url}`,{cause:"excluded"})):a.url.startsWith(this.config.Get("webPulseUrl"))?d=Promise.reject(Error(`Don't perform recursive lookups on lookup query traffic: ${a.url}`,{cause:"excluded"})):(d=this.cache.GetEx(a.url,a.method),k(d)?this.ExceededDailyQuota()?d=Promise.reject(Error(`We exceeded maximum daily lookups. Ignoring: ${a.url}`,{cause:"excluded"})):
(d=this.GetWebPulseRequestHeaders(a),d=this.FetchReputation(a.url,a.method,d).then(c=>{b&&(c.eventTabIdSet.add(a.tabId),a.eventContext.reputationObject=c,SEF.eventing.reputationResult.onReputationResult.emit(a.eventContext));c.tabId=a.tabId;return c})):d instanceof Promise||d instanceof l?d=d.then(c=>{b&&!c.eventTabIdSet.has(a.tabId)&&(c.eventTabIdSet.add(a.tabId),a.eventContext.reputationObject=c,SEF.eventing.reputationResult.onReputationResult.emit(a.eventContext));c.tabId=a.tabId;return c}):(d.tabId=
a.tabId,d=Promise.resolve(d))):d=Promise.reject(Error(`Invalid URL: ${a.url}`));d.then(a=>{}).catch(a=>{"excluded"!==a.cause&&f.error(`[SEF.Web Error]: Error while reputation fetch: ${a}`)});return d}Initialize(){return{}}}})()})(this);(function(){(SEF.utils=SEF.utils||{}).OpState=function(){const a=new SEF.utils.Logger("OPSTATE");class b{static Malfunctioned(b=""){a.error(`Malfunctioned. Error: ${b}`);void 0!==SEF.bridge&&SEF.bridge.portManager.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"ERROR",[SEF.constants.teleKeys.PAYLOAD]:b},SEF.config.Get("nativeMessasingAppId"));return!0}}return b}()})(this);(function(){(function(){const a=new SEF.utils.Logger("SERVING"),{utils:b}=SEF;return new class extends SEF.core.Module{constructor(){super({name:"serving",version:"1.0"})}Initialize(){SEF.OnInitComplete().then(()=>new Promise(c=>{function d(f){if(0===f)a.info("giving up on waiting for policyOrchestrator"),c();else if(void 0!==SEF.policyOrchestrator&&SEF.policyOrchestrator.initstate){try{a.info("Sending halo to connector and starting service"),b.Message.resetKey(),SEF.bridge.portManager.Send({[SEF.constants.teleKeys.MESSAGE_TYPE]:"EHLO"},
SEF.config.Get("nativeMessasingAppId"))}catch(k){a.error(`Failed to send halo to connector: ${JSON.stringify(k)}`)}c()}else a.info("policyOrchestrator is not ready"),setTimeout(()=>{d(f-1)},1E3)}d(120)}));return!0}}})()})(this);(function(){(SEF.utils=SEF.utils||{}).Telemetry=function(){const {constants:a}=SEF;new SEF.utils.Logger("TELEMETRY");class b{static SendTelemetry(b){if(!SEF.config.Get("allowTelemetry"))return!1;b={[a.teleKeys.MESSAGE_TYPE]:"TELEMETRY",[a.teleKeys.BROWSER_VERSION]:SEF.common.GetBrowserVersion().version,[a.teleKeys.URL]:b.url,[a.teleKeys.SOURCE]:b.source,[a.teleKeys.SILENT]:b.silent,[a.teleKeys.EXCLUDED]:b.excluded,[a.teleKeys.ACTION]:b.action,[a.teleKeys.CATEGORY_IDS]:b.categoryIds,[a.teleKeys.THREAT_LEVEL]:b.threatLevel,
[a.teleKeys.SIG_ID]:b.sigId,[a.teleKeys.SIG_NAME]:b.sigName,[a.teleKeys.PAYLOAD]:JSON.stringify(b.payload),[a.teleKeys.LANGUAGE]:SEF.context.browserObject.i18n.getUILanguage(),[a.teleKeys.SUBMIT_ONLY]:b.submitOnly};SEF.bridge.portManager.Send(b,SEF.config.Get("nativeMessasingAppId"));return!0}}return b}()})(this);(function(){(function(){const {common:a,NDC:b,constants:c,utils:d}=SEF,f=new d.Logger("scanner");class k extends SEF.utils.Configs{constructor(){super("IdsFilter")}Set(a,b){a=Number(a);return isNaN(a)?null:super.Set(a,b)}Match(a){return super.Get(a)}}class l extends SEF.core.Plugin{constructor(){super({name:"scanner",version:"1.0.0",configurations:[{key:"state",value:c.moduleStates.DISABLED,accessors:["persist"]},{key:"asyncScan",value:!1,accessors:["persist"]},{key:"notify",value:!0,accessors:["persist"]},
{key:"fullNotifyMode",value:!0,accessors:["persist"]},{key:"submitOnlyEvents",value:!1,accessors:["persist"]}]});this.weight=c.consolPriorities.MEDIUM_LOW;this.idsFilter=new k}ProcessResult(a,b,c){if(a&&a.hasOwnProperty("sigIds")){var d=[],e=[],h=[],k=!1;for(const [,b]of Object.entries(a.sigIds))if(0!==b){const a=SEF.scanner.idsFilter.Match(b);k?void 0!==a&&a.cancel&&h.push(b):void 0===a||void 0!==a&&a.cancel?d.push(b):e.push(b)}else k||(k=!0);h.reverse();d=d.concat(h);if(0<d.length||0<e.length){h=
{cancel:!1};if(0<d.length){e=d;d=SEF.NDC.GetResponseAction(e);k=!1;for(var l of d)if(l===SEF.NDC.constants.enEventAction.BLOCK){k=!0;break}h.cancel=k;h.suppress=c?!1:!0}SEF.scanner.IsModuleSilent()&&(h.silent=!0);try{const d=SEF.NDC.GetSigName(e),f=SEF.NDC.GetThreatLevel(e),g=SEF.NDC.GetResponseFlags(e);b.incidents=[];for(l=0;l<e.length;l++){const k=e[l],m=SEF.scanner.idsFilter.Match(k);if(void 0===m&&SEF.scanner.config.Get("notify")||void 0!==m&&m.log){c={};c.url=a.optional.url;c.source="scanner";
c.silent=h.hasOwnProperty("silent");c.action=h;c.sigId=k;c.sigName=d[l];c.threatLevel=f[l];c.payload={[SEF.constants.telePayloadKeys.NDC_DEF_VERSION]:SEF.context.ndcDefVer};c.submitOnly=g[l].Submit&&!g[l].Log&&!g[l].NotifyUser;if(!SEF.scanner.config.Get("submitOnlyEvents")&&c.submitOnly)continue;b.incidents.push(c)}if(!SEF.scanner.config.Get("fullNotifyMode"))break}}catch(v){f.error(`Failed to map metadata, : ${v}`)}return h}}return{cancel:!1}}Initialize(){return Promise.all([this.idsFilter.OnInitComplete(),
b.OnInitComplete()]).then(()=>{const c={cancel:!1};this.webRequest.onBeforeSendHeaders.addListener(function(d){if(SEF.scanner.IsModuleDisabled()||-1===d.tabId)return c;if(d.requestHeaders){const {url:c,tabId:h,requestId:k,frameId:l,requestHeaders:m}=d;var {method:e}=d;d=0<=d.type.indexOf("main_frame")&&0===l;e=e.toUpperCase();var f=new a.ParsedUrl(c);({hostname:f}=f);const n=c.substr(c.indexOf(f)+f.length);let A=[`${e} ${n} HTTP/1.1`];m.forEach(({name:a,value:b})=>A.push(`${a}: ${b}`));A.push(`X-Request-Id: ${k}`);
A.push(`Host: ${f}`);["POST","PUT","PATCH","DELETE"].includes(e)&&A.push("Content-Length: 0");A=`${A.join("\r\n")}\r\n`;e=(SEF.scanner.config.Get("asyncScan")?b.ScanBufferAsync:b.ScanBuffer).bind(b)(A,c,h,k,l,0);return e instanceof a.Contract||e instanceof Promise?Promise.all([e.then((a,b)=>SEF.scanner.ProcessResult(a,this.detail,b)).catch(()=>({cancel:!1}))]).then(a=>a[0]):SEF.scanner.ProcessResult(e,this.detail,d)}return c},{urls:["<all_urls>"]},["requestHeaders","blocking"]);this.webRequest.onHeadersReceived.addListener(function(){return c},
{urls:["<all_urls>"]},["responseHeaders","blocking"]);this.webRequest.onCompleted.addListener(function(a){b.EndSession(a.tabId,a.requestId)},{urls:["<all_urls>"]});this.webContent.onScript.addListener(function(d){if(SEF.scanner.IsModuleDisabled())return c;var e=new a.ParsedUrl(d.url);b.ScanBuffer(`GET ${e.pathname} HTTP/1.1\r\nHOST: ${e.host}\r\n\r\n`,d.url,d.tabId,d.requestId,d.frameId,0);e=b.ScanBuffer("HTTP/1.1 200 OK\r\ncontent-type: application/javascript\r\n"+`content-length: ${d.buffer.length}\r\n\r\n${d.buffer}`,
d.url,d.tabId,d.requestId,d.frameId,1);b.EndSession(d.tabId,d.requestId);return SEF.scanner.ProcessResult(e,this.detail,!0)});SEF.context.browserObject.tabs.onRemoved.addListener(function(a,c){b.removeTab(a,c)});return!0})}}return new l})()})(this);(function(){(function(){function a(a){var {accessFilter:b}=SEF;let c={cancel:!1};return b.IsModuleDisabled()?c:(b=b.ztFilter.Match(a.requestHeaders))&&b.accessControl?(a.requestHeaders.push({name:SEF.config.Get("httpHeaderNameSourceId"),value:SEF.config.Get("sourceID")}),{requestHeaders:a.requestHeaders}):c}const {utils:b,exceptions:c,constants:d}=SEF,{ValidationError:f}=c,k=new b.Logger("accessFilter");class l extends SEF.utils.Configs{constructor(){super("ZeroTrustFilter");this.filters=new Map;
this.OnInitComplete().then(()=>{this._Load()})}_Load(){for(const a of super.Keys())this.filters.set(a,super.Get(a))}Set(a,b){if(!b||b&&"boolean"!==typeof b.accessControl)throw new f(`Invalid value type <${typeof b.accessControl}>, `+"expecting Boolean");this.filters.set(a,b);return super.Set(a,b)}Match(a){if(a)try{for(const [b,c]of this.filters.entries()){const [d,e]=b.split("=");for(const b of a)if(d.toLowerCase()===b.name.toLowerCase()){if(!e||e&&e.toLowerCase()===b.value.toLowerCase())return c;
break}}}catch(h){k.error(`Match zero trust filter rule error: ${h}`)}}Clear(){this.filters.clear();super.Clear()}}class m extends SEF.core.Plugin{constructor(){super({name:"accessFilter",version:"1.0.0",configurations:[{key:"state",value:d.moduleStates.DISABLED,accessors:["persist"]}]});this.ztFilter=new l}Initialize(){return Promise.all([this.ztFilter.OnInitComplete()]).then(()=>{this.webRequest.onBeforeSendHeaders.addListener(a,{urls:["<all_urls>"]},["requestHeaders","extraHeaders"]);return!0})}}
return new m})()})(this);(function(){(function(){function a(a,b){this.engine="WebPulse";const c=new f.ParsedUrl(a.url);var d=0<=a.type.indexOf("main_frame")&&0===a.frameId;const {webFilter:g}=SEF;var h={cancel:!1};if(g.IsModuleDisabled())return h;const k=(c,d,f,h=[])=>{b===q.OnReputationResult&&5E3<a.reputationObject.queryTimeMs&&(c.suppress=!0);if(!1===c.cancel&&"HID"!==f)return c;g.IsModuleSilent()&&(c={...c,silent:!0});const k={};k.url=d;k.source=`webFilter@${f.toLowerCase()}Filter`;k.silent=c.silent||!1;k.action=c;k.categoryIds=
h;switch(f){case "IPV4":case "URL":k.sigId=e.sigInfo.RULE_BASED_SIG_ID;k.sigName=e.sigInfo.RULE_BASED_SIG_NAME;k.threatLevel=e.sigInfo.RULE_BASED_THREAT_LEVEL;break;case "CATEGORY":case "HID":k.sigId=e.sigInfo.WEBPULSE_BASED_SIG_ID;k.sigName=e.sigInfo.WEBPULSE_BASED_SIG_NAME;k.threatLevel=e.sigInfo.WEBPULSE_BASED_THREAT_LEVEL;break;default:throw Error(`Found unsupported filter type ${f}`);}this.detail.incidents=[k];return c};if(b!==q.OnReputationResult){var m=c.href;e.URL_MAX_LENGTH<m.length&&(m=
m.substring(0,e.URL_MAX_LENGTH));if(m=g.urlFilter.Match(m))return m.suppress=d?!1:!0,k(m,c,"URL");if(m=g.ipv4Filter.Match(c.hostname))return m.suppress=d?!1:!0,k(m,c,"IPV4")}if(l.IsModuleDisabled()||!l.config.Get("webPulseBasedConviction"))return h;if(d||l.AllUrlLookupsEnabled())if(m=null,b!==q.OnReputationResult?(m=l.cache.Get(a.url,a.method),null===m&&b===q.OnBeforeSendHeaders&&(l.GetReputation({url:a.url,method:a.method,headers:a.requestHeaders,eventContext:a,tabId:a.tabId,isMainFrame:d,Method:a.method,
BrowserURL:a.documentUrl,ReferrerURL:a.originUrl,initiator:a.initiator,requestId:a.requestId,type:a.type},!0),m=l.cache.Get(a.url,a.method))):m=a.reputationObject,m){this.detail.result=m;var n=g.categoryExclusion.Match(m.categories);d=g.categoryFilter.Match(n);n=g.urlInspectorFilter.Match(n);n=g.hidFilter.Match(n);if(d||n){h=p.Rank(d);const a=p.Rank(n);let b="CATEGORY";h<a&&(d=n,b="HID");return k(d,c,b,m.categories)}}return h}function b(b){return a.bind(this)(b,q.OnBeforeSendHeaders)}function c(b){return a.bind(this)(b,
q.OnHeadersReceived)}function d(b){return a.bind(this)(b,q.OnReputationResult)}const {common:f,utils:k,webPulse:l,exceptions:m,constants:e}=SEF,{ValidationError:h,UnsupportedError:n}=m,g=new k.Logger("webFilter");class p{static get Schema(){return{cancel:{supported:!0,type:"boolean",rank(a){return a?1E3:100}},redirectUrl:{supported:!0,type:"string",rank:()=>900},isolationUrl:{supported:!0,type:"string",rank:()=>800},upgradeToSecure:{supported:!1,type:"boolean",rank:()=>700},authCredentials:{supported:!1,
type:"object",rank:()=>600},requestHeaders:{supported:!1,type:"object",rank:()=>500},responseHeaders:{supported:!0,type:"object",rank:()=>400}}}static Validate(a){if(!a)throw new h("null action");a=Object.entries(a);let b="",c="";if(1!==a.length){let d=!1;if(2!==a.length)throw new h("Multiple actions are not supported");for(const [e,f]of a)"silent"===e?d=!0:(b=e,c=f);if(!d)throw new h("The second action is not silent");}else[[b,c]]=a;if(!p.Schema.hasOwnProperty(b)||!1===p.Schema[b].supported)throw new n(`Action <${b}> is not supported.`);
if(typeof c!==p.Schema[b].type)throw new h(`Invalid value type <${typeof c}>, `+`expecting <${p.Schema[b].type}>`);}static Rank(a){if(a){a.hasOwnProperty("silent")&&(a={...a},delete a.silent);const [[b,c]]=Object.entries(a);return p.Schema[b].rank(c)}return 0}}const q={OnBeforeSendHeaders:0,OnHeadersReceived:1,OnReputationResult:2};class r extends SEF.utils.Configs{constructor(){super("UrlFilter");this.filters=new Map;super.OnInitComplete().then(()=>{this._Load()})}_Load(){for(const a of super.Keys()){let b=
f.UrlMatcher.CreateUrlMatcher(a);null!==b&&(b.action=super.Get(a),this.filters.set(b.url,b))}}Match(a){let b=0,c={action:void 0};for(const [,d]of this.filters.entries()){const e=d.Match(a);e>b&&(b=e,c=d)}return c.action}Set(a,b){if(!b)return null;let c=f.UrlMatcher.CreateUrlMatcher(a);if(null===c)return null;p.Validate(b);c.action=b;this.filters.set(a,c);return super.Set(a,b)}Delete(a){this.filters.delete(a);return super.Delete(a)}Clear(){this.filters.clear();super.Clear()}}class v extends SEF.utils.Configs{constructor(){super("Ipv4RangeFilter");
this.sortedArray=new k.SortedArray(f.Ipv4RangeMatcher.compareFn);super.OnInitComplete().then(()=>{this._Load()})}_Load(){for(const a of super.Keys()){const b=f.Ipv4RangeMatcher.CreateIpv4RangeMatcherFromIpv4Range(a.substring(6));null!==b&&(b.action=super.Get(`range:${a}`),this.sortedArray.push(b))}}Match(a){let b={action:void 0};a=f.Ipv4RangeMatcher.Preprocess(a);if(null===a)return b.action;(a=this.sortedArray.find(f.Ipv4RangeMatcher.matchFn(a)))&&(b=a);return b.action}Set(a,b){if(!b)return null;
const c=f.Ipv4RangeMatcher.CreateIpv4RangeMatcherFromIpv4Range(a);if(null===c)return null;p.Validate(b);c.action=b;this.sortedArray.push(c);return super.Set(`range:${a}`,b)}Get(a){return super.Get(`range:${a}`)}Delete(a){const b=f.Ipv4RangeMatcher.CreateIpv4RangeMatcherFromIpv4Range(a);this.sortedArray.splice(this.sortedArray.indexOf(b),1);return super.Delete(`range:${a}`)}Clear(){this.sortedArray.splice(0,this.sortedArray.length);super.Clear()}}class u extends SEF.utils.Configs{constructor(){super("CategoryFilter")}Set(a,
b){if(!b)return null;a=Number(a);p.Validate(b);return super.Set(a,b)}Match(a){let b=void 0,c=p.Rank(b);for(const d of a){a=super.Get(d);const e=p.Rank(a);e>c&&(b=a,c=e)}return b}}class A extends SEF.utils.Configs{constructor(){super("HidFilter");this.filters={};this.OnInitComplete().then(()=>{this._Load()})}_Load(){for(const a of super.Keys())Object.assign(this.filters,super.Get(a))}Set(a,b){this.filters=b;return super.Set(a,b)}Match(a){if(void 0!==this.filters.ConvictionLevel&&a<=this.filters.ConvictionLevel)return{cancel:!0};
if(void 0!==this.filters.LoggingLevel&&a<=this.filters.LoggingLevel)return{cancel:!1}}Clear(){this.filters={};super.Clear()}}class x extends SEF.utils.Configs{constructor(){super("UrlInspectorFilter");this.filters={};this.MAX_HID_LEVEL=500;this.OnInitComplete().then(()=>{this._Load()})}_Load(){for(const a of super.Keys())Object.assign(this.filters,super.Get(a))}Set(a,b){this.filters=b;return super.Set(a,b)}Match(a){let b=this.MAX_HID_LEVEL+1;for(const c of a)void 0!==this.filters.categoryLevels&&
this.filters.categoryLevels.hasOwnProperty(c)&&(b=Math.min(this.filters.categoryLevels[c],b));return b}Clear(){this.filters={};super.Clear()}}class B extends SEF.utils.Configs{constructor(){super("CategoryExclusion")}Set(a,b){super.Set(Number(a),b.categories)}Match(a){let b=[];for(const c of a)if(super.Keys().includes(c)){let d=!1;for(const b of super.Get(c))if(a.includes(b)){g.info(`Category exclusion met. ${c} will redirect to ${b}`);d=!0;break}d||b.push(c)}else b.push(c);return b}Clear(){super.Clear()}}
class I extends SEF.core.Plugin{constructor(){super({name:"webFilter",version:"1.0.0",configurations:[{key:"state",value:e.moduleStates.DISABLED,accessors:["persist"]}]});this.weight=e.consolPriorities.HIGH_MEDIUM;this.urlFilter=new r;this.ipv4Filter=new v;this.categoryFilter=new u;this.hidFilter=new A;this.urlInspectorFilter=new x;this.categoryExclusion=new B}Initialize(){return Promise.all([this.urlFilter.OnInitComplete(),this.ipv4Filter.OnInitComplete(),this.categoryFilter.OnInitComplete(),this.hidFilter.OnInitComplete(),
this.urlInspectorFilter.OnInitComplete(),this.categoryExclusion.OnInitComplete()]).then(()=>{this.webRequest.onBeforeSendHeaders.addListener(b,{urls:["<all_urls>"]},["requestHeaders","blocking","extraHeaders"]);this.webRequest.onHeadersReceived.addListener(c,{urls:["<all_urls>"]},["responseHeaders","blocking"]);this.reputationResult.onReputationResult.addListener(d);return!0})}}return new I})()})(this);(function(a){var b=new SEF.utils.Logger("MAIN");a=(window.browser||window.chrome).runtime.getManifest();SEF.Initialize({productName:a.short_name,productVersion:a.version,partnerKey:"785e8a8ddd1940c689e4b058575be1f6de659fc65b27433282c30437bd562645"}).then(()=>{b.info(`SEF ${SEF.version} initialized succesfully`)}).catch(a=>{a=`SEF init failed: ${a}`;b.error(a);SEF.utils.OpState.Malfunctioned(a)})})(this);
